var Prototype={Version:"1.7",Browser:(function(){var b=navigator.userAgent;var a=Object.prototype.toString.call(window.opera)=="[object Opera]";var d=/MSIE\s([\d.]+)/.exec(b);var c=(d&&d.length>1)?parseInt(d[1]):NaN;return{IE:!!window.attachEvent&&!a,Opera:a,WebKit:b.indexOf("AppleWebKit/")>-1,Gecko:b.indexOf("Gecko")>-1&&b.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(b),IEV:c}})(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){var a=window.Element||window.HTMLElement;return !!(a&&a.prototype)})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement!=="undefined"){return true}var c=document.createElement("div"),b=document.createElement("form"),a=false;if(c.__proto__&&(c.__proto__!==b.__proto__)){a=true}c=b=null;return a})()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",TemplateScriptFilter:/<script type="text\/template"/i,JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(a){return a}};if(Prototype.Browser.MobileSafari){Prototype.BrowserFeatures.SpecificElementExtensions=false}var Abstract={};var Try={these:function(){var c;for(var b=0,d=arguments.length;b<d;b++){var a=arguments[b];try{c=a();break}catch(f){}}return c}};var Class=(function(){var d=(function(){for(var e in {toString:1}){if(e==="toString"){return false}}return true})();function a(){}function b(){var h=null,g=$A(arguments);if(Object.isFunction(g[0])){h=g.shift()}function e(){this.initialize.apply(this,arguments)}Object.extend(e,Class.Methods);e.superclass=h;e.subclasses=[];if(h){a.prototype=h.prototype;e.prototype=new a;h.subclasses.push(e)}for(var f=0,j=g.length;f<j;f++){e.addMethods(g[f])}if(!e.prototype.initialize){e.prototype.initialize=Prototype.emptyFunction}e.prototype.constructor=e;return e}function c(l){var g=this.superclass&&this.superclass.prototype,f=Object.keys(l);if(d){if(l.toString!=Object.prototype.toString){f.push("toString")}if(l.valueOf!=Object.prototype.valueOf){f.push("valueOf")}}for(var e=0,h=f.length;e<h;e++){var k=f[e],j=l[k];if(g&&Object.isFunction(j)&&j.argumentNames()[0]=="$super"){var m=j;j=(function(n){return function(){return g[n].apply(this,arguments)}})(k).wrap(m);j.valueOf=m.valueOf.bind(m);j.toString=m.toString.bind(m)}this.prototype[k]=j}return this}return{create:b,Methods:{addMethods:c}}})();(function(){var D=Object.prototype.toString,C="Null",p="Undefined",w="Boolean",f="Number",t="String",I="Object",u="[object Function]",z="[object Boolean]",g="[object Number]",m="[object String]",h="[object Array]",y="[object Date]",j=window.JSON&&typeof JSON.stringify==="function"&&JSON.stringify(0)==="0"&&typeof JSON.stringify(Prototype.K)==="undefined";function l(K){switch(K){case null:return C;case (void 0):return p}var J=typeof K;switch(J){case"boolean":return w;case"number":return f;case"string":return t}return I}function A(J,L){for(var K in L){J[K]=L[K]}return J}function H(J){try{if(c(J)){return"undefined"}if(J===null){return"null"}return J.inspect?J.inspect():String(J)}catch(K){if(K instanceof RangeError){return"..."}throw K}}function E(J){return G("",{"":J},[])}function G(S,P,Q){var R=P[S],O=typeof R;if(l(R)===I&&typeof R.toJSON==="function"){R=R.toJSON(S)}var L=D.call(R);switch(L){case g:case z:case m:R=R.valueOf()}switch(R){case null:return"null";case true:return"true";case false:return"false"}O=typeof R;switch(O){case"string":return R.inspect(true);case"number":return isFinite(R)?String(R):"null";case"object":for(var K=0,J=Q.length;K<J;K++){if(Q[K]===R){throw new TypeError()}}Q.push(R);var N=[];if(L===h){for(var K=0,J=R.length;K<J;K++){var M=G(K,R,Q);N.push(typeof M==="undefined"?"null":M)}N="["+N.join(",")+"]"}else{var U=Object.keys(R);for(var K=0,J=U.length;K<J;K++){var S=U[K],M=G(S,R,Q);if(typeof M!=="undefined"){N.push(S.inspect(true)+":"+M)}}N="{"+N.join(",")+"}"}Q.pop();return N}}function x(J){return JSON.stringify(J)}function k(J){return $H(J).toQueryString()}function q(J){return J&&J.toHTML?J.toHTML():String.interpret(J)}function s(J){if(l(J)!==I){throw new TypeError()}var K=[];for(var L in J){if(J.hasOwnProperty(L)){K.push(L)}}return K}function d(J){var K=[];for(var L in J){K.push(J[L])}return K}function B(J){return A({},J)}function v(J){return !!(J&&J.nodeType==1)}function n(J){return D.call(J)===h}var b=(typeof Array.isArray=="function")&&Array.isArray([])&&!Array.isArray({});if(b){n=Array.isArray}function e(J){return J instanceof Hash}function a(J){return D.call(J)===u}function o(J){return D.call(J)===m}function r(J){return D.call(J)===g}function F(J){return D.call(J)===y}function c(J){return typeof J==="undefined"}A(Object,{extend:A,inspect:H,toJSON:j?x:E,toQueryString:k,toHTML:q,keys:Object.keys||s,values:d,clone:B,isElement:v,isArray:n,isHash:e,isFunction:a,isString:o,isNumber:r,isDate:F,isUndefined:c})})();Object.extend(Function.prototype,(function(){var l=Array.prototype.slice;function d(p,m){var o=p.length,n=m.length;while(n--){p[o+n]=m[n]}return p}function j(n,m){n=l.call(n,0);return d(n,m)}function g(){var m=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return m.length==1&&!m[0]?[]:m}function h(o){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var m=this,n=l.call(arguments,1);return function(){var p=j(n,arguments);return m.apply(o,p)}}function f(o){var m=this,n=l.call(arguments,1);return function(q){var p=d([q||window.event],n);return m.apply(o,p)}}function k(){if(!arguments.length){return this}var m=this,n=l.call(arguments,0);return function(){var o=j(n,arguments);return m.apply(this,o)}}function e(o){var m=this,n=l.call(arguments,1);o=o*1000;return window.setTimeout(function(){return m.apply(m,n)},o)}function a(){var m=d([0.01],arguments);return this.delay.apply(this,m)}function c(n){var m=this;return function(){var o=d([m.bind(this)],arguments);return n.apply(this,o)}}function b(){if(this._methodized){return this._methodized}var m=this;return this._methodized=function(){var n=d([this],arguments);return m.apply(null,n)}}return{argumentNames:g,bind:h,bindAsEventListener:f,curry:k,delay:e,defer:a,wrap:c,methodize:b}})());(function(c){function b(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function a(){return this.toISOString()}if(!c.toISOString){c.toISOString=b}if(!c.toJSON){c.toJSON=a}})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(b,a){this.callback=b;this.frequency=a;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},execute:function(){this.callback(this)},stop:function(){if(!this.timer){return}clearInterval(this.timer);this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false}catch(a){this.currentlyExecuting=false;throw a}}}});Object.extend(String,{interpret:function(a){return a==null?"":String(a)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});Object.extend(String.prototype,(function(){var NATIVE_JSON_PARSE_SUPPORT=window.JSON&&typeof JSON.parse==="function"&&JSON.parse('{"test": true}').test;function prepareReplacement(replacement){if(Object.isFunction(replacement)){return replacement}var template=new Template(replacement);return function(match){return template.evaluate(match)}}function gsub(pattern,replacement){var result="",source=this,match;replacement=prepareReplacement(replacement);if(Object.isString(pattern)){pattern=RegExp.escape(pattern)}if(!(pattern.length||pattern.source)){replacement=replacement("");return replacement+source.split("").join(replacement)+replacement}while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length)}else{result+=source,source=""}}return result}function sub(pattern,replacement,count){replacement=prepareReplacement(replacement);count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match){if(--count<0){return match[0]}return replacement(match)})}function scan(pattern,iterator){this.gsub(pattern,iterator);return String(this)}function truncate(length,truncation){length=length||30;truncation=Object.isUndefined(truncation)?"...":truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this)}function strip(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function extractScripts(){var matchAll=new RegExp(Prototype.ScriptFragment,"img"),matchOne=new RegExp(Prototype.ScriptFragment,"im");return(this.match(matchAll)||[]).map(function(scriptTag){if(!Prototype.TemplateScriptFilter.match(scriptTag)){return(scriptTag.match(matchOne)||["",""])[1]}})}function evalScripts(){return this.extractScripts().map(function(script){return eval(script)})}function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function unescapeHTML(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function toQueryParams(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match){return{}}return match[1].split(separator||"&").inject({},function(hash,pair){if((pair=pair.split("="))[0]){var key=decodeURIComponent(pair.shift()),value=pair.length>1?pair.join("="):pair[0];if(value!=undefined){value=decodeURIComponent(value)}if(key in hash){if(!Object.isArray(hash[key])){hash[key]=[hash[key]]}hash[key].push(value)}else{hash[key]=value}}return hash})}function toArray(){return this.split("")}function succ(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function times(count){return count<1?"":new Array(count+1).join(this)}function camelize(){return this.replace(/-+(.)?/g,function(match,chr){return chr?chr.toUpperCase():""})}function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function underscore(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function dasherize(){return this.replace(/_/g,"-")}function inspect(useDoubleQuotes){var escapedString=this.replace(/[\x00-\x1f\\]/g,function(character){if(character in String.specialChar){return String.specialChar[character]}return"\\u00"+character.charCodeAt().toPaddedString(2,16)});if(useDoubleQuotes){return'"'+escapedString.replace(/"/g,'\\"')+'"'}return"'"+escapedString.replace(/'/g,"\\'")+"'"}function unfilterJSON(filter){return this.replace(filter||Prototype.JSONFilter,"$1")}function isJSON(){var str=this;if(str.blank()){return false}str=str.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@");str=str.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");str=str.replace(/(?:^|:|,)(?:\s*\[)+/g,"");return(/^[\],:{}\s]*$/).test(str)}function evalJSON(sanitize){var json=this.unfilterJSON(),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(cx.test(json)){json=json.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())}function parseJSON(){var json=this.unfilterJSON();return JSON.parse(json)}function include(pattern){return this.indexOf(pattern)>-1}function startsWith(pattern){return this.lastIndexOf(pattern,0)===0}function endsWith(pattern){var d=this.length-pattern.length;return d>=0&&this.indexOf(pattern,d)===d}function empty(){return this==""}function blank(){return/^\s*$/.test(this)}function interpolate(object,pattern){return new Template(this,pattern).evaluate(object)}return{gsub:gsub,sub:sub,scan:scan,truncate:truncate,strip:String.prototype.trim||strip,stripTags:stripTags,stripScripts:stripScripts,extractScripts:extractScripts,evalScripts:evalScripts,escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,toQueryParams:toQueryParams,parseQuery:toQueryParams,toArray:toArray,succ:succ,times:times,camelize:camelize,capitalize:capitalize,underscore:underscore,dasherize:dasherize,inspect:inspect,unfilterJSON:unfilterJSON,isJSON:isJSON,evalJSON:NATIVE_JSON_PARSE_SUPPORT?parseJSON:evalJSON,include:include,startsWith:startsWith,endsWith:endsWith,empty:empty,blank:blank,interpolate:interpolate}})());var Template=Class.create({initialize:function(a,b){this.template=a.toString();this.pattern=b||Template.Pattern},evaluate:function(a){if(a&&Object.isFunction(a.toTemplateReplacements)){a=a.toTemplateReplacements()}return this.template.gsub(this.pattern,function(d){if(a==null){return(d[1]+"")}var f=d[1]||"";if(f=="\\"){return d[2]}var b=a,g=d[3],e=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;d=e.exec(g);if(d==null){return f}while(d!=null){var c=d[1].startsWith("[")?d[2].replace(/\\\\]/g,"]"):d[1];b=b[c];if(null==b||""==d[3]){break}g=g.substring("["==d[3]?d[1].length:d[0].length);d=e.exec(g)}return f+String.interpret(b)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable=(function(){function c(z,y){var x=0;try{this._each(function(B){z.call(y,B,x++)})}catch(A){if(A!=$break){throw A}}return this}function s(A,z,y){var x=-A,B=[],C=this.toArray();if(A<1){return C}while((x+=A)<C.length){B.push(C.slice(x,x+A))}return B.collect(z,y)}function b(z,y){z=z||Prototype.K;var x=true;this.each(function(B,A){x=x&&!!z.call(y,B,A);if(!x){throw $break}});return x}function j(z,y){z=z||Prototype.K;var x=false;this.each(function(B,A){if(x=!!z.call(y,B,A)){throw $break}});return x}function k(z,y){z=z||Prototype.K;var x=[];this.each(function(B,A){x.push(z.call(y,B,A))});return x}function u(z,y){var x;this.each(function(B,A){if(z.call(y,B,A)){x=B;throw $break}});return x}function h(z,y){var x=[];this.each(function(B,A){if(z.call(y,B,A)){x.push(B)}});return x}function g(A,z,y){z=z||Prototype.K;var x=[];if(Object.isString(A)){A=new RegExp(RegExp.escape(A))}this.each(function(C,B){if(A.match(C)){x.push(z.call(y,C,B))}});return x}function a(x){if(Object.isFunction(this.indexOf)){if(this.indexOf(x)!=-1){return true}}var y=false;this.each(function(z){if(z==x){y=true;throw $break}});return y}function r(y,x){x=Object.isUndefined(x)?null:x;return this.eachSlice(y,function(z){while(z.length<y){z.push(x)}return z})}function m(x,z,y){this.each(function(B,A){x=z.call(y,x,B,A)});return x}function w(y){var x=$A(arguments).slice(1);return this.map(function(z){return z[y].apply(z,x)})}function q(z,y){z=z||Prototype.K;var x;this.each(function(B,A){B=z.call(y,B,A);if(x==null||B>=x){x=B}});return x}function o(z,y){z=z||Prototype.K;var x;this.each(function(B,A){B=z.call(y,B,A);if(x==null||B<x){x=B}});return x}function e(A,y){A=A||Prototype.K;var z=[],x=[];this.each(function(C,B){(A.call(y,C,B)?z:x).push(C)});return[z,x]}function f(y){var x=[];this.each(function(z){x.push(z[y])});return x}function d(z,y){var x=[];this.each(function(B,A){if(!z.call(y,B,A)){x.push(B)}});return x}function n(y,x){return this.map(function(A,z){return{value:A,criteria:y.call(x,A,z)}}).sort(function(C,B){var A=C.criteria,z=B.criteria;return A<z?-1:A>z?1:0}).pluck("value")}function p(){return this.map()}function t(){var y=Prototype.K,x=$A(arguments);if(Object.isFunction(x.last())){y=x.pop()}var z=[this].concat(x).map($A);return this.map(function(B,A){return y(z.pluck(A))})}function l(){return this.toArray().length}function v(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:c,eachSlice:s,all:b,every:b,any:j,some:j,collect:k,map:k,detect:u,findAll:h,select:h,filter:h,grep:g,include:a,member:a,inGroupsOf:r,inject:m,invoke:w,max:q,min:o,partition:e,pluck:f,reject:d,sortBy:n,toArray:p,entries:p,zip:t,size:l,inspect:v,find:u}})();function $A(c){if(!c){return[]}if("toArray" in Object(c)){return c.toArray()}var b=c.length||0,a=new Array(b);while(b--){a[b]=c[b]}return a}function $w(a){if(!Object.isString(a)){return[]}a=a.strip();return a?a.split(/\s+/):[]}Array.from=$A;(function(){var s=Array.prototype,n=s.slice,p=s.forEach;function b(x,w){for(var v=0,y=this.length>>>0;v<y;v++){if(v in this){x.call(w,this[v],v,this)}}}if(!p){p=b}function m(){this.length=0;return this}function d(){return this[0]}function g(){return this[this.length-1]}function j(){return this.select(function(v){return v!=null})}function u(){return this.inject([],function(w,v){if(Object.isArray(v)){return w.concat(v.flatten())}w.push(v);return w})}function h(){var v=n.call(arguments,0);return this.select(function(w){return !v.include(w)})}function f(v){return(v===false?this.toArray():this)._reverse()}function l(v){return this.inject([],function(y,x,w){if(0==w||(v?y.last()!=x:!y.include(x))){y.push(x)}return y})}function q(v){return this.uniq().findAll(function(w){return v.detect(function(x){return w===x})})}function r(){return n.call(this,0)}function k(){return this.length}function t(){return"["+this.map(Object.inspect).join(", ")+"]"}function a(x,v){v||(v=0);var w=this.length;if(v<0){v=w+v}for(;v<w;v++){if(this[v]===x){return v}}return -1}function o(w,v){v=isNaN(v)?this.length:(v<0?this.length+v:v)+1;var x=this.slice(0,v).reverse().indexOf(w);return(x<0)?x:v-x-1}function c(){var A=n.call(this,0),y;for(var w=0,x=arguments.length;w<x;w++){y=arguments[w];if(Object.isArray(y)&&!("callee" in y)){for(var v=0,z=y.length;v<z;v++){A.push(y[v])}}else{A.push(y)}}return A}Object.extend(s,Enumerable);if(!s._reverse){s._reverse=s.reverse}Object.extend(s,{_each:p,clear:m,first:d,last:g,compact:j,flatten:u,without:h,reverse:f,uniq:l,intersect:q,clone:r,toArray:r,size:k,inspect:t});var e=(function(){return[].concat(arguments)[0][0]!==1})(1,2);if(e){s.concat=c}if(!s.indexOf){s.indexOf=a}if(!s.lastIndexOf){s.lastIndexOf=o}})();function $H(a){return new Hash(a)}var Hash=Class.create(Enumerable,(function(){function e(q){this._object=Object.isHash(q)?q.toObject():Object.clone(q)}function f(r){for(var q in this._object){var s=this._object[q],t=[q,s];t.key=q;t.value=s;r(t)}}function k(q,r){return this._object[q]=r}function c(q){if(this._object[q]!==Object.prototype[q]){return this._object[q]}}function n(q){var r=this._object[q];delete this._object[q];return r}function p(){return Object.clone(this._object)}function o(){return this.pluck("key")}function m(){return this.pluck("value")}function g(r){var q=this.detect(function(s){return s.value===r});return q&&q.key}function j(q){return this.clone().update(q)}function d(q){return new Hash(q).inject(this,function(r,s){r.set(s.key,s.value);return r})}function b(q,r){if(Object.isUndefined(r)){return q}return q+"="+encodeURIComponent(String.interpret(r))}function a(){return this.inject([],function(u,x){var t=encodeURIComponent(x.key),r=x.value;if(r&&typeof r=="object"){if(Object.isArray(r)){var w=[];for(var s=0,q=r.length,v;s<q;s++){v=r[s];w.push(b(t,v))}return u.concat(w)}}else{u.push(b(t,r))}return u}).join("&")}function l(){return"#<Hash:{"+this.map(function(q){return q.map(Object.inspect).join(": ")}).join(", ")+"}>"}function h(){return new Hash(this)}return{initialize:e,_each:f,set:k,get:c,unset:n,toObject:p,toTemplateReplacements:p,keys:o,values:m,index:g,merge:j,update:d,toQueryString:a,inspect:l,toJSON:p,clone:h}})());Hash.from=$H;Object.extend(Number.prototype,(function(){function d(){return this.toPaddedString(2,16)}function b(){return this+1}function h(k,j){$R(0,this,true).each(k,j);return this}function g(l,k){var j=this.toString(k||10);return"0".times(l-j.length)+j}function a(){return Math.abs(this)}function c(){return Math.round(this)}function e(){return Math.ceil(this)}function f(){return Math.floor(this)}return{toColorPart:d,succ:b,times:h,toPaddedString:g,abs:a,round:c,ceil:e,floor:f}})());function $R(c,a,b){return new ObjectRange(c,a,b)}var ObjectRange=Class.create(Enumerable,(function(){function b(f,d,e){this.start=f;this.end=d;this.exclusive=e}function c(d){var e=this.start;while(this.include(e)){d(e);e=e.succ()}}function a(d){if(d<this.start){return false}if(this.exclusive){return d<this.end}return d<=this.end}return{initialize:b,_each:c,include:a}})());var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(a){this.responders._each(a)},register:function(a){if(!this.include(a)){this.responders.push(a)}},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(d,b,c,a){this.each(function(f){if(Object.isFunction(f[d])){try{f[d].apply(f,[b,c,a])}catch(g){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(Object.isHash(this.options.parameters)){this.options.parameters=this.options.parameters.toObject()}}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,b,a){$super(a);this.transport=Ajax.getTransport();this.request(b)},request:function(b){this.url=b;this.method=this.options.method;var d=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);if(!["get","post"].include(this.method)){d+=(d?"&":"")+"_method="+this.method;this.method="post"}if(d&&this.method==="get"){this.url+=(this.url.include("?")?"&":"?")+d}this.parameters=d.toQueryParams();try{var a=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(a)}Ajax.Responders.dispatch("onCreate",this,a);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.withCredentials){this.transport.withCredentials=true}if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||d):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(c){this.dispatchException(c)}},onStateChange:function(){var a=this.transport.readyState;if(a>1&&!((a==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var e={Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(!this.options.suppress_nonstandard_headers){e["X-Requested-With"]="XMLHttpRequest";e["X-Prototype-Version"]=Prototype.Version}if(this.method=="post"){e["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){e.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var c=this.options.requestHeaders;if(Object.isFunction(c.push)){for(var b=0,d=c.length;b<d;b+=2){e[c[b]]=c[b+1]}}else{$H(c).each(function(f){e[f.key]=f.value})}}for(var a in e){this.transport.setRequestHeader(a,e[a])}},success:function(){var a=this.getStatus();return !a||(a>=200&&a<300)||a==304},getStatus:function(){try{if(this.transport.status===1223){return 204}return this.transport.status||0}catch(a){return 0}},respondToReadyState:function(a){var c=Ajax.Request.Events[a],b=new Ajax.Response(this);if(c=="Complete"){try{this._complete=true;(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(b,b.headerJSON)}catch(d){this.dispatchException(d)}var f=b.getHeader("Content-type");if(this.options.evalJS=="force"||(this.options.evalJS&&this.isSameOrigin()&&f&&f.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))){this.evalResponse()}}try{(this.options["on"+c]||Prototype.emptyFunction)(b,b.headerJSON);Ajax.Responders.dispatch("on"+c,this,b,b.headerJSON)}catch(d){this.dispatchException(d)}if(c=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},isSameOrigin:function(){var a=this.url.match(/^\s*https?:\/\/[^\/]*/);return !a||(a[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""}))},getHeader:function(a){try{return this.transport.getResponseHeader(a)||null}catch(b){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(a){(this.options.onException||Prototype.emptyFunction)(this,a);Ajax.Responders.dispatch("onException",this,a)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Response=Class.create({initialize:function(c){this.request=c;var d=this.transport=c.transport,a=this.readyState=d.readyState;if((a>2&&!Prototype.Browser.IE)||a==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(d.responseText);if(this.request.options.evalJSON){this.headerJSON=this._getHeaderJSON()}}if(a==4){var b=d.responseXML;this.responseXML=Object.isUndefined(b)?null:b;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(a){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(a){return null}},getResponseHeader:function(a){return this.transport.getResponseHeader(a)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var a=this.getHeader("X-JSON");if(!a){return null}a=decodeURIComponent(escape(a));try{return a.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}},_getResponseJSON:function(){var a=this.request.options;if(!a.evalJSON||(a.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json"))||this.responseText.blank()){return null}try{return this.responseText.evalJSON(a.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,a,c,b){this.container={success:(a.success||a),failure:(a.failure||(a.success?null:a))};b=Object.clone(b);var d=b.onComplete;b.onComplete=(function(e,f){this.updateContent(e.responseText);if(Object.isFunction(d)){d(e,f)}}).bind(this);$super(c,b)},updateContent:function(d){var c=this.container[this.success()?"success":"failure"],a=this.options;if(!a.evalScripts){d=d.stripScripts()}if(c=$(c)){if(a.insertion){if(Object.isString(a.insertion)){var b={};b[a.insertion]=d;c.insert(b)}else{a.insertion(c,d)}}else{c.update(d)}}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,a,c,b){$super(b);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=a;this.url=c;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(a){if(this.options.decay){this.decay=(a.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=a.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});function $(b){if(arguments.length>1){for(var a=0,d=[],c=arguments.length;a<c;a++){d.push($(arguments[a]))}return d}if(Object.isString(b)){b=document.getElementById(b)}return Element.extend(b)}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(f,a){var c=[];var e=document.evaluate(f,$(a)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var b=0,d=e.snapshotLength;b<d;b++){c.push(Element.extend(e.snapshotItem(b)))}return c}}if(!Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}(function(c){function d(f,e){if(f==="select"){return false}if("type" in e){return false}return true}var b=(function(){try{var e=document.createElement('<input name="x">');return e.tagName.toLowerCase()==="input"&&e.name==="x"}catch(f){return false}})();var a=c.Element;c.Element=function(g,f){f=f||{};g=g.toLowerCase();var e=Element.cache;if(b&&f.name){g="<"+g+' name="'+f.name+'">';delete f.name;return Element.writeAttribute(document.createElement(g),f)}if(!e[g]){e[g]=Element.extend(document.createElement(g))}var h=d(g,f)?e[g].cloneNode(false):document.createElement(g);return Element.writeAttribute(h,f)};Object.extend(c.Element,a||{});if(a){c.Element.prototype=a.prototype}})(this);Element.idCounter=1;Element.cache={};Element._purgeElement=function(b){var a=b._prototypeUID;if(a){Element.stopObserving(b);b._prototypeUID=void 0;delete Element.Storage[a]}};Element.Methods={visible:function(a){return $(a).style.display!="none"},toggle:function(a){a=$(a);Element[Element.visible(a)?"hide":"show"](a);return a},hide:function(a){a=$(a);a.style.display="none";return a},show:function(a){a=$(a);a.style.display="";return a},remove:function(a){a=$(a);a.parentNode.removeChild(a);return a},update:(function(){var d=(function(){var g=document.createElement("select"),h=true;g.innerHTML='<option value="test">test</option>';if(g.options&&g.options[0]){h=g.options[0].nodeName.toUpperCase()!=="OPTION"}g=null;return h})();var b=(function(){try{var g=document.createElement("table");if(g&&g.tBodies){g.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var j=typeof g.tBodies[0]=="undefined";g=null;return j}}catch(h){return true}})();var a=(function(){try{var g=document.createElement("div");g.innerHTML="<link>";var j=(g.childNodes.length===0);g=null;return j}catch(h){return true}})();var c=d||b||a;var f=(function(){var g=document.createElement("script"),j=false;try{g.appendChild(document.createTextNode(""));j=!g.firstChild||g.firstChild&&g.firstChild.nodeType!==3}catch(h){j=true}g=null;return j})();function e(l,m){l=$(l);var g=Element._purgeElement;var n=l.getElementsByTagName("*"),k=n.length;while(k--){g(n[k])}if(m&&m.toElement){m=m.toElement()}if(Object.isElement(m)){return l.update().insert(m)}m=Object.toHTML(m);var j=l.tagName.toUpperCase();if(j==="SCRIPT"&&f){l.text=m;return l}if(c){if(j in Element._insertionTranslations.tags){while(l.firstChild){l.removeChild(l.firstChild)}Element._getContentFromAnonymousElement(j,m.stripScripts()).each(function(o){l.appendChild(o)})}else{if(a&&Object.isString(m)&&m.indexOf("<link")>-1){while(l.firstChild){l.removeChild(l.firstChild)}var h=Element._getContentFromAnonymousElement(j,m.stripScripts(),true);h.each(function(o){l.appendChild(o)})}else{l.innerHTML=m.stripScripts()}}}else{l.innerHTML=m.stripScripts()}m.evalScripts.bind(m).defer();return l}return e})(),replace:function(b,c){b=$(b);if(c&&c.toElement){c=c.toElement()}else{if(!Object.isElement(c)){c=Object.toHTML(c);var a=b.ownerDocument.createRange();a.selectNode(b);c.evalScripts.bind(c).defer();c=a.createContextualFragment(c.stripScripts())}}b.parentNode.replaceChild(c,b);return b},insert:function(c,e){c=$(c);if(Object.isString(e)||Object.isNumber(e)||Object.isElement(e)||(e&&(e.toElement||e.toHTML))){e={bottom:e}}var d,f,b,g;for(var a in e){d=e[a];a=a.toLowerCase();f=Element._insertionTranslations[a];if(d&&d.toElement){d=d.toElement()}if(Object.isElement(d)){f(c,d);continue}d=Object.toHTML(d);b=((a=="before"||a=="after")?c.parentNode:c).tagName.toUpperCase();g=Element._getContentFromAnonymousElement(b,d.stripScripts());if(a=="top"||a=="after"){g.reverse()}g.each(f.curry(c));d.evalScripts.bind(d).defer()}return c},wrap:function(b,c,a){b=$(b);if(Object.isElement(c)){$(c).writeAttribute(a||{})}else{if(Object.isString(c)){c=new Element(c,a)}else{c=new Element("div",c)}}if(b.parentNode){b.parentNode.replaceChild(c,b)}c.appendChild(b);return c},inspect:function(b){b=$(b);var a="<"+b.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(f){var e=f.first(),c=f.last(),d=(b[e]||"").toString();if(d){a+=" "+c+"="+d.inspect(true)}});return a+">"},recursivelyCollect:function(a,c,d){a=$(a);d=d||-1;var b=[];while(a=a[c]){if(a.nodeType==1){b.push(Element.extend(a))}if(b.length==d){break}}return b},ancestors:function(a){return Element.recursivelyCollect(a,"parentNode")},descendants:function(a){return Element.select(a,"*")},firstDescendant:function(a){a=$(a).firstChild;while(a&&a.nodeType!=1){a=a.nextSibling}return $(a)},immediateDescendants:function(b){var a=[],c=$(b).firstChild;while(c){if(c.nodeType===1){a.push(Element.extend(c))}c=c.nextSibling}return a},previousSiblings:function(a,b){return Element.recursivelyCollect(a,"previousSibling")},nextSiblings:function(a){return Element.recursivelyCollect(a,"nextSibling")},siblings:function(a){a=$(a);return Element.previousSiblings(a).reverse().concat(Element.nextSiblings(a))},match:function(b,a){b=$(b);if(Object.isString(a)){return Prototype.Selector.match(b,a)}return a.match(b)},up:function(b,d,a){b=$(b);if(arguments.length==1){return $(b.parentNode)}var c=Element.ancestors(b);return Object.isNumber(d)?c[d]:Prototype.Selector.find(c,d,a)},down:function(b,c,a){b=$(b);if(arguments.length==1){return Element.firstDescendant(b)}return Object.isNumber(c)?Element.descendants(b)[c]:Element.select(b,c)[a||0]},previous:function(b,c,a){b=$(b);if(Object.isNumber(c)){a=c,c=false}if(!Object.isNumber(a)){a=0}if(c){return Prototype.Selector.find(b.previousSiblings(),c,a)}else{return b.recursivelyCollect("previousSibling",a+1)[a]}},next:function(b,d,a){b=$(b);if(Object.isNumber(d)){a=d,d=false}if(!Object.isNumber(a)){a=0}if(d){return Prototype.Selector.find(b.nextSiblings(),d,a)}else{var c=Object.isNumber(a)?a+1:1;return b.recursivelyCollect("nextSibling",a+1)[a]}},select:function(a){a=$(a);var b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a)},adjacent:function(a){a=$(a);var b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a.parentNode).without(a)},identify:function(a){a=$(a);var b=Element.readAttribute(a,"id");if(b){return b}do{b="anonymous_element_"+Element.idCounter++}while($(b));Element.writeAttribute(a,"id",b);return b},readAttribute:function(c,a){c=$(c);if(Prototype.Browser.IE){var b=Element._attributeTranslations.read;if(b.values[a]){return b.values[a](c,a)}if(b.names[a]){a=b.names[a]}if(a.include(":")){return(!c.attributes||!c.attributes[a])?null:c.attributes[a].value}}return c.getAttribute(a)},writeAttribute:function(e,c,f){e=$(e);var b={},d=Element._attributeTranslations.write;if(typeof c=="object"){b=c}else{b[c]=Object.isUndefined(f)?true:f}for(var a in b){c=d.names[a]||a;f=b[a];if(d.values[a]){c=d.values[a](e,f)}if(f===false||f===null){e.removeAttribute(c)}else{if(f===true){e.setAttribute(c,c)}else{e.setAttribute(c,f)}}}return e},getHeight:function(a){return Element.getDimensions(a).height},getWidth:function(a){return Element.getDimensions(a).width},classNames:function(a){return new Element.ClassNames(a)},hasClassName:function(a,b){if(!(a=$(a))){return}var c=a.className;return(c.length>0&&(c==b||new RegExp("(^|\\s)"+b+"(\\s|$)").test(c)))},addClassName:function(a,b){if(!(a=$(a))){return}if(!Element.hasClassName(a,b)){a.className+=(a.className?" ":"")+b}return a},removeClassName:function(a,b){if(!(a=$(a))){return}a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," ").strip();return a},toggleClassName:function(a,b){if(!(a=$(a))){return}return Element[Element.hasClassName(a,b)?"removeClassName":"addClassName"](a,b)},cleanWhitespace:function(b){b=$(b);var c=b.firstChild;while(c){var a=c.nextSibling;if(c.nodeType==3&&!/\S/.test(c.nodeValue)){b.removeChild(c)}c=a}return b},empty:function(a){return $(a).innerHTML.blank()},descendantOf:function(b,a){b=$(b),a=$(a);if(b.compareDocumentPosition){return(b.compareDocumentPosition(a)&8)===8}if(a.contains){return a.contains(b)&&a!==b}while(b=b.parentNode){if(b==a){return true}}return false},scrollTo:function(a){a=$(a);var b=Element.cumulativeOffset(a);window.scrollTo(b[0],b[1]);return a},getStyle:function(b,c){b=$(b);c=c=="float"?"cssFloat":c.camelize();var d=b.style[c];if(!d||d=="auto"){var a=document.defaultView.getComputedStyle(b,null);d=a?a[c]:null}if(c=="opacity"){return d?parseFloat(d):1}return d=="auto"?null:d},getOpacity:function(a){return $(a).getStyle("opacity")},setStyle:function(b,c){b=$(b);var e=b.style,a;if(Object.isString(c)){b.style.cssText+=";"+c;return c.include("opacity")?b.setOpacity(c.match(/opacity:\s*(\d?\.?\d*)/)[1]):b}for(var d in c){if(d=="opacity"){b.setOpacity(c[d])}else{e[(d=="float"||d=="cssFloat")?(Object.isUndefined(e.styleFloat)?"cssFloat":"styleFloat"):d]=c[d]}}return b},setOpacity:function(a,b){a=$(a);a.style.opacity=(b==1||b==="")?"":(b<0.00001)?0:b;return a},makePositioned:function(a){a=$(a);var b=Element.getStyle(a,"position");if(b=="static"||!b){a._madePositioned=true;a.style.position="relative";if(Prototype.Browser.Opera){a.style.top=0;a.style.left=0}}return a},undoPositioned:function(a){a=$(a);if(a._madePositioned){a._madePositioned=undefined;a.style.position=a.style.top=a.style.left=a.style.bottom=a.style.right=""}return a},makeClipping:function(a){a=$(a);if(a._overflow){return a}a._overflow=Element.getStyle(a,"overflow")||"auto";if(a._overflow!=="hidden"){a.style.overflow="hidden"}return a},undoClipping:function(a){a=$(a);if(!a._overflow){return a}a.style.overflow=a._overflow=="auto"?"":a._overflow;a._overflow=null;return a},clonePosition:function(b,d){var a=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});d=$(d);var e=Element.viewportOffset(d),f=[0,0],c=null;b=$(b);if(Element.getStyle(b,"position")=="absolute"){c=Element.getOffsetParent(b);f=Element.viewportOffset(c)}if(c==document.body){f[0]-=document.body.offsetLeft;f[1]-=document.body.offsetTop}if(a.setLeft){b.style.left=(e[0]-f[0]+a.offsetLeft)+"px"}if(a.setTop){b.style.top=(e[1]-f[1]+a.offsetTop)+"px"}if(a.setWidth){b.style.width=d.offsetWidth+"px"}if(a.setHeight){b.style.height=d.offsetHeight+"px"}return b}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(d,b,c){switch(c){case"height":case"width":if(!Element.visible(b)){return null}var e=parseInt(d(b,c),10);if(e!==b["offset"+c.capitalize()]){return e+"px"}var a;if(c==="height"){a=["border-top-width","padding-top","padding-bottom","border-bottom-width"]}else{a=["border-left-width","padding-left","padding-right","border-right-width"]}return a.inject(e,function(f,g){var h=d(b,g);return h===null?f:f-parseInt(h,10)})+"px";default:return d(b,c)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(c,a,b){if(b==="title"){return a.title}return c(a,b)})}else{if(Prototype.Browser.IE){Element.Methods.getStyle=function(a,b){a=$(a);b=(b=="float"||b=="cssFloat")?"styleFloat":b.camelize();var c=a.style[b];if(!c&&a.currentStyle){c=a.currentStyle[b]}if(b=="opacity"){if(c=(a.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(c[1]){return parseFloat(c[1])/100}}return 1}if(c=="auto"){if((b=="width"||b=="height")&&(a.getStyle("display")!="none")){return a["offset"+b.capitalize()]+"px"}return null}return c};Element.Methods.setOpacity=function(b,e){function f(g){g=g||"";return g.replace(/alpha\([^\)]*\)/gi,"")}b=$(b);var a=b.currentStyle;if((a&&!a.hasLayout)||(!a&&b.style.zoom=="normal")){b.style.zoom=1}var d=b.getStyle("filter"),c=b.style;if(e==1||e===""){(d=f(d))?c.filter=d:c.removeAttribute("filter");return b}else{if(e<0.00001){e=0}}c.filter=f(d)+"alpha(opacity="+(e*100)+")";return b};Element._attributeTranslations=(function(){var b="className",a="for",c=document.createElement("div");c.setAttribute(b,"x");if(c.className!=="x"){c.setAttribute("class","x");if(c.className==="x"){b="class"}}c=null;c=document.createElement("label");c.setAttribute(a,"x");if(c.htmlFor!=="x"){c.setAttribute("htmlFor","x");if(c.htmlFor==="x"){a="htmlFor"}}c=null;return{read:{names:{"class":b,className:b,"for":a,htmlFor:a},values:{_getAttr:function(d,e){return d.getAttribute(e)},_getAttr2:function(d,e){return d.getAttribute(e,2)},_getAttrNode:function(d,f){var e=d.getAttributeNode(f);return e?e.value:""},_getEv:(function(){var d=document.createElement("div"),g;d.onclick=Prototype.emptyFunction;var e=d.getAttribute("onclick");if(String(e).indexOf("{")>-1){g=function(f,h){h=f.getAttribute(h);if(!h){return null}h=h.toString();h=h.split("{")[1];h=h.split("}")[0];return h.strip()}}else{if(e===""){g=function(f,h){h=f.getAttribute(h);if(!h){return null}return h.strip()}}}d=null;return g})(),_flag:function(d,e){return $(d).hasAttribute(e)?e:null},style:function(d){return d.style.cssText.toLowerCase()},title:function(d){return d.title}}}}})();Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(a,b){a.checked=!!b},style:function(a,b){a.style.cssText=b?b:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(a){Element._attributeTranslations.write.names[a.toLowerCase()]=a;Element._attributeTranslations.has[a.toLowerCase()]=a});(function(a){Object.extend(a,{href:a._getAttr2,src:a._getAttr2,type:a._getAttr,action:a._getAttrNode,disabled:a._flag,checked:a._flag,readonly:a._flag,multiple:a._flag,onload:a._getEv,onunload:a._getEv,onclick:a._getEv,ondblclick:a._getEv,onmousedown:a._getEv,onmouseup:a._getEv,onmouseover:a._getEv,onmousemove:a._getEv,onmouseout:a._getEv,onfocus:a._getEv,onblur:a._getEv,onkeypress:a._getEv,onkeydown:a._getEv,onkeyup:a._getEv,onsubmit:a._getEv,onreset:a._getEv,onselect:a._getEv,onchange:a._getEv})})(Element._attributeTranslations.read.values);if(Prototype.BrowserFeatures.ElementExtensions){(function(){function a(e){var b=e.getElementsByTagName("*"),d=[];for(var c=0,f;f=b[c];c++){if(f.tagName!=="!"){d.push(f)}}return d}Element.Methods.down=function(c,d,b){c=$(c);if(arguments.length==1){return c.firstDescendant()}return Object.isNumber(d)?a(c)[d]:Element.select(c,d)[b||0]}})()}}else{if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=(b==1)?0.999999:(b==="")?"":(b<0.00001)?0:b;return a}}else{if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=(b==1||b==="")?"":(b<0.00001)?0:b;if(b==1){if(a.tagName.toUpperCase()=="IMG"&&a.width){a.width++;a.width--}else{try{var d=document.createTextNode(" ");a.appendChild(d);a.removeChild(d)}catch(c){}}}return a}}}}}if("outerHTML" in document.documentElement){Element.Methods.replace=function(c,e){c=$(c);if(e&&e.toElement){e=e.toElement()}if(Object.isElement(e)){c.parentNode.replaceChild(e,c);return c}e=Object.toHTML(e);var d=c.parentNode,b=d.tagName.toUpperCase();if(Element._insertionTranslations.tags[b]){var f=c.next(),a=Element._getContentFromAnonymousElement(b,e.stripScripts());d.removeChild(c);if(f){a.each(function(g){d.insertBefore(g,f)})}else{a.each(function(g){d.appendChild(g)})}}else{c.outerHTML=e.stripScripts()}e.evalScripts.bind(e).defer();return c}}Element._returnOffset=function(b,c){var a=[b,c];a.left=b;a.top=c;return a};Element._getContentFromAnonymousElement=function(e,d,f){var g=new Element("div"),c=Element._insertionTranslations.tags[e];var a=false;if(c){a=true}else{if(f){a=true;c=["","",0]}}if(a){g.innerHTML="&nbsp;"+c[0]+d+c[1];g.removeChild(g.firstChild);for(var b=c[2];b--;){g=g.firstChild}}else{g.innerHTML=d}return $A(g.childNodes)};Element._insertionTranslations={before:function(a,b){a.parentNode.insertBefore(b,a)},top:function(a,b){a.insertBefore(b,a.firstChild)},bottom:function(a,b){a.appendChild(b)},after:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};(function(){var a=Element._insertionTranslations.tags;Object.extend(a,{THEAD:a.TBODY,TFOOT:a.TBODY,TH:a.TD})})();Element.Methods.Simulated={hasAttribute:function(a,c){c=Element._attributeTranslations.has[c]||c;var b=$(a).getAttributeNode(c);return !!(b&&b.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);(function(a){if(!Prototype.BrowserFeatures.ElementExtensions&&a.__proto__){window.HTMLElement={};window.HTMLElement.prototype=a.__proto__;Prototype.BrowserFeatures.ElementExtensions=true}a=null})(document.createElement("div"));Element.extend=(function(){function c(g){if(typeof window.Element!="undefined"){var j=window.Element.prototype;if(j){var l="_"+(Math.random()+"").slice(2),h=document.createElement(g);j[l]="x";var k=(h[l]!=="x");delete j[l];h=null;return k}}return false}function b(h,g){for(var k in g){var j=g[k];if(Object.isFunction(j)&&!(k in h)){h[k]=j.methodize()}}}var d=c("object");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(d){return function(h){if(h&&typeof h._extendedByPrototype=="undefined"){var g=h.tagName;if(g&&(/^(?:object|applet|embed)$/i.test(g))){b(h,Element.Methods);b(h,Element.Methods.Simulated);b(h,Element.Methods.ByTag[g.toUpperCase()])}}return h}}return Prototype.K}var a={},e=Element.Methods.ByTag;var f=Object.extend(function(j){if(!j||typeof j._extendedByPrototype!="undefined"||j.nodeType!=1||j==window){return j}var g=Object.clone(a),h=j.tagName.toUpperCase();if(e[h]){Object.extend(g,e[h])}b(j,g);j._extendedByPrototype=Prototype.emptyFunction;return j},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(a,Element.Methods);Object.extend(a,Element.Methods.Simulated)}}});f.refresh();return f})();if(document.documentElement.hasAttribute){Element.hasAttribute=function(a,b){return a.hasAttribute(b)}}else{Element.hasAttribute=Element.Methods.Simulated.hasAttribute}Element.addMethods=function(c){var j=Prototype.BrowserFeatures,d=Element.Methods.ByTag;if(!c){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var b=c;c=arguments[1]}if(!b){Object.extend(Element.Methods,c||{})}else{if(Object.isArray(b)){b.each(g)}else{g(b)}}function g(l){l=l.toUpperCase();if(!Element.Methods.ByTag[l]){Element.Methods.ByTag[l]={}}Object.extend(Element.Methods.ByTag[l],c)}function a(n,m,l){l=l||false;for(var p in n){var o=n[p];if(!Object.isFunction(o)){continue}if(!l||!(p in m)){m[p]=o.methodize()}}}function e(o){var l;var n={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(n[o]){l="HTML"+n[o]+"Element"}if(window[l]){return window[l]}l="HTML"+o+"Element";if(window[l]){return window[l]}l="HTML"+o.capitalize()+"Element";if(window[l]){return window[l]}var m=document.createElement(o),p=m.__proto__||m.constructor.prototype;m=null;return p}var h=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(j.ElementExtensions){a(Element.Methods,h);a(Element.Methods.Simulated,h,true)}if(j.SpecificElementExtensions){for(var k in Element.Methods.ByTag){var f=e(k);if(Object.isUndefined(f)){continue}a(d[k],f.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh){Element.extend.refresh()}Element.cache={}};document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};(function(b){var g=Prototype.Browser,e=document,c,d={};function a(){if(g.WebKit&&!e.evaluate){return document}if(g.Opera&&window.parseFloat(window.opera.version())<9.5){return document.body}return document.documentElement}function f(h){if(!c){c=a()}d[h]="client"+h;b["get"+h]=function(){return c[d[h]]};return b["get"+h]()}b.getWidth=f.curry("Width");b.getHeight=f.curry("Height")})(document.viewport);Element.Storage={UID:1};Element.addMethods({getStorage:function(b){if(!(b=$(b))){return}var a;if(b===window){a=0}else{if(typeof b._prototypeUID==="undefined"){b._prototypeUID=Element.Storage.UID++}a=b._prototypeUID}if(!Element.Storage[a]){Element.Storage[a]=$H()}return Element.Storage[a]},store:function(b,a,c){if(!(b=$(b))){return}if(arguments.length===2){Element.getStorage(b).update(a)}else{Element.getStorage(b).set(a,c)}return b},retrieve:function(c,b,a){if(!(c=$(c))){return}var e=Element.getStorage(c),d=e.get(b);if(Object.isUndefined(d)){e.set(b,a);d=a}return d},clone:function(c,a){if(!(c=$(c))){return}var e=c.cloneNode(a);e._prototypeUID=void 0;if(a){var d=Element.select(e,"*"),b=d.length;while(b--){d[b]._prototypeUID=void 0}}return Element.extend(e)},purge:function(c){if(!(c=$(c))){return}var a=Element._purgeElement;a(c);var d=c.getElementsByTagName("*"),b=d.length;while(b--){a(d[b])}return null}});(function(){function h(w){var v=w.match(/^(\d+)%?$/i);if(!v){return null}return(Number(v[1])/100)}function p(G,H,w){var z=null;if(Object.isElement(G)){z=G;G=z.getStyle(H)}if(G===null){return null}if((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(G)){return window.parseFloat(G)}var B=G.include("%"),x=(w===document.viewport);if(/\d/.test(G)&&z&&z.runtimeStyle&&!(B&&x)){var v=z.style.left,F=z.runtimeStyle.left;z.runtimeStyle.left=z.currentStyle.left;z.style.left=G||0;G=z.style.pixelLeft;z.style.left=v;z.runtimeStyle.left=F;return G}if(z&&B){w=w||z.parentNode;var y=h(G);var C=null;var A=z.getStyle("position");var E=H.include("left")||H.include("right")||H.include("width");var D=H.include("top")||H.include("bottom")||H.include("height");if(w===document.viewport){if(E){C=document.viewport.getWidth()}else{if(D){C=document.viewport.getHeight()}}}else{if(E){C=$(w).measure("width")}else{if(D){C=$(w).measure("height")}}}return(C===null)?0:C*y}return 0}function g(v){if(Object.isString(v)&&v.endsWith("px")){return v}return v+"px"}function k(w){var v=w;while(w&&w.parentNode){var x=w.getStyle("display");if(x==="none"){return false}w=$(w.parentNode)}return true}var d=Prototype.K;if("currentStyle" in document.documentElement){d=function(v){if(!v.currentStyle.hasLayout){v.style.zoom=1}return v}}function f(v){if(v.include("border")){v=v+"-width"}return v.camelize()}Element.Layout=Class.create(Hash,{initialize:function($super,w,v){$super();this.element=$(w);Element.Layout.PROPERTIES.each(function(x){this._set(x,null)},this);if(v){this._preComputing=true;this._begin();Element.Layout.PROPERTIES.each(this._compute,this);this._end();this._preComputing=false}},_set:function(w,v){return Hash.prototype.set.call(this,w,v)},set:function(w,v){throw"Properties of Element.Layout are read-only."},get:function($super,w){var v=$super(w);return v===null?this._compute(w):v},_begin:function(){if(this._prepared){return}var z=this.element;if(k(z)){this._prepared=true;return}var B={position:z.style.position||"",width:z.style.width||"",visibility:z.style.visibility||"",display:z.style.display||""};z.store("prototype_original_styles",B);var C=z.getStyle("position"),v=z.getStyle("width");if(v==="0px"||v===null){z.style.display="block";v=z.getStyle("width")}var w=(C==="fixed")?document.viewport:z.parentNode;z.setStyle({position:"absolute",visibility:"hidden",display:"block"});var x=z.getStyle("width");var y;if(v&&(x===v)){y=p(z,"width",w)}else{if(C==="absolute"||C==="fixed"){y=p(z,"width",w)}else{var D=z.parentNode,A=$(D).getLayout();y=A.get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right")}}z.setStyle({width:y+"px"});this._prepared=true},_end:function(){var w=this.element;var v=w.retrieve("prototype_original_styles");w.store("prototype_original_styles",null);w.setStyle(v);this._prepared=false},_compute:function(w){var v=Element.Layout.COMPUTATIONS;if(!(w in v)){throw"Property not found."}return this._set(w,v[w].call(this,this.element))},toObject:function(){var v=$A(arguments);var w=(v.length===0)?Element.Layout.PROPERTIES:v.join(" ").split(" ");var x={};w.each(function(y){if(!Element.Layout.PROPERTIES.include(y)){return}var z=this.get(y);if(z!=null){x[y]=z}},this);return x},toHash:function(){var v=this.toObject.apply(this,arguments);return new Hash(v)},toCSS:function(){var v=$A(arguments);var x=(v.length===0)?Element.Layout.PROPERTIES:v.join(" ").split(" ");var w={};x.each(function(y){if(!Element.Layout.PROPERTIES.include(y)){return}if(Element.Layout.COMPOSITE_PROPERTIES.include(y)){return}var z=this.get(y);if(z!=null){w[f(y)]=z+"px"}},this);return w},inspect:function(){return"#<Element.Layout>"}});Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(x){if(!this._preComputing){this._begin()}var v=this.get("border-box-height");if(v<=0){if(!this._preComputing){this._end()}return 0}var y=this.get("border-top"),w=this.get("border-bottom");var A=this.get("padding-top"),z=this.get("padding-bottom");if(!this._preComputing){this._end()}return v-y-w-A-z},width:function(x){if(!this._preComputing){this._begin()}var w=this.get("border-box-width");if(w<=0){if(!this._preComputing){this._end()}return 0}var A=this.get("border-left"),v=this.get("border-right");var y=this.get("padding-left"),z=this.get("padding-right");if(!this._preComputing){this._end()}return w-A-v-y-z},"padding-box-height":function(w){var v=this.get("height"),y=this.get("padding-top"),x=this.get("padding-bottom");return v+y+x},"padding-box-width":function(v){var w=this.get("width"),x=this.get("padding-left"),y=this.get("padding-right");return w+x+y},"border-box-height":function(w){if(!this._preComputing){this._begin()}var v=w.offsetHeight;if(!this._preComputing){this._end()}return v},"border-box-width":function(v){if(!this._preComputing){this._begin()}var w=v.offsetWidth;if(!this._preComputing){this._end()}return w},"margin-box-height":function(w){var v=this.get("border-box-height"),x=this.get("margin-top"),y=this.get("margin-bottom");if(v<=0){return 0}return v+x+y},"margin-box-width":function(x){var w=this.get("border-box-width"),y=this.get("margin-left"),v=this.get("margin-right");if(w<=0){return 0}return w+y+v},top:function(v){var w=v.positionedOffset();return w.top},bottom:function(v){var y=v.positionedOffset(),w=v.getOffsetParent(),x=w.measure("height");var z=this.get("border-box-height");return x-z-y.top},left:function(v){var w=v.positionedOffset();return w.left},right:function(x){var z=x.positionedOffset(),y=x.getOffsetParent(),v=y.measure("width");var w=this.get("border-box-width");return v-w-z.left},"padding-top":function(v){return p(v,"paddingTop")},"padding-bottom":function(v){return p(v,"paddingBottom")},"padding-left":function(v){return p(v,"paddingLeft")},"padding-right":function(v){return p(v,"paddingRight")},"border-top":function(v){return p(v,"borderTopWidth")},"border-bottom":function(v){return p(v,"borderBottomWidth")},"border-left":function(v){return p(v,"borderLeftWidth")},"border-right":function(v){return p(v,"borderRightWidth")},"margin-top":function(v){return p(v,"marginTop")},"margin-bottom":function(v){return p(v,"marginBottom")},"margin-left":function(v){return p(v,"marginLeft")},"margin-right":function(v){return p(v,"marginRight")}}});if("getBoundingClientRect" in document.documentElement){Object.extend(Element.Layout.COMPUTATIONS,{right:function(w){var x=d(w.getOffsetParent());var y=w.getBoundingClientRect(),v=x.getBoundingClientRect();return(v.right-y.right).round()},bottom:function(w){var x=d(w.getOffsetParent());var y=w.getBoundingClientRect(),v=x.getBoundingClientRect();return(v.bottom-y.bottom).round()}})}Element.Offset=Class.create({initialize:function(w,v){this.left=w.round();this.top=v.round();this[0]=this.left;this[1]=this.top},relativeTo:function(v){return new Element.Offset(this.left-v.left,this.top-v.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}});function s(w,v){return new Element.Layout(w,v)}function b(v,w){return $(v).getLayout().get(w)}function o(w){w=$(w);var A=Element.getStyle(w,"display");if(A&&A!=="none"){return{width:w.offsetWidth,height:w.offsetHeight}}var x=w.style;var v={visibility:x.visibility,position:x.position,display:x.display};var z={visibility:"hidden",display:"block"};if(v.position!=="fixed"){z.position="absolute"}Element.setStyle(w,z);var y={width:w.offsetWidth,height:w.offsetHeight};Element.setStyle(w,v);return y}function m(v){v=$(v);if(e(v)||c(v)||n(v)||l(v)){return $(document.body)}var w=(Element.getStyle(v,"display")==="inline");if(!w&&v.offsetParent&&!Prototype.Browser.IE){return $(v.offsetParent)}while((v=v.parentNode)&&v!==document.body){if(Element.getStyle(v,"position")!=="static"){return l(v)?$(document.body):$(v)}}return $(document.body)}function u(w){w=$(w);var v=0,x=0;if(w.parentNode){do{v+=w.offsetTop||0;x+=w.offsetLeft||0;w=w.offsetParent}while(w)}return new Element.Offset(x,v)}function q(w){w=$(w);var x=w.getLayout();var v=0,z=0;do{v+=w.offsetTop||0;z+=w.offsetLeft||0;w=w.offsetParent;if(w){if(n(w)){break}var y=Element.getStyle(w,"position");if(y!=="static"){break}}}while(w);z-=x.get("margin-top");v-=x.get("margin-left");return new Element.Offset(z,v)}function a(w){var v=0,x=0;do{v+=w.scrollTop||0;x+=w.scrollLeft||0;w=w.parentNode}while(w);return new Element.Offset(x,v)}function t(z){w=$(w);var v=0,y=0,x=document.body;var w=z;do{v+=w.offsetTop||0;y+=w.offsetLeft||0;if(w.offsetParent==x&&Element.getStyle(w,"position")=="absolute"){break}}while(w=w.offsetParent);w=z;do{if(w!=x){v-=w.scrollTop||0;y-=w.scrollLeft||0}}while(w=w.parentNode);return new Element.Offset(y,v)}function r(v){v=$(v);if(Element.getStyle(v,"position")==="absolute"){return v}var z=m(v);var y=v.viewportOffset(),w=z.viewportOffset();var A=y.relativeTo(w);var x=v.getLayout();v.store("prototype_absolutize_original_styles",{left:v.getStyle("left"),top:v.getStyle("top"),width:v.getStyle("width"),height:v.getStyle("height")});v.setStyle({position:"absolute",top:A.top+"px",left:A.left+"px",width:x.get("width")+"px",height:x.get("height")+"px"});return v}function j(w){w=$(w);if(Element.getStyle(w,"position")==="relative"){return w}var v=w.retrieve("prototype_absolutize_original_styles");if(v){w.setStyle(v)}return w}if(Prototype.Browser.IE){m=m.wrap(function(x,w){w=$(w);if(e(w)||c(w)||n(w)||l(w)){return $(document.body)}var v=w.getStyle("position");if(v!=="static"){return x(w)}w.setStyle({position:"relative"});var y=x(w);w.setStyle({position:v});return y});q=q.wrap(function(y,w){w=$(w);if(!w.parentNode){return new Element.Offset(0,0)}var v=w.getStyle("position");if(v!=="static"){return y(w)}var x=w.getOffsetParent();if(x&&x.getStyle("position")==="fixed"){d(x)}w.setStyle({position:"relative"});var z=y(w);w.setStyle({position:v});return z})}else{if(Prototype.Browser.Webkit){u=function(w){w=$(w);var v=0,x=0;do{v+=w.offsetTop||0;x+=w.offsetLeft||0;if(w.offsetParent==document.body){if(Element.getStyle(w,"position")=="absolute"){break}}w=w.offsetParent}while(w);return new Element.Offset(x,v)}}}Element.addMethods({getLayout:s,measure:b,getDimensions:o,getOffsetParent:m,cumulativeOffset:u,positionedOffset:q,cumulativeScrollOffset:a,viewportOffset:t,absolutize:r,relativize:j});function n(v){return v.nodeName.toUpperCase()==="BODY"}function l(v){return v.nodeName.toUpperCase()==="HTML"}function e(v){return v.nodeType===Node.DOCUMENT_NODE}function c(v){return v!==document.body&&!Element.descendantOf(v,document.body)}if("getBoundingClientRect" in document.documentElement){Element.addMethods({viewportOffset:function(v){v=$(v);if(c(v)){return new Element.Offset(0,0)}var w=v.getBoundingClientRect(),x=document.documentElement;return new Element.Offset(w.left-x.clientLeft,w.top-x.clientTop)}})}})();window.$$=function(){var a=$A(arguments).join(", ");return Prototype.Selector.select(a,document)};Prototype.Selector=(function(){function a(){throw new Error('Method "Prototype.Selector.select" must be defined.')}function c(){throw new Error('Method "Prototype.Selector.match" must be defined.')}function d(l,m,h){h=h||0;var g=Prototype.Selector.match,k=l.length,f=0,j;for(j=0;j<k;j++){if(g(l[j],m)&&h==f++){return Element.extend(l[j])}}}function e(h){for(var f=0,g=h.length;f<g;f++){Element.extend(h[f])}return h}var b=Prototype.K;return{select:a,match:c,find:d,extendElements:(Element.extend===b)?b:e,extendElement:Element.extend}})();Prototype._original_property=window.Sizzle;
/*
 * Sizzle CSS Selector Engine - v1.0
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var r=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,k=0,d=Object.prototype.toString,p=false,j=true;[0,0].sort(function(){j=false;return 0});var b=function(F,v,C,x){C=C||[];var e=v=v||document;if(v.nodeType!==1&&v.nodeType!==9){return[]}if(!F||typeof F!=="string"){return C}var D=[],E,A,J,I,B,u,t=true,y=q(v),H=F;while((r.exec(""),E=r.exec(H))!==null){H=E[3];D.push(E[1]);if(E[2]){u=E[3];break}}if(D.length>1&&l.exec(F)){if(D.length===2&&f.relative[D[0]]){A=g(D[0]+D[1],v)}else{A=f.relative[D[0]]?[v]:b(D.shift(),v);while(D.length){F=D.shift();if(f.relative[F]){F+=D.shift()}A=g(F,A)}}}else{if(!x&&D.length>1&&v.nodeType===9&&!y&&f.match.ID.test(D[0])&&!f.match.ID.test(D[D.length-1])){var K=b.find(D.shift(),v,y);v=K.expr?b.filter(K.expr,K.set)[0]:K.set[0]}if(v){var K=x?{expr:D.pop(),set:a(x)}:b.find(D.pop(),D.length===1&&(D[0]==="~"||D[0]==="+")&&v.parentNode?v.parentNode:v,y);A=K.expr?b.filter(K.expr,K.set):K.set;if(D.length>0){J=a(A)}else{t=false}while(D.length){var w=D.pop(),z=w;if(!f.relative[w]){w=""}else{z=D.pop()}if(z==null){z=v}f.relative[w](J,z,y)}}else{J=D=[]}}if(!J){J=A}if(!J){throw"Syntax error, unrecognized expression: "+(w||F)}if(d.call(J)==="[object Array]"){if(!t){C.push.apply(C,J)}else{if(v&&v.nodeType===1){for(var G=0;J[G]!=null;G++){if(J[G]&&(J[G]===true||J[G].nodeType===1&&h(v,J[G]))){C.push(A[G])}}}else{for(var G=0;J[G]!=null;G++){if(J[G]&&J[G].nodeType===1){C.push(A[G])}}}}}else{a(J,C)}if(u){b(u,e,C,x);b.uniqueSort(C)}return C};b.uniqueSort=function(t){if(c){p=j;t.sort(c);if(p){for(var e=1;e<t.length;e++){if(t[e]===t[e-1]){t.splice(e--,1)}}}}return t};b.matches=function(e,t){return b(e,null,null,t)};b.find=function(z,e,A){var y,w;if(!z){return[]}for(var v=0,u=f.order.length;v<u;v++){var x=f.order[v],w;if((w=f.leftMatch[x].exec(z))){var t=w[1];w.splice(1,1);if(t.substr(t.length-1)!=="\\"){w[1]=(w[1]||"").replace(/\\/g,"");y=f.find[x](w,e,A);if(y!=null){z=z.replace(f.match[x],"");break}}}}if(!y){y=e.getElementsByTagName("*")}return{set:y,expr:z}};b.filter=function(C,B,F,v){var u=C,H=[],z=B,x,e,y=B&&B[0]&&q(B[0]);while(C&&B.length){for(var A in f.filter){if((x=f.match[A].exec(C))!=null){var t=f.filter[A],G,E;e=false;if(z==H){H=[]}if(f.preFilter[A]){x=f.preFilter[A](x,z,F,H,v,y);if(!x){e=G=true}else{if(x===true){continue}}}if(x){for(var w=0;(E=z[w])!=null;w++){if(E){G=t(E,x,w,z);var D=v^!!G;if(F&&G!=null){if(D){e=true}else{z[w]=false}}else{if(D){H.push(E);e=true}}}}}if(G!==undefined){if(!F){z=H}C=C.replace(f.match[A],"");if(!e){return[]}break}}}if(C==u){if(e==null){throw"Syntax error, unrecognized expression: "+C}else{break}}u=C}return z};var f=b.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")}},relative:{"+":function(z,e,y){var w=typeof e==="string",A=w&&!/\W/.test(e),x=w&&!A;if(A&&!y){e=e.toUpperCase()}for(var v=0,u=z.length,t;v<u;v++){if((t=z[v])){while((t=t.previousSibling)&&t.nodeType!==1){}z[v]=x||t&&t.nodeName===e?t||false:t===e}}if(x){b.filter(e,z,true)}},">":function(y,t,z){var w=typeof t==="string";if(w&&!/\W/.test(t)){t=z?t:t.toUpperCase();for(var u=0,e=y.length;u<e;u++){var x=y[u];if(x){var v=x.parentNode;y[u]=v.nodeName===t?v:false}}}else{for(var u=0,e=y.length;u<e;u++){var x=y[u];if(x){y[u]=w?x.parentNode:x.parentNode===t}}if(w){b.filter(t,y,true)}}},"":function(v,t,x){var u=k++,e=s;if(!/\W/.test(t)){var w=t=x?t:t.toUpperCase();e=o}e("parentNode",t,u,v,w,x)},"~":function(v,t,x){var u=k++,e=s;if(typeof t==="string"&&!/\W/.test(t)){var w=t=x?t:t.toUpperCase();e=o}e("previousSibling",t,u,v,w,x)}},find:{ID:function(t,u,v){if(typeof u.getElementById!=="undefined"&&!v){var e=u.getElementById(t[1]);return e?[e]:[]}},NAME:function(u,x,y){if(typeof x.getElementsByName!=="undefined"){var t=[],w=x.getElementsByName(u[1]);for(var v=0,e=w.length;v<e;v++){if(w[v].getAttribute("name")===u[1]){t.push(w[v])}}return t.length===0?null:t}},TAG:function(e,t){return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(v,t,u,e,y,z){v=" "+v[1].replace(/\\/g,"")+" ";if(z){return v}for(var w=0,x;(x=t[w])!=null;w++){if(x){if(y^(x.className&&(" "+x.className+" ").indexOf(v)>=0)){if(!u){e.push(x)}}else{if(u){t[w]=false}}}}return false},ID:function(e){return e[1].replace(/\\/g,"")},TAG:function(t,e){for(var u=0;e[u]===false;u++){}return e[u]&&q(e[u])?t[1]:t[1].toUpperCase()},CHILD:function(e){if(e[1]=="nth"){var t=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(e[2]=="even"&&"2n"||e[2]=="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=(t[1]+(t[2]||1))-0;e[3]=t[3]-0}e[0]=k++;return e},ATTR:function(w,t,u,e,x,y){var v=w[1].replace(/\\/g,"");if(!y&&f.attrMap[v]){w[1]=f.attrMap[v]}if(w[2]==="~="){w[4]=" "+w[4]+" "}return w},PSEUDO:function(w,t,u,e,x){if(w[1]==="not"){if((r.exec(w[3])||"").length>1||/^\w/.test(w[3])){w[3]=b(w[3],null,null,t)}else{var v=b.filter(w[3],t,u,true^x);if(!u){e.push.apply(e,v)}return false}}else{if(f.match.POS.test(w[0])||f.match.CHILD.test(w[0])){return true}}return w},POS:function(e){e.unshift(true);return e}},filters:{enabled:function(e){return e.disabled===false&&e.type!=="hidden"},disabled:function(e){return e.disabled===true},checked:function(e){return e.checked===true},selected:function(e){e.parentNode.selectedIndex;return e.selected===true},parent:function(e){return !!e.firstChild},empty:function(e){return !e.firstChild},has:function(u,t,e){return !!b(e[3],u).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){return"text"===e.type},radio:function(e){return"radio"===e.type},checkbox:function(e){return"checkbox"===e.type},file:function(e){return"file"===e.type},password:function(e){return"password"===e.type},submit:function(e){return"submit"===e.type},image:function(e){return"image"===e.type},reset:function(e){return"reset"===e.type},button:function(e){return"button"===e.type||e.nodeName.toUpperCase()==="BUTTON"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)}},setFilters:{first:function(t,e){return e===0},last:function(u,t,e,v){return t===v.length-1},even:function(t,e){return e%2===0},odd:function(t,e){return e%2===1},lt:function(u,t,e){return t<e[3]-0},gt:function(u,t,e){return t>e[3]-0},nth:function(u,t,e){return e[3]-0==t},eq:function(u,t,e){return e[3]-0==t}},filter:{PSEUDO:function(y,u,v,z){var t=u[1],w=f.filters[t];if(w){return w(y,v,u,z)}else{if(t==="contains"){return(y.textContent||y.innerText||"").indexOf(u[3])>=0}else{if(t==="not"){var x=u[3];for(var v=0,e=x.length;v<e;v++){if(x[v]===y){return false}}return true}}}},CHILD:function(e,v){var y=v[1],t=e;switch(y){case"only":case"first":while((t=t.previousSibling)){if(t.nodeType===1){return false}}if(y=="first"){return true}t=e;case"last":while((t=t.nextSibling)){if(t.nodeType===1){return false}}return true;case"nth":var u=v[2],B=v[3];if(u==1&&B==0){return true}var x=v[0],A=e.parentNode;if(A&&(A.sizcache!==x||!e.nodeIndex)){var w=0;for(t=A.firstChild;t;t=t.nextSibling){if(t.nodeType===1){t.nodeIndex=++w}}A.sizcache=x}var z=e.nodeIndex-B;if(u==0){return z==0}else{return(z%u==0&&z/u>=0)}}},ID:function(t,e){return t.nodeType===1&&t.getAttribute&&t.getAttribute("id")===e},TAG:function(t,e){return(e==="*"&&t.nodeType===1)||t.nodeName===e},CLASS:function(t,e){return(" "+(t.className||t.getAttribute("class"))+" ").indexOf(e)>-1},ATTR:function(x,v){var u=v[1],e=f.attrHandle[u]?f.attrHandle[u](x):x[u]!=null?x[u]:x.getAttribute(u),y=e+"",w=v[2],t=v[4];return e==null?w==="!=":w==="="?y===t:w==="*="?y.indexOf(t)>=0:w==="~="?(" "+y+" ").indexOf(t)>=0:!t?y&&e!==false:w==="!="?y!=t:w==="^="?y.indexOf(t)===0:w==="$="?y.substr(y.length-t.length)===t:w==="|="?y===t||y.substr(0,t.length+1)===t+"-":false},POS:function(w,t,u,x){var e=t[2],v=f.setFilters[e];if(v){return v(w,u,t,x)}}}};var l=f.match.POS;for(var n in f.match){f.match[n]=new RegExp(f.match[n].source+/(?![^\[]*\])(?![^\(]*\))/.source);f.leftMatch[n]=new RegExp(/(^(?:.|\r|\n)*?)/.source+f.match[n].source)}var a=function(t,e){t=Array.prototype.slice.call(t,0);if(e){e.push.apply(e,t);return e}return t};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(m){a=function(w,v){var t=v||[];if(d.call(w)==="[object Array]"){Array.prototype.push.apply(t,w)}else{if(typeof w.length==="number"){for(var u=0,e=w.length;u<e;u++){t.push(w[u])}}else{for(var u=0;w[u];u++){t.push(w[u])}}}return t}}var c;if(document.documentElement.compareDocumentPosition){c=function(t,e){if(!t.compareDocumentPosition||!e.compareDocumentPosition){if(t==e){p=true}return 0}var u=t.compareDocumentPosition(e)&4?-1:t===e?0:1;if(u===0){p=true}return u}}else{if("sourceIndex" in document.documentElement){c=function(t,e){if(!t.sourceIndex||!e.sourceIndex){if(t==e){p=true}return 0}var u=t.sourceIndex-e.sourceIndex;if(u===0){p=true}return u}}else{if(document.createRange){c=function(v,t){if(!v.ownerDocument||!t.ownerDocument){if(v==t){p=true}return 0}var u=v.ownerDocument.createRange(),e=t.ownerDocument.createRange();u.setStart(v,0);u.setEnd(v,0);e.setStart(t,0);e.setEnd(t,0);var w=u.compareBoundaryPoints(Range.START_TO_END,e);if(w===0){p=true}return w}}}}(function(){var t=document.createElement("div"),u="script"+(new Date).getTime();t.innerHTML="<a name='"+u+"'/>";var e=document.documentElement;e.insertBefore(t,e.firstChild);if(!!document.getElementById(u)){f.find.ID=function(w,x,y){if(typeof x.getElementById!=="undefined"&&!y){var v=x.getElementById(w[1]);return v?v.id===w[1]||typeof v.getAttributeNode!=="undefined"&&v.getAttributeNode("id").nodeValue===w[1]?[v]:undefined:[]}};f.filter.ID=function(x,v){var w=typeof x.getAttributeNode!=="undefined"&&x.getAttributeNode("id");return x.nodeType===1&&w&&w.nodeValue===v}}e.removeChild(t);e=t=null})();(function(){var e=document.createElement("div");e.appendChild(document.createComment(""));if(e.getElementsByTagName("*").length>0){f.find.TAG=function(t,x){var w=x.getElementsByTagName(t[1]);if(t[1]==="*"){var v=[];for(var u=0;w[u];u++){if(w[u].nodeType===1){v.push(w[u])}}w=v}return w}}e.innerHTML="<a href='#'></a>";if(e.firstChild&&typeof e.firstChild.getAttribute!=="undefined"&&e.firstChild.getAttribute("href")!=="#"){f.attrHandle.href=function(t){return t.getAttribute("href",2)}}e=null})();if(document.querySelectorAll){(function(){var e=b,u=document.createElement("div");u.innerHTML="<p class='TEST'></p>";if(u.querySelectorAll&&u.querySelectorAll(".TEST").length===0){return}b=function(y,x,v,w){x=x||document;if(!w&&x.nodeType===9&&!q(x)){try{return a(x.querySelectorAll(y),v)}catch(z){}}return e(y,x,v,w)};for(var t in e){b[t]=e[t]}u=null})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var e=document.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(e.getElementsByClassName("e").length===0){return}e.lastChild.className="e";if(e.getElementsByClassName("e").length===1){return}f.order.splice(1,0,"CLASS");f.find.CLASS=function(t,u,v){if(typeof u.getElementsByClassName!=="undefined"&&!v){return u.getElementsByClassName(t[1])}};e=null})()}function o(t,y,x,C,z,B){var A=t=="previousSibling"&&!B;for(var v=0,u=C.length;v<u;v++){var e=C[v];if(e){if(A&&e.nodeType===1){e.sizcache=x;e.sizset=v}e=e[t];var w=false;while(e){if(e.sizcache===x){w=C[e.sizset];break}if(e.nodeType===1&&!B){e.sizcache=x;e.sizset=v}if(e.nodeName===y){w=e;break}e=e[t]}C[v]=w}}}function s(t,y,x,C,z,B){var A=t=="previousSibling"&&!B;for(var v=0,u=C.length;v<u;v++){var e=C[v];if(e){if(A&&e.nodeType===1){e.sizcache=x;e.sizset=v}e=e[t];var w=false;while(e){if(e.sizcache===x){w=C[e.sizset];break}if(e.nodeType===1){if(!B){e.sizcache=x;e.sizset=v}if(typeof y!=="string"){if(e===y){w=true;break}}else{if(b.filter(y,[e]).length>0){w=e;break}}}e=e[t]}C[v]=w}}}var h=document.compareDocumentPosition?function(t,e){return t.compareDocumentPosition(e)&16}:function(t,e){return t!==e&&(t.contains?t.contains(e):true)};var q=function(e){return e.nodeType===9&&e.documentElement.nodeName!=="HTML"||!!e.ownerDocument&&e.ownerDocument.documentElement.nodeName!=="HTML"};var g=function(e,z){var v=[],w="",x,u=z.nodeType?[z]:z;while((x=f.match.PSEUDO.exec(e))){w+=x[0];e=e.replace(f.match.PSEUDO,"")}e=f.relative[e]?e+"*":e;for(var y=0,t=u.length;y<t;y++){b(e,u[y],v)}return b.filter(w,v)};window.Sizzle=b})();(function(c){var d=Prototype.Selector.extendElements;function a(e,f){return d(c(e,f||document))}function b(f,e){return c.matches(e,[f]).length==1}Prototype.Selector.engine=c;Prototype.Selector.select=a;Prototype.Selector.match=b})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;var Form={reset:function(a){a=$(a);a.reset();return a},serializeElements:function(h,d){if(typeof d!="object"){d={hash:!!d}}else{if(Object.isUndefined(d.hash)){d.hash=true}}var e,g,a=false,f=d.submit,b,c;if(d.hash){c={};b=function(j,k,l){if(k in j){if(!Object.isArray(j[k])){j[k]=[j[k]]}j[k].push(l)}else{j[k]=l}return j}}else{c="";b=function(j,k,l){return j+(j?"&":"")+encodeURIComponent(k)+"="+encodeURIComponent(l)}}return h.inject(c,function(j,k){if(!k.disabled&&k.name){e=k.name;g=$(k).getValue();if(g!=null&&k.type!="file"&&(k.type!="submit"||(!a&&f!==false&&(!f||e==f)&&(a=true)))){j=b(j,e,g)}}return j})}};Form.Methods={serialize:function(b,a){return Form.serializeElements(Form.getElements(b),a)},getElements:function(e){var f=$(e).getElementsByTagName("*"),d,a=[],c=Form.Element.Serializers;for(var b=0;d=f[b];b++){a.push(d)}return a.inject([],function(g,h){if(c[h.tagName.toLowerCase()]){g.push(Element.extend(h))}return g})},getInputs:function(g,c,d){g=$(g);var a=g.getElementsByTagName("input");if(!c&&!d){return $A(a).map(Element.extend)}for(var e=0,h=[],f=a.length;e<f;e++){var b=a[e];if((c&&b.type!=c)||(d&&b.name!=d)){continue}h.push(Element.extend(b))}return h},disable:function(a){a=$(a);Form.getElements(a).invoke("disable");return a},enable:function(a){a=$(a);Form.getElements(a).invoke("enable");return a},findFirstElement:function(b){var c=$(b).getElements().findAll(function(d){return"hidden"!=d.type&&!d.disabled});var a=c.findAll(function(d){return d.hasAttribute("tabIndex")&&d.tabIndex>=0}).sortBy(function(d){return d.tabIndex}).first();return a?a:c.find(function(d){return/^(?:input|select|textarea)$/i.test(d.tagName)})},focusFirstElement:function(b){b=$(b);var a=b.findFirstElement();if(a){a.activate()}return b},request:function(b,a){b=$(b),a=Object.clone(a||{});var d=a.parameters,c=b.readAttribute("action")||"";if(c.blank()){c=window.location.href}a.parameters=b.serialize(true);if(d){if(Object.isString(d)){d=d.toQueryParams()}Object.extend(a.parameters,d)}if(b.hasAttribute("method")&&!a.method){a.method=b.method}return new Ajax.Request(c,a)}};Form.Element={focus:function(a){$(a).focus();return a},select:function(a){$(a).select();return a}};Form.Element.Methods={serialize:function(a){a=$(a);if(!a.disabled&&a.name){var b=a.getValue();if(b!=undefined){var c={};c[a.name]=b;return Object.toQueryString(c)}}return""},getValue:function(a){a=$(a);var b=a.tagName.toLowerCase();return Form.Element.Serializers[b](a)},setValue:function(a,b){a=$(a);var c=a.tagName.toLowerCase();Form.Element.Serializers[c](a,b);return a},clear:function(a){$(a).value="";return a},present:function(a){return $(a).value!=""},activate:function(a){a=$(a);try{a.focus();if(a.select&&(a.tagName.toLowerCase()!="input"||!(/^(?:button|reset|submit)$/i.test(a.type)))){a.select()}}catch(b){}return a},disable:function(a){a=$(a);a.disabled=true;return a},enable:function(a){a=$(a);a.disabled=false;return a}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers=(function(){function b(h,j){switch(h.type.toLowerCase()){case"checkbox":case"radio":return f(h,j);default:return e(h,j)}}function f(h,j){if(Object.isUndefined(j)){return h.checked?h.value:null}else{h.checked=!!j}}function e(h,j){if(Object.isUndefined(j)){return h.value}else{h.value=j}}function a(k,n){if(Object.isUndefined(n)){return(k.type==="select-one"?c:d)(k)}var j,l,o=!Object.isArray(n);for(var h=0,m=k.length;h<m;h++){j=k.options[h];l=this.optionValue(j);if(o){if(l==n){j.selected=true;return}}else{j.selected=n.include(l)}}}function c(j){var h=j.selectedIndex;return h>=0?g(j.options[h]):null}function d(l){var h,m=l.length;if(!m){return null}for(var k=0,h=[];k<m;k++){var j=l.options[k];if(j.selected){h.push(g(j))}}return h}function g(h){return Element.hasAttribute(h,"value")?h.value:h.text}return{input:b,inputSelector:f,textarea:e,select:a,selectOne:c,selectMany:d,optionValue:g,button:e}})();Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,a,b,c){$super(c,b);this.element=$(a);this.lastValue=this.getValue()},execute:function(){var a=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(a)?this.lastValue!=a:String(this.lastValue)!=String(a)){this.callback(this.element,a);this.lastValue=a}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=Class.create({initialize:function(a,b){this.element=$(a);this.callback=b;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var a=this.getValue();if(this.lastValue!=a){this.callback(this.element,a);this.lastValue=a}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(a){if(a.type){switch(a.type.toLowerCase()){case"checkbox":case"radio":Event.observe(a,"click",this.onElementEvent.bind(this));break;default:Event.observe(a,"change",this.onElementEvent.bind(this));break}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});(function(){var D={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}};var f=document.documentElement;var E="onmouseenter" in f&&"onmouseleave" in f;var a=function(F){return false};if(window.attachEvent){if(window.addEventListener){a=function(F){return !(F instanceof window.Event)}}else{a=function(F){return true}}}var s;function B(G,F){return G.which?(G.which===F+1):(G.button===F)}var p={0:1,1:4,2:2};function z(G,F){return G.button===p[F]}function C(G,F){switch(F){case 0:return G.which==1&&!G.metaKey;case 1:return G.which==2||(G.which==1&&G.metaKey);case 2:return G.which==3;default:return false}}if(window.attachEvent){if(!window.addEventListener){s=z}else{s=function(G,F){return a(G)?z(G,F):B(G,F)}}}else{if(Prototype.Browser.WebKit){s=C}else{s=B}}function w(F){return s(F,0)}function u(F){return s(F,1)}function o(F){return s(F,2)}function d(H){H=D.extend(H);var G=H.target,F=H.type,I=H.currentTarget;if(I&&I.tagName){if(F==="load"||F==="error"||(F==="click"&&I.tagName.toLowerCase()==="input"&&I.type==="radio")){G=I}}if(G.nodeType==Node.TEXT_NODE){G=G.parentNode}return Element.extend(G)}function q(G,H){var F=D.element(G);if(!H){return F}while(F){if(Object.isElement(F)&&Prototype.Selector.match(F,H)){return Element.extend(F)}F=F.parentNode}}function t(F){return{x:c(F),y:b(F)}}function c(H){var G=document.documentElement,F=document.body||{scrollLeft:0};return H.pageX||(H.clientX+(G.scrollLeft||F.scrollLeft)-(G.clientLeft||0))}function b(H){var G=document.documentElement,F=document.body||{scrollTop:0};return H.pageY||(H.clientY+(G.scrollTop||F.scrollTop)-(G.clientTop||0))}function r(F){D.extend(F);F.preventDefault();F.stopPropagation();F.stopped=true}D.Methods={isLeftClick:w,isMiddleClick:u,isRightClick:o,element:d,findElement:q,pointer:t,pointerX:c,pointerY:b,stop:r};var y=Object.keys(D.Methods).inject({},function(F,G){F[G]=D.Methods[G].methodize();return F});if(window.attachEvent){function j(G){var F;switch(G.type){case"mouseover":case"mouseenter":F=G.fromElement;break;case"mouseout":case"mouseleave":F=G.toElement;break;default:return null}return Element.extend(F)}var v={stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}};D.extend=function(G,F){if(!G){return false}if(!a(G)){return G}if(G._extendedByPrototype){return G}G._extendedByPrototype=Prototype.emptyFunction;var H=D.pointer(G);Object.extend(G,{target:G.srcElement||F,relatedTarget:j(G),pageX:H.x,pageY:H.y});Object.extend(G,y);Object.extend(G,v);return G}}else{D.extend=Prototype.K}if(window.addEventListener){D.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(D.prototype,y)}function n(J,I,K){var H=Element.retrieve(J,"prototype_event_registry");if(Object.isUndefined(H)){e.push(J);H=Element.retrieve(J,"prototype_event_registry",$H())}var F=H.get(I);if(Object.isUndefined(F)){F=[];H.set(I,F)}if(F.pluck("handler").include(K)){return false}var G;if(I.include(":")){G=function(L){if(Object.isUndefined(L.eventName)){return false}if(L.eventName!==I){return false}D.extend(L,J);K.call(J,L)}}else{if(!E&&(I==="mouseenter"||I==="mouseleave")){if(I==="mouseenter"||I==="mouseleave"){G=function(M){D.extend(M,J);var L=M.relatedTarget;while(L&&L!==J){try{L=L.parentNode}catch(N){L=J}}if(L===J){return}K.call(J,M)}}}else{G=function(L){D.extend(L,J);K.call(J,L)}}}G.handler=K;F.push(G);return G}function h(){for(var F=0,G=e.length;F<G;F++){D.stopObserving(e[F]);e[F]=null}}var e=[];if(Prototype.Browser.IE){window.attachEvent("onunload",h)}if(Prototype.Browser.WebKit){window.addEventListener("unload",Prototype.emptyFunction,false)}var m=Prototype.K,g={mouseenter:"mouseover",mouseleave:"mouseout"};if(!E){m=function(F){return(g[F]||F)}}function x(I,H,J){I=$(I);var G=n(I,H,J);if(!G){return I}if(H.include(":")){if(I.addEventListener){I.addEventListener("dataavailable",G,false)}else{I.attachEvent("ondataavailable",G);I.attachEvent("onlosecapture",G)}}else{var F=m(H);if(I.addEventListener){I.addEventListener(F,G,false)}else{I.attachEvent("on"+F,G)}}return I}function l(L,I,M){L=$(L);var H=Element.retrieve(L,"prototype_event_registry");if(!H){return L}if(!I){H.each(function(O){var N=O.key;l(L,N)});return L}var J=H.get(I);if(!J){return L}if(!M){J.each(function(N){l(L,I,N.handler)});return L}var K=J.length,G;while(K--){if(J[K].handler===M){G=J[K];break}}if(!G){return L}if(I.include(":")){if(L.removeEventListener){L.removeEventListener("dataavailable",G,false)}else{L.detachEvent("ondataavailable",G);L.detachEvent("onlosecapture",G)}}else{var F=m(I);if(L.removeEventListener){L.removeEventListener(F,G,false)}else{L.detachEvent("on"+F,G)}}H.set(I,J.without(G));return L}function A(I,H,G,F){I=$(I);if(Object.isUndefined(F)){F=true}if(I==document&&document.createEvent&&!I.dispatchEvent){I=document.documentElement}var J;if(document.createEvent){J=document.createEvent("HTMLEvents");J.initEvent("dataavailable",F,true)}else{J=document.createEventObject();J.eventType=F?"ondataavailable":"onlosecapture"}J.eventName=H;J.memo=G||{};if(document.createEvent){I.dispatchEvent(J)}else{I.fireEvent(J.eventType,J)}return D.extend(J)}D.Handler=Class.create({initialize:function(H,G,F,I){this.element=$(H);this.eventName=G;this.selector=F;this.callback=I;this.handler=this.handleEvent.bind(this)},start:function(){D.observe(this.element,this.eventName,this.handler);return this},stop:function(){D.stopObserving(this.element,this.eventName,this.handler);return this},handleEvent:function(G){var F=D.findElement(G,this.selector);if(F){this.callback.call(this.element,G,F)}}});function k(H,G,F,I){H=$(H);if(Object.isFunction(F)&&Object.isUndefined(I)){I=F,F=null}return new D.Handler(H,G,F,I).start()}Object.extend(D,D.Methods);Object.extend(D,{fire:A,observe:x,stopObserving:l,on:k});Element.addMethods({fire:A,observe:x,stopObserving:l,on:k});Object.extend(document,{fire:A.methodize(),observe:x.methodize(),stopObserving:l.methodize(),on:k.methodize(),loaded:false});if(window.Event){Object.extend(window.Event,D)}else{window.Event=D}})();(function(){var d;function a(){if(document.loaded){return}if(d){window.clearTimeout(d)}document.loaded=true;document.fire("dom:loaded")}function c(){if(document.readyState==="complete"){document.stopObserving("readystatechange",c);a()}}function b(){try{document.documentElement.doScroll("left")}catch(f){d=b.defer();return}a()}if(document.addEventListener){document.addEventListener("DOMContentLoaded",a,false)}else{document.observe("readystatechange",c);if(window==top){d=b.defer()}}Event.observe(window,"load",a)})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(a,b){return Element.insert(a,{before:b})},Top:function(a,b){return Element.insert(a,{top:b})},Bottom:function(a,b){return Element.insert(a,{bottom:b})},After:function(a,b){return Element.insert(a,{after:b})}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(b,a,c){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(b,a,c)}this.xcomp=a;this.ycomp=c;this.offset=Element.cumulativeOffset(b);return(c>=this.offset[1]&&c<this.offset[1]+b.offsetHeight&&a>=this.offset[0]&&a<this.offset[0]+b.offsetWidth)},withinIncludingScrolloffsets:function(b,a,d){var c=Element.cumulativeScrollOffset(b);this.xcomp=a+c[0]-this.deltaX;this.ycomp=d+c[1]-this.deltaY;this.offset=Element.cumulativeOffset(b);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+b.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+b.offsetWidth)},overlap:function(b,a){if(!b){return 0}if(b=="vertical"){return((this.offset[1]+a.offsetHeight)-this.ycomp)/a.offsetHeight}if(b=="horizontal"){return((this.offset[0]+a.offsetWidth)-this.xcomp)/a.offsetWidth}},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(a){Position.prepare();return Element.absolutize(a)},relativize:function(a){Position.prepare();return Element.relativize(a)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(b,c,a){a=a||{};return Element.clonePosition(c,b,a)}};if(!document.getElementsByClassName){document.getElementsByClassName=function(b){function a(c){return c.blank()?null:"[contains(concat(' ', @class, ' '), ' "+c+" ')]"}b.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(c,e){e=e.toString().strip();var d=/\s/.test(e)?$w(e).map(a).join(""):a(e);return d?document._getElementsByXPath(".//*"+d,c):[]}:function(e,f){f=f.toString().strip();var g=[],h=(/\s/.test(f)?$w(f):null);if(!h&&!f){return g}var c=$(e).getElementsByTagName("*");f=" "+f+" ";for(var d=0,k,j;k=c[d];d++){if(k.className&&(j=" "+k.className+" ")&&(j.include(f)||(h&&h.all(function(l){return !l.toString().blank()&&j.include(" "+l+" ")})))){g.push(Element.extend(k))}}return g};return function(d,c){return $(c||document.body).getElementsByClassName(d)}}(Element.Methods)}Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(a){this.element=$(a)},_each:function(a){this.element.className.split(/\s+/).select(function(b){return b.length>0})._each(a)},set:function(a){this.element.className=a},add:function(a){if(this.include(a)){return}this.set($A(this).concat(a).join(" "))},remove:function(a){if(!this.include(a)){return}this.set($A(this).without(a).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);(function(){window.Selector=Class.create({initialize:function(a){this.expression=a.strip()},findElements:function(a){return Prototype.Selector.select(this.expression,a)},match:function(a){return Prototype.Selector.match(a,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}});Object.extend(Selector,{matchElements:function(f,g){var a=Prototype.Selector.match,d=[];for(var c=0,e=f.length;c<e;c++){var b=f[c];if(a(b,g)){d.push(Element.extend(b))}}return d},findElement:function(f,g,b){b=b||0;var a=0,d;for(var c=0,e=f.length;c<e;c++){d=f[c];if(Prototype.Selector.match(d,g)&&b===a++){return Element.extend(d)}}},findChildElements:function(b,c){var a=c.toArray().join(", ");return Prototype.Selector.select(a,b||document)}})})();String.prototype.parseColor=function(){var a="#";if(this.slice(0,4)=="rgb("){var c=this.slice(4,this.length-1).split(",");var b=0;do{a+=parseInt(c[b]).toColorPart()}while(++b<3)}else{if(this.slice(0,1)=="#"){if(this.length==4){for(var b=1;b<4;b++){a+=(this.charAt(b)+this.charAt(b)).toLowerCase()}}if(this.length==7){a=this.toLowerCase()}}}return(a.length==7?a:(arguments[0]||this))};Element.collectTextNodes=function(a){return $A($(a).childNodes).collect(function(b){return(b.nodeType==3?b.nodeValue:(b.hasChildNodes()?Element.collectTextNodes(b):""))}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(c){return(c.nodeType==3?c.nodeValue:((c.hasChildNodes()&&!Element.hasClassName(c,b))?Element.collectTextNodesIgnoreClass(c,b):""))}).flatten().join("")};Element.setContentZoom=function(a,b){a=$(a);a.setStyle({fontSize:(b/100)+"em"});if(Prototype.Browser.WebKit){window.scrollBy(0,0)}return a};Element.getInlineOpacity=function(a){return $(a).style.opacity||""};Element.forceRerendering=function(a){try{a=$(a);var c=document.createTextNode(" ");a.appendChild(c);a.removeChild(c)}catch(b){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(a){return(-Math.cos(a*Math.PI)/2)+0.5},reverse:function(a){return 1-a},flicker:function(a){var a=((-Math.cos(a*Math.PI)/4)+0.75)+Math.random()/4;return a>1?1:a},wobble:function(a){return(-Math.cos(a*Math.PI*(9*a))/2)+0.5},pulse:function(b,a){return(-Math.cos((b*((a||5)-0.5)*2)*Math.PI)/2)+0.5},spring:function(a){return 1-(Math.cos(a*4.5*Math.PI)*Math.exp(-a*6))},none:function(a){return 0},full:function(a){return 1}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(a){var b="position:relative";if(Prototype.Browser.IE){b+=";zoom:1"}a=$(a);$A(a.childNodes).each(function(c){if(c.nodeType==3){c.nodeValue.toArray().each(function(d){a.insertBefore(new Element("span",{style:b}).update(d==" "?String.fromCharCode(160):d),c)});Element.remove(c)}})},multiple:function(b,c){var e;if(((typeof b=="object")||Object.isFunction(b))&&(b.length)){e=b}else{e=$(b).childNodes}var a=Object.extend({speed:0.1,delay:0},arguments[2]||{});var d=a.delay;$A(e).each(function(g,f){new c(g,Object.extend(a,{delay:f*a.speed+d}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(b,c,a){b=$(b);c=(c||"appear").toLowerCase();return Effect[Effect.PAIRS[c][b.visible()?1:0]](b,Object.extend({queue:{position:"end",scope:(b.id||"global"),limit:1}},a||{}))}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(a){this.effects._each(a)},add:function(b){var c=new Date().getTime();var a=Object.isString(b.options.queue)?b.options.queue:b.options.queue.position;switch(a){case"front":this.effects.findAll(function(d){return d.state=="idle"}).each(function(d){d.startOn+=b.finishOn;d.finishOn+=b.finishOn});break;case"with-last":c=this.effects.pluck("startOn").max()||c;break;case"end":c=this.effects.pluck("finishOn").max()||c;break}b.startOn+=c;b.finishOn+=c;if(!b.options.queue.limit||(this.effects.length<b.options.queue.limit)){this.effects.push(b)}if(!this.interval){this.interval=setInterval(this.loop.bind(this),15)}},remove:function(a){this.effects=this.effects.reject(function(b){return b==a});if(this.effects.length==0){clearInterval(this.interval);this.interval=null}},loop:function(){var c=new Date().getTime();for(var b=0,a=this.effects.length;b<a;b++){this.effects[b]&&this.effects[b].loop(c)}}});Effect.Queues={instances:$H(),get:function(a){if(!Object.isString(a)){return a}return this.instances.get(a)||this.instances.set(a,new Effect.ScopedQueue())}};Effect.Queue=Effect.Queues.get("global");Effect.Base=Class.create({position:null,start:function(a){if(a&&a.transition===false){a.transition=Effect.Transitions.linear}this.options=Object.extend(Object.extend({},Effect.DefaultOptions),a||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=(function(){function b(d,c){if(d.options[c+"Internal"]){d.options[c+"Internal"](d)}if(d.options[c]){d.options[c](d)}}return function(c){if(this.state==="idle"){this.state="running";b(this,"beforeSetup");if(this.setup){this.setup()}b(this,"afterSetup")}if(this.state==="running"){c=(this.options.transition(c)*this.fromToDelta)+this.options.from;this.position=c;b(this,"beforeUpdate");if(this.update){this.update(c)}b(this,"afterUpdate")}}})();this.event("beforeStart");if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)}},loop:function(c){if(c>=this.startOn){if(c>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");if(this.finish){this.finish()}this.event("afterFinish");return}var b=(c-this.startOn)/this.totalTime,a=(b*this.totalFrames).round();if(a>this.currentFrame){this.render(b);this.currentFrame=a}}},cancel:function(){if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this)}this.state="finished"},event:function(a){if(this.options[a+"Internal"]){this.options[a+"Internal"](this)}if(this.options[a]){this.options[a](this)}},inspect:function(){var a=$H();for(property in this){if(!Object.isFunction(this[property])){a.set(property,this[property])}}return"#<Effect:"+a.inspect()+",options:"+$H(this.options).inspect()+">"}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(a){this.effects=a||[];this.start(arguments[1])},update:function(a){this.effects.invoke("render",a)},finish:function(a){this.effects.each(function(b){b.render(1);b.cancel();b.event("beforeFinish");if(b.finish){b.finish(a)}b.event("afterFinish")})}});Effect.Tween=Class.create(Effect.Base,{initialize:function(c,f,e){c=Object.isString(c)?$(c):c;var b=$A(arguments),d=b.last(),a=b.length==5?b[3]:null;this.method=Object.isFunction(d)?d.bind(c):Object.isFunction(c[d])?c[d].bind(c):function(g){c[d]=g};this.start(Object.extend({from:f,to:e},a||{}))},update:function(a){this.method(a)}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}))},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}var a=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(a)},update:function(a){this.element.setOpacity(a)}});Effect.Move=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(a)},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop}},update:function(a){this.element.setStyle({left:(this.options.x*a+this.originalLeft).round()+"px",top:(this.options.y*a+this.originalTop).round()+"px"})}});Effect.MoveBy=function(b,a,c){return new Effect.Move(b,Object.extend({x:c,y:a},arguments[3]||{}))};Effect.Scale=Class.create(Effect.Base,{initialize:function(b,c){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:c},arguments[2]||{});this.start(a)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(b){this.originalStyle[b]=this.element.style[b]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var a=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(b){if(a.indexOf(b)>0){this.fontSize=parseFloat(a);this.fontSizeType=b}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box"){this.dims=[this.element.offsetHeight,this.element.offsetWidth]}if(/^content/.test(this.options.scaleMode)){this.dims=[this.element.scrollHeight,this.element.scrollWidth]}if(!this.dims){this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]}},update:function(a){var b=(this.options.scaleFrom/100)+(this.factor*a);if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*b+this.fontSizeType})}this.setDimensions(this.dims[0]*b,this.dims[1]*b)},finish:function(a){if(this.restoreAfterFinish){this.element.setStyle(this.originalStyle)}},setDimensions:function(a,e){var f={};if(this.options.scaleX){f.width=e.round()+"px"}if(this.options.scaleY){f.height=a.round()+"px"}if(this.options.scaleFromCenter){var c=(a-this.dims[0])/2;var b=(e-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY){f.top=this.originalTop-c+"px"}if(this.options.scaleX){f.left=this.originalLeft-b+"px"}}else{if(this.options.scaleY){f.top=-c+"px"}if(this.options.scaleX){f.left=-b+"px"}}}this.element.setStyle(f)}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(a)},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return}this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color")}this._base=$R(0,2).map(function(a){return parseInt(this.options.startcolor.slice(a*2+1,a*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(a){return parseInt(this.options.endcolor.slice(a*2+1,a*2+3),16)-this._base[a]}.bind(this))},update:function(a){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(b,c,d){return b+((this._base[d]+(this._delta[d]*a)).round().toColorPart())}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(c){var b=arguments[1]||{},a=document.viewport.getScrollOffsets(),d=$(c).cumulativeOffset();if(b.offset){d[1]+=b.offset}return new Effect.Tween(null,a.top,d[1],b,function(e){scrollTo(a.left,e.round())})};Effect.Fade=function(c){c=$(c);var a=c.getInlineOpacity();var b=Object.extend({from:c.getOpacity()||1,to:0,afterFinishInternal:function(d){if(d.options.to!=0){return}d.element.hide().setStyle({opacity:a})}},arguments[1]||{});return new Effect.Opacity(c,b)};Effect.Appear=function(b){b=$(b);var a=Object.extend({from:(b.getStyle("display")=="none"?0:b.getOpacity()||0),to:1,afterFinishInternal:function(c){c.element.forceRerendering()},beforeSetup:function(c){c.element.setOpacity(c.options.from).show()}},arguments[1]||{});return new Effect.Opacity(b,a)};Effect.Puff=function(b){b=$(b);var a={opacity:b.getInlineOpacity(),position:b.getStyle("position"),top:b.style.top,left:b.style.left,width:b.style.width,height:b.style.height};return new Effect.Parallel([new Effect.Scale(b,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(b,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(c){Position.absolutize(c.effects[0].element)},afterFinishInternal:function(c){c.effects[0].element.hide().setStyle(a)}},arguments[1]||{}))};Effect.BlindUp=function(a){a=$(a);a.makeClipping();return new Effect.Scale(a,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(b){b.element.hide().undoClipping()}},arguments[1]||{}))};Effect.BlindDown=function(b){b=$(b);var a=b.getDimensions();return new Effect.Scale(b,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:a.height,originalWidth:a.width},restoreAfterFinish:true,afterSetup:function(c){c.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(c){c.element.undoClipping()}},arguments[1]||{}))};Effect.SwitchOff=function(b){b=$(b);var a=b.getInlineOpacity();return new Effect.Appear(b,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(c){new Effect.Scale(c.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(d){d.element.makePositioned().makeClipping()},afterFinishInternal:function(d){d.element.hide().undoClipping().undoPositioned().setStyle({opacity:a})}})}},arguments[1]||{}))};Effect.DropOut=function(b){b=$(b);var a={top:b.getStyle("top"),left:b.getStyle("left"),opacity:b.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(b,{x:0,y:100,sync:true}),new Effect.Opacity(b,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(c){c.effects[0].element.makePositioned()},afterFinishInternal:function(c){c.effects[0].element.hide().undoPositioned().setStyle(a)}},arguments[1]||{}))};Effect.Shake=function(d){d=$(d);var b=Object.extend({distance:20,duration:0.5},arguments[1]||{});var e=parseFloat(b.distance);var c=parseFloat(b.duration)/10;var a={top:d.getStyle("top"),left:d.getStyle("left")};return new Effect.Move(d,{x:e,y:0,duration:c,afterFinishInternal:function(f){new Effect.Move(f.element,{x:-e*2,y:0,duration:c*2,afterFinishInternal:function(g){new Effect.Move(g.element,{x:e*2,y:0,duration:c*2,afterFinishInternal:function(h){new Effect.Move(h.element,{x:-e*2,y:0,duration:c*2,afterFinishInternal:function(j){new Effect.Move(j.element,{x:e*2,y:0,duration:c*2,afterFinishInternal:function(k){new Effect.Move(k.element,{x:-e,y:0,duration:c,afterFinishInternal:function(l){l.element.undoPositioned().setStyle(a)}})}})}})}})}})}})};Effect.SlideDown=function(c){c=$(c).cleanWhitespace();var a=c.down().getStyle("bottom");var b=c.getDimensions();return new Effect.Scale(c,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:b.height,originalWidth:b.width},restoreAfterFinish:true,afterSetup:function(d){d.element.makePositioned();d.element.down().makePositioned();if(window.opera){d.element.setStyle({top:""})}d.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(d){d.element.down().setStyle({bottom:(d.dims[0]-d.element.clientHeight)+"px"})},afterFinishInternal:function(d){d.element.undoClipping().undoPositioned();d.element.down().undoPositioned().setStyle({bottom:a})}},arguments[1]||{}))};Effect.SlideUp=function(c){c=$(c).cleanWhitespace();var a=c.down().getStyle("bottom");var b=c.getDimensions();return new Effect.Scale(c,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:b.height,originalWidth:b.width},restoreAfterFinish:true,afterSetup:function(d){d.element.makePositioned();d.element.down().makePositioned();if(window.opera){d.element.setStyle({top:""})}d.element.makeClipping().show()},afterUpdateInternal:function(d){d.element.down().setStyle({bottom:(d.dims[0]-d.element.clientHeight)+"px"})},afterFinishInternal:function(d){d.element.hide().undoClipping().undoPositioned();d.element.down().undoPositioned().setStyle({bottom:a})}},arguments[1]||{}))};Effect.Squish=function(a){return new Effect.Scale(a,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(b){b.element.makeClipping()},afterFinishInternal:function(b){b.element.hide().undoClipping()}})};Effect.Grow=function(c){c=$(c);var b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var a={top:c.style.top,left:c.style.left,height:c.style.height,width:c.style.width,opacity:c.getInlineOpacity()};var g=c.getDimensions();var h,f;var e,d;switch(b.direction){case"top-left":h=f=e=d=0;break;case"top-right":h=g.width;f=d=0;e=-g.width;break;case"bottom-left":h=e=0;f=g.height;d=-g.height;break;case"bottom-right":h=g.width;f=g.height;e=-g.width;d=-g.height;break;case"center":h=g.width/2;f=g.height/2;e=-g.width/2;d=-g.height/2;break}return new Effect.Move(c,{x:h,y:f,duration:0.01,beforeSetup:function(j){j.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(j){new Effect.Parallel([new Effect.Opacity(j.element,{sync:true,to:1,from:0,transition:b.opacityTransition}),new Effect.Move(j.element,{x:e,y:d,sync:true,transition:b.moveTransition}),new Effect.Scale(j.element,100,{scaleMode:{originalHeight:g.height,originalWidth:g.width},sync:true,scaleFrom:window.opera?1:0,transition:b.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(k){k.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(k){k.effects[0].element.undoClipping().undoPositioned().setStyle(a)}},b))}})};Effect.Shrink=function(c){c=$(c);var b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var a={top:c.style.top,left:c.style.left,height:c.style.height,width:c.style.width,opacity:c.getInlineOpacity()};var f=c.getDimensions();var e,d;switch(b.direction){case"top-left":e=d=0;break;case"top-right":e=f.width;d=0;break;case"bottom-left":e=0;d=f.height;break;case"bottom-right":e=f.width;d=f.height;break;case"center":e=f.width/2;d=f.height/2;break}return new Effect.Parallel([new Effect.Opacity(c,{sync:true,to:0,from:1,transition:b.opacityTransition}),new Effect.Scale(c,window.opera?1:0,{sync:true,transition:b.scaleTransition,restoreAfterFinish:true}),new Effect.Move(c,{x:e,y:d,sync:true,transition:b.moveTransition})],Object.extend({beforeStartInternal:function(g){g.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(g){g.effects[0].element.hide().undoClipping().undoPositioned().setStyle(a)}},b))};Effect.Pulsate=function(c){c=$(c);var b=arguments[1]||{},a=c.getInlineOpacity(),e=b.transition||Effect.Transitions.linear,d=function(f){return 1-e((-Math.cos((f*(b.pulses||5)*2)*Math.PI)/2)+0.5)};return new Effect.Opacity(c,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(f){f.element.setStyle({opacity:a})}},b),{transition:d}))};Effect.Fold=function(b){b=$(b);var a={top:b.style.top,left:b.style.left,width:b.style.width,height:b.style.height};b.makeClipping();return new Effect.Scale(b,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(c){new Effect.Scale(b,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(d){d.element.hide().undoClipping().setStyle(a)}})}},arguments[1]||{}))};Effect.Morph=Class.create(Effect.Base,{initialize:function(c){this.element=$(c);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(a.style)){this.style=$H(a.style)}else{if(a.style.include(":")){this.style=a.style.parseStyle()}else{this.element.addClassName(a.style);this.style=$H(this.element.getStyles());this.element.removeClassName(a.style);var b=this.element.getStyles();this.style=this.style.reject(function(d){return d.value==b[d.key]});a.afterFinishInternal=function(d){d.element.addClassName(d.options.style);d.transforms.each(function(e){d.element.style[e.style]=""})}}}this.start(a)},setup:function(){function a(b){if(!b||["rgba(0, 0, 0, 0)","transparent"].include(b)){b="#ffffff"}b=b.parseColor();return $R(0,2).map(function(c){return parseInt(b.slice(c*2+1,c*2+3),16)})}this.transforms=this.style.map(function(g){var f=g[0],e=g[1],d=null;if(e.parseColor("#zzzzzz")!="#zzzzzz"){e=e.parseColor();d="color"}else{if(f=="opacity"){e=parseFloat(e);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}}else{if(Element.CSS_LENGTH.test(e)){var c=e.match(/^([\+\-]?[0-9\.]+)(.*)$/);e=parseFloat(c[1]);d=(c.length==3)?c[2]:null}}}var b=this.element.getStyle(f);return{style:f.camelize(),originalValue:d=="color"?a(b):parseFloat(b||0),targetValue:d=="color"?a(e):e,unit:d}}.bind(this)).reject(function(b){return((b.originalValue==b.targetValue)||(b.unit!="color"&&(isNaN(b.originalValue)||isNaN(b.targetValue))))})},update:function(a){var d={},b,c=this.transforms.length;while(c--){d[(b=this.transforms[c]).style]=b.unit=="color"?"#"+(Math.round(b.originalValue[0]+(b.targetValue[0]-b.originalValue[0])*a)).toColorPart()+(Math.round(b.originalValue[1]+(b.targetValue[1]-b.originalValue[1])*a)).toColorPart()+(Math.round(b.originalValue[2]+(b.targetValue[2]-b.originalValue[2])*a)).toColorPart():(b.originalValue+(b.targetValue-b.originalValue)*a).toFixed(3)+(b.unit===null?"":b.unit)}this.element.setStyle(d,true)}});Effect.Transform=Class.create({initialize:function(a){this.tracks=[];this.options=arguments[1]||{};this.addTracks(a)},addTracks:function(a){a.each(function(b){b=$H(b);var c=b.values().first();this.tracks.push($H({ids:b.keys().first(),effect:Effect.Morph,options:{style:c}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(a){var d=a.get("ids"),c=a.get("effect"),b=a.get("options");var e=[$(d)||$$(d)].flatten();return e.map(function(f){return new c(f,Object.extend({sync:true},b))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");String.prototype.parseStyle=function(){var b,a=$H();if(Prototype.Browser.WebKit){b=new Element("div",{style:this}).style}else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';b=String.__parseStyleElement.childNodes[0].style}Element.CSS_PROPERTIES.each(function(c){if(b[c]){a.set(c,b[c])}});if(Prototype.Browser.IE&&this.include("opacity")){a.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1])}return a};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(b){var a=document.defaultView.getComputedStyle($(b),null);return Element.CSS_PROPERTIES.inject({},function(c,d){c[d]=a[d];return c})}}else{Element.getStyles=function(b){b=$(b);var a=b.currentStyle,c;c=Element.CSS_PROPERTIES.inject({},function(d,e){d[e]=a[e];return d});if(!c.opacity){c.opacity=b.getOpacity()}return c}}Effect.Methods={morph:function(a,b){a=$(a);new Effect.Morph(a,Object.extend({style:b},arguments[2]||{}));return a},visualEffect:function(c,e,b){c=$(c);var d=e.dasherize().camelize(),a=d.charAt(0).toUpperCase()+d.substring(1);new Effect[a](c,b);return c},highlight:function(b,a){b=$(b);new Effect.Highlight(b,a);return b}};$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(a){Effect.Methods[a]=function(c,b){c=$(c);Effect[a.charAt(0).toUpperCase()+a.substring(1)](c,b);return c}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(a){Effect.Methods[a]=Element[a]});Element.addMethods(Effect.Methods);if(typeof Effect=="undefined"){throw ("controls.js requires including script.aculo.us' effects.js library")}var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(b,c,a){b=$(b);this.element=b;this.update=$(c);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;this.oldElementValue=this.element.value;if(this.setOptions){this.setOptions(a)}else{this.options=a||{}}this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(d,e){if(!e.style.position||e.style.position=="absolute"){e.style.position="absolute";Position.clone(d,e,{setHeight:false,offsetTop:d.offsetHeight-1})}Effect.Appear(e,{duration:0.15})};this.options.onHide=this.options.onHide||function(d,e){new Effect.Fade(e,{duration:0.15})};if(typeof(this.options.tokens)=="string"){this.options.tokens=new Array(this.options.tokens)}if(!this.options.tokens.include("\n")){this.options.tokens.push("\n")}this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){if(Element.getStyle(this.update,"display")=="none"){this.options.onShow(this.element,this.update)}if(!this.iefix&&(Prototype.Browser.IE)&&(Element.getStyle(this.update,"position")=="absolute")){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+"_iefix")}if(this.iefix){setTimeout(this.fixIEOverlapping.bind(this),50)}},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:(!this.update.style.height)});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none"){this.options.onHide(this.element,this.update)}if(this.iefix){Element.hide(this.iefix)}},startIndicator:function(){if(this.options.indicator){Element.show(this.options.indicator)}},stopIndicator:function(){if(this.options.indicator){Element.hide(this.options.indicator)}},onKeyPress:function(a){this.onObserverEvent();if(this.active){switch(a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(a);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(a);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(a);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(a);return}}else{if(a.keyCode==Event.KEY_TAB||a.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&a.keyCode==0)){return}}this.changed=true;this.hasFocus=true;if(this.observer){clearTimeout(this.observer)}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(b){var a=Event.findElement(b,"LI");if(this.index!=a.autocompleteIndex){this.index=a.autocompleteIndex;this.render()}Event.stop(b)},onClick:function(b){var a=Event.findElement(b,"LI");this.index=a.autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(a){setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false},render:function(){if(this.entryCount>0){for(var a=0;a<this.entryCount;a++){this.index==a?Element.addClassName(this.getEntry(a),"selected"):Element.removeClassName(this.getEntry(a),"selected")}if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0){this.index--}else{this.index=this.entryCount-1}this.getEntry(this.index)},markNext:function(){if(this.index<this.entryCount-1){this.index++}else{this.index=0}this.getEntry(this.index)},getEntry:function(a){return this.update.firstChild.childNodes[a]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry());this.index=0},updateElement:function(f){if(this.options.updateElement){this.options.updateElement(f);return}var d="";if(this.options.select){var a=$(f).select("."+this.options.select)||[];if(a.length>0){d=Element.collectTextNodes(a[0],this.options.select)}}else{d=Element.collectTextNodesIgnoreClass(f,"informal")}var c=this.getTokenBounds();if(c[0]!=-1){var e=this.element.value.substr(0,c[0]);var b=this.element.value.substr(c[0]).match(/^\s+/);if(b){e+=b[0]}this.element.value=e+d+this.element.value.substr(c[1])}else{this.element.value=d}this.oldElementValue=this.element.value;this.element.focus();if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,f)}},updateChoices:function(c){if(!this.changed&&this.hasFocus){this.update.innerHTML=c;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}if(this.index>=this.entryCount){this.index=0}}else{this.entryCount=0}this.stopIndicator();if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else{this.render()}}},addObservers:function(a){Event.observe(a,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(a,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars){this.getUpdatedChoices()}else{this.active=false;this.hide()}this.oldElementValue=this.element.value},getToken:function(){var a=this.getTokenBounds();return this.element.value.substring(a[0],a[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds){return this.tokenBounds}var e=this.element.value;if(e.strip().empty()){return[-1,0]}var f=arguments.callee.getFirstDifferencePos(e,this.oldElementValue);var h=(f==this.oldElementValue.length?1:0);var d=-1,c=e.length;var g;for(var b=0,a=this.options.tokens.length;b<a;++b){g=e.lastIndexOf(this.options.tokens[b],f+h-1);if(g>d){d=g}g=e.indexOf(this.options.tokens[b],f+h);if(-1!=g&&g<c){c=g}}return(this.tokenBounds=[d+1,c])}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(c,a){var d=Math.min(c.length,a.length);for(var b=0;b<d;++b){if(c[b]!=a[b]){return b}}return d};Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(c,d,b,a){this.baseInitialize(c,d,a);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=b},getUpdatedChoices:function(){this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)}});Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(b,d,c,a){this.baseInitialize(b,d,a);this.options.array=c},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(a){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(b){var d=[];var c=[];var h=b.getToken();var g=0;for(var e=0;e<b.options.array.length&&d.length<b.options.choices;e++){var f=b.options.array[e];var j=b.options.ignoreCase?f.toLowerCase().indexOf(h.toLowerCase()):f.indexOf(h);while(j!=-1){if(j==0&&f.length!=h.length){d.push("<li><strong>"+f.substr(0,h.length)+"</strong>"+f.substr(h.length)+"</li>");break}else{if(h.length>=b.options.partialChars&&b.options.partialSearch&&j!=-1){if(b.options.fullSearch||/\s/.test(f.substr(j-1,1))){c.push("<li>"+f.substr(0,j)+"<strong>"+f.substr(j,h.length)+"</strong>"+f.substr(j+h.length)+"</li>");break}}}j=b.options.ignoreCase?f.toLowerCase().indexOf(h.toLowerCase(),j+1):f.indexOf(h,j+1)}}if(c.length){d=d.concat(c.slice(0,b.options.choices-d.length))}return"<ul>"+d.join("")+"</ul>"}},a||{})}});Field.scrollFreeActivate=function(a){setTimeout(function(){Field.activate(a)},1)};Ajax.InPlaceEditor=Class.create({initialize:function(c,b,a){this.url=b;this.element=c=$(c);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(a);Object.extend(this.options,a||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId)){this.options.formId=""}}if(this.options.externalControl){this.options.externalControl=$(this.options.externalControl)}if(!this.options.externalControl){this.options.externalControlOnly=false}this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundCancel=(this.options.onCancel||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this._keyHandler=this.checkForEscapeOrReturn.bind(this);if(this.options.clickToEdit){this.registerListeners()}},checkForEscapeOrReturn:function(a){if(!this._editing||a.ctrlKey||a.altKey||a.shiftKey){return}if(Event.KEY_ESC==a.keyCode){this.handleFormCancellation(a)}else{if(Event.KEY_RETURN==a.keyCode){this.handleFormSubmission(a)}}},createControl:function(g,c,b){var e=this.options[g+"Control"];var f=this.options[g+"Text"];if("button"==e){var a=document.createElement("input");a.type="submit";a.value=f;a.className="editor_"+g+"_button";if("cancel"==g){a.onclick=this._boundCancelHandler}this._form.appendChild(a);this._controls[g]=a}else{if("link"==e){var d=document.createElement("a");d.href="#";d.appendChild(document.createTextNode(f));d.onclick="cancel"==g?this._boundCancelHandler:this._boundSubmitHandler;d.className="editor_"+g+"_link";if(b){d.className+=" "+b}this._form.appendChild(d);this._controls[g]=d}}},createEditField:function(){var c=(this.options.loadTextURL?this.options.loadingText:this.getText());var b;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){b=document.createElement("input");b.type="text";var a=this.options.size||this.options.cols||0;if(0<a){b.size=a}}else{b=document.createElement("textarea");b.rows=(1>=this.options.rows?this.options.autoRows:this.options.rows);b.cols=this.options.cols||40}b.name=this.options.paramName;if(this.options.initialText!==undefined&&this.options.initialText!==null){this.initialValue=this.options.initialText}else{this.initialValue=c}b.value=this.initialValue;b.className="editor_field";if(this.options.submitOnBlur){b.onblur=this._boundSubmitHandler}Event.observe(b,"keydown",this._keyHandler);this._controls.editor=b;if(this.options.loadTextURL){this.loadExternalText()}this._form.appendChild(this._controls.editor)},createForm:function(){var b=this;function a(d,e){var c=b.options["text"+d+"Controls"];if(!c||e===false){return}b._form.appendChild(document.createTextNode(c))}this._form=$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();if("textarea"==this._controls.editor.tagName.toLowerCase()){this._form.appendChild(document.createElement("br"))}if(this.options.onFormCustomization){this.options.onFormCustomization(this,this._form)}a("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);a("Between",this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");a("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML}this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(a){if(this._saving||this._editing){return}this._editing=true;this.triggerCallback("onEnterEditMode");if(this.options.externalControl){this.options.externalControl.hide()}this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);if(!this.options.loadTextURL){this.postProcessEditField()}if(a){Event.stop(a)}},enterHover:function(a){if(this.options.hoverClassName){this.element.addClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(a){this.triggerCallback("onFailure",a);if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML;this._oldInnerHTML=null}},handleFormCancellation:function(a){if(this._handling_form){return}this._handling_form=true;this.wrapUp();if(a){Event.stop(a)}this._boundCancel();this._handling_form=false},handleFormSubmission:function(c,g){if(this._handling_form){return}var d=this._form;var f=$F(this._controls.editor);if(this.options.cancelIfSame&&(f===this.initialValue)){this.handleFormCancellation(g);return}this._handling_form=true;this.prepareSubmission();var h=this.options.callback(d,f)||"";if(Object.isString(h)){h=h.toQueryParams()}h.editorId=this.element.id;if(this.options.htmlResponse){var b=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(b,{parameters:h,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Updater({success:this.element},this.url,b)}else{var b=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(b,{parameters:h,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});var a=this.options.ajaxClass||Ajax.Request;new a(this.url,b)}if(g){Event.stop(g)}this._handling_form=false;return false},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();if(this.options.externalControl){this.options.externalControl.show()}this._saving=false;this._editing=false;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(a){if(this.options.hoverClassName){this.element.removeClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(c){this._form.removeClassName(this.options.loadingClassName);var b=c.responseText;if(this.options.stripLoadedTextTags){b=b.stripTags()}this._controls.editor.value=b;this._controls.editor.disabled=false;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,a)},postProcessEditField:function(){var a=this.options.fieldPostCreation;if(a){$(this._controls.editor)["focus"==a?"focus":"activate"]()}},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(a){Object.extend(this.options,a)}.bind(this))},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var a;$H(Ajax.InPlaceEditor.Listeners).each(function(b){a=this[b.value].bind(this);this._listeners[b.key]=a;if(!this.options.externalControlOnly){this.element.observe(b.key,a)}if(this.options.externalControl){this.options.externalControl.observe(b.key,a)}}.bind(this))},removeForm:function(){if(!this._form){return}this._controls.editor.blur();this._form.remove();this._form=null;this._controls={}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(b,a){if("function"==typeof this.options[b]){this.options[b](this,a)}},unregisterListeners:function(){$H(this._listeners).each(function(a){if(!this.options.externalControlOnly){this.element.stopObserving(a.key,a.value)}if(this.options.externalControl){this.options.externalControl.stopObserving(a.key,a.value)}}.bind(this))},wrapUp:function(a){this.leaveEditMode();this._boundComplete(a,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,c,b,a){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(c,b,a)},createEditField:function(){var a=document.createElement("select");a.name=this.options.paramName;a.size=1;this._controls.editor=a;this._collection=this.options.collection||[];if(this.options.loadCollectionURL){this.loadCollection()}else{this.checkForExternalText()}this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!/^\[.*\]$/.test(js)){throw ("Server returned an invalid collection representation.")}this._collection=eval(js);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,options)},showLoadingText:function(b){this._controls.editor.disabled=true;var a=this._controls.editor.firstChild;if(!a){a=document.createElement("option");a.value="";this._controls.editor.appendChild(a);a.selected=true}a.update((b||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();if(this.options.loadTextURL){this.loadExternalText()}else{this.buildOptionList()}},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(b){this._text=b.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,a)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(d){return 2===d.length?d:[d,d].flatten()});var b=("value" in this.options)?this.options.value:this._text;var a=this._collection.any(function(d){return d[0]==b}.bind(this));this._controls.editor.update("");var c;this._collection.each(function(e,d){c=document.createElement("option");c.value=e[0];c.selected=a?e[0]==b:0==d;c.appendChild(document.createTextNode(e[1]));this._controls.editor.appendChild(c)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor)}});Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(a){if(!a){return}function b(c,d){if(c in a||d===undefined){return}a[c]=d}b("cancelControl",(a.cancelLink?"link":(a.cancelButton?"button":a.cancelLink==a.cancelButton==false?false:undefined)));b("okControl",(a.okLink?"link":(a.okButton?"button":a.okLink==a.okButton==false?false:undefined)));b("highlightColor",a.highlightcolor);b("highlightEndColor",a.highlightendcolor)};Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelIfSame:false,cancelText:"cancel",clickToEdit:true,clickToEditText:"Click to edit",externalControl:null,externalControlOnly:false,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:true,initialText:"",loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",savingText:"Saving...",size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(a){return Form.serialize(a)},onComplete:function(b,a){new Effect.Highlight(a,{startcolor:this.options.highlightColor,keepBackgroundImage:true})},onEnterEditMode:null,onEnterHover:function(a){a.element.style.backgroundColor=a.options.highlightColor;if(a._effect){a._effect.cancel()}},onFailure:function(b,a){alert("Error communication with the server: "+b.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(a){a._effect=new Effect.Highlight(a.element,{startcolor:a.options.highlightColor,endcolor:a.options.highlightEndColor,restorecolor:a._originalBackground,keepBackgroundImage:true})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};Form.Element.DelayedObserver=Class.create({initialize:function(b,a,c){this.delay=a||0.5;this.element=$(b);this.callback=c;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(a){if(this.lastValue==$F(this.element)){return}if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1000);this.lastValue=$F(this.element)},onTimerEvent:function(){this.timer=null;this.callback(this.element,$F(this.element))}});var Builder={NODEMAP:{AREA:"map",CAPTION:"table",COL:"table",COLGROUP:"table",LEGEND:"fieldset",OPTGROUP:"select",OPTION:"select",PARAM:"object",TBODY:"table",TD:"table",TFOOT:"table",TH:"table",THEAD:"table",TR:"table"},node:function(a){a=a.toUpperCase();var g=this.NODEMAP[a]||"div";var b=document.createElement(g);try{b.innerHTML="<"+a+"></"+a+">"}catch(f){}var d=b.firstChild||null;if(d&&(d.tagName.toUpperCase()!=a)){d=d.getElementsByTagName(a)[0]}if(!d){d=document.createElement(a)}if(!d){return}if(arguments[1]){if(this._isStringOrNumber(arguments[1])||(arguments[1] instanceof Array)||arguments[1].tagName){this._children(d,arguments[1])}else{var c=this._attributes(arguments[1]);if(c.length){try{b.innerHTML="<"+a+" "+c+"></"+a+">"}catch(f){}d=b.firstChild||null;if(!d){d=document.createElement(a);for(attr in arguments[1]){d[attr=="class"?"className":attr]=arguments[1][attr]}}if(d.tagName.toUpperCase()!=a){d=b.getElementsByTagName(a)[0]}}}}if(arguments[2]){this._children(d,arguments[2])}return $(d)},_text:function(a){return document.createTextNode(a)},ATTR_MAP:{className:"class",htmlFor:"for"},_attributes:function(a){var b=[];for(attribute in a){b.push((attribute in this.ATTR_MAP?this.ATTR_MAP[attribute]:attribute)+'="'+a[attribute].toString().escapeHTML().gsub(/"/,"&quot;")+'"')}return b.join(" ")},_children:function(b,a){if(a.tagName){b.appendChild(a);return}if(typeof a=="object"){a.flatten().each(function(c){if(typeof c=="object"){b.appendChild(c)}else{if(Builder._isStringOrNumber(c)){b.appendChild(Builder._text(c))}}})}else{if(Builder._isStringOrNumber(a)){b.appendChild(Builder._text(a))}}},_isStringOrNumber:function(a){return(typeof a=="string"||typeof a=="number")},build:function(b){var a=this.node("div");$(a).update(b.strip());return a.down()},dump:function(b){if(typeof b!="object"&&typeof b!="function"){b=window}var a=("A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR").split(/\s+/);a.each(function(c){b[c]=function(){return Builder.node.apply(Builder,[c].concat($A(arguments)))}})}};if(!Control){var Control={}}Control.Slider=Class.create({initialize:function(d,a,b){var c=this;if(Object.isArray(d)){this.handles=d.collect(function(f){return $(f)})}else{this.handles=[$(d)]}this.track=$(a);this.options=b||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step||"1");this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0});this.spans=this.options.spans?this.options.spans.map(function(e){return $(e)}):false;this.options.startSpan=$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||"0");this.alignY=parseInt(this.options.alignY||"0");this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled){this.setDisabled()}this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):false;if(this.allowedValues){this.minimum=this.allowedValues.min();this.maximum=this.allowedValues.max()}this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.handles.each(function(f,e){e=c.handles.length-1-e;c.setValue(parseFloat((Object.isArray(c.options.sliderValue)?c.options.sliderValue[e]:c.options.sliderValue)||c.range.start),e);f.makePositioned().observe("mousedown",c.eventMouseDown)});this.track.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);this.initialized=true},dispose:function(){var a=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(b){Event.stopObserving(b,"mousedown",a.eventMouseDown)})},setDisabled:function(){this.disabled=true},setEnabled:function(){this.disabled=false},getNearestValue:function(a){if(this.allowedValues){if(a>=this.allowedValues.max()){return(this.allowedValues.max())}if(a<=this.allowedValues.min()){return(this.allowedValues.min())}var c=Math.abs(this.allowedValues[0]-a);var b=this.allowedValues[0];this.allowedValues.each(function(d){var e=Math.abs(d-a);if(e<=c){b=d;c=e}});return b}if(a>this.range.end){return this.range.end}if(a<this.range.start){return this.range.start}return a},setValue:function(b,a){if(!this.active){this.activeHandleIdx=a||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles()}a=a||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((a>0)&&(b<this.values[a-1])){b=this.values[a-1]}if((a<(this.handles.length-1))&&(b>this.values[a+1])){b=this.values[a+1]}}b=this.getNearestValue(b);this.values[a]=b;this.value=this.values[0];this.handles[a].style[this.isVertical()?"top":"left"]=this.translateToPx(b);this.drawSpans();if(!this.dragging||!this.event){this.updateFinished()}},setValueBy:function(b,a){this.setValue(this.values[a||this.activeHandleIdx||0]+b,a||this.activeHandleIdx||0)},translateToPx:function(a){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(a-this.range.start))+"px"},translateToValue:function(a){return((a/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start)},getRange:function(b){var a=this.values.sortBy(Prototype.K);b=b||0;return $R(a[b],a[b+1])},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX)},maximumOffset:function(){return(this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX)},isVertical:function(){return(this.axis=="vertical")},drawSpans:function(){var a=this;if(this.spans){$R(0,this.spans.length-1).each(function(b){a.setSpan(a.spans[b],a.getRange(b))})}if(this.options.startSpan){this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value))}if(this.options.endSpan){this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum))}},setSpan:function(b,a){if(this.isVertical()){b.style.top=this.translateToPx(a.start);b.style.height=this.translateToPx(a.end-a.start+this.range.start)}else{b.style.left=this.translateToPx(a.start);b.style.width=this.translateToPx(a.end-a.start+this.range.start)}},updateStyles:function(){this.handles.each(function(a){Element.removeClassName(a,"selected")});Element.addClassName(this.activeHandle,"selected")},startDrag:function(c){if(Event.isLeftClick(c)){if(!this.disabled){this.active=true;var d=Event.element(c);var e=[Event.pointerX(c),Event.pointerY(c)];var a=d;if(a==this.track){var b=this.track.cumulativeOffset();this.event=c;this.setValue(this.translateToValue((this.isVertical()?e[1]-b[1]:e[0]-b[0])-(this.handleLength/2)));var b=this.activeHandle.cumulativeOffset();this.offsetX=(e[0]-b[0]);this.offsetY=(e[1]-b[1])}else{while((this.handles.indexOf(d)==-1)&&d.parentNode){d=d.parentNode}if(this.handles.indexOf(d)!=-1){this.activeHandle=d;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();var b=this.activeHandle.cumulativeOffset();this.offsetX=(e[0]-b[0]);this.offsetY=(e[1]-b[1])}}}Event.stop(c)}},update:function(a){if(this.active){if(!this.dragging){this.dragging=true}this.draw(a);if(Prototype.Browser.WebKit){window.scrollBy(0,0)}Event.stop(a)}},draw:function(b){var c=[Event.pointerX(b),Event.pointerY(b)];var a=this.track.cumulativeOffset();c[0]-=this.offsetX+a[0];c[1]-=this.offsetY+a[1];this.event=b;this.setValue(this.translateToValue(this.isVertical()?c[1]:c[0]));if(this.initialized&&this.options.onSlide){this.options.onSlide(this.values.length>1?this.values:this.value,this)}},endDrag:function(a){if(this.active&&this.dragging){this.finishDrag(a,true);Event.stop(a)}this.active=false;this.dragging=false},finishDrag:function(a,b){this.active=false;this.dragging=false;this.updateFinished()},updateFinished:function(){if(this.initialized&&this.options.onChange){this.options.onChange(this.values.length>1?this.values:this.value,this)}this.event=null}});
/* jQuery v@1.8.1 jquery.com | jquery.org/license */
(function(a,b){function G(a){var b=F[a]={};return p.each(a.split(s),function(a,c){b[c]=!0}),b}function J(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(I,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:+d+""===d?+d:H.test(d)?p.parseJSON(d):d}catch(f){}p.data(a,c,d)}else{d=b}}return d}function K(a){var b;for(b in a){if(b==="data"&&p.isEmptyObject(a[b])){continue}if(b!=="toJSON"){return !1}}return !0}function ba(){return !1}function bb(){return !0}function bh(a){return !a||!a.parentNode||a.parentNode.nodeType===11}function bi(a,b){do{a=a[b]}while(a&&a.nodeType!==1);return a}function bj(a,b,c){b=b||0;if(p.isFunction(b)){return p.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c})}if(b.nodeType){return p.grep(a,function(a,d){return a===b===c})}if(typeof b=="string"){var d=p.grep(a,function(a){return a.nodeType===1});if(be.test(b)){return p.filter(b,d,!c)}b=p.filter(b,d)}return p.grep(a,function(a,d){return p.inArray(a,b)>=0===c})}function bk(a){var b=bl.split("|"),c=a.createDocumentFragment();if(c.createElement){while(b.length){c.createElement(b.pop())}}return c}function bC(a,b){return a.getElementsByTagName(b)[0]||a.appendChild(a.ownerDocument.createElement(b))}function bD(a,b){if(b.nodeType!==1||!p.hasData(a)){return}var c,d,e,f=p._data(a),g=p._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h){for(d=0,e=h[c].length;d<e;d++){p.event.add(b,c,h[c][d])}}}g.data&&(g.data=p.extend({},g.data))}function bE(a,b){var c;if(b.nodeType!==1){return}b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),c==="object"?(b.parentNode&&(b.outerHTML=a.outerHTML),p.support.html5Clone&&a.innerHTML&&!p.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):c==="input"&&bv.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):c==="option"?b.selected=a.defaultSelected:c==="input"||c==="textarea"?b.defaultValue=a.defaultValue:c==="script"&&b.text!==a.text&&(b.text=a.text),b.removeAttribute(p.expando)}function bF(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bG(a){bv.test(a.type)&&(a.defaultChecked=a.checked)}function bY(a,b){if(b in a){return b}var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=bW.length;while(e--){b=bW[e]+c;if(b in a){return b}}return d}function bZ(a,b){return a=b||a,p.css(a,"display")==="none"||!p.contains(a.ownerDocument,a)}function b$(a,b){var c,d,e=[],f=0,g=a.length;for(;f<g;f++){c=a[f];if(!c.style){continue}e[f]=p._data(c,"olddisplay"),b?(!e[f]&&c.style.display==="none"&&(c.style.display=""),c.style.display===""&&bZ(c)&&(e[f]=p._data(c,"olddisplay",cc(c.nodeName)))):(d=bH(c,"display"),!e[f]&&d!=="none"&&p._data(c,"olddisplay",d))}for(f=0;f<g;f++){c=a[f];if(!c.style){continue}if(!b||c.style.display==="none"||c.style.display===""){c.style.display=b?e[f]||"":"none"}}return a}function b_(a,b,c){var d=bP.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function ca(a,b,c,d){var e=c===(d?"border":"content")?4:b==="width"?1:0,f=0;for(;e<4;e+=2){c==="margin"&&(f+=p.css(a,c+bV[e],!0)),d?(c==="content"&&(f-=parseFloat(bH(a,"padding"+bV[e]))||0),c!=="margin"&&(f-=parseFloat(bH(a,"border"+bV[e]+"Width"))||0)):(f+=parseFloat(bH(a,"padding"+bV[e]))||0,c!=="padding"&&(f+=parseFloat(bH(a,"border"+bV[e]+"Width"))||0))}return f}function cb(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=!0,f=p.support.boxSizing&&p.css(a,"boxSizing")==="border-box";if(d<=0||d==null){d=bH(a,b);if(d<0||d==null){d=a.style[b]}if(bQ.test(d)){return d}e=f&&(p.support.boxSizingReliable||d===a.style[b]),d=parseFloat(d)||0}return d+ca(a,b,c||(f?"border":"content"),e)+"px"}function cc(a){if(bS[a]){return bS[a]}var b=p("<"+a+">").appendTo(e.body),c=b.css("display");b.remove();if(c==="none"||c===""){bI=e.body.appendChild(bI||p.extend(e.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!bJ||!bI.createElement){bJ=(bI.contentWindow||bI.contentDocument).document,bJ.write("<!doctype html><html><body>"),bJ.close()}b=bJ.body.appendChild(bJ.createElement(a)),c=bH(b,"display"),e.body.removeChild(bI)}return bS[a]=c,c}function ci(a,b,c,d){var e;if(p.isArray(b)){p.each(b,function(b,e){c||ce.test(a)?d(a,e):ci(a+"["+(typeof e=="object"?b:"")+"]",e,c,d)})}else{if(!c&&p.type(b)==="object"){for(e in b){ci(a+"["+e+"]",b[e],c,d)}}else{d(a,b)}}}function cz(a){return function(b,c){typeof b!="string"&&(c=b,b="*");var d,e,f,g=b.toLowerCase().split(s),h=0,i=g.length;if(p.isFunction(c)){for(;h<i;h++){d=g[h],f=/^\+/.test(d),f&&(d=d.substr(1)||"*"),e=a[d]=a[d]||[],e[f?"unshift":"push"](c)}}}}function cA(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h,i=a[f],j=0,k=i?i.length:0,l=a===cv;for(;j<k&&(l||!h);j++){h=i[j](c,d,e),typeof h=="string"&&(!l||g[h]?h=b:(c.dataTypes.unshift(h),h=cA(a,c,d,e,h,g)))}return(l||!h)&&!g["*"]&&(h=cA(a,c,d,e,"*",g)),h}function cB(a,c){var d,e,f=p.ajaxSettings.flatOptions||{};for(d in c){c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d])}e&&p.extend(!0,a,e)}function cC(a,c,d){var e,f,g,h,i=a.contents,j=a.dataTypes,k=a.responseFields;for(f in k){f in d&&(c[k[f]]=d[f])}while(j[0]==="*"){j.shift(),e===b&&(e=a.mimeType||c.getResponseHeader("content-type"))}if(e){for(f in i){if(i[f]&&i[f].test(e)){j.unshift(f);break}}}if(j[0] in d){g=j[0]}else{for(f in d){if(!j[0]||a.converters[f+" "+j[0]]){g=f;break}h||(h=f)}g=g||h}if(g){return g!==j[0]&&j.unshift(g),d[g]}}function cD(a,b){var c,d,e,f,g=a.dataTypes.slice(),h=g[0],i={},j=0;a.dataFilter&&(b=a.dataFilter(b,a.dataType));if(g[1]){for(c in a.converters){i[c.toLowerCase()]=a.converters[c]}}for(;e=g[++j];){if(e!=="*"){if(h!=="*"&&h!==e){c=i[h+" "+e]||i["* "+e];if(!c){for(d in i){f=d.split(" ");if(f[1]===e){c=i[h+" "+f[0]]||i["* "+f[0]];if(c){c===!0?c=i[d]:i[d]!==!0&&(e=f[0],g.splice(j--,0,e));break}}}}if(c!==!0){if(c&&a["throws"]){b=c(b)}else{try{b=c(b)}catch(k){return{state:"parsererror",error:c?k:"No conversion from "+h+" to "+e}}}}}h=e}}return{state:"success",data:b}}function cL(){try{return new a.XMLHttpRequest}catch(b){}}function cM(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function cU(){return setTimeout(function(){cN=b},0),cN=p.now()}function cV(a,b){p.each(b,function(b,c){var d=(cT[b]||[]).concat(cT["*"]),e=0,f=d.length;for(;e<f;e++){if(d[e].call(a,b,c)){return}}})}function cW(a,b,c){var d,e=0,f=0,g=cS.length,h=p.Deferred().always(function(){delete i.elem}),i=function(){var b=cN||cU(),c=Math.max(0,j.startTime+j.duration-b),d=1-(c/j.duration||0),e=0,f=j.tweens.length;for(;e<f;e++){j.tweens[e].run(d)}return h.notifyWith(a,[j,d,c]),d<1&&f?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:p.extend({},b),opts:p.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:cN||cU(),duration:c.duration,tweens:[],createTween:function(b,c,d){var e=p.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(e),e},stop:function(b){var c=0,d=b?j.tweens.length:0;for(;c<d;c++){j.tweens[c].run(1)}return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;cX(k,j.opts.specialEasing);for(;e<g;e++){d=cS[e].call(j,a,k,j.opts);if(d){return d}}return cV(j,k),p.isFunction(j.opts.start)&&j.opts.start.call(a,j),p.fx.timer(p.extend(i,{anim:j,queue:j.opts.queue,elem:a})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function cX(a,b){var c,d,e,f,g;for(c in a){d=p.camelCase(c),e=b[d],f=a[c],p.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=p.cssHooks[d];if(g&&"expand" in g){f=g.expand(f),delete a[d];for(c in f){c in a||(a[c]=f[c],b[c]=e)}}else{b[d]=e}}}function cY(a,b,c){var d,e,f,g,h,i,j,k,l=this,m=a.style,n={},o=[],q=a.nodeType&&bZ(a);c.queue||(j=p._queueHooks(a,"fx"),j.unqueued==null&&(j.unqueued=0,k=j.empty.fire,j.empty.fire=function(){j.unqueued||k()}),j.unqueued++,l.always(function(){l.always(function(){j.unqueued--,p.queue(a,"fx").length||j.empty.fire()})})),a.nodeType===1&&("height" in b||"width" in b)&&(c.overflow=[m.overflow,m.overflowX,m.overflowY],p.css(a,"display")==="inline"&&p.css(a,"float")==="none"&&(!p.support.inlineBlockNeedsLayout||cc(a.nodeName)==="inline"?m.display="inline-block":m.zoom=1)),c.overflow&&(m.overflow="hidden",p.support.shrinkWrapBlocks||l.done(function(){m.overflow=c.overflow[0],m.overflowX=c.overflow[1],m.overflowY=c.overflow[2]}));for(d in b){f=b[d];if(cP.exec(f)){delete b[d];if(f===(q?"hide":"show")){continue}o.push(d)}}g=o.length;if(g){h=p._data(a,"fxshow")||p._data(a,"fxshow",{}),q?p(a).show():l.done(function(){p(a).hide()}),l.done(function(){var b;p.removeData(a,"fxshow",!0);for(b in n){p.style(a,b,n[b])}});for(d=0;d<g;d++){e=o[d],i=l.createTween(e,q?h[e]:0),n[e]=h[e]||p.style(a,e),e in h||(h[e]=i.start,q&&(i.end=i.start,i.start=e==="width"||e==="height"?1:0))}}}function cZ(a,b,c,d,e){return new cZ.prototype.init(a,b,c,d,e)}function c$(a,b){var c,d={height:a},e=0;b=b?1:0;for(;e<4;e+=2-b){c=bV[e],d["margin"+c]=d["padding"+c]=a}return b&&(d.opacity=d.width=a),d}function da(a){return p.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}var c,d,e=a.document,f=a.location,g=a.navigator,h=a.jQuery,i=a.$,j=Array.prototype.push,k=Array.prototype.slice,l=Array.prototype.indexOf,m=Object.prototype.toString,n=Object.prototype.hasOwnProperty,o=String.prototype.trim,p=function(a,b){return new p.fn.init(a,b,c)},q=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,r=/\S/,s=/\s+/,t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,u=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^[\],:{}\s]*$/,x=/(?:^|:|,)(?:\s*\[)+/g,y=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,z=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,A=/^-ms-/,B=/-([\da-z])/gi,C=function(a,b){return(b+"").toUpperCase()},D=function(){e.addEventListener?(e.removeEventListener("DOMContentLoaded",D,!1),p.ready()):e.readyState==="complete"&&(e.detachEvent("onreadystatechange",D),p.ready())},E={};p.fn=p.prototype={constructor:p,init:function(a,c,d){var f,g,h,i;if(!a){return this}if(a.nodeType){return this.context=this[0]=a,this.length=1,this}if(typeof a=="string"){a.charAt(0)==="<"&&a.charAt(a.length-1)===">"&&a.length>=3?f=[null,a,null]:f=u.exec(a);if(f&&(f[1]||!c)){if(f[1]){return c=c instanceof p?c[0]:c,i=c&&c.nodeType?c.ownerDocument||c:e,a=p.parseHTML(f[1],i,!0),v.test(f[1])&&p.isPlainObject(c)&&this.attr.call(a,c,!0),p.merge(this,a)}g=e.getElementById(f[2]);if(g&&g.parentNode){if(g.id!==f[2]){return d.find(a)}this.length=1,this[0]=g}return this.context=e,this.selector=a,this}return !c||c.jquery?(c||d).find(a):this.constructor(c).find(a)}return p.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),p.makeArray(a,this))},selector:"",jquery:"1.8.1",length:0,size:function(){return this.length},toArray:function(){return k.call(this)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=p.merge(this.constructor(),a);return d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")"),d},each:function(a,b){return p.each(this,a,b)},ready:function(a){return p.ready.promise().done(a),this},eq:function(a){return a=+a,a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(k.apply(this,arguments),"slice",k.call(arguments).join(","))},map:function(a){return this.pushStack(p.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:j,sort:[].sort,splice:[].splice},p.fn.init.prototype=p.fn,p.extend=p.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;typeof h=="boolean"&&(k=h,h=arguments[1]||{},i=2),typeof h!="object"&&!p.isFunction(h)&&(h={}),j===i&&(h=this,--i);for(;i<j;i++){if((a=arguments[i])!=null){for(c in a){d=h[c],e=a[c];if(h===e){continue}k&&e&&(p.isPlainObject(e)||(f=p.isArray(e)))?(f?(f=!1,g=d&&p.isArray(d)?d:[]):g=d&&p.isPlainObject(d)?d:{},h[c]=p.extend(k,g,e)):e!==b&&(h[c]=e)}}}return h},p.extend({noConflict:function(b){return a.$===p&&(a.$=i),b&&a.jQuery===p&&(a.jQuery=h),p},isReady:!1,readyWait:1,holdReady:function(a){a?p.readyWait++:p.ready(!0)},ready:function(a){if(a===!0?--p.readyWait:p.isReady){return}if(!e.body){return setTimeout(p.ready,1)}p.isReady=!0;if(a!==!0&&--p.readyWait>0){return}d.resolveWith(e,[p]),p.fn.trigger&&p(e).trigger("ready").off("ready")},isFunction:function(a){return p.type(a)==="function"},isArray:Array.isArray||function(a){return p.type(a)==="array"},isWindow:function(a){return a!=null&&a==a.window},isNumeric:function(a){return !isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):E[m.call(a)]||"object"},isPlainObject:function(a){if(!a||p.type(a)!=="object"||a.nodeType||p.isWindow(a)){return !1}try{if(a.constructor&&!n.call(a,"constructor")&&!n.call(a.constructor.prototype,"isPrototypeOf")){return !1}}catch(c){return !1}var d;for(d in a){}return d===b||n.call(a,d)},isEmptyObject:function(a){var b;for(b in a){return !1}return !0},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){var d;return !a||typeof a!="string"?null:(typeof b=="boolean"&&(c=b,b=0),b=b||e,(d=v.exec(a))?[b.createElement(d[1])]:(d=p.buildFragment([a],b,c?null:[]),p.merge([],(d.cacheable?p.clone(d.fragment):d.fragment).childNodes)))},parseJSON:function(b){if(!b||typeof b!="string"){return null}b=p.trim(b);if(a.JSON&&a.JSON.parse){return a.JSON.parse(b)}if(w.test(b.replace(y,"@").replace(z,"]").replace(x,""))){return(new Function("return "+b))()}p.error("Invalid JSON: "+b)},parseXML:function(c){var d,e;if(!c||typeof c!="string"){return null}try{a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(f){d=b}return(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&p.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(b){b&&r.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(A,"ms-").replace(B,C)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var e,f=0,g=a.length,h=g===b||p.isFunction(a);if(d){if(h){for(e in a){if(c.apply(a[e],d)===!1){break}}}else{for(;f<g;){if(c.apply(a[f++],d)===!1){break}}}}else{if(h){for(e in a){if(c.call(a[e],e,a[e])===!1){break}}}else{for(;f<g;){if(c.call(a[f],f,a[f++])===!1){break}}}}return a},trim:o&&!o.call(" ")?function(a){return a==null?"":o.call(a)}:function(a){return a==null?"":a.toString().replace(t,"")},makeArray:function(a,b){var c,d=b||[];return a!=null&&(c=p.type(a),a.length==null||c==="string"||c==="function"||c==="regexp"||p.isWindow(a)?j.call(d,a):p.merge(d,a)),d},inArray:function(a,b,c){var d;if(b){if(l){return l.call(b,a,c)}d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++){if(c in b&&b[c]===a){return c}}}return -1},merge:function(a,c){var d=c.length,e=a.length,f=0;if(typeof d=="number"){for(;f<d;f++){a[e++]=c[f]}}else{while(c[f]!==b){a[e++]=c[f++]}}return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;c=!!c;for(;f<g;f++){d=!!b(a[f],f),c!==d&&e.push(a[f])}return e},map:function(a,c,d){var e,f,g=[],h=0,i=a.length,j=a instanceof p||i!==b&&typeof i=="number"&&(i>0&&a[0]&&a[i-1]||i===0||p.isArray(a));if(j){for(;h<i;h++){e=c(a[h],h,d),e!=null&&(g[g.length]=e)}}else{for(f in a){e=c(a[f],f,d),e!=null&&(g[g.length]=e)}}return g.concat.apply([],g)},guid:1,proxy:function(a,c){var d,e,f;return typeof c=="string"&&(d=a[c],c=a,a=d),p.isFunction(a)?(e=k.call(arguments,2),f=function(){return a.apply(c,e.concat(k.call(arguments)))},f.guid=a.guid=a.guid||f.guid||p.guid++,f):b},access:function(a,c,d,e,f,g,h){var i,j=d==null,k=0,l=a.length;if(d&&typeof d=="object"){for(k in d){p.access(a,c,k,d[k],1,g,e)}f=1}else{if(e!==b){i=h===b&&p.isFunction(e),j&&(i?(i=c,c=function(a,b,c){return i.call(p(a),c)}):(c.call(a,e),c=null));if(c){for(;k<l;k++){c(a[k],d,i?e.call(a[k],k,c(a[k],d)):e,h)}}f=1}}return f?a:j?c.call(a):l?c(a[0],d):g},now:function(){return(new Date).getTime()}}),p.ready.promise=function(b){if(!d){d=p.Deferred();if(e.readyState==="complete"){setTimeout(p.ready,1)}else{if(e.addEventListener){e.addEventListener("DOMContentLoaded",D,!1),a.addEventListener("load",p.ready,!1)}else{e.attachEvent("onreadystatechange",D),a.attachEvent("onload",p.ready);var c=!1;try{c=a.frameElement==null&&e.documentElement}catch(f){}c&&c.doScroll&&function g(){if(!p.isReady){try{c.doScroll("left")}catch(a){return setTimeout(g,50)}p.ready()}}()}}}return d.promise(b)},p.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){E["[object "+b+"]"]=b.toLowerCase()}),c=p(e);var F={};p.Callbacks=function(a){a=typeof a=="string"?F[a]||G(a):p.extend({},a);var c,d,e,f,g,h,i=[],j=!a.once&&[],k=function(b){c=a.memory&&b,d=!0,h=f||0,f=0,g=i.length,e=!0;for(;i&&h<g;h++){if(i[h].apply(b[0],b[1])===!1&&a.stopOnFalse){c=!1;break}}e=!1,i&&(j?j.length&&k(j.shift()):c?i=[]:l.disable())},l={add:function(){if(i){var b=i.length;(function d(b){p.each(b,function(b,c){var e=p.type(c);e==="function"&&(!a.unique||!l.has(c))?i.push(c):c&&c.length&&e!=="string"&&d(c)})})(arguments),e?g=i.length:c&&(f=b,k(c))}return this},remove:function(){return i&&p.each(arguments,function(a,b){var c;while((c=p.inArray(b,i,c))>-1){i.splice(c,1),e&&(c<=g&&g--,c<=h&&h--)}}),this},has:function(a){return p.inArray(a,i)>-1},empty:function(){return i=[],this},disable:function(){return i=j=c=b,this},disabled:function(){return !i},lock:function(){return j=b,c||l.disable(),this},locked:function(){return !j},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],i&&(!d||j)&&(e?j.push(b):k(b)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return !!d}};return l},p.extend({Deferred:function(a){var b=[["resolve","done",p.Callbacks("once memory"),"resolved"],["reject","fail",p.Callbacks("once memory"),"rejected"],["notify","progress",p.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return p.Deferred(function(c){p.each(b,function(b,d){var f=d[0],g=a[b];e[d[1]](p.isFunction(g)?function(){var a=g.apply(this,arguments);a&&p.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f+"With"](this===e?c:this,[a])}:c[f])}),a=null}).promise()},promise:function(a){return typeof a=="object"?p.extend(a,d):d}},e={};return d.pipe=d.then,p.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[a^1][2].disable,b[2][2].lock),e[f[0]]=g.fire,e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=k.call(arguments),d=c.length,e=d!==1||a&&p.isFunction(a.promise)?d:0,f=e===1?a:p.Deferred(),g=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?k.call(arguments):d,c===h?f.notifyWith(b,c):--e||f.resolveWith(b,c)}},h,i,j;if(d>1){h=new Array(d),i=new Array(d),j=new Array(d);for(;b<d;b++){c[b]&&p.isFunction(c[b].promise)?c[b].promise().done(g(b,j,c)).fail(f.reject).progress(g(b,i,h)):--e}}return e||f.resolveWith(j,c),f.promise()}}),p.support=function(){var b,c,d,f,g,h,i,j,k,l,m,n=e.createElement("div");n.setAttribute("className","t"),n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",c=n.getElementsByTagName("*"),d=n.getElementsByTagName("a")[0],d.style.cssText="top:1px;float:left;opacity:.5";if(!c||!c.length||!d){return{}}f=e.createElement("select"),g=f.appendChild(e.createElement("option")),h=n.getElementsByTagName("input")[0],b={leadingWhitespace:n.firstChild.nodeType===3,tbody:!n.getElementsByTagName("tbody").length,htmlSerialize:!!n.getElementsByTagName("link").length,style:/top/.test(d.getAttribute("style")),hrefNormalized:d.getAttribute("href")==="/a",opacity:/^0.5/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:h.value==="on",optSelected:g.selected,getSetAttribute:n.className!=="t",enctype:!!e.createElement("form").enctype,html5Clone:e.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:e.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},h.checked=!0,b.noCloneChecked=h.cloneNode(!0).checked,f.disabled=!0,b.optDisabled=!g.disabled;try{delete n.test}catch(o){b.deleteExpando=!1}!n.addEventListener&&n.attachEvent&&n.fireEvent&&(n.attachEvent("onclick",m=function(){b.noCloneEvent=!1}),n.cloneNode(!0).fireEvent("onclick"),n.detachEvent("onclick",m)),h=e.createElement("input"),h.value="t",h.setAttribute("type","radio"),b.radioValue=h.value==="t",h.setAttribute("checked","checked"),h.setAttribute("name","t"),n.appendChild(h),i=e.createDocumentFragment(),i.appendChild(n.lastChild),b.checkClone=i.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=h.checked,i.removeChild(h),i.appendChild(n);if(n.attachEvent){for(k in {submit:!0,change:!0,focusin:!0}){j="on"+k,l=j in n,l||(n.setAttribute(j,"return;"),l=typeof n[j]=="function"),b[k+"Bubbles"]=l}}return p(function(){var c,d,f,g,h="padding:0;margin:0;border:0;display:block;overflow:hidden;",i=e.getElementsByTagName("body")[0];if(!i){return}c=e.createElement("div"),c.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",i.insertBefore(c,i.firstChild),d=e.createElement("div"),c.appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",f=d.getElementsByTagName("td"),f[0].style.cssText="padding:0;margin:0;border:0;display:none",l=f[0].offsetHeight===0,f[0].style.display="",f[1].style.display="none",b.reliableHiddenOffsets=l&&f[0].offsetHeight===0,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",b.boxSizing=d.offsetWidth===4,b.doesNotIncludeMarginInBodyOffset=i.offsetTop!==1,a.getComputedStyle&&(b.pixelPosition=(a.getComputedStyle(d,null)||{}).top!=="1%",b.boxSizingReliable=(a.getComputedStyle(d,null)||{width:"4px"}).width==="4px",g=e.createElement("div"),g.style.cssText=d.style.cssText=h,g.style.marginRight=g.style.width="0",d.style.width="1px",d.appendChild(g),b.reliableMarginRight=!parseFloat((a.getComputedStyle(g,null)||{}).marginRight)),typeof d.style.zoom!="undefined"&&(d.innerHTML="",d.style.cssText=h+"width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=d.offsetWidth===3,d.style.display="block",d.style.overflow="visible",d.innerHTML="<div></div>",d.firstChild.style.width="5px",b.shrinkWrapBlocks=d.offsetWidth!==3,c.style.zoom=1),i.removeChild(c),c=d=f=g=null}),i.removeChild(n),c=d=f=g=h=i=n=null,b}();var H=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,I=/([A-Z])/g;p.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(p.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?p.cache[a[p.expando]]:a[p.expando],!!a&&!K(a)},data:function(a,c,d,e){if(!p.acceptData(a)){return}var f,g,h=p.expando,i=typeof c=="string",j=a.nodeType,k=j?p.cache:a,l=j?a[h]:a[h]&&h;if((!l||!k[l]||!e&&!k[l].data)&&i&&d===b){return}l||(j?a[h]=l=p.deletedIds.pop()||++p.uuid:l=h),k[l]||(k[l]={},j||(k[l].toJSON=p.noop));if(typeof c=="object"||typeof c=="function"){e?k[l]=p.extend(k[l],c):k[l].data=p.extend(k[l].data,c)}return f=k[l],e||(f.data||(f.data={}),f=f.data),d!==b&&(f[p.camelCase(c)]=d),i?(g=f[c],g==null&&(g=f[p.camelCase(c)])):g=f,g},removeData:function(a,b,c){if(!p.acceptData(a)){return}var d,e,f,g=a.nodeType,h=g?p.cache:a,i=g?a[p.expando]:p.expando;if(!h[i]){return}if(b){d=c?h[i]:h[i].data;if(d){p.isArray(b)||(b in d?b=[b]:(b=p.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,f=b.length;e<f;e++){delete d[b[e]]}if(!(c?K:p.isEmptyObject)(d)){return}}}if(!c){delete h[i].data;if(!K(h[i])){return}}g?p.cleanData([a],!0):p.support.deleteExpando||h!=h.window?delete h[i]:h[i]=null},_data:function(a,b,c){return p.data(a,b,c,!0)},acceptData:function(a){var b=a.nodeName&&p.noData[a.nodeName.toLowerCase()];return !b||b!==!0&&a.getAttribute("classid")===b}}),p.fn.extend({data:function(a,c){var d,e,f,g,h,i=this[0],j=0,k=null;if(a===b){if(this.length){k=p.data(i);if(i.nodeType===1&&!p._data(i,"parsedAttrs")){f=i.attributes;for(h=f.length;j<h;j++){g=f[j].name,g.indexOf("data-")===0&&(g=p.camelCase(g.substring(5)),J(i,g,k[g]))}p._data(i,"parsedAttrs",!0)}}return k}return typeof a=="object"?this.each(function(){p.data(this,a)}):(d=a.split(".",2),d[1]=d[1]?"."+d[1]:"",e=d[1]+"!",p.access(this,function(c){if(c===b){return k=this.triggerHandler("getData"+e,[d[0]]),k===b&&i&&(k=p.data(i,a),k=J(i,a,k)),k===b&&d[1]?this.data(d[0]):k}d[1]=c,this.each(function(){var b=p(this);b.triggerHandler("setData"+e,d),p.data(this,a,c),b.triggerHandler("changeData"+e,d)})},null,c,arguments.length>1,null,!1))},removeData:function(a){return this.each(function(){p.removeData(this,a)})}}),p.extend({queue:function(a,b,c){var d;if(a){return b=(b||"fx")+"queue",d=p._data(a,b),c&&(!d||p.isArray(c)?d=p._data(a,b,p.makeArray(c)):d.push(c)),d||[]}},dequeue:function(a,b){b=b||"fx";var c=p.queue(a,b),d=c.length,e=c.shift(),f=p._queueHooks(a,b),g=function(){p.dequeue(a,b)};e==="inprogress"&&(e=c.shift(),d--),e&&(b==="fx"&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return p._data(a,c)||p._data(a,c,{empty:p.Callbacks("once memory").add(function(){p.removeData(a,b+"queue",!0),p.removeData(a,c,!0)})})}}),p.fn.extend({queue:function(a,c){var d=2;return typeof a!="string"&&(c=a,a="fx",d--),arguments.length<d?p.queue(this[0],a):c===b?this:this.each(function(){var b=p.queue(this,a,c);p._queueHooks(this,a),a==="fx"&&b[0]!=="inprogress"&&p.dequeue(this,a)})},dequeue:function(a){return this.each(function(){p.dequeue(this,a)})},delay:function(a,b){return a=p.fx?p.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=p.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};typeof a!="string"&&(c=a,a=b),a=a||"fx";while(h--){d=p._data(g[h],a+"queueHooks"),d&&d.empty&&(e++,d.empty.add(i))}return i(),f.promise(c)}});var L,M,N,O=/[\t\r\n]/g,P=/\r/g,Q=/^(?:button|input)$/i,R=/^(?:button|input|object|select|textarea)$/i,S=/^a(?:rea|)$/i,T=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,U=p.support.getSetAttribute;p.fn.extend({attr:function(a,b){return p.access(this,p.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){p.removeAttr(this,a)})},prop:function(a,b){return p.access(this,p.prop,a,b,arguments.length>1)},removeProp:function(a){return a=p.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g,h;if(p.isFunction(a)){return this.each(function(b){p(this).addClass(a.call(this,b,this.className))})}if(a&&typeof a=="string"){b=a.split(s);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1){if(!e.className&&b.length===1){e.className=a}else{f=" "+e.className+" ";for(g=0,h=b.length;g<h;g++){~f.indexOf(" "+b[g]+" ")||(f+=b[g]+" ")}e.className=p.trim(f)}}}}return this},removeClass:function(a){var c,d,e,f,g,h,i;if(p.isFunction(a)){return this.each(function(b){p(this).removeClass(a.call(this,b,this.className))})}if(a&&typeof a=="string"||a===b){c=(a||"").split(s);for(h=0,i=this.length;h<i;h++){e=this[h];if(e.nodeType===1&&e.className){d=(" "+e.className+" ").replace(O," ");for(f=0,g=c.length;f<g;f++){while(d.indexOf(" "+c[f]+" ")>-1){d=d.replace(" "+c[f]+" "," ")}}e.className=a?p.trim(d):""}}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";return p.isFunction(a)?this.each(function(c){p(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if(c==="string"){var e,f=0,g=p(this),h=b,i=a.split(s);while(e=i[f++]){h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e)}}else{if(c==="undefined"||c==="boolean"){this.className&&p._data(this,"__className__",this.className),this.className=this.className||a===!1?"":p._data(this,"__className__")||""}}})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++){if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(O," ").indexOf(b)>-1){return !0}}return !1},val:function(a){var c,d,e,f=this[0];if(!arguments.length){if(f){return c=p.valHooks[f.type]||p.valHooks[f.nodeName.toLowerCase()],c&&"get" in c&&(d=c.get(f,"value"))!==b?d:(d=f.value,typeof d=="string"?d.replace(P,""):d==null?"":d)}return}return e=p.isFunction(a),this.each(function(d){var f,g=p(this);if(this.nodeType!==1){return}e?f=a.call(this,d,g.val()):f=a,f==null?f="":typeof f=="number"?f+="":p.isArray(f)&&(f=p.map(f,function(a){return a==null?"":a+""})),c=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()];if(!c||!("set" in c)||c.set(this,f,"value")===b){this.value=f}})}}),p.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return !b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,f=a.selectedIndex,g=[],h=a.options,i=a.type==="select-one";if(f<0){return null}c=i?f:0,d=i?f+1:h.length;for(;c<d;c++){e=h[c];if(e.selected&&(p.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!p.nodeName(e.parentNode,"optgroup"))){b=p(e).val();if(i){return b}g.push(b)}}return i&&!g.length&&h.length?p(h[f]).val():g},set:function(a,b){var c=p.makeArray(b);return p(a).find("option").each(function(){this.selected=p.inArray(p(this).val(),c)>=0}),c.length||(a.selectedIndex=-1),c}}},attrFn:{},attr:function(a,c,d,e){var f,g,h,i=a.nodeType;if(!a||i===3||i===8||i===2){return}if(e&&p.isFunction(p.fn[c])){return p(a)[c](d)}if(typeof a.getAttribute=="undefined"){return p.prop(a,c,d)}h=i!==1||!p.isXMLDoc(a),h&&(c=c.toLowerCase(),g=p.attrHooks[c]||(T.test(c)?M:L));if(d!==b){if(d===null){p.removeAttr(a,c);return}return g&&"set" in g&&h&&(f=g.set(a,d,c))!==b?f:(a.setAttribute(c,""+d),d)}return g&&"get" in g&&h&&(f=g.get(a,c))!==null?f:(f=a.getAttribute(c),f===null?b:f)},removeAttr:function(a,b){var c,d,e,f,g=0;if(b&&a.nodeType===1){d=b.split(s);for(;g<d.length;g++){e=d[g],e&&(c=p.propFix[e]||e,f=T.test(e),f||p.attr(a,e,""),a.removeAttribute(U?e:c),f&&c in a&&(a[c]=!1))}}},attrHooks:{type:{set:function(a,b){if(Q.test(a.nodeName)&&a.parentNode){p.error("type property can't be changed")}else{if(!p.support.radioValue&&b==="radio"&&p.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},value:{get:function(a,b){return L&&p.nodeName(a,"button")?L.get(a,b):b in a?a.value:null},set:function(a,b,c){if(L&&p.nodeName(a,"button")){return L.set(a,b,c)}a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(!a||h===3||h===8||h===2){return}return g=h!==1||!p.isXMLDoc(a),g&&(c=p.propFix[c]||c,f=p.propHooks[c]),d!==b?f&&"set" in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get" in f&&(e=f.get(a,c))!==null?e:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):R.test(a.nodeName)||S.test(a.nodeName)&&a.href?0:b}}}}),M={get:function(a,c){var d,e=p.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;return b===!1?p.removeAttr(a,c):(d=p.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase())),c}},U||(N={name:!0,id:!0,coords:!0},L=p.valHooks.button={get:function(a,c){var d;return d=a.getAttributeNode(c),d&&(N[c]?d.value!=="":d.specified)?d.value:b},set:function(a,b,c){var d=a.getAttributeNode(c);return d||(d=e.createAttribute(c),a.setAttributeNode(d)),d.value=b+""}},p.each(["width","height"],function(a,b){p.attrHooks[b]=p.extend(p.attrHooks[b],{set:function(a,c){if(c===""){return a.setAttribute(b,"auto"),c}}})}),p.attrHooks.contenteditable={get:L.get,set:function(a,b,c){b===""&&(b="false"),L.set(a,b,c)}}),p.support.hrefNormalized||p.each(["href","src","width","height"],function(a,c){p.attrHooks[c]=p.extend(p.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),p.support.style||(p.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),p.support.optSelected||(p.propHooks.selected=p.extend(p.propHooks.selected,{get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}})),p.support.enctype||(p.propFix.enctype="encoding"),p.support.checkOn||p.each(["radio","checkbox"],function(){p.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),p.each(["radio","checkbox"],function(){p.valHooks[this]=p.extend(p.valHooks[this],{set:function(a,b){if(p.isArray(b)){return a.checked=p.inArray(p(a).val(),b)>=0}}})});var V=/^(?:textarea|input|select)$/i,W=/^([^\.]*|)(?:\.(.+)|)$/,X=/(?:^|\s)hover(\.\S+|)\b/,Y=/^key/,Z=/^(?:mouse|contextmenu)|click/,$=/^(?:focusinfocus|focusoutblur)$/,_=function(a){return p.event.special.hover?a:a.replace(X,"mouseenter$1 mouseleave$1")};p.event={add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,q,r;if(a.nodeType===3||a.nodeType===8||!c||!d||!(g=p._data(a))){return}d.handler&&(o=d,d=o.handler,f=o.selector),d.guid||(d.guid=p.guid++),i=g.events,i||(g.events=i={}),h=g.handle,h||(g.handle=h=function(a){return typeof p!="undefined"&&(!a||p.event.triggered!==a.type)?p.event.dispatch.apply(h.elem,arguments):b},h.elem=a),c=p.trim(_(c)).split(" ");for(j=0;j<c.length;j++){k=W.exec(c[j])||[],l=k[1],m=(k[2]||"").split(".").sort(),r=p.event.special[l]||{},l=(f?r.delegateType:r.bindType)||l,r=p.event.special[l]||{},n=p.extend({type:l,origType:k[1],data:e,handler:d,guid:d.guid,selector:f,namespace:m.join(".")},o),q=i[l];if(!q){q=i[l]=[],q.delegateCount=0;if(!r.setup||r.setup.call(a,e,m,h)===!1){a.addEventListener?a.addEventListener(l,h,!1):a.attachEvent&&a.attachEvent("on"+l,h)}}r.add&&(r.add.call(a,n),n.handler.guid||(n.handler.guid=d.guid)),f?q.splice(q.delegateCount++,0,n):q.push(n),p.event.global[l]=!0}a=null},global:{},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,q,r=p.hasData(a)&&p._data(a);if(!r||!(m=r.events)){return}b=p.trim(_(b||"")).split(" ");for(f=0;f<b.length;f++){g=W.exec(b[f])||[],h=i=g[1],j=g[2];if(!h){for(h in m){p.event.remove(a,h+b[f],c,d,!0)}continue}n=p.event.special[h]||{},h=(d?n.delegateType:n.bindType)||h,o=m[h]||[],k=o.length,j=j?new RegExp("(^|\\.)"+j.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(l=0;l<o.length;l++){q=o[l],(e||i===q.origType)&&(!c||c.guid===q.guid)&&(!j||j.test(q.namespace))&&(!d||d===q.selector||d==="**"&&q.selector)&&(o.splice(l--,1),q.selector&&o.delegateCount--,n.remove&&n.remove.call(a,q))}o.length===0&&k!==o.length&&((!n.teardown||n.teardown.call(a,j,r.handle)===!1)&&p.removeEvent(a,h,r.handle),delete m[h])}p.isEmptyObject(m)&&(delete r.handle,p.removeData(a,"events",!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,f,g){if(!f||f.nodeType!==3&&f.nodeType!==8){var h,i,j,k,l,m,n,o,q,r,s=c.type||c,t=[];if($.test(s+p.event.triggered)){return}s.indexOf("!")>=0&&(s=s.slice(0,-1),i=!0),s.indexOf(".")>=0&&(t=s.split("."),s=t.shift(),t.sort());if((!f||p.event.customEvent[s])&&!p.event.global[s]){return}c=typeof c=="object"?c[p.expando]?c:new p.Event(s,c):new p.Event(s),c.type=s,c.isTrigger=!0,c.exclusive=i,c.namespace=t.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+t.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,m=s.indexOf(":")<0?"on"+s:"";if(!f){h=p.cache;for(j in h){h[j].events&&h[j].events[s]&&p.event.trigger(c,d,h[j].handle.elem,!0)}return}c.result=b,c.target||(c.target=f),d=d!=null?p.makeArray(d):[],d.unshift(c),n=p.event.special[s]||{};if(n.trigger&&n.trigger.apply(f,d)===!1){return}q=[[f,n.bindType||s]];if(!g&&!n.noBubble&&!p.isWindow(f)){r=n.delegateType||s,k=$.test(r+s)?f:f.parentNode;for(l=f;k;k=k.parentNode){q.push([k,r]),l=k}l===(f.ownerDocument||e)&&q.push([l.defaultView||l.parentWindow||a,r])}for(j=0;j<q.length&&!c.isPropagationStopped();j++){k=q[j][0],c.type=q[j][1],o=(p._data(k,"events")||{})[c.type]&&p._data(k,"handle"),o&&o.apply(k,d),o=m&&k[m],o&&p.acceptData(k)&&o.apply(k,d)===!1&&c.preventDefault()}return c.type=s,!g&&!c.isDefaultPrevented()&&(!n._default||n._default.apply(f.ownerDocument,d)===!1)&&(s!=="click"||!p.nodeName(f,"a"))&&p.acceptData(f)&&m&&f[s]&&(s!=="focus"&&s!=="blur"||c.target.offsetWidth!==0)&&!p.isWindow(f)&&(l=f[m],l&&(f[m]=null),p.event.triggered=s,f[s](),p.event.triggered=b,l&&(f[m]=l)),c.result}return},dispatch:function(c){c=p.event.fix(c||a.event);var d,e,f,g,h,i,j,k,l,m,n=(p._data(this,"events")||{})[c.type]||[],o=n.delegateCount,q=[].slice.call(arguments),r=!c.exclusive&&!c.namespace,s=p.event.special[c.type]||{},t=[];q[0]=c,c.delegateTarget=this;if(s.preDispatch&&s.preDispatch.call(this,c)===!1){return}if(o&&(!c.button||c.type!=="click")){for(f=c.target;f!=this;f=f.parentNode||this){if(f.disabled!==!0||c.type!=="click"){h={},j=[];for(d=0;d<o;d++){k=n[d],l=k.selector,h[l]===b&&(h[l]=p(l,this).index(f)>=0),h[l]&&j.push(k)}j.length&&t.push({elem:f,matches:j})}}}n.length>o&&t.push({elem:this,matches:n.slice(o)});for(d=0;d<t.length&&!c.isPropagationStopped();d++){i=t[d],c.currentTarget=i.elem;for(e=0;e<i.matches.length&&!c.isImmediatePropagationStopped();e++){k=i.matches[e];if(r||!c.namespace&&!k.namespace||c.namespace_re&&c.namespace_re.test(k.namespace)){c.data=k.data,c.handleObj=k,g=((p.event.special[k.origType]||{}).handle||k.handler).apply(i.elem,q),g!==b&&(c.result=g,g===!1&&(c.preventDefault(),c.stopPropagation()))}}}return s.postDispatch&&s.postDispatch.call(this,c),c.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,f,g,h=c.button,i=c.fromElement;return a.pageX==null&&c.clientX!=null&&(d=a.target.ownerDocument||e,f=d.documentElement,g=d.body,a.pageX=c.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=c.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?c.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0),a}},fix:function(a){if(a[p.expando]){return a}var b,c,d=a,f=p.event.fixHooks[a.type]||{},g=f.props?this.props.concat(f.props):this.props;a=p.Event(d);for(b=g.length;b;){c=g[--b],a[c]=d[c]}return a.target||(a.target=d.srcElement||e),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,f.filter?f.filter(a,d):a},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){p.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=p.extend(new p.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?p.event.trigger(e,null,b):p.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},p.event.handle=p.event.dispatch,p.removeEvent=e.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]=="undefined"&&(a[d]=null),a.detachEvent(d,c))},p.Event=function(a,b){if(this instanceof p.Event){a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?bb:ba):this.type=a,b&&p.extend(this,b),this.timeStamp=a&&a.timeStamp||p.now(),this[p.expando]=!0}else{return new p.Event(a,b)}},p.Event.prototype={preventDefault:function(){this.isDefaultPrevented=bb;var a=this.originalEvent;if(!a){return}a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=bb;var a=this.originalEvent;if(!a){return}a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=bb,this.stopPropagation()},isDefaultPrevented:ba,isPropagationStopped:ba,isImmediatePropagationStopped:ba},p.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){p.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj,g=f.selector;if(!e||e!==d&&!p.contains(d,e)){a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b}return c}}}),p.support.submitBubbles||(p.event.special.submit={setup:function(){if(p.nodeName(this,"form")){return !1}p.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=p.nodeName(c,"input")||p.nodeName(c,"button")?c.form:b;d&&!p._data(d,"_submit_attached")&&(p.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),p._data(d,"_submit_attached",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&p.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(p.nodeName(this,"form")){return !1}p.event.remove(this,"._submit")}}),p.support.changeBubbles||(p.event.special.change={setup:function(){if(V.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){p.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),p.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),p.event.simulate("change",this,a,!0)})}return !1}p.event.add(this,"beforeactivate._change",function(a){var b=a.target;V.test(b.nodeName)&&!p._data(b,"_change_attached")&&(p.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&p.event.simulate("change",this.parentNode,a,!0)}),p._data(b,"_change_attached",!0))})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox"){return a.handleObj.handler.apply(this,arguments)}},teardown:function(){return p.event.remove(this,"._change"),!V.test(this.nodeName)}}),p.support.focusinBubbles||p.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){p.event.simulate(b,a.target,p.event.fix(a),!0)};p.event.special[b]={setup:function(){c++===0&&e.addEventListener(a,d,!0)},teardown:function(){--c===0&&e.removeEventListener(a,d,!0)}}}),p.fn.extend({on:function(a,c,d,e,f){var g,h;if(typeof a=="object"){typeof c!="string"&&(d=d||c,c=b);for(h in a){this.on(h,c,d,a[h],f)}return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1){e=ba}else{if(!e){return this}}return f===1&&(g=e,e=function(a){return p().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=p.guid++)),this.each(function(){p.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,f;if(a&&a.preventDefault&&a.handleObj){return e=a.handleObj,p(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this}if(typeof a=="object"){for(f in a){this.off(f,c,a[f])}return this}if(c===!1||typeof c=="function"){d=c,c=b}return d===!1&&(d=ba),this.each(function(){p.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){return p(this.context).on(a,this.selector,b,c),this},die:function(a,b){return p(this.context).off(a,this.selector||"**",b),this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a||"**",c)},trigger:function(a,b){return this.each(function(){p.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0]){return p.event.trigger(a,b,this[0],!0)}},toggle:function(a){var b=arguments,c=a.guid||p.guid++,d=0,e=function(c){var e=(p._data(this,"lastToggle"+a.guid)||0)%d;return p._data(this,"lastToggle"+a.guid,e+1),c.preventDefault(),b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length){b[d++].guid=c}return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),p.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){p.fn[b]=function(a,c){return c==null&&(c=a,a=null),arguments.length>0?this.on(b,null,a,c):this.trigger(b)},Y.test(b)&&(p.event.fixHooks[b]=p.event.keyHooks),Z.test(b)&&(p.event.fixHooks[b]=p.event.mouseHooks)}),function(a,b){function $(a,b,c,d){c=c||[],b=b||q;var e,f,g,j,k=b.nodeType;if(k!==1&&k!==9){return[]}if(!a||typeof a!="string"){return c}g=h(b);if(!g&&!d){if(e=L.exec(a)){if(j=e[1]){if(k===9){f=b.getElementById(j);if(!f||!f.parentNode){return c}if(f.id===j){return c.push(f),c}}else{if(b.ownerDocument&&(f=b.ownerDocument.getElementById(j))&&i(b,f)&&f.id===j){return c.push(f),c}}}else{if(e[2]){return u.apply(c,t.call(b.getElementsByTagName(a),0)),c}if((j=e[3])&&X&&b.getElementsByClassName){return u.apply(c,t.call(b.getElementsByClassName(j),0)),c}}}}return bk(a,b,c,d,g)}function _(a){return function(b){var c=b.nodeName.toLowerCase();return c==="input"&&b.type===a}}function ba(a){return function(b){var c=b.nodeName.toLowerCase();return(c==="input"||c==="button")&&b.type===a}}function bb(a,b,c){if(a===b){return c}var d=a.nextSibling;while(d){if(d===b){return -1}d=d.nextSibling}return 1}function bc(a,b,c,d){var e,g,h,i,j,k,l,m,n,p,r=!c&&b!==q,s=(r?"<s>":"")+a.replace(H,"$1<s>"),u=y[o][s];if(u){return d?0:t.call(u,0)}j=a,k=[],m=0,n=f.preFilter,p=f.filter;while(j){if(!e||(g=I.exec(j))){g&&(j=j.slice(g[0].length),h.selector=l),k.push(h=[]),l="",r&&(j=" "+j)}e=!1;if(g=J.exec(j)){l+=g[0],j=j.slice(g[0].length),e=h.push({part:g.pop().replace(H," "),string:g[0],captures:g})}for(i in p){(g=S[i].exec(j))&&(!n[i]||(g=n[i](g,b,c)))&&(l+=g[0],j=j.slice(g[0].length),e=h.push({part:i,string:g.shift(),captures:g}))}if(!e){break}}return l&&(h.selector=l),d?j.length:j?$.error(a):t.call(y(s,k),0)}function bd(a,b,e,f){var g=b.dir,h=s++;return a||(a=function(a){return a===e}),b.first?function(b){while(b=b[g]){if(b.nodeType===1){return a(b)&&b}}}:f?function(b){while(b=b[g]){if(b.nodeType===1&&a(b)){return b}}}:function(b){var e,f=h+"."+c,i=f+"."+d;while(b=b[g]){if(b.nodeType===1){if((e=b[o])===i){return b.sizset}if(typeof e=="string"&&e.indexOf(f)===0){if(b.sizset){return b}}else{b[o]=i;if(a(b)){return b.sizset=!0,b}b.sizset=!1}}}}}function be(a,b){return a?function(c){var d=b(c);return d&&a(d===!0?c:d)}:b}function bf(a,b,c){var d,e,g=0;for(;d=a[g];g++){f.relative[d.part]?e=bd(e,f.relative[d.part],b,c):e=be(e,f.filter[d.part].apply(null,d.captures.concat(b,c)))}return e}function bg(a){return function(b){var c,d=0;for(;c=a[d];d++){if(c(b)){return !0}}return !1}}function bh(a,b,c,d){var e=0,f=b.length;for(;e<f;e++){$(a,b[e],c,d)}}function bi(a,b,c,d,e,g){var h,i=f.setFilters[b.toLowerCase()];return i||$.error(b),(a||!(h=e))&&bh(a||"*",d,h=[],e),h.length>0?i(h,c,g):[]}function bj(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s=0,t=a.length,v=S.POS,w=new RegExp("^"+v.source+"(?!"+A+")","i"),x=function(){var a=1,c=arguments.length-2;for(;a<c;a++){arguments[a]===b&&(n[a]=b)}};for(;s<t;s++){f=a[s],g="",m=e;for(h=0,i=f.length;h<i;h++){j=f[h],k=j.string;if(j.part==="PSEUDO"){v.exec(""),l=0;while(n=v.exec(k)){o=!0,p=v.lastIndex=n.index+n[0].length;if(p>l){g+=k.slice(l,n.index),l=p,q=[c],J.test(g)&&(m&&(q=m),m=e);if(r=O.test(g)){g=g.slice(0,-5).replace(J,"$&*"),l++}n.length>1&&n[0].replace(w,x),m=bi(g,n[1],n[2],q,m,r)}g=""}}o||(g+=k),o=!1}g?J.test(g)?bh(g,m||[c],d,e):$(g,c,d,e?e.concat(m):m):u.apply(d,m)}return t===1?d:$.uniqueSort(d)}function bk(a,b,e,g,h){a=a.replace(H,"$1");var i,k,l,m,n,o,p,q,r,s,v=bc(a,b,h),w=b.nodeType;if(S.POS.test(a)){return bj(v,b,e,g)}if(g){i=t.call(g,0)}else{if(v.length===1){if((o=t.call(v[0],0)).length>2&&(p=o[0]).part==="ID"&&w===9&&!h&&f.relative[o[1].part]){b=f.find.ID(p.captures[0].replace(R,""),b,h)[0];if(!b){return e}a=a.slice(o.shift().string.length)}r=(v=N.exec(o[0].string))&&!v.index&&b.parentNode||b,q="";for(n=o.length-1;n>=0;n--){p=o[n],s=p.part,q=p.string+q;if(f.relative[s]){break}if(f.order.test(s)){i=f.find[s](p.captures[0].replace(R,""),r,h);if(i==null){continue}a=a.slice(0,a.length-q.length)+q.replace(S[s],""),a||u.apply(e,t.call(i,0));break}}}}if(a){k=j(a,b,h),c=k.dirruns++,i==null&&(i=f.find.TAG("*",N.test(a)&&b.parentNode||b));for(n=0;m=i[n];n++){d=k.runs++,k(m)&&e.push(m)}}return e}var c,d,e,f,g,h,i,j,k,l,m=!0,n="undefined",o=("sizcache"+Math.random()).replace(".",""),q=a.document,r=q.documentElement,s=0,t=[].slice,u=[].push,v=function(a,b){return a[o]=b||!0,a},w=function(){var a={},b=[];return v(function(c,d){return b.push(c)>f.cacheLength&&delete a[b.shift()],a[c]=d},a)},x=w(),y=w(),z=w(),A="[\\x20\\t\\r\\n\\f]",B="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",C=B.replace("w","w#"),D="([*^$|!~]?=)",E="\\["+A+"*("+B+")"+A+"*(?:"+D+A+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+C+")|)|)"+A+"*\\]",F=":("+B+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+E+")|[^:]|\\\\.)*|.*))\\)|)",G=":(nth|eq|gt|lt|first|last|even|odd)(?:\\(((?:-\\d)?\\d*)\\)|)(?=[^-]|$)",H=new RegExp("^"+A+"+|((?:^|[^\\\\])(?:\\\\.)*)"+A+"+$","g"),I=new RegExp("^"+A+"*,"+A+"*"),J=new RegExp("^"+A+"*([\\x20\\t\\r\\n\\f>+~])"+A+"*"),K=new RegExp(F),L=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,M=/^:not/,N=/[\x20\t\r\n\f]*[+~]/,O=/:not\($/,P=/h\d/i,Q=/input|select|textarea|button/i,R=/\\(?!\\)/g,S={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),NAME:new RegExp("^\\[name=['\"]?("+B+")['\"]?\\]"),TAG:new RegExp("^("+B.replace("w","w*")+")"),ATTR:new RegExp("^"+E),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|nth|last|first)-child(?:\\("+A+"*(even|odd|(([+-]|)(\\d*)n|)"+A+"*(?:([+-]|)"+A+"*(\\d+)|))"+A+"*\\)|)","i"),POS:new RegExp(G,"ig"),needsContext:new RegExp("^"+A+"*[>+~]|"+G,"i")},T=function(a){var b=q.createElement("div");try{return a(b)}catch(c){return !1}finally{b=null}},U=T(function(a){return a.appendChild(q.createComment("")),!a.getElementsByTagName("*").length}),V=T(function(a){return a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!==n&&a.firstChild.getAttribute("href")==="#"}),W=T(function(a){a.innerHTML="<select></select>";var b=typeof a.lastChild.getAttribute("multiple");return b!=="boolean"&&b!=="string"}),X=T(function(a){return a.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!a.getElementsByClassName||!a.getElementsByClassName("e").length?!1:(a.lastChild.className="e",a.getElementsByClassName("e").length===2)}),Y=T(function(a){a.id=o+0,a.innerHTML="<a name='"+o+"'></a><div name='"+o+"'></div>",r.insertBefore(a,r.firstChild);var b=q.getElementsByName&&q.getElementsByName(o).length===2+q.getElementsByName(o+0).length;return e=!q.getElementById(o),r.removeChild(a),b});try{t.call(r.childNodes,0)[0].nodeType}catch(Z){t=function(a){var b,c=[];for(;b=this[a];a++){c.push(b)}return c}}$.matches=function(a,b){return $(a,null,null,b)},$.matchesSelector=function(a,b){return $(b,null,null,[a]).length>0},g=$.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(e===1||e===9||e===11){if(typeof a.textContent=="string"){return a.textContent}for(a=a.firstChild;a;a=a.nextSibling){c+=g(a)}}else{if(e===3||e===4){return a.nodeValue}}}else{for(;b=a[d];d++){c+=g(b)}}return c},h=$.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?b.nodeName!=="HTML":!1},i=$.contains=r.contains?function(a,b){var c=a.nodeType===9?a.documentElement:a,d=b&&b.parentNode;return a===d||!!(d&&d.nodeType===1&&c.contains&&c.contains(d))}:r.compareDocumentPosition?function(a,b){return b&&!!(a.compareDocumentPosition(b)&16)}:function(a,b){while(b=b.parentNode){if(b===a){return !0}}return !1},$.attr=function(a,b){var c,d=h(a);return d||(b=b.toLowerCase()),f.attrHandle[b]?f.attrHandle[b](a):W||d?a.getAttribute(b):(c=a.getAttributeNode(b),c?typeof a[b]=="boolean"?a[b]?b:null:c.specified?c.value:null:null)},f=$.selectors={cacheLength:50,createPseudo:v,match:S,order:new RegExp("ID|TAG"+(Y?"|NAME":"")+(X?"|CLASS":"")),attrHandle:V?{}:{href:function(a){return a.getAttribute("href",2)},type:function(a){return a.getAttribute("type")}},find:{ID:e?function(a,b,c){if(typeof b.getElementById!==n&&!c){var d=b.getElementById(a);return d&&d.parentNode?[d]:[]}}:function(a,c,d){if(typeof c.getElementById!==n&&!d){var e=c.getElementById(a);return e?e.id===a||typeof e.getAttributeNode!==n&&e.getAttributeNode("id").value===a?[e]:b:[]}},TAG:U?function(a,b){if(typeof b.getElementsByTagName!==n){return b.getElementsByTagName(a)}}:function(a,b){var c=b.getElementsByTagName(a);if(a==="*"){var d,e=[],f=0;for(;d=c[f];f++){d.nodeType===1&&e.push(d)}return e}return c},NAME:function(a,b){if(typeof b.getElementsByName!==n){return b.getElementsByName(name)}},CLASS:function(a,b,c){if(typeof b.getElementsByClassName!==n&&!c){return b.getElementsByClassName(a)}}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(R,""),a[3]=(a[4]||a[5]||"").replace(R,""),a[2]==="~="&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),a[1]==="nth"?(a[2]||$.error(a[0]),a[3]=+(a[3]?a[4]+(a[5]||1):2*(a[2]==="even"||a[2]==="odd")),a[4]=+(a[6]+a[7]||a[2]==="odd")):a[2]&&$.error(a[0]),a},PSEUDO:function(a,b,c){var d,e;if(S.CHILD.test(a[0])){return null}if(a[3]){a[2]=a[3]}else{if(d=a[4]){K.test(d)&&(e=bc(d,b,c,!0))&&(e=d.indexOf(")",d.length-e)-d.length)&&(d=d.slice(0,e),a[0]=a[0].slice(0,e)),a[2]=d}}return a.slice(0,3)}},filter:{ID:e?function(a){return a=a.replace(R,""),function(b){return b.getAttribute("id")===a}}:function(a){return a=a.replace(R,""),function(b){var c=typeof b.getAttributeNode!==n&&b.getAttributeNode("id");return c&&c.value===a}},TAG:function(a){return a==="*"?function(){return !0}:(a=a.replace(R,"").toLowerCase(),function(b){return b.nodeName&&b.nodeName.toLowerCase()===a})},CLASS:function(a){var b=x[o][a];return b||(b=x(a,new RegExp("(^|"+A+")"+a+"("+A+"|$)"))),function(a){return b.test(a.className||typeof a.getAttribute!==n&&a.getAttribute("class")||"")}},ATTR:function(a,b,c){return b?function(d){var e=$.attr(d,a),f=e+"";if(e==null){return b==="!="}switch(b){case"=":return f===c;case"!=":return f!==c;case"^=":return c&&f.indexOf(c)===0;case"*=":return c&&f.indexOf(c)>-1;case"$=":return c&&f.substr(f.length-c.length)===c;case"~=":return(" "+f+" ").indexOf(c)>-1;case"|=":return f===c||f.substr(0,c.length+1)===c+"-"}}:function(b){return $.attr(b,a)!=null}},CHILD:function(a,b,c,d){if(a==="nth"){var e=s++;return function(a){var b,f,g=0,h=a;if(c===1&&d===0){return !0}b=a.parentNode;if(b&&(b[o]!==e||!a.sizset)){for(h=b.firstChild;h;h=h.nextSibling){if(h.nodeType===1){h.sizset=++g;if(h===a){break}}}b[o]=e}return f=a.sizset-d,c===0?f===0:f%c===0&&f/c>=0}}return function(b){var c=b;switch(a){case"only":case"first":while(c=c.previousSibling){if(c.nodeType===1){return !1}}if(a==="first"){return !0}c=b;case"last":while(c=c.nextSibling){if(c.nodeType===1){return !1}}return !0}}},PSEUDO:function(a,b,c,d){var e,g=f.pseudos[a]||f.pseudos[a.toLowerCase()];return g||$.error("unsupported pseudo: "+a),g[o]?g(b,c,d):g.length>1?(e=[a,a,"",b],function(a){return g(a,0,e)}):g}},pseudos:{not:v(function(a,b,c){var d=j(a.replace(H,"$1"),b,c);return function(a){return !d(a)}}),enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&!!a.checked||b==="option"&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},parent:function(a){return !f.pseudos.empty(a)},empty:function(a){var b;a=a.firstChild;while(a){if(a.nodeName>"@"||(b=a.nodeType)===3||b===4){return !1}a=a.nextSibling}return !0},contains:v(function(a){return function(b){return(b.textContent||b.innerText||g(b)).indexOf(a)>-1}}),has:v(function(a){return function(b){return $(a,b).length>0}}),header:function(a){return P.test(a.nodeName)},text:function(a){var b,c;return a.nodeName.toLowerCase()==="input"&&(b=a.type)==="text"&&((c=a.getAttribute("type"))==null||c.toLowerCase()===b)},radio:_("radio"),checkbox:_("checkbox"),file:_("file"),password:_("password"),image:_("image"),submit:ba("submit"),reset:ba("reset"),button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&a.type==="button"||b==="button"},input:function(a){return Q.test(a.nodeName)},focus:function(a){var b=a.ownerDocument;return a===b.activeElement&&(!b.hasFocus||b.hasFocus())&&(!!a.type||!!a.href)},active:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b,c){return c?a.slice(1):[a[0]]},last:function(a,b,c){var d=a.pop();return c?a:[d]},even:function(a,b,c){var d=[],e=c?1:0,f=a.length;for(;e<f;e=e+2){d.push(a[e])}return d},odd:function(a,b,c){var d=[],e=c?0:1,f=a.length;for(;e<f;e=e+2){d.push(a[e])}return d},lt:function(a,b,c){return c?a.slice(+b):a.slice(0,+b)},gt:function(a,b,c){return c?a.slice(0,+b+1):a.slice(+b+1)},eq:function(a,b,c){var d=a.splice(+b,1);return c?a:d}}},k=r.compareDocumentPosition?function(a,b){return a===b?(l=!0,0):(!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition:a.compareDocumentPosition(b)&4)?-1:1}:function(a,b){if(a===b){return l=!0,0}if(a.sourceIndex&&b.sourceIndex){return a.sourceIndex-b.sourceIndex}var c,d,e=[],f=[],g=a.parentNode,h=b.parentNode,i=g;if(g===h){return bb(a,b)}if(!g){return -1}if(!h){return 1}while(i){e.unshift(i),i=i.parentNode}i=h;while(i){f.unshift(i),i=i.parentNode}c=e.length,d=f.length;for(var j=0;j<c&&j<d;j++){if(e[j]!==f[j]){return bb(e[j],f[j])}}return j===c?bb(a,f[j],-1):bb(e[j],b,1)},[0,0].sort(k),m=!l,$.uniqueSort=function(a){var b,c=1;l=m,a.sort(k);if(l){for(;b=a[c];c++){b===a[c-1]&&a.splice(c--,1)}}return a},$.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},j=$.compile=function(a,b,c){var d,e,f,g=z[o][a];if(g&&g.context===b){return g}d=bc(a,b,c);for(e=0,f=d.length;e<f;e++){d[e]=bf(d[e],b,c)}return g=z(a,bg(d)),g.context=b,g.runs=g.dirruns=0,g},q.querySelectorAll&&function(){var a,b=bk,c=/'|\\/g,d=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,e=[],f=[":active"],g=r.matchesSelector||r.mozMatchesSelector||r.webkitMatchesSelector||r.oMatchesSelector||r.msMatchesSelector;T(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||e.push("\\["+A+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),a.querySelectorAll(":checked").length||e.push(":checked")}),T(function(a){a.innerHTML="<p test=''></p>",a.querySelectorAll("[test^='']").length&&e.push("[*^$]="+A+"*(?:\"\"|'')"),a.innerHTML="<input type='hidden'/>",a.querySelectorAll(":enabled").length||e.push(":enabled",":disabled")}),e=e.length&&new RegExp(e.join("|")),bk=function(a,d,f,g,h){if(!g&&!h&&(!e||!e.test(a))){if(d.nodeType===9){try{return u.apply(f,t.call(d.querySelectorAll(a),0)),f}catch(i){}}else{if(d.nodeType===1&&d.nodeName.toLowerCase()!=="object"){var j,k,l,m=d.getAttribute("id"),n=m||o,p=N.test(a)&&d.parentNode||d;m?n=n.replace(c,"\\$&"):d.setAttribute("id",n),j=bc(a,d,h),n="[id='"+n+"']";for(k=0,l=j.length;k<l;k++){j[k]=n+j[k].selector}try{return u.apply(f,t.call(p.querySelectorAll(j.join(",")),0)),f}catch(i){}finally{m||d.removeAttribute("id")}}}}return b(a,d,f,g,h)},g&&(T(function(b){a=g.call(b,"div");try{g.call(b,"[test!='']:sizzle"),f.push(S.PSEUDO.source,S.POS.source,"!=")}catch(c){}}),f=new RegExp(f.join("|")),$.matchesSelector=function(b,c){c=c.replace(d,"='$1']");if(!h(b)&&!f.test(c)&&(!e||!e.test(c))){try{var i=g.call(b,c);if(i||a||b.document&&b.document.nodeType!==11){return i}}catch(j){}}return $(c,null,null,[b]).length>0})}(),f.setFilters.nth=f.setFilters.eq,f.filters=f.pseudos,$.attr=p.attr,p.find=$,p.expr=$.selectors,p.expr[":"]=p.expr.pseudos,p.unique=$.uniqueSort,p.text=$.getText,p.isXMLDoc=$.isXML,p.contains=$.contains}(a);var bc=/Until$/,bd=/^(?:parents|prev(?:Until|All))/,be=/^.[^:#\[\.,]*$/,bf=p.expr.match.needsContext,bg={children:!0,contents:!0,next:!0,prev:!0};p.fn.extend({find:function(a){var b,c,d,e,f,g,h=this;if(typeof a!="string"){return p(a).filter(function(){for(b=0,c=h.length;b<c;b++){if(p.contains(h[b],this)){return !0}}})}g=this.pushStack("","find",a);for(b=0,c=this.length;b<c;b++){d=g.length,p.find(a,this[b],g);if(b>0){for(e=d;e<g.length;e++){for(f=0;f<d;f++){if(g[f]===g[e]){g.splice(e--,1);break}}}}}return g},has:function(a){var b,c=p(a,this),d=c.length;return this.filter(function(){for(b=0;b<d;b++){if(p.contains(this,c[b])){return !0}}})},not:function(a){return this.pushStack(bj(this,a,!1),"not",a)},filter:function(a){return this.pushStack(bj(this,a,!0),"filter",a)},is:function(a){return !!a&&(typeof a=="string"?bf.test(a)?p(a,this.context).index(this[0])>=0:p.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c,d=0,e=this.length,f=[],g=bf.test(a)||typeof a!="string"?p(a,b||this.context):0;for(;d<e;d++){c=this[d];while(c&&c.ownerDocument&&c!==b&&c.nodeType!==11){if(g?g.index(c)>-1:p.find.matchesSelector(c,a)){f.push(c);break}c=c.parentNode}}return f=f.length>1?p.unique(f):f,this.pushStack(f,"closest",a)},index:function(a){return a?typeof a=="string"?p.inArray(this[0],p(a)):p.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(a,b){var c=typeof a=="string"?p(a,b):p.makeArray(a&&a.nodeType?[a]:a),d=p.merge(this.get(),c);return this.pushStack(bh(c[0])||bh(d[0])?d:p.unique(d))},addBack:function(a){return this.add(a==null?this.prevObject:this.prevObject.filter(a))}}),p.fn.andSelf=p.fn.addBack,p.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return p.dir(a,"parentNode")},parentsUntil:function(a,b,c){return p.dir(a,"parentNode",c)},next:function(a){return bi(a,"nextSibling")},prev:function(a){return bi(a,"previousSibling")},nextAll:function(a){return p.dir(a,"nextSibling")},prevAll:function(a){return p.dir(a,"previousSibling")},nextUntil:function(a,b,c){return p.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return p.dir(a,"previousSibling",c)},siblings:function(a){return p.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return p.sibling(a.firstChild)},contents:function(a){return p.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:p.merge([],a.childNodes)}},function(a,b){p.fn[a]=function(c,d){var e=p.map(this,b,c);return bc.test(a)||(d=c),d&&typeof d=="string"&&(e=p.filter(d,e)),e=this.length>1&&!bg[a]?p.unique(e):e,this.length>1&&bd.test(a)&&(e=e.reverse()),this.pushStack(e,a,k.call(arguments).join(","))}}),p.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),b.length===1?p.find.matchesSelector(b[0],a)?[b[0]]:[]:p.find.matches(a,b)},dir:function(a,c,d){var e=[],f=a[c];while(f&&f.nodeType!==9&&(d===b||f.nodeType!==1||!p(f).is(d))){f.nodeType===1&&e.push(f),f=f[c]}return e},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling){a.nodeType===1&&a!==b&&c.push(a)}return c}});var bl="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",bm=/ jQuery\d+="(?:null|\d+)"/g,bn=/^\s+/,bo=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bp=/<([\w:]+)/,bq=/<tbody/i,br=/<|&#?\w+;/,bs=/<(?:script|style|link)/i,bt=/<(?:script|object|embed|option|style)/i,bu=new RegExp("<(?:"+bl+")[\\s/>]","i"),bv=/^(?:checkbox|radio)$/,bw=/checked\s*(?:[^=]|=\s*.checked.)/i,bx=/\/(java|ecma)script/i,by=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,bz={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bA=bk(e),bB=bA.appendChild(e.createElement("div"));bz.optgroup=bz.option,bz.tbody=bz.tfoot=bz.colgroup=bz.caption=bz.thead,bz.th=bz.td,p.support.htmlSerialize||(bz._default=[1,"X<div>","</div>"]),p.fn.extend({text:function(a){return p.access(this,function(a){return a===b?p.text(this):this.empty().append((this[0]&&this[0].ownerDocument||e).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(p.isFunction(a)){return this.each(function(b){p(this).wrapAll(a.call(this,b))})}if(this[0]){var b=p(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1){a=a.firstChild}return a}).append(this)}return this},wrapInner:function(a){return p.isFunction(a)?this.each(function(b){p(this).wrapInner(a.call(this,b))}):this.each(function(){var b=p(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=p.isFunction(a);return this.each(function(c){p(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){p.nodeName(this,"body")||p(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){(this.nodeType===1||this.nodeType===11)&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(a,this.firstChild)})},before:function(){if(!bh(this[0])){return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)})}if(arguments.length){var a=p.clean(arguments);return this.pushStack(p.merge(a,this),"before",this.selector)}},after:function(){if(!bh(this[0])){return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)})}if(arguments.length){var a=p.clean(arguments);return this.pushStack(p.merge(this,a),"after",this.selector)}},remove:function(a,b){var c,d=0;for(;(c=this[d])!=null;d++){if(!a||p.filter(a,[c]).length){!b&&c.nodeType===1&&(p.cleanData(c.getElementsByTagName("*")),p.cleanData([c])),c.parentNode&&c.parentNode.removeChild(c)}}return this},empty:function(){var a,b=0;for(;(a=this[b])!=null;b++){a.nodeType===1&&p.cleanData(a.getElementsByTagName("*"));while(a.firstChild){a.removeChild(a.firstChild)}}return this},clone:function(a,b){return a=a==null?!1:a,b=b==null?a:b,this.map(function(){return p.clone(this,a,b)})},html:function(a){return p.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b){return c.nodeType===1?c.innerHTML.replace(bm,""):b}if(typeof a=="string"&&!bs.test(a)&&(p.support.htmlSerialize||!bu.test(a))&&(p.support.leadingWhitespace||!bn.test(a))&&!bz[(bp.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(bo,"<$1></$2>");try{for(;d<e;d++){c=this[d]||{},c.nodeType===1&&(p.cleanData(c.getElementsByTagName("*")),c.innerHTML=a)}c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){return bh(this[0])?this.length?this.pushStack(p(p.isFunction(a)?a():a),"replaceWith",a):this:p.isFunction(a)?this.each(function(b){var c=p(this),d=c.html();c.replaceWith(a.call(this,b,d))}):(typeof a!="string"&&(a=p(a).detach()),this.each(function(){var b=this.nextSibling,c=this.parentNode;p(this).remove(),b?p(b).before(a):p(c).append(a)}))},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){a=[].concat.apply([],a);var e,f,g,h,i=0,j=a[0],k=[],l=this.length;if(!p.support.checkClone&&l>1&&typeof j=="string"&&bw.test(j)){return this.each(function(){p(this).domManip(a,c,d)})}if(p.isFunction(j)){return this.each(function(e){var f=p(this);a[0]=j.call(this,e,c?f.html():b),f.domManip(a,c,d)})}if(this[0]){e=p.buildFragment(a,this,k),g=e.fragment,f=g.firstChild,g.childNodes.length===1&&(g=f);if(f){c=c&&p.nodeName(f,"tr");for(h=e.cacheable||l-1;i<l;i++){d.call(c&&p.nodeName(this[i],"table")?bC(this[i],"tbody"):this[i],i===h?g:p.clone(g,!0,!0))}}g=f=null,k.length&&p.each(k,function(a,b){b.src?p.ajax?p.ajax({url:b.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):p.error("no ajax"):p.globalEval((b.text||b.textContent||b.innerHTML||"").replace(by,"")),b.parentNode&&b.parentNode.removeChild(b)})}return this}}),p.buildFragment=function(a,c,d){var f,g,h,i=a[0];return c=c||e,c=!c.nodeType&&c[0]||c,c=c.ownerDocument||c,a.length===1&&typeof i=="string"&&i.length<512&&c===e&&i.charAt(0)==="<"&&!bt.test(i)&&(p.support.checkClone||!bw.test(i))&&(p.support.html5Clone||!bu.test(i))&&(g=!0,f=p.fragments[i],h=f!==b),f||(f=c.createDocumentFragment(),p.clean(a,c,f,d),g&&(p.fragments[i]=h&&f)),{fragment:f,cacheable:g}},p.fragments={},p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){p.fn[a]=function(c){var d,e=0,f=[],g=p(c),h=g.length,i=this.length===1&&this[0].parentNode;if((i==null||i&&i.nodeType===11&&i.childNodes.length===1)&&h===1){return g[b](this[0]),this}for(;e<h;e++){d=(e>0?this.clone(!0):this).get(),p(g[e])[b](d),f=f.concat(d)}return this.pushStack(f,a,g.selector)}}),p.extend({clone:function(a,b,c){var d,e,f,g;p.support.html5Clone||p.isXMLDoc(a)||!bu.test("<"+a.nodeName+">")?g=a.cloneNode(!0):(bB.innerHTML=a.outerHTML,bB.removeChild(g=bB.firstChild));if((!p.support.noCloneEvent||!p.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!p.isXMLDoc(a)){bE(a,g),d=bF(a),e=bF(g);for(f=0;d[f];++f){e[f]&&bE(d[f],e[f])}}if(b){bD(a,g);if(c){d=bF(a),e=bF(g);for(f=0;d[f];++f){bD(d[f],e[f])}}}return d=e=null,g},clean:function(a,b,c,d){var f,g,h,i,j,k,l,m,n,o,q,r,s=b===e&&bA,t=[];if(!b||typeof b.createDocumentFragment=="undefined"){b=e}for(f=0;(h=a[f])!=null;f++){typeof h=="number"&&(h+="");if(!h){continue}if(typeof h=="string"){if(!br.test(h)){h=b.createTextNode(h)}else{s=s||bk(b),l=b.createElement("div"),s.appendChild(l),h=h.replace(bo,"<$1></$2>"),i=(bp.exec(h)||["",""])[1].toLowerCase(),j=bz[i]||bz._default,k=j[0],l.innerHTML=j[1]+h+j[2];while(k--){l=l.lastChild}if(!p.support.tbody){m=bq.test(h),n=i==="table"&&!m?l.firstChild&&l.firstChild.childNodes:j[1]==="<table>"&&!m?l.childNodes:[];for(g=n.length-1;g>=0;--g){p.nodeName(n[g],"tbody")&&!n[g].childNodes.length&&n[g].parentNode.removeChild(n[g])}}!p.support.leadingWhitespace&&bn.test(h)&&l.insertBefore(b.createTextNode(bn.exec(h)[0]),l.firstChild),h=l.childNodes,l.parentNode.removeChild(l)}}h.nodeType?t.push(h):p.merge(t,h)}l&&(h=l=s=null);if(!p.support.appendChecked){for(f=0;(h=t[f])!=null;f++){p.nodeName(h,"input")?bG(h):typeof h.getElementsByTagName!="undefined"&&p.grep(h.getElementsByTagName("input"),bG)}}if(c){q=function(a){if(!a.type||bx.test(a.type)){return d?d.push(a.parentNode?a.parentNode.removeChild(a):a):c.appendChild(a)}};for(f=0;(h=t[f])!=null;f++){if(!p.nodeName(h,"script")||!q(h)){c.appendChild(h),typeof h.getElementsByTagName!="undefined"&&(r=p.grep(p.merge([],h.getElementsByTagName("script")),q),t.splice.apply(t,[f+1,0].concat(r)),f+=r.length)}}}return t},cleanData:function(a,b){var c,d,e,f,g=0,h=p.expando,i=p.cache,j=p.support.deleteExpando,k=p.event.special;for(;(e=a[g])!=null;g++){if(b||p.acceptData(e)){d=e[h],c=d&&i[d];if(c){if(c.events){for(f in c.events){k[f]?p.event.remove(e,f):p.removeEvent(e,f,c.handle)}}i[d]&&(delete i[d],j?delete e[h]:e.removeAttribute?e.removeAttribute(h):e[h]=null,p.deletedIds.push(d))}}}}}),function(){var a,b;p.uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},a=p.uaMatch(g.userAgent),b={},a.browser&&(b[a.browser]=!0,b.version=a.version),b.chrome?b.webkit=!0:b.webkit&&(b.safari=!0),p.browser=b,p.sub=function(){function a(b,c){return new a.fn.init(b,c)}p.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function c(c,d){return d&&d instanceof p&&!(d instanceof a)&&(d=a(d)),p.fn.init.call(this,c,d,b)},a.fn.init.prototype=a.fn;var b=a(e);return a}}();var bH,bI,bJ,bK=/alpha\([^)]*\)/i,bL=/opacity=([^)]*)/,bM=/^(top|right|bottom|left)$/,bN=/^(none|table(?!-c[ea]).+)/,bO=/^margin/,bP=new RegExp("^("+q+")(.*)$","i"),bQ=new RegExp("^("+q+")(?!px)[a-z%]+$","i"),bR=new RegExp("^([-+])=("+q+")","i"),bS={},bT={position:"absolute",visibility:"hidden",display:"block"},bU={letterSpacing:0,fontWeight:400},bV=["Top","Right","Bottom","Left"],bW=["Webkit","O","Moz","ms"],bX=p.fn.toggle;p.fn.extend({css:function(a,c){return p.access(this,function(a,c,d){return d!==b?p.style(a,c,d):p.css(a,c)},a,c,arguments.length>1)},show:function(){return b$(this,!0)},hide:function(){return b$(this)},toggle:function(a,b){var c=typeof a=="boolean";return p.isFunction(a)&&p.isFunction(b)?bX.apply(this,arguments):this.each(function(){(c?a:bZ(this))?p(this).show():p(this).hide()})}}),p.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bH(a,"opacity");return c===""?"1":c}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":p.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!a||a.nodeType===3||a.nodeType===8||!a.style){return}var f,g,h,i=p.camelCase(c),j=a.style;c=p.cssProps[i]||(p.cssProps[i]=bY(j,i)),h=p.cssHooks[c]||p.cssHooks[i];if(d===b){return h&&"get" in h&&(f=h.get(a,!1,e))!==b?f:j[c]}g=typeof d,g==="string"&&(f=bR.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(p.css(a,c)),g="number");if(d==null||g==="number"&&isNaN(d)){return}g==="number"&&!p.cssNumber[i]&&(d+="px");if(!h||!("set" in h)||(d=h.set(a,d,e))!==b){try{j[c]=d}catch(k){}}},css:function(a,c,d,e){var f,g,h,i=p.camelCase(c);return c=p.cssProps[i]||(p.cssProps[i]=bY(a.style,i)),h=p.cssHooks[c]||p.cssHooks[i],h&&"get" in h&&(f=h.get(a,!0,e)),f===b&&(f=bH(a,c)),f==="normal"&&c in bU&&(f=bU[c]),d||e!==b?(g=parseFloat(f),d||p.isNumeric(g)?g||0:f):f},swap:function(a,b,c){var d,e,f={};for(e in b){f[e]=a.style[e],a.style[e]=b[e]}d=c.call(a);for(e in b){a.style[e]=f[e]}return d}}),a.getComputedStyle?bH=function(b,c){var d,e,f,g,h=a.getComputedStyle(b,null),i=b.style;return h&&(d=h[c],d===""&&!p.contains(b.ownerDocument,b)&&(d=p.style(b,c)),bQ.test(d)&&bO.test(c)&&(e=i.width,f=i.minWidth,g=i.maxWidth,i.minWidth=i.maxWidth=i.width=d,d=h.width,i.width=e,i.minWidth=f,i.maxWidth=g)),d}:e.documentElement.currentStyle&&(bH=function(a,b){var c,d,e=a.currentStyle&&a.currentStyle[b],f=a.style;return e==null&&f&&f[b]&&(e=f[b]),bQ.test(e)&&!bM.test(b)&&(c=f.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),f.left=b==="fontSize"?"1em":e,e=f.pixelLeft+"px",f.left=c,d&&(a.runtimeStyle.left=d)),e===""?"auto":e}),p.each(["height","width"],function(a,b){p.cssHooks[b]={get:function(a,c,d){if(c){return a.offsetWidth===0&&bN.test(bH(a,"display"))?p.swap(a,bT,function(){return cb(a,b,d)}):cb(a,b,d)}},set:function(a,c,d){return b_(a,c,d?ca(a,b,d,p.support.boxSizing&&p.css(a,"boxSizing")==="border-box"):0)}}}),p.support.opacity||(p.cssHooks.opacity={get:function(a,b){return bL.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?0.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=p.isNumeric(b)?"alpha(opacity="+b*100+")":"",f=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&p.trim(f.replace(bK,""))===""&&c.removeAttribute){c.removeAttribute("filter");if(d&&!d.filter){return}}c.filter=bK.test(f)?f.replace(bK,e):f+" "+e}}),p(function(){p.support.reliableMarginRight||(p.cssHooks.marginRight={get:function(a,b){return p.swap(a,{display:"inline-block"},function(){if(b){return bH(a,"marginRight")}})}}),!p.support.pixelPosition&&p.fn.position&&p.each(["top","left"],function(a,b){p.cssHooks[b]={get:function(a,c){if(c){var d=bH(a,b);return bQ.test(d)?p(a).position()[b]+"px":d}}}})}),p.expr&&p.expr.filters&&(p.expr.filters.hidden=function(a){return a.offsetWidth===0&&a.offsetHeight===0||!p.support.reliableHiddenOffsets&&(a.style&&a.style.display||bH(a,"display"))==="none"},p.expr.filters.visible=function(a){return !p.expr.filters.hidden(a)}),p.each({margin:"",padding:"",border:"Width"},function(a,b){p.cssHooks[a+b]={expand:function(c){var d,e=typeof c=="string"?c.split(" "):[c],f={};for(d=0;d<4;d++){f[a+bV[d]+b]=e[d]||e[d-2]||e[0]}return f}},bO.test(a)||(p.cssHooks[a+b].set=b_)});var cd=/%20/g,ce=/\[\]$/,cf=/\r?\n/g,cg=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,ch=/^(?:select|textarea)/i;p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?p.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||ch.test(this.nodeName)||cg.test(this.type))}).map(function(a,b){var c=p(this).val();return c==null?null:p.isArray(c)?p.map(c,function(a,c){return{name:b.name,value:a.replace(cf,"\r\n")}}):{name:b.name,value:c.replace(cf,"\r\n")}}).get()}}),p.param=function(a,c){var d,e=[],f=function(a,b){b=p.isFunction(b)?b():b==null?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=p.ajaxSettings&&p.ajaxSettings.traditional);if(p.isArray(a)||a.jquery&&!p.isPlainObject(a)){p.each(a,function(){f(this.name,this.value)})}else{for(d in a){ci(d,a[d],c,f)}}return e.join("&").replace(cd,"+")};var cj,ck,cl=/#.*$/,cm=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,cn=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,co=/^(?:GET|HEAD)$/,cp=/^\/\//,cq=/\?/,cr=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,cs=/([?&])_=[^&]*/,ct=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,cu=p.fn.load,cv={},cw={},cx=["*/"]+["*"];try{cj=f.href}catch(cy){cj=e.createElement("a"),cj.href="",cj=cj.href}ck=ct.exec(cj.toLowerCase())||[],p.fn.load=function(a,c,d){if(typeof a!="string"&&cu){return cu.apply(this,arguments)}if(!this.length){return this}var e,f,g,h=this,i=a.indexOf(" ");return i>=0&&(e=a.slice(i,a.length),a=a.slice(0,i)),p.isFunction(c)?(d=c,c=b):c&&typeof c=="object"&&(f="POST"),p.ajax({url:a,type:f,dataType:"html",data:c,complete:function(a,b){d&&h.each(d,g||[a.responseText,b,a])}}).done(function(a){g=arguments,h.html(e?p("<div>").append(a.replace(cr,"")).find(e):a)}),this},p.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){p.fn[b]=function(a){return this.on(b,a)}}),p.each(["get","post"],function(a,c){p[c]=function(a,d,e,f){return p.isFunction(d)&&(f=f||e,e=d,d=b),p.ajax({type:c,url:a,data:d,success:e,dataType:f})}}),p.extend({getScript:function(a,c){return p.get(a,b,c,"script")},getJSON:function(a,b,c){return p.get(a,b,c,"json")},ajaxSetup:function(a,b){return b?cB(a,p.ajaxSettings):(b=a,a=p.ajaxSettings),cB(a,b),a},ajaxSettings:{url:cj,isLocal:cn.test(ck[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":cx},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":p.parseJSON,"text xml":p.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:cz(cv),ajaxTransport:cz(cw),ajax:function(a,c){function y(a,c,f,i){var k,s,t,u,w,y=c;if(v===2){return}v=2,h&&clearTimeout(h),g=b,e=i||"",x.readyState=a>0?4:0,f&&(u=cC(l,x,f));if(a>=200&&a<300||a===304){l.ifModified&&(w=x.getResponseHeader("Last-Modified"),w&&(p.lastModified[d]=w),w=x.getResponseHeader("Etag"),w&&(p.etag[d]=w)),a===304?(y="notmodified",k=!0):(k=cD(l,u),y=k.state,s=k.data,t=k.error,k=!t)}else{t=y;if(!y||a){y="error",a<0&&(a=0)}}x.status=a,x.statusText=""+(c||y),k?o.resolveWith(m,[s,y,x]):o.rejectWith(m,[x,y,t]),x.statusCode(r),r=b,j&&n.trigger("ajax"+(k?"Success":"Error"),[x,l,k?s:t]),q.fireWith(m,[x,y]),j&&(n.trigger("ajaxComplete",[x,l]),--p.active||p.event.trigger("ajaxStop"))}typeof a=="object"&&(c=a,a=b),c=c||{};var d,e,f,g,h,i,j,k,l=p.ajaxSetup({},c),m=l.context||l,n=m!==l&&(m.nodeType||m instanceof p)?p(m):p.event,o=p.Deferred(),q=p.Callbacks("once memory"),r=l.statusCode||{},t={},u={},v=0,w="canceled",x={readyState:0,setRequestHeader:function(a,b){if(!v){var c=a.toLowerCase();a=u[c]=u[c]||a,t[a]=b}return this},getAllResponseHeaders:function(){return v===2?e:null},getResponseHeader:function(a){var c;if(v===2){if(!f){f={};while(c=cm.exec(e)){f[c[1].toLowerCase()]=c[2]}}c=f[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){return v||(l.mimeType=a),this},abort:function(a){return a=a||w,g&&g.abort(a),y(0,a),this}};o.promise(x),x.success=x.done,x.error=x.fail,x.complete=q.add,x.statusCode=function(a){if(a){var b;if(v<2){for(b in a){r[b]=[r[b],a[b]]}}else{b=a[x.status],x.always(b)}}return this},l.url=((a||l.url)+"").replace(cl,"").replace(cp,ck[1]+"//"),l.dataTypes=p.trim(l.dataType||"*").toLowerCase().split(s),l.crossDomain==null&&(i=ct.exec(l.url.toLowerCase()),l.crossDomain=!(!i||i[1]==ck[1]&&i[2]==ck[2]&&(i[3]||(i[1]==="http:"?80:443))==(ck[3]||(ck[1]==="http:"?80:443)))),l.data&&l.processData&&typeof l.data!="string"&&(l.data=p.param(l.data,l.traditional)),cA(cv,l,c,x);if(v===2){return x}j=l.global,l.type=l.type.toUpperCase(),l.hasContent=!co.test(l.type),j&&p.active++===0&&p.event.trigger("ajaxStart");if(!l.hasContent){l.data&&(l.url+=(cq.test(l.url)?"&":"?")+l.data,delete l.data),d=l.url;if(l.cache===!1){var z=p.now(),A=l.url.replace(cs,"$1_="+z);l.url=A+(A===l.url?(cq.test(l.url)?"&":"?")+"_="+z:"")}}(l.data&&l.hasContent&&l.contentType!==!1||c.contentType)&&x.setRequestHeader("Content-Type",l.contentType),l.ifModified&&(d=d||l.url,p.lastModified[d]&&x.setRequestHeader("If-Modified-Since",p.lastModified[d]),p.etag[d]&&x.setRequestHeader("If-None-Match",p.etag[d])),x.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+cx+"; q=0.01":""):l.accepts["*"]);for(k in l.headers){x.setRequestHeader(k,l.headers[k])}if(!l.beforeSend||l.beforeSend.call(m,x,l)!==!1&&v!==2){w="abort";for(k in {success:1,error:1,complete:1}){x[k](l[k])}g=cA(cw,l,c,x);if(!g){y(-1,"No Transport")}else{x.readyState=1,j&&n.trigger("ajaxSend",[x,l]),l.async&&l.timeout>0&&(h=setTimeout(function(){x.abort("timeout")},l.timeout));try{v=1,g.send(t,y)}catch(B){if(v<2){y(-1,B)}else{throw B}}}return x}return x.abort()},active:0,lastModified:{},etag:{}});var cE=[],cF=/\?/,cG=/(=)\?(?=&|$)|\?\?/,cH=p.now();p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=cE.pop()||p.expando+"_"+cH++;return this[a]=!0,a}}),p.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,i=c.data,j=c.url,k=c.jsonp!==!1,l=k&&cG.test(j),m=k&&!l&&typeof i=="string"&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&cG.test(i);if(c.dataTypes[0]==="jsonp"||l||m){return f=c.jsonpCallback=p.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,g=a[f],l?c.url=j.replace(cG,"$1"+f):m?c.data=i.replace(cG,"$1"+f):k&&(c.url+=(cF.test(j)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||p.error(f+" was not called"),h[0]},c.dataTypes[0]="json",a[f]=function(){h=arguments},e.always(function(){a[f]=g,c[f]&&(c.jsonpCallback=d.jsonpCallback,cE.push(f)),h&&p.isFunction(g)&&g(h[0]),h=g=b}),"script"}}),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){return p.globalEval(a),a}}}),p.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),p.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=e.head||e.getElementsByTagName("head")[0]||e.documentElement;return{send:function(f,g){c=e.createElement("script"),c.async="async",a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,e){if(e||!c.readyState||/loaded|complete/.test(c.readyState)){c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=b,e||g(200,"success")}},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var cI,cJ=a.ActiveXObject?function(){for(var a in cI){cI[a](0,1)}}:!1,cK=0;p.ajaxSettings.xhr=a.ActiveXObject?function(){return !this.isLocal&&cL()||cM()}:cL,function(a){p.extend(p.support,{ajax:!!a,cors:!!a&&"withCredentials" in a})}(p.ajaxSettings.xhr()),p.support.ajax&&p.ajaxTransport(function(c){if(!c.crossDomain||p.support.cors){var d;return{send:function(e,f){var g,h,i=c.xhr();c.username?i.open(c.type,c.url,c.async,c.username,c.password):i.open(c.type,c.url,c.async);if(c.xhrFields){for(h in c.xhrFields){i[h]=c.xhrFields[h]}}c.mimeType&&i.overrideMimeType&&i.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(h in e){i.setRequestHeader(h,e[h])}}catch(j){}i.send(c.hasContent&&c.data||null),d=function(a,e){var h,j,k,l,m;try{if(d&&(e||i.readyState===4)){d=b,g&&(i.onreadystatechange=p.noop,cJ&&delete cI[g]);if(e){i.readyState!==4&&i.abort()}else{h=i.status,k=i.getAllResponseHeaders(),l={},m=i.responseXML,m&&m.documentElement&&(l.xml=m);try{l.text=i.responseText}catch(a){}try{j=i.statusText}catch(n){j=""}!h&&c.isLocal&&!c.crossDomain?h=l.text?200:404:h===1223&&(h=204)}}}catch(o){e||f(-1,o)}l&&f(h,j,l,k)},c.async?i.readyState===4?setTimeout(d,0):(g=++cK,cJ&&(cI||(cI={},p(a).unload(cJ)),cI[g]=d),i.onreadystatechange=d):d()},abort:function(){d&&d(0,1)}}}});var cN,cO,cP=/^(?:toggle|show|hide)$/,cQ=new RegExp("^(?:([-+])=|)("+q+")([a-z%]*)$","i"),cR=/queueHooks$/,cS=[cY],cT={"*":[function(a,b){var c,d,e,f=this.createTween(a,b),g=cQ.exec(b),h=f.cur(),i=+h||0,j=1;if(g){c=+g[2],d=g[3]||(p.cssNumber[a]?"":"px");if(d!=="px"&&i){i=p.css(f.elem,a,!0)||c||1;do{e=j=j||".5",i=i/j,p.style(f.elem,a,i+d),j=f.cur()/h}while(j!==1&&j!==e)}f.unit=d,f.start=i,f.end=g[1]?i+(g[1]+1)*c:c}return f}]};p.Animation=p.extend(cW,{tweener:function(a,b){p.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");var c,d=0,e=a.length;for(;d<e;d++){c=a[d],cT[c]=cT[c]||[],cT[c].unshift(b)}},prefilter:function(a,b){b?cS.unshift(a):cS.push(a)}}),p.Tween=cZ,cZ.prototype={constructor:cZ,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(p.cssNumber[c]?"":"px")},cur:function(){var a=cZ.propHooks[this.prop];return a&&a.get?a.get(this):cZ.propHooks._default.get(this)},run:function(a){var b,c=cZ.propHooks[this.prop];return this.options.duration?this.pos=b=p.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):cZ.propHooks._default.set(this),this}},cZ.prototype.init.prototype=cZ.prototype,cZ.propHooks={_default:{get:function(a){var b;return a.elem[a.prop]==null||!!a.elem.style&&a.elem.style[a.prop]!=null?(b=p.css(a.elem,a.prop,!1,""),!b||b==="auto"?0:b):a.elem[a.prop]},set:function(a){p.fx.step[a.prop]?p.fx.step[a.prop](a):a.elem.style&&(a.elem.style[p.cssProps[a.prop]]!=null||p.cssHooks[a.prop])?p.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},cZ.propHooks.scrollTop=cZ.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},p.each(["toggle","show","hide"],function(a,b){var c=p.fn[b];p.fn[b]=function(d,e,f){return d==null||typeof d=="boolean"||!a&&p.isFunction(d)&&p.isFunction(e)?c.apply(this,arguments):this.animate(c$(b,!0),d,e,f)}}),p.fn.extend({fadeTo:function(a,b,c,d){return this.filter(bZ).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=p.isEmptyObject(a),f=p.speed(b,c,d),g=function(){var b=cW(this,p.extend({},a),f);e&&b.stop(!0)};return e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop,b(d)};return typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=a!=null&&a+"queueHooks",f=p.timers,g=p._data(this);if(c){g[c]&&g[c].stop&&e(g[c])}else{for(c in g){g[c]&&g[c].stop&&cR.test(c)&&e(g[c])}}for(c=f.length;c--;){f[c].elem===this&&(a==null||f[c].queue===a)&&(f[c].anim.stop(d),b=!1,f.splice(c,1))}(b||!d)&&p.dequeue(this,a)})}}),p.each({slideDown:c$("show"),slideUp:c$("hide"),slideToggle:c$("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){p.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),p.speed=function(a,b,c){var d=a&&typeof a=="object"?p.extend({},a):{complete:c||!c&&b||p.isFunction(a)&&a,duration:a,easing:c&&b||b&&!p.isFunction(b)&&b};d.duration=p.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in p.fx.speeds?p.fx.speeds[d.duration]:p.fx.speeds._default;if(d.queue==null||d.queue===!0){d.queue="fx"}return d.old=d.complete,d.complete=function(){p.isFunction(d.old)&&d.old.call(this),d.queue&&p.dequeue(this,d.queue)},d},p.easing={linear:function(a){return a},swing:function(a){return 0.5-Math.cos(a*Math.PI)/2}},p.timers=[],p.fx=cZ.prototype.init,p.fx.tick=function(){var a,b=p.timers,c=0;for(;c<b.length;c++){a=b[c],!a()&&b[c]===a&&b.splice(c--,1)}b.length||p.fx.stop()},p.fx.timer=function(a){a()&&p.timers.push(a)&&!cO&&(cO=setInterval(p.fx.tick,p.fx.interval))},p.fx.interval=13,p.fx.stop=function(){clearInterval(cO),cO=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fx.step={},p.expr&&p.expr.filters&&(p.expr.filters.animated=function(a){return p.grep(p.timers,function(b){return a===b.elem}).length});var c_=/^(?:body|html)$/i;p.fn.offset=function(a){if(arguments.length){return a===b?this:this.each(function(b){p.offset.setOffset(this,a,b)})}var c,d,e,f,g,h,i,j,k,l,m=this[0],n=m&&m.ownerDocument;if(!n){return}return(e=n.body)===m?p.offset.bodyOffset(m):(d=n.documentElement,p.contains(d,m)?(c=m.getBoundingClientRect(),f=da(n),g=d.clientTop||e.clientTop||0,h=d.clientLeft||e.clientLeft||0,i=f.pageYOffset||d.scrollTop,j=f.pageXOffset||d.scrollLeft,k=c.top+i-g,l=c.left+j-h,{top:k,left:l}):{top:0,left:0})},p.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;return p.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(p.css(a,"marginTop"))||0,c+=parseFloat(p.css(a,"marginLeft"))||0),{top:b,left:c}},setOffset:function(a,b,c){var d=p.css(a,"position");d==="static"&&(a.style.position="relative");var e=p(a),f=e.offset(),g=p.css(a,"top"),h=p.css(a,"left"),i=(d==="absolute"||d==="fixed")&&p.inArray("auto",[g,h])>-1,j={},k={},l,m;i?(k=e.position(),l=k.top,m=k.left):(l=parseFloat(g)||0,m=parseFloat(h)||0),p.isFunction(b)&&(b=b.call(a,c,f)),b.top!=null&&(j.top=b.top-f.top+l),b.left!=null&&(j.left=b.left-f.left+m),"using" in b?b.using.call(a,j):e.css(j)}},p.fn.extend({position:function(){if(!this[0]){return}var a=this[0],b=this.offsetParent(),c=this.offset(),d=c_.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=parseFloat(p.css(a,"marginTop"))||0,c.left-=parseFloat(p.css(a,"marginLeft"))||0,d.top+=parseFloat(p.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(p.css(b[0],"borderLeftWidth"))||0,{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||e.body;while(a&&!c_.test(a.nodeName)&&p.css(a,"position")==="static"){a=a.offsetParent}return a||e.body})}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);p.fn[a]=function(e){return p.access(this,function(a,e,f){var g=da(a);if(f===b){return g?c in g?g[c]:g.document.documentElement[e]:a[e]}g?g.scrollTo(d?p(g).scrollLeft():f,d?f:p(g).scrollTop()):a[e]=f},a,e,arguments.length,null)}}),p.each({Height:"height",Width:"width"},function(a,c){p.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){p.fn[e]=function(e,f){var g=arguments.length&&(d||typeof e!="boolean"),h=d||(e===!0||f===!0?"margin":"border");return p.access(this,function(c,d,e){var f;return p.isWindow(c)?c.document.documentElement["client"+a]:c.nodeType===9?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?p.css(c,d,e,h):p.style(c,d,e,h)},c,g?e:b,g,null)}})}),a.jQuery=a.$=p,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return p})})(window);jQuery.noConflict();
/*	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
var swfobject=function(){var E="undefined",s="object",U="Shockwave Flash",Y="ShockwaveFlash.ShockwaveFlash",r="application/x-shockwave-flash",S="SWFObjectExprInst",y="onreadystatechange",P=window,k=document,u=navigator,V=false,W=[h],p=[],O=[],J=[],m,R,F,C,K=false,a=false,o,H,n=true,N=function(){var ac=typeof k.getElementById!=E&&typeof k.getElementsByTagName!=E&&typeof k.createElement!=E,aj=u.userAgent.toLowerCase(),aa=u.platform.toLowerCase(),ag=aa?/win/.test(aa):/win/.test(aj),ae=aa?/mac/.test(aa):/mac/.test(aj),ah=/webkit/.test(aj)?parseFloat(aj.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,Z=!+"\v1",ai=[0,0,0],ad=null;if(typeof u.plugins!=E&&typeof u.plugins[U]==s){ad=u.plugins[U].description;if(ad&&!(typeof u.mimeTypes!=E&&u.mimeTypes[r]&&!u.mimeTypes[r].enabledPlugin)){V=true;Z=false;ad=ad.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ai[0]=parseInt(ad.replace(/^(.*)\..*$/,"$1"),10);ai[1]=parseInt(ad.replace(/^.*\.(.*)\s.*$/,"$1"),10);ai[2]=/[a-zA-Z]/.test(ad)?parseInt(ad.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof P.ActiveXObject!=E){try{var af=new ActiveXObject(Y);if(af){ad=af.GetVariable("$version");if(ad){Z=true;ad=ad.split(" ")[1].split(",");ai=[parseInt(ad[0],10),parseInt(ad[1],10),parseInt(ad[2],10)]}}}catch(ab){}}}return{w3:ac,pv:ai,wk:ah,ie:Z,win:ag,mac:ae}}(),l=function(){if(!N.w3){return}if((typeof k.readyState!=E&&k.readyState=="complete")||(typeof k.readyState==E&&(k.getElementsByTagName("body")[0]||k.body))){f()}if(!K){if(typeof k.addEventListener!=E){k.addEventListener("DOMContentLoaded",f,false)}if(N.ie&&N.win){k.attachEvent(y,function(){if(k.readyState=="complete"){k.detachEvent(y,arguments.callee);f()}});if(P==top){(function(){if(K){return}try{k.documentElement.doScroll("left")}catch(Z){setTimeout(arguments.callee,0);return}f()})()}}if(N.wk){(function(){if(K){return}if(!/loaded|complete/.test(k.readyState)){setTimeout(arguments.callee,0);return}f()})()}t(f)}}();function f(){if(K){return}try{var ab=k.getElementsByTagName("body")[0].appendChild(D("span"));ab.parentNode.removeChild(ab)}catch(ac){return}K=true;var Z=W.length;for(var aa=0;aa<Z;aa++){W[aa]()}}function L(Z){if(K){Z()}else{W[W.length]=Z}}function t(aa){if(typeof P.addEventListener!=E){P.addEventListener("load",aa,false)}else{if(typeof k.addEventListener!=E){k.addEventListener("load",aa,false)}else{if(typeof P.attachEvent!=E){j(P,"onload",aa)}else{if(typeof P.onload=="function"){var Z=P.onload;P.onload=function(){Z();aa()}}else{P.onload=aa}}}}}function h(){if(V){X()}else{I()}}function X(){var Z=k.getElementsByTagName("body")[0];var ac=D(s);ac.setAttribute("type",r);var ab=Z.appendChild(ac);if(ab){var aa=0;(function(){if(typeof ab.GetVariable!=E){var ad=ab.GetVariable("$version");if(ad){ad=ad.split(" ")[1].split(",");N.pv=[parseInt(ad[0],10),parseInt(ad[1],10),parseInt(ad[2],10)]}}else{if(aa<10){aa++;setTimeout(arguments.callee,10);return}}Z.removeChild(ac);ab=null;I()})()}else{I()}}function I(){var ai=p.length;if(ai>0){for(var ah=0;ah<ai;ah++){var aa=p[ah].id;var ad=p[ah].callbackFn;var ac={success:false,id:aa};if(N.pv[0]>0){var ag=c(aa);if(ag){if(G(p[ah].swfVersion)&&!(N.wk&&N.wk<312)){x(aa,true);if(ad){ac.success=true;ac.ref=A(aa);ad(ac)}}else{if(p[ah].expressInstall&&B()){var ak={};ak.data=p[ah].expressInstall;ak.width=ag.getAttribute("width")||"0";ak.height=ag.getAttribute("height")||"0";if(ag.getAttribute("class")){ak.styleclass=ag.getAttribute("class")}if(ag.getAttribute("align")){ak.align=ag.getAttribute("align")}var aj={};var Z=ag.getElementsByTagName("param");var ae=Z.length;for(var af=0;af<ae;af++){if(Z[af].getAttribute("name").toLowerCase()!="movie"){aj[Z[af].getAttribute("name")]=Z[af].getAttribute("value")}}Q(ak,aj,aa,ad)}else{q(ag);if(ad){ad(ac)}}}}}else{x(aa,true);if(ad){var ab=A(aa);if(ab&&typeof ab.SetVariable!=E){ac.success=true;ac.ref=ab}ad(ac)}}}}}function A(ac){var Z=null;var aa=c(ac);if(aa&&aa.nodeName=="OBJECT"){if(typeof aa.SetVariable!=E){Z=aa}else{var ab=aa.getElementsByTagName(s)[0];if(ab){Z=ab}}}return Z}function B(){return !a&&G("6.0.65")&&(N.win||N.mac)&&!(N.wk&&N.wk<312)}function Q(ac,ad,Z,ab){a=true;F=ab||null;C={success:false,id:Z};var ag=c(Z);if(ag){if(ag.nodeName=="OBJECT"){m=g(ag);R=null}else{m=ag;R=Z}ac.id=S;if(typeof ac.width==E||(!/%$/.test(ac.width)&&parseInt(ac.width,10)<310)){ac.width="310"}if(typeof ac.height==E||(!/%$/.test(ac.height)&&parseInt(ac.height,10)<137)){ac.height="137"}k.title=k.title.slice(0,47)+" - Flash Player Installation";var af=N.ie&&N.win?"ActiveX":"PlugIn",ae="MMredirectURL="+P.location.toString().replace(/&/g,"%26")+"&MMplayerType="+af+"&MMdoctitle="+k.title;if(typeof ad.flashvars!=E){ad.flashvars+="&"+ae}else{ad.flashvars=ae}if(N.ie&&N.win&&ag.readyState!=4){var aa=D("div");Z+="SWFObjectNew";aa.setAttribute("id",Z);ag.parentNode.insertBefore(aa,ag);ag.style.display="none";(function(){if(ag.readyState==4){ag.parentNode.removeChild(ag)}else{setTimeout(arguments.callee,10)}})()}v(ac,ad,Z)}}function q(aa){if(N.ie&&N.win&&aa.readyState!=4){var Z=D("div");aa.parentNode.insertBefore(Z,aa);Z.parentNode.replaceChild(g(aa),Z);aa.style.display="none";(function(){if(aa.readyState==4){aa.parentNode.removeChild(aa)}else{setTimeout(arguments.callee,10)}})()}else{aa.parentNode.replaceChild(g(aa),aa)}}function g(ae){var ad=D("div");if(N.win&&N.ie){ad.innerHTML=ae.innerHTML}else{var aa=ae.getElementsByTagName(s)[0];if(aa){var af=aa.childNodes;if(af){var Z=af.length;for(var ab=0;ab<Z;ab++){if(!(af[ab].nodeType==1&&af[ab].nodeName=="PARAM")&&!(af[ab].nodeType==8)){ad.appendChild(af[ab].cloneNode(true))}}}}}return ad}function v(ak,ai,aa){var Z,ac=c(aa);if(N.wk&&N.wk<312){return Z}if(ac){if(typeof ak.id==E){ak.id=aa}if(N.ie&&N.win){var aj="";for(var ag in ak){if(ak[ag]!=Object.prototype[ag]){if(ag.toLowerCase()=="data"){ai.movie=ak[ag]}else{if(ag.toLowerCase()=="styleclass"){aj+=' class="'+ak[ag]+'"'}else{if(ag.toLowerCase()!="classid"){aj+=" "+ag+'="'+ak[ag]+'"'}}}}}var ah="";for(var af in ai){if(ai[af]!=Object.prototype[af]){ah+='<param name="'+af+'" value="'+ai[af]+'" />'}}ac.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+aj+">"+ah+"</object>";O[O.length]=ak.id;Z=c(ak.id)}else{var ab=D(s);ab.setAttribute("type",r);for(var ae in ak){if(ak[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="styleclass"){ab.setAttribute("class",ak[ae])}else{if(ae.toLowerCase()!="classid"){ab.setAttribute(ae,ak[ae])}}}}for(var ad in ai){if(ai[ad]!=Object.prototype[ad]&&ad.toLowerCase()!="movie"){e(ab,ad,ai[ad])}}ac.parentNode.replaceChild(ab,ac);Z=ab}}return Z}function e(ab,Z,aa){var ac=D("param");ac.setAttribute("name",Z);ac.setAttribute("value",aa);ab.appendChild(ac)}function z(aa){var Z=c(aa);if(Z&&Z.nodeName=="OBJECT"){if(N.ie&&N.win){Z.style.display="none";(function(){if(Z.readyState==4){b(aa)}else{setTimeout(arguments.callee,10)}})()}else{Z.parentNode.removeChild(Z)}}}function b(ab){var aa=c(ab);if(aa){for(var Z in aa){if(typeof aa[Z]=="function"){aa[Z]=null}}aa.parentNode.removeChild(aa)}}function c(ab){var Z=null;try{Z=k.getElementById(ab)}catch(aa){}return Z}function D(Z){return k.createElement(Z)}function j(ab,Z,aa){ab.attachEvent(Z,aa);J[J.length]=[ab,Z,aa]}function G(ab){var aa=N.pv,Z=ab.split(".");Z[0]=parseInt(Z[0],10);Z[1]=parseInt(Z[1],10)||0;Z[2]=parseInt(Z[2],10)||0;return(aa[0]>Z[0]||(aa[0]==Z[0]&&aa[1]>Z[1])||(aa[0]==Z[0]&&aa[1]==Z[1]&&aa[2]>=Z[2]))?true:false}function w(ae,aa,af,ad){if(N.ie&&N.mac){return}var ac=k.getElementsByTagName("head")[0];if(!ac){return}var Z=(af&&typeof af=="string")?af:"screen";if(ad){o=null;H=null}if(!o||H!=Z){var ab=D("style");ab.setAttribute("type","text/css");ab.setAttribute("media",Z);o=ac.appendChild(ab);if(N.ie&&N.win&&typeof k.styleSheets!=E&&k.styleSheets.length>0){o=k.styleSheets[k.styleSheets.length-1]}H=Z}if(N.ie&&N.win){if(o&&typeof o.addRule==s){o.addRule(ae,aa)}}else{if(o&&typeof k.createTextNode!=E){o.appendChild(k.createTextNode(ae+" {"+aa+"}"))}}}function x(ab,Z){if(!n){return}var aa=Z?"visible":"hidden";if(K&&c(ab)){c(ab).style.visibility=aa}else{w("#"+ab,"visibility:"+aa)}}function M(aa){var ab=/[\\\"<>\.;]/;var Z=ab.exec(aa)!=null;return Z&&typeof encodeURIComponent!=E?encodeURIComponent(aa):aa}var d=function(){if(N.ie&&N.win){window.attachEvent("onunload",function(){var ae=J.length;for(var ad=0;ad<ae;ad++){J[ad][0].detachEvent(J[ad][1],J[ad][2])}var ab=O.length;for(var ac=0;ac<ab;ac++){z(O[ac])}for(var aa in N){N[aa]=null}N=null;for(var Z in swfobject){swfobject[Z]=null}swfobject=null})}}();return{registerObject:function(ad,Z,ac,ab){if(N.w3&&ad&&Z){var aa={};aa.id=ad;aa.swfVersion=Z;aa.expressInstall=ac;aa.callbackFn=ab;p[p.length]=aa;x(ad,false)}else{if(ab){ab({success:false,id:ad})}}},getObjectById:function(Z){if(N.w3){return A(Z)}},embedSWF:function(ad,aj,ag,ai,aa,ac,ab,af,ah,ae){var Z={success:false,id:aj};if(N.w3&&!(N.wk&&N.wk<312)&&ad&&aj&&ag&&ai&&aa){x(aj,false);L(function(){ag+="";ai+="";var al={};if(ah&&typeof ah===s){for(var an in ah){al[an]=ah[an]}}al.data=ad;al.width=ag;al.height=ai;var ao={};if(af&&typeof af===s){for(var am in af){ao[am]=af[am]}}if(ab&&typeof ab===s){for(var ak in ab){if(typeof ao.flashvars!=E){ao.flashvars+="&"+ak+"="+ab[ak]}else{ao.flashvars=ak+"="+ab[ak]}}}if(G(aa)){var ap=v(al,ao,aj);if(al.id==aj){x(aj,true)}Z.success=true;Z.ref=ap}else{if(ac&&B()){al.data=ac;Q(al,ao,aj,ae);return}else{x(aj,true)}}if(ae){ae(Z)}})}else{if(ae){ae(Z)}}},switchOffAutoHideShow:function(){n=false},ua:N,getFlashPlayerVersion:function(){return{major:N.pv[0],minor:N.pv[1],release:N.pv[2]}},hasFlashPlayerVersion:G,createSWF:function(ab,aa,Z){if(N.w3){return v(ab,aa,Z)}else{return undefined}},showExpressInstall:function(ab,ac,Z,aa){if(N.w3&&B()){Q(ab,ac,Z,aa)}},removeSWF:function(Z){if(N.w3){z(Z)}},createCSS:function(ac,ab,aa,Z){if(N.w3){w(ac,ab,aa,Z)}},addDomLoadEvent:L,addLoadEvent:t,getQueryParamValue:function(ac){var ab=k.location.search||k.location.hash;if(ab){if(/\?/.test(ab)){ab=ab.split("?")[1]}if(ac==null){return M(ab)}var aa=ab.split("&");for(var Z=0;Z<aa.length;Z++){if(aa[Z].substring(0,aa[Z].indexOf("="))==ac){return M(aa[Z].substring((aa[Z].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var Z=c(S);if(Z&&m){Z.parentNode.replaceChild(m,Z);if(R){x(R,true);if(N.ie&&N.win){m.style.display="block"}}if(F){F(C)}}a=false}}}}();var FlashDetect=new function(){var a=this;a.installed=false;a.raw="";a.major=-1;a.minor=-1;a.revision=-1;a.revisionStr="";var b=[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(h){return d(h)}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(k){var h="6,0,21";try{k.AllowScriptAccess="always";h=d(k)}catch(j){}return h}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(h){return d(h)}}];var d=function(k){var h=-1;try{h=k.GetVariable("$version")}catch(j){}return h};var g=function(h){var k=-1;try{k=new ActiveXObject(h)}catch(j){k={activeXError:true}}return k};var c=function(j){var h=j.split(",");return{raw:j,major:parseInt(h[0].split(" ")[1],10),minor:parseInt(h[1],10),revision:parseInt(h[2],10),revisionStr:h[2]}};var f=function(l){var j=l.split(/ +/);var k=j[2].split(/\./);var h=j[3];return{raw:l,major:parseInt(k[0],10),minor:parseInt(k[1],10),revisionStr:h,revision:e(h)}};var e=function(h){return parseInt(h.replace(/[a-zA-Z]/g,""),10)||a.revision};a.majorAtLeast=function(h){return a.major>=h};a.minorAtLeast=function(h){return a.minor>=h};a.revisionAtLeast=function(h){return a.revision>=h};a.versionAtLeast=function(j){var k=[a.major,a.minor,a.revision];var h=Math.min(k.length,arguments.length);for(i=0;i<h;i++){if(k[i]>=arguments[i]){if(i+1<h&&k[i]==arguments[i]){continue}else{return true}}else{return false}}};a.FlashDetect=function(){if(navigator.plugins&&navigator.plugins.length>0){var l="application/x-shockwave-flash";var k=navigator.mimeTypes;if(k&&k[l]&&k[l].enabledPlugin&&k[l].enabledPlugin.description){var h=k[l].enabledPlugin.description;var m=f(h);a.raw=m.raw;a.major=m.major;a.minor=m.minor;a.revisionStr=m.revisionStr;a.revision=m.revision;a.installed=true}}else{if(navigator.appVersion.indexOf("Mac")==-1&&window.execScript){var h=-1;for(var j=0;j<b.length&&h==-1;j++){var n=g(b[j].name);if(!n.activeXError){a.installed=true;h=b[j].version(n);if(h!=-1){var m=c(h);a.raw=m.raw;a.major=m.major;a.minor=m.minor;a.revision=m.revision;a.revisionStr=m.revisionStr}}}}}}()};FlashDetect.JS_RELEASE="1.0.4";(function(c){var g,f={},o={16:false,18:false,17:false,91:false},d="all",a={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},p={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220};for(g=1;g<20;g++){p["f"+g]=111+g}function m(s,r){var k=s.length;while(k--){if(s[k]===r){return k}}return -1}function n(w){var u,t,x,v,r,s,y;x=w.target||w.srcElement;t=x.tagName;u=w.keyCode;if(u==93||u==224){u=91}if(u in o){o[u]=true;for(r in a){if(a[r]==u){b[r]=true}}return}if(t=="INPUT"||t=="SELECT"||t=="TEXTAREA"){if(["submit","button"].indexOf(x.type)==-1){if(u!=p.escape&&u!=p.tab){return}}}if(!(u in f)){return}for(s=0;s<f[u].length;s++){v=f[u][s];if(v.scope==d||v.scope=="all"){y=v.mods.length>0;for(r in o){if((!o[r]&&m(v.mods,+r)>-1)||(o[r]&&m(v.mods,+r)==-1)){y=false}}if((v.mods.length==0&&!o[16]&&!o[18]&&!o[17]&&!o[91])||y){if(v.method(w,v)===false){if(w.preventDefault){w.preventDefault()}else{w.returnValue=false}if(w.stopPropagation){w.stopPropagation()}if(w.cancelBubble){w.cancelBubble=true}}}}}}function e(t){var s=t.keyCode,r;if(s==93||s==224){s=91}if(s in o){o[s]=false;for(r in a){if(a[r]==s){b[r]=false}}}}function q(){for(g in o){if(o.hasOwnProperty(g)){o[g]=false}}}function b(s,t,w){var v,u,r,k;if(w===undefined){w=t;t="all"}s=s.replace(/\s/g,"");v=s.split(",");if((v[v.length-1])==""){v[v.length-2]+=","}for(r=0;r<v.length;r++){u=[];s=v[r].split("+");if(s.length>1){u=s.slice(0,s.length-1);for(k=0;k<u.length;k++){u[k]=a[u[k]]}s=[s[s.length-1]]}s=s[0];s=p[s]||s.toUpperCase().charCodeAt(0);if(!(s in f)){f[s]=[]}f[s].push({shortcut:v[r],scope:t,method:w,key:v[r],mods:u})}}for(g in a){b[g]=false}function j(k){d=k||"all"}function l(){return d}function h(k,r,s){if(k.addEventListener){k.addEventListener(r,s,false)}else{if(k.attachEvent){k.attachEvent("on"+r,function(){s(window.event)})}}}h(document,"keydown",n);h(document,"keyup",e);h(window,"focus",q);h(document,"contextmenu",q);c.key=b;c.key.setScope=j;c.key.getScope=l;if(typeof module!=="undefined"){module.exports=key}})(this);window.Modernizr=function(ax,aw,av){function V(b){an.cssText=b}function U(d,c){return V(aj.join(d+";")+(c||""))}function S(d,c){return typeof d===c}function R(d,c){return !!~(""+d).indexOf(c)}function Q(e,c){for(var f in e){if(an[e[f]]!==av){return c=="pfx"?e[f]:!0}}return !1}function P(g,c,k){for(var j in g){var h=c[g[j]];if(h!==av){return k===!1?g[j]:S(h,"function")?h.bind(k||c):h}}return !1}function O(g,f,k){var j=g.charAt(0).toUpperCase()+g.substr(1),h=(g+" "+ah.join(j+" ")+j).split(" ");return S(f,"string")||S(f,"undefined")?Q(h,f):(h=(g+" "+ag.join(j+" ")+j).split(" "),P(h,f,k))}function M(){at.input=function(f){for(var b=0,a=f.length;b<a;b++){ad[f[b]]=f[b] in am}return ad.list&&(ad.list=!!aw.createElement("datalist")&&!!ax.HTMLDataListElement),ad}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),at.inputtypes=function(b){for(var l=0,k,j,g,c=b.length;l<c;l++){am.setAttribute("type",j=b[l]),k=am.type!=="text",k&&(am.value=al,am.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(j)&&am.style.WebkitAppearance!==av?(aq.appendChild(am),g=aw.defaultView,k=g.getComputedStyle&&g.getComputedStyle(am,null).WebkitAppearance!=="textfield"&&am.offsetHeight!==0,aq.removeChild(am)):/^(search|tel)$/.test(j)||(/^(url|email)$/.test(j)?k=am.checkValidity&&am.checkValidity()===!1:/^color$/.test(j)?(aq.appendChild(am),aq.offsetWidth,k=am.value!=al,aq.removeChild(am)):k=am.value!=al)),ae[b[l]]=!!k}return ae}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var au="2.5.3",at={},ar=!0,aq=aw.documentElement,ap="modernizr",ao=aw.createElement(ap),an=ao.style,am=aw.createElement("input"),al=":)",ak={}.toString,aj=" -webkit- -moz- -o- -ms- ".split(" "),ai="Webkit Moz O ms",ah=ai.split(" "),ag=ai.toLowerCase().split(" "),af={},ae={},ad={},ac=[],ab=ac.slice,aa,Z=function(t,s,r,q){var p,o,n,h=aw.createElement("div"),g=aw.body,b=g?g:aw.createElement("body");if(parseInt(r,10)){while(r--){n=aw.createElement("div"),n.id=q?q[r]:ap+(r+1),h.appendChild(n)}}return p=["&#173;","<style>",t,"</style>"].join(""),h.id=ap,(g?h:b).innerHTML+=p,b.appendChild(h),g||(b.style.background="",aq.appendChild(b)),o=s(h,t),g?h.parentNode.removeChild(h):b.parentNode.removeChild(b),!!o},Y=function(){function c(h,g){g=g||aw.createElement(b[h]||"div"),h="on"+h;var a=h in g;return a||(g.setAttribute||(g=aw.createElement("div")),g.setAttribute&&g.removeAttribute&&(g.setAttribute(h,""),a=S(g[h],"function"),S(g[h],"undefined")||(g[h]=av),g.removeAttribute(h))),g=null,a}var b={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return c}(),X={}.hasOwnProperty,W;!S(X,"undefined")&&!S(X.call,"undefined")?W=function(d,c){return X.call(d,c)}:W=function(d,c){return c in d&&S(d.constructor.prototype[c],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(a){var h=this;if(typeof h!="function"){throw new TypeError}var g=ab.call(arguments,1),f=function(){if(this instanceof f){var b=function(){};b.prototype=h.prototype;var d=new b,c=h.apply(d,g.concat(ab.call(arguments)));return Object(c)===c?c:d}return h.apply(a,g.concat(ab.call(arguments)))};return f});var N=function(h,e){var b=h.join(""),a=e.length;Z(b,function(o,n){var m=aw.styleSheets[aw.styleSheets.length-1],l=m?m.cssRules&&m.cssRules[0]?m.cssRules[0].cssText:m.cssText||"":"",k=o.childNodes,g={};while(a--){g[k[a].id]=k[a]}at.touch="ontouchstart" in ax||ax.DocumentTouch&&aw instanceof DocumentTouch||(g.touch&&g.touch.offsetTop)===9,at.csstransforms3d=(g.csstransforms3d&&g.csstransforms3d.offsetLeft)===9&&g.csstransforms3d.offsetHeight===3,at.generatedcontent=(g.generatedcontent&&g.generatedcontent.offsetHeight)>=1,at.fontface=/src/i.test(l)&&l.indexOf(n.split(" ")[0])===0},a,e)}(['@font-face {font-family:"font";src:url("https://")}',["@media (",aj.join("touch-enabled),("),ap,")","{#touch{top:9px;position:absolute}}"].join(""),["@media (",aj.join("transform-3d),("),ap,")","{#csstransforms3d{left:9px;position:absolute;height:3px;}}"].join(""),['#generatedcontent:after{content:"',al,'";visibility:hidden}'].join("")],["fontface","touch","csstransforms3d","generatedcontent"]);af.flexbox=function(){return O("flexOrder")},af.canvas=function(){var b=aw.createElement("canvas");return !!b.getContext&&!!b.getContext("2d")},af.canvastext=function(){return !!at.canvas&&!!S(aw.createElement("canvas").getContext("2d").fillText,"function")},af.touch=function(){return at.touch},af.postmessage=function(){return !!ax.postMessage},af.websqldatabase=function(){return !!ax.openDatabase},af.indexedDB=function(){return !!O("indexedDB",ax)},af.hashchange=function(){return Y("hashchange",ax)&&(aw.documentMode===av||aw.documentMode>7)},af.history=function(){return !!ax.history&&!!history.pushState},af.draganddrop=function(){var b=aw.createElement("div");return"draggable" in b||"ondragstart" in b&&"ondrop" in b},af.websockets=function(){for(var a=-1,d=ah.length;++a<d;){if(ax[ah[a]+"WebSocket"]){return !0}}return"WebSocket" in ax},af.rgba=function(){return V("background-color:rgba(150,255,150,.5)"),R(an.backgroundColor,"rgba")},af.hsla=function(){return V("background-color:hsla(120,40%,100%,.5)"),R(an.backgroundColor,"rgba")||R(an.backgroundColor,"hsla")},af.multiplebgs=function(){return V("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(an.background)},af.backgroundsize=function(){return O("backgroundSize")},af.borderimage=function(){return O("borderImage")},af.borderradius=function(){return O("borderRadius")},af.boxshadow=function(){return O("boxShadow")},af.textshadow=function(){return aw.createElement("div").style.textShadow===""},af.opacity=function(){return U("opacity:.55"),/^0.55$/.test(an.opacity)},af.cssanimations=function(){return O("animationName")},af.csscolumns=function(){return O("columnCount")},af.cssgradients=function(){var e="background-image:",d="gradient(linear,left top,right bottom,from(#9f9),to(white));",f="linear-gradient(left top,#9f9, white);";return V((e+"-webkit- ".split(" ").join(d+e)+aj.join(f+e)).slice(0,-e.length)),R(an.backgroundImage,"gradient")},af.cssreflections=function(){return O("boxReflect")},af.csstransforms=function(){return !!O("transform")},af.csstransforms3d=function(){var b=!!O("perspective");return b&&"webkitPerspective" in aq.style&&(b=at.csstransforms3d),b},af.csstransitions=function(){return O("transition")},af.fontface=function(){return at.fontface},af.generatedcontent=function(){return at.generatedcontent},af.video=function(){var b=aw.createElement("video"),f=!1;try{if(f=!!b.canPlayType){f=new Boolean(f),f.ogg=b.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),f.h264=b.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),f.webm=b.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}}catch(e){}return f},af.audio=function(){var b=aw.createElement("audio"),f=!1;try{if(f=!!b.canPlayType){f=new Boolean(f),f.ogg=b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),f.mp3=b.canPlayType("audio/mpeg;").replace(/^no$/,""),f.wav=b.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),f.m4a=(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/aac;")).replace(/^no$/,"")}}catch(e){}return f},af.localstorage=function(){try{return localStorage.setItem(ap,ap),localStorage.removeItem(ap),!0}catch(b){return !1}},af.sessionstorage=function(){try{return sessionStorage.setItem(ap,ap),sessionStorage.removeItem(ap),!0}catch(b){return !1}},af.webworkers=function(){return !!ax.Worker},af.applicationcache=function(){return !!ax.applicationCache};for(var L in af){W(af,L)&&(aa=L.toLowerCase(),at[aa]=af[L](),ac.push((at[aa]?"":"no-")+aa))}return at.input||M(),V(""),ao=am=null,at._version=au,at._prefixes=aj,at._domPrefixes=ag,at._cssomPrefixes=ah,at.hasEvent=Y,at.testProp=function(b){return Q([b])},at.testAllProps=O,at.testStyles=Z,aq.className=aq.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(ar?" js "+ac.join(" "):""),at}(this,this.document);var HTML=Class.create({initialize:function(a){if(a instanceof HTML){return a}this._str_DONT_TOUCH=a},toHTML:function(){return this._str_DONT_TOUCH},toString:function(){return"[object HTML]"}});(function(){var d={};HTML.tmpl=function c(k,j){var h=!/\W/.test(k)?d[k]=d[k]||c(document.getElementById(k).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+k.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.*?)%>/g,"',HTML._raw_escape($1),'").split("<%").join("');").split("%>").join("p.push('")+"');}return new HTML(p.join('').trim());");return j?h(j):h};var e=/[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@\.\ _\-\(\)\,\$~%#\[\]\{\}\!\^]/g;var f=function b(h){return"&#"+h.charCodeAt(0)+";"};function g(h){return(""+h).replace(e,f)}HTML.escape=HTML.quoteattr=function(h){if(h instanceof HTML){return h}else{return new HTML(g(h))}};HTML._raw_escape=function a(h){if(h instanceof HTML){return h.toHTML()}else{if(typeof h=="number"){return h}else{return g(h)}}}})();var MailCheck=Class.create({DOMAINS:["yahoo.com","google.com","hotmail.com","gmail.com","me.com","aol.com","mac.com","live.com","comcast.net","googlemail.com","msn.com"],WHITELIST_REGEXS:["ymail.com","yahoo\\.co\\.","yahoo\\.com\\.","hotmail\\.co\\.","hotmail\\.com\\."],THRESHOLD:2,initialize:function(b,a){this.emailTextInputId=b;this.resultElemId=a;this.listen()},listen:function(){$(this.emailTextInputId).observe("blur",this.onEmailBlur.bind(this))},onEmailBlur:function(){if(!this.emailTextInputId||!this.resultElemId){return}this.suggestion=this.suggest($(this.emailTextInputId).getValue());if(this.suggestion){var a='<span class="email_warning_area">'+this.suggestion.domain+"</span>";var c=this.suggestion.address+"@"+a;var b=new HTML(_("Did you mean <a>%(suggested_email)s</a>?").format({suggested_email:c}));$(this.resultElemId).__date(b);$(this.resultElemId).setStyle({display:"block"});$(this.resultElemId).on("click","a",this.onLinkClick.bind(this))}else{$(this.resultElemId).__date();$(this.resultElemId).setStyle({display:"none"})}},onLinkClick:function(){$(this.emailTextInputId).setValue(this.suggestion.full);$(this.resultElemId).__date();$(this.resultElemId).setStyle({display:"none"})},suggest:function(c){c=c.toLowerCase();var a=this.splitEmail(c);var b=this.findClosestDomain(a.domain);for(var d=0;d<this.WHITELIST_REGEXS.length;d++){var e=RegExp(this.WHITELIST_REGEXS[d]);if(e.match(a.domain)){return false}}if(b){return{address:a.address,domain:b,full:a.address+"@"+b}}else{return false}},findClosestDomain:function(d){var e;var b=99;var a=null;for(var c=0;c<this.DOMAINS.length;c++){e=this.stringDistance(d,this.DOMAINS[c]);if(e<b){b=e;a=this.DOMAINS[c]}}if(b<=this.THRESHOLD&&a!==null&&a!==d){return a}else{return false}},stringDistance:function(f,b){if(f==null||f.length===0){if(b==null||b.length===0){return 0}else{return b.length}}if(b==null||b.length===0){return f.length}var j=0;var h=0;var g=0;var a=0;var e=5;while((j+h<f.length)&&(j+g<b.length)){if(f.charAt(j+h)==b.charAt(j+g)){a++}else{h=0;g=0;for(var d=0;d<e;d++){if((j+d<f.length)&&(f.charAt(j+d)==b.charAt(j))){h=d;break}if((j+d<b.length)&&(f.charAt(j)==b.charAt(j+d))){g=d;break}}}j++}return(f.length+b.length)/2-a},splitEmail:function(a){var b=a.split("@");if(b.length<2){return false}return{domain:b.pop(),address:b.join("@")}}});(function(){var b,d,a,c;Function.prototype.defer=Function.prototype.defer.wrap(function(f){var e;e=$A(arguments).slice(1);this.__tb__=get_stack_rep();return f.apply(this,e)});String.prototype.evalScripts=String.prototype.evalScripts.wrap(function(g){var f;f=$A(arguments).slice(1);try{return g.apply(this,f)}catch(h){return assert(0,h.toString())}});Function.prototype.cached=function(e){var h,g;g=Math.random();h=this;return function(){var f;f=Jcached.get(g);if(f!==false){return f}f=h();Jcached.set(g,f,e);return f}};Array.prototype.sort_by_key=function(g,h){var e;if(h==null){h=false}e=h?-1:1;return this.sort(function(f,j){f=g(f);j=g(j);if(f<j){return e*-1}else{if(f>j){return e*1}else{return 0}}})};Array.prototype.contains=function(e){return this.indexOf(e)!==-1};Array.prototype.remove=function(f,e){e=e||f+1;return this.splice(f,e-f)};Array.prototype.removeItem=function(f){var e;e=this.indexOf(f);if(e>=0){return this.remove(e)}else{return false}};Array.prototype.dict_by=function(e){var h,j,g,k,f;g={};for(h=k=0,f=this.length;k<f;h=++k){j=this[h];g[this[h][e]]=this[h]}return g};Array.prototype.unique=function(){var j,g,h,f,e;j={};for(h=0,f=this.length;h<f;h++){g=this[h];if(typeof g!=="string"){return this}j[g]=0}e=[];for(g in j){e.push(g)}return e};String.prototype.widthSplit=function(h){var e,g,f,j;if(h==null){h=15}e=[];g=this;j=0;f=g.substring(j,j+h);while(f!==""){e.push(f);j+=h;f=g.substring(j,j+h)}return e};Object.extend(Effect.Transitions,{EaseIn:function(e){return Math.pow(e,2)},EaseOut:function(e){return Math.pow(e,0.5)}});(function(g){var f,e;f=function(m){var j,q,p,n,r,l,k,o,h;if(m){if(Object.isArray(m)){j=[];for(l=0,o=m.length;l<o;l++){q=m[l];j.push(HTML.escape(q).toHTML())}m=new HTML(j.join(""))}else{if(m.top||m.bottom||m.before||m.after){n=["top","bottom","before","after"];for(k=0,h=n.length;k<h;k++){p=n[k];r=m[p];if(r){m[p]=arguments.callee(r)}}}else{if(Util.isElm(m||m.toElement||m.toHTML)){}else{m=HTML.escape(m)}}}}return m};return Element.addMethods({db_observe:function(j,h,k){return j.observe(h,function(l){return k(l,j)})},smoothScrollIntoView:function(l,k){var p,j,h,o,n,m;if(k==null){k={}}p={duration:0.3,offset:0,padding:0,transition:Effect.Transitions.EaseOut};k=Object.extend(p,k);h=l.viewportOffset(l);j=l.getDimensions();m=document.viewport.getDimensions();n=k.padding||0;if(h.top>n&&(h.top+j.height)<(m.height-n)){return}o=h.top<n?-1*Math.floor(m.height/4):-1*Math.floor(3*m.height/4);k.offset=k.offset||o;return new Effect.ScrollTo(l,k)},__sert:function(h,j){return Element.insert(h,f(j))},__date:function(h,j){return Element.update(h,f(j))},replace:e=function(h,j){return g(h,f(j))}})})(Element.replace);a=function(e){if(e!=null?e.target:void 0){try{return document.activeElement=e.target===document?null:e.target}catch(f){}}};c=function(e){try{return document.activeElement=null}catch(f){}};if(document.addEventListener){document.addEventListener("focus",a,true);document.addEventListener("blur",c,true)}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}String.prototype.lpad=function(f,e){var g;if(e==null){e="0"}g=this;while(g.length<f){g=e+g}return g.toString()};String.prototype.reverse=function(){var g,f,e;e=this.split("");f=e.reverse();g=f.join("");return g};String.prototype.create=function(e){return e};String.prototype.count=function(e){return(this.length-this.gsub(e,"").length)/e.length};d=/^\.[a-zA-Z0-9]$/;String.prototype.snippet=function(k,m){var e,f,j,n,h,l,g;if(k==null){k=50}if(m==null){m=0.75}if(this.length<=k){return this}f="";e=this.lastIndexOf(".");if(this.length-e>5){e=-1}if(e>0){f=this.substr(e);if(d.match(f)){k=k-f.length}else{e=this.length;f=""}}else{e=this.length;f=""}k=k-this.create("...").length;j=k*m;if(!(this instanceof Emstring)){j=Math.floor(j)}l=k-j;g=e-l;h=this.substr(0,j);n=this.substr(g,l);return h+"..."+n+f};String.prototype.em_snippet=function(f,e){return new Emstring(this).snippet(f,e).toString()};String.prototype.repeat=function(e){return(new Array(e+1)).join(this)};String.prototype.title=function(){return this.charAt(0).toUpperCase()+this.substr(1)};Ajax.DBRequest=Class.create(Ajax.Request,{initialize:function($super,g,f){var e,j,h,k;if(f==null){f={}}this.start_time=Util.time();f.method=f.method||"post";f.parameters=f.parameters||{};f.parameters.t=Constants.TOKEN;if(Ajax.DBRequest.restrict){f.parameters.restrict=Ajax.DBRequest.restrict}j=f.cleanUp||(function(){});if(f.job){this.job_id=Util.nonce();f.parameters.job_id=this.job_id;ProgressWatcher.watch(this)}if(!f.no_watch){RequestWatcher.watch(this,!!f.job)}h=f.onFailure;k=f.onSuccess;f.onFailure=function(m){var o,l,n;if(Job.handled(m.request.job_id)){return}if(!f.noAutonotify){o=null;if(!Constants.IS_PROD&&m.status===500&&m.getHeader("X-Debug-Url")){g=m.getHeader("X-Debug-Url");o=_("There was a problem completing this request.")+(' <a href="'+g+'" target="_blank">View debug</a>')}Notify.server_error(o)}j(false);if(h){h(m)}if(m.status===403){l=Util.session_storage_get("reload-timestamp");if(!l||Util.time()-l>30*1000){Util.session_storage_set("reload-timestamp",Util.time());location.reload(true)}}return assert(f.noAutonotify||((n=m.status)===403||n===404||n===502),"Ajax "+m.status+" on "+m.request.url)};f.onSuccess=function(l){var m;m=Util.time()-l.request.start_time;WIT._record("AJAX","load",l.request.url,{time:m});if(Job.handled(l.request.job_id)){return}TranslationSuggest.update_i18n_messages_from_req(l);if(typeof QueryLog!=="undefined"){QueryLog.update_query_log_from_req(l)}if(!l.responseText.length){if(!f.job){if(!f.noAutonotify?!l||l.status!==0:void 0){Notify.server_error()}if(h){h(l)}}}else{if(l.responseText.indexOf("err:")===0){if(!f.noAutonotify){Notify.server_error(l.responseText.substr(4))}if(h){h(l)}}else{if(k){if(l.responseText.indexOf("ok:")===0){Notify.server_success(l.responseText.substr(3))}k(l)}if(f.log_timing){WebTimingLogger.log_ajax_transition.defer(m)}}}return j(true)};f.onException=function(m,n){var o,l;if(window.console){throw n}o=("Error with AJAX callback for: "+g+" :::: ")+n.toString();l=get_stack_rep();l.pop();return global_report_exception(o,window.location.href,"",l.join("\n"))};if(f.job){g+=(g.indexOf("?")===-1?"?":"&")+"long_running=1"}e=$H({url:g});if(f.parameters){e.update(f.parameters);e.unset("t")}f.onSuccess.__tb_ajax_info__=f.onFailure.__tb_ajax_info__=Object.toJSON(e);return $super(g,f)}});Object.extend(key,{main_modifier:function(){if(Util.is_mac()){return decodeURIComponent("%E2%8C%98")}else{return"ctrl"}}});b=function(){var g,h,e,f;e=function(k){var l,j;k=$(k);j=$(k.target);if(!Element.match(j,"input,textarea")){return}l=j.readAttribute("placeholder");if(l){if("focus"===k.type||"focusin"===k.type){if(j.getValue()===""){j.setValue("");return j.removeClassName(g)}}else{if(""===j.value){j.addClassName(g);return j.value=l}}}};$(document.body);h=$(document.documentElement);g="placeholder";if(h.addEventListener){h.addEventListener("focus",e,true);h.addEventListener("blur",e,true)}else{h.on("focusin","[placeholder]",e);h.on("focusout","[placeholder]",e)}f=Element.Methods.ByTag.INPUT.getValue.wrap(function(l,j){var k;k=$(j).readAttribute("placeholder");if(k&&k===j.value&&$(j).hasClassName(g)){return""}return l.apply(this,$A(arguments).slice(1))});Element.addMethods("input",{getValue:f});return Element.addMethods("textarea",{getValue:f})};if(document.loaded){b()}else{document.observe("dom:loaded",b)}Object.extend(Prototype.BrowserFeatures,{DB_CORS:window.XMLHttpRequest&&("withCredentials" in new XMLHttpRequest())})}).call(this);var __slice=[].slice;jQuery.fn.curry=function(){var a,c,b;c=arguments[0],b=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[];if(b==null){b=window}return function(){var d;d=1<=arguments.length?__slice.call(arguments,0):[];return c.apply(b,__slice.call(a).concat(__slice.call(d)))}};jQuery.fn.stripTags=function(a){return a.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")};var LANGPACK,N_,PLURAL_RULES,add_i18n_message,localized_path,singular_01,singular_1,singular_all,ungettext,_;add_i18n_message=function(d,c,a,b){Constants.messages=Constants.messages||{};Constants.emessages=Constants.emessages||{};c=c.stripTags().friendly_format();a=a.stripTags();Constants.messages[c]=d;Constants.emessages[c]=a;if(b){delete Constants.messages[b];delete Constants.emessages[b]}if(typeof TranslationSuggest!=="undefined"&&TranslationSuggest!==null){return TranslationSuggest.index_message(c)}};singular_1=function(a){if(a===1){return 0}else{return 1}};singular_01=function(a){if(a<=1){return 0}else{return 1}};singular_all=function(a){return 0};PLURAL_RULES={es_US:singular_1,es_ES:singular_1,de:singular_1,es:singular_1,fr:singular_01,ja:singular_all,ko:singular_all,pl:singular_1,it:singular_1};if(!window.LANGPACK){LANGPACK={}}_=function(a){var b;b=LANGPACK[a]||a;add_i18n_message(a,b,a);return b};N_=function(a){return a};ungettext=function(c,b,g){var f,d,e,a;assert(g!=null,"missing number parameter for ungettext");if(c in LANGPACK&&Constants.USER_LOCALE){d=LANGPACK[c];if(Object.isString(d)&&Constants.USER_LOCALE==="ja"){return d}e=PLURAL_RULES[Constants.USER_LOCALE](g);assert(e in d,"bad plural lookup");a=d[e]}f=g===1?c:b;if(a==null){a=f}add_i18n_message(c,a,f);return a};localized_path=function(f,b){var c,e,a,d;if(!b){d=Constants.LOCALES;for(e=0,a=d.length;e<a;e++){c=d[e];b=c[0]}}if(b.indexOf(Constants.USER_LOCALE)!==-1){return f.replace(/(\.[a-zA-Z0-9]{2,4})$/,"__%s$1".format(Constants.USER_LOCALE))}else{return f}};Date.prototype.localize=function(){assert(Constants.date_format!=null,"Date format missing.");return this.format(Constants.date_format)};Date.prototype.format=function(a){var b,c=this;assert(typeof a==="string","Date format requires a format string");b={yy:function(){return c.getFullYear().toString().substring(2)},yyyy:function(){return c.getFullYear().toString()},M:function(){return(c.getMonth()+1).toString()},MM:function(){return(c.getMonth()+1).toString().lpad(2)},d:function(){return c.getDate().toString()},dd:function(){return c.getDate().toString().lpad(2)},h:function(){return(c.getHours()%12||12).toString()},H:function(){return(c.getHours()%12||12).toString()},HH:function(){return(c.getHours()%12||12).toString().lpad(2)},m:function(){return c.getMinutes().toString()},mm:function(){return c.getMinutes().toString().lpad(2)},a:function(){if(c.getHours()>11){return _("PM")}else{return _("AM")}}};return a.replace(/([a-zA-Z]+)/g,function(d){if(b[d]!=null){return b[d]()}else{return d}})};String.prototype.format_sub=function(a){return this.replace(/%(\([a-z_\-]+\))?(.\d+)?(.)/g,a.bind(this))};String.prototype.format=function(){var g,f,e,c,b,a;if(arguments.length===0){return this.toString()}f=void 0;g=0;if(arguments.length===1&&arguments[0] instanceof Object){f=arguments[0]}else{f=$A(arguments)}b=function(m,k,j,l){var n,d,h;if(!k){if(!Object.isArray(f)){f=[f]}assert(g>-1,"Cannot mix named and positional indices in string formatting for string '"+this+"'.");assert(g<f.length,"Insufficient number of items in format for string '"+this+"', list "+Object.toJSON($A(f))+".");h=f[g];g++}else{k=k.slice(1,-1);assert(g<=0,"Cannot mix named and positional indices in string formatting for string '"+this+"'.");g=-1;assert(k in f,"Key '"+k+"' not present during string substitution for string '"+this+"', dict "+Object.toJSON($H(f))+".");h=f[k]}assert(typeof h!=="undefined",'value for key "'+(k||"").toString()+'" is undefined');d=void 0;if(l==="s"){d=h.toString()}else{if(l==="d"){d=parseInt(h,10).toString()}else{if(l==="f"){d=Number(h).toString()}else{if(l==="%"){return"%"}else{assert(false,"Unexpected format character '"+l+"' for string '"+this+"'.")}}}}if(j){j=parseInt(j.slice(1),10);if(l==="f"){if(d.indexOf("."===-1)){d=d+".0"}n=d.split(".");return n[0]+"."+n[1].slice(0,j)}else{return d.slice(0,j)}}return d};a=this.format_sub(b);if(Constants.messages&&this in Constants.messages){g=0;c=Constants.emessages[this];e=String.prototype.format_sub.call(c,b);add_i18n_message(c,a,e,this)}return a};String.prototype.friendly_format=function(){var a,c,b;c=function(g,e,d,f){if(!e){if(f==="s"){return"[word"+(b++)+"]"}else{return"[number"+(a++)+"]"}}else{return"["+(e.slice(1,1).replace("-","_"))+"]"}};a=1;b=1;return this.format_sub(c)};String.prototype.blank_format=function(){var a;a=function(){return""};return this.format_sub(a)};var DBObserver,DomUtil,Email,Emstring,IE7_OR_LESS,RequestWatcher,SimpleSet,SuperDictionary,T,Trace,UIButton,Util,Velocity,alertd,assert,console,fn_body,get_stack_rep,strip_comments,__slice=[].slice;strip_comments=function(a){return a.replace(/\/\/.*/g,"").replace(/\/\*[\s\S]*?\*\//g,"")};fn_body=function(b){var a;a=strip_comments(b.toString());a=a.replace(/[\s]+/g," ");if(a.startsWith("(")){a=a.substr(1)}if(a.endsWith(")")){a=a.substr(0,a.length-1)}a=a.replace("function (","function(");return a};get_stack_rep=function(){var d,c,b,a;b=[];a={};d=arguments.callee.caller;while(d){if(d.__tb_ajax_info__){b.unshift("Ajax.DBRequest: "+d.__tb_ajax_info__);break}if(d.__tb__){b=d.__tb__.concat(b);break}c=fn_body(d);if(c in a){break}a[c]=true;b.unshift(c);d=d.caller}return b};alertd=window.alert;assert=function(c,d,b){var a;if(!c){d="Assertion Error: "+d;if(!Constants.IS_PROD){if(typeof console!=="undefined"&&console!==null){if(typeof console.trace==="function"){console.trace()}}alert(d)}a=get_stack_rep();a.pop();global_report_exception(d,window.location.href,"",a.join("\n"));throw d}};DBObserver={watch:function(b,c){var a;a=function(){var e,d;e=$(b);assert(e,"Couldn't find watch element");d=e.getValue().strip();if(d!==e.last_search&&!SuggestionInput.defaulted(e)){e.last_search=d;return c(d)}};return setInterval(a,300)}};Email={mailto:function(c,b,d,a){if(d==null){d="dropbox.com"}if(a==null){a=""}c.href="mailto:"+b+"@"+d;if(a){c.href+="?body="+a}return c.onMouseover=null}};SimpleSet=Class.create({initialize:function(a){this.length=0;this.d={};this.items=[];return this.update(a)},update:function(c){var d,e,b,a;if(c==null){c=[]}a=[];for(e=0,b=c.length;e<b;e++){d=c[e];a.push(this.add(d))}return a},_hash:function(b){var a;a=typeof b;assert(a==="string"||a==="number","expected a string or a number, got "+a);return a+":"+b},add:function(b){var a;a=this._hash(b);if(!this.d[a]){this.items.push(b);this.length+=1}return this.d[a]=true},contains:function(b){var a;a=this._hash(b);return this.d[a]||false},union:function(){var b,c,d,a;a=1<=arguments.length?__slice.call(arguments,0):[];b=this.items;c=(function(){var g,f,e;e=[];for(g=0,f=a.length;g<f;g++){d=a[g];e.push(d.items)}return e})();return new SimpleSet(b.concat.apply(b,c))},difference:function(){var b,c,g,h,d,f,a,e;b=$A(arguments);assert(b.length>0,"Requires at least one SimpleSet");if(b.length>1){g=b[0];c=g.union.apply(g,b.slice(1))}else{c=b[0]}h=[];e=this.items;for(f=0,a=e.length;f<a;f++){d=e[f];if(!c.contains(d)){h.push(d)}}return new SimpleSet(h)}});Emstring=Class.create({initialize:function(a){this.s=a;this.info=this.widthInfo();return this.length=a.length?this.info[this.s.length-1]:0},create:function(a){return new Emstring(a)},widthInfo:function(){var a,b,d,c;b={};b[-1]=0;for(a=d=0,c=this.s.length;0<=c?d<c:d>c;a=0<=c?++d:--d){b[a]=b[a-1]+this.ems(this.s.charAt(a))}return b},findSpot:function(b){var d,f,a,c;if(!b){return 0}c=0;f=this.s.length;while(c<=f){a=Math.floor(c/2+f/2);d=this.info[a-1];if(d>b){f=a-1}else{if(d<b){c=a+1}else{return a}}}if(c>a){return c}else{return a}},ems:function(g){var b,a,f,e,d;a=0.65;b=1.08;f=0.58;e=g.charCodeAt(0);d=Emstring.CODEPOINT_TO_WIDTH[e];if(d){return d/Math.pow(10,Emstring.ACCURACY)}if((768<=e&&e<=879)){return 0}if((65377<=e&&e<=65500)){return f}if(((11904<=e&&e<=40911))||((44032<=e&&e<=55215))||((4352<=e&&e<=4607))||((63744<=e&&e<=64255))||((65280<=e&&e<=65535))||((131072<=e&&e<=196607))){return b}return a},substr:function(d,a){var b,c;c=this.findSpot(d);if(a!=null){b=this.findSpot(d+a);return new Emstring(this.s.substr(c,b-c))}else{return new Emstring(this.s.substr(c))}},indexOf:function(b){var a;a=this.s.indexOf(b);if(a>-1){return this.info[a-1]}else{return -1}},lastIndexOf:function(b){var a;a=this.s.reverse().indexOf(b.reverse());if(a<0){return -1}return this.info[this.s.length-a-b.length-1]},toString:function(){return this.s},snippet:String.prototype.snippet});Emstring.ACCURACY=2;Emstring.CODEPOINT_TO_WIDTH={32:38,33:25,34:42,35:67,36:58,37:92,38:75,39:25,40:33,41:33,42:58,43:58,44:25,45:33,46:25,47:42,48:58,49:58,50:58,51:58,52:58,53:58,54:58,55:58,56:58,57:58,58:25,59:25,60:58,61:58,62:58,63:50,64:100,65:67,66:67,67:67,68:75,69:58,70:58,71:75,72:83,73:33,74:25,75:67,76:58,77:100,78:83,79:83,80:67,81:83,82:67,83:58,84:58,85:75,86:67,87:100,88:67,89:58,90:58,91:33,92:42,93:33,94:58,95:50,96:67,97:58,98:67,99:50,100:67,101:58,102:33,103:58,104:67,105:25,106:25,107:58,108:25,109:100,110:67,111:67,112:67,113:67,114:42,115:50,116:42,117:67,118:58,119:83,120:58,121:58,122:50,123:42,124:58,125:42,126:58,161:25,162:58,163:58,164:58,165:58,166:58,167:58,168:67,169:92,170:42,171:50,172:58,174:92,175:58,176:50,177:58,178:42,179:42,180:67,181:67,182:75,183:25,184:25,185:42,186:42,187:50,188:83,189:83,190:83,191:50,192:67,193:67,194:67,195:67,196:67,197:67,198:92,199:67,200:58,201:58,202:58,203:58,204:33,205:33,206:33,207:33,208:75,209:83,210:83,211:83,212:83,213:83,214:83,215:58,216:83,217:75,218:75,219:75,220:75,221:58,222:67,223:67,224:58,225:58,226:58,227:58,228:58,229:58,230:92,231:50,232:58,233:58,234:58,235:58,236:25,237:25,238:25,239:25,240:67,241:67,242:67,243:67,244:67,245:67,246:67,247:58,248:67,249:67,250:67,251:67,252:67,253:58,254:67,255:58,256:75,257:67,258:75,259:67,260:75,261:67,262:75,263:58,264:75,265:58,266:75,267:58,268:75,269:58,270:83,271:83,272:83,273:75,274:67,275:67,276:67,277:67,278:67,279:67,280:67,281:67,282:67,283:67,284:83,285:75,286:83,287:75,288:83,289:75,290:83,291:75,292:83,293:75,294:92,295:75,296:33,297:33,298:33,299:33,300:33,301:33,302:33,303:33,304:33,305:25,306:67,307:67,308:42,309:33,310:75,311:67,312:67,313:58,314:33,315:58,316:33,317:58,318:42,319:58,320:50,321:67,322:42,323:83,324:75,325:83,326:75,327:83,328:75,329:83,330:83,331:75,332:92,333:67,334:92,335:67,336:92,337:67,338:100,339:100,340:75,341:50,342:75,343:50,344:75,345:50,346:67,347:58,348:67,349:58,350:67,351:58,352:67,353:58,354:75,355:42,356:75,357:42,358:75,359:42,360:83,361:75,362:83,363:75,364:83,365:75,366:83,367:75,368:83,369:75,370:83,371:75,372:100,373:92,374:75,375:58,376:75,377:67,378:67,379:67,380:67,381:67,382:67,383:42,384:75,385:83,386:67,387:75,388:75,389:67,390:75,391:83,392:58,393:83,394:100,395:67,396:75,397:67,398:67,399:75,400:58,401:58,402:75,403:83,404:75,405:100,406:50,407:50,408:75,409:67,410:50,411:67,412:117,413:83,414:75,415:92,416:92,417:75,418:117,419:100,420:75,421:75,422:75,423:67,424:58,425:67,426:58,427:42,428:75,429:42,430:75,431:83,432:75,433:92,434:83,435:75,436:75,437:67,438:67,439:67,440:67,441:58,442:58,443:75,444:75,445:58,446:50,447:67,448:33,449:50,450:50,451:33,452:142,453:142,454:133,455:100,456:92,457:67,458:117,459:117,460:100,461:75,462:67,463:33,464:33,465:92,466:67,467:83,468:75,469:83,470:75,471:83,472:75,473:83,474:75,475:83,476:75,477:67,478:75,479:67,480:75,481:67,482:100,483:100,484:92,485:75,486:83,487:75,488:75,489:67,490:92,491:67,492:92,493:67,494:67,495:58,496:33,497:142,498:142,499:133,500:83,501:75,502:117,503:67,504:83,505:75,506:75,507:67,508:100,509:100,510:92,511:67,512:75,513:67,514:75,515:67,516:67,517:67,518:67,519:67,520:33,521:33,522:33,523:33,524:92,525:67,526:92,527:67,528:75,529:50,530:75,531:50,532:83,533:75,534:83,535:75,536:67,537:58,538:75,539:42,540:58,541:58,542:83,543:75,544:83,545:100,546:92,547:67,548:67,549:67,550:75,551:67,552:67,553:67,554:92,555:67,556:92,557:67,558:92,559:67,560:92,561:67,562:75,563:58,564:67,565:100,566:67,567:33,568:100,569:100,570:75,571:75,572:58,573:58,574:67,575:58,576:58,577:67,578:50,579:75,580:75,581:75,582:75,583:58,584:58,585:25,586:83,587:58,588:75,589:33,590:75,591:58,880:67,881:50,882:67,883:50,884:33,885:33,886:75,887:67,888:108,889:108,890:67,891:58,892:58,893:58,894:42,895:108,896:108,897:108,898:108,899:108,900:67,901:67,902:75,903:42,904:83,905:100,906:58,907:108,908:100,909:108,910:100,911:100,912:42,913:75,914:67,915:58,916:83,917:67,918:67,919:83,920:92,921:33,922:75,923:75,924:100,925:83,926:75,927:92,928:83,929:67,930:108,931:67,932:75,933:75,934:83,935:75,936:83,937:92,938:33,939:75,940:83,941:58,942:75,943:42,944:67,945:83,946:67,947:67,948:67,949:58,950:75,951:75,952:67,953:42,954:67,955:67,956:75,957:67,958:67,959:67,960:92,961:67,962:67,963:75,964:67,965:67,966:92,967:67,968:92,969:100,970:42,971:67,972:67,973:67,974:100,975:108,976:58,977:75,978:75,979:100,980:75,981:92,982:100,983:67,984:92,985:67,986:75,987:58,988:58,989:58,990:67,991:58,992:75,993:92,994:100,995:92,996:75,997:58,998:75,999:58,1000:75,1001:75,1002:67,1003:67,1004:83,1005:58,1006:50,1007:42,1008:67,1009:67,1010:58,1011:33,1012:92,1013:58,1014:58,1015:67,1016:67,1017:75,1018:100,1019:83,1020:58,1021:75,1022:75,1023:75,1024:67,1025:67,1026:92,1027:58,1028:75,1029:67,1030:33,1031:33,1032:42,1033:108,1034:108,1035:83,1036:75,1037:83,1038:75,1039:83,1040:75,1041:67,1042:67,1043:58,1044:83,1045:67,1046:92,1047:67,1048:83,1049:83,1050:75,1051:83,1052:100,1053:83,1054:92,1055:83,1056:67,1057:75,1058:75,1059:75,1060:83,1061:75,1062:83,1063:75,1064:108,1065:108,1066:75,1067:92,1068:67,1069:75,1070:108,1071:75,1072:67,1073:67,1074:58,1075:58,1076:75,1077:67,1078:83,1079:58,1080:75,1081:75,1082:67,1083:67,1084:83,1085:75,1086:67,1087:75,1088:75,1089:58,1090:58,1091:58,1092:92,1093:67,1094:75,1095:58,1096:92,1097:100,1098:67,1099:83,1100:58,1101:58,1102:92,1103:58,1104:67,1105:67,1106:75,1107:58,1108:58,1109:58,1110:33,1111:33,1112:42,1113:92,1114:92,1115:75,1116:67,1117:75,1118:58,1119:75,1120:100,1121:75,1122:75,1123:67,1124:83,1125:83,1126:75,1127:67,1128:100,1129:92,1130:92,1131:83,1132:117,1133:108,1134:67,1135:67,1136:83,1137:83,1138:92,1139:67,1140:83,1141:67,1142:83,1143:67,1144:133,1145:125,1146:92,1147:67,1148:100,1149:75,1150:100,1151:75,1152:75,1153:58,1154:75,1155:0,1156:0,1157:0,1158:0,1159:108,1160:0,1161:0,1162:83,1163:75,1164:67,1165:58,1166:67,1167:75,1168:58,1169:58,1170:67,1171:58,1172:75,1173:67,1174:100,1175:92,1176:67,1177:58,1178:75,1179:67,1180:83,1181:75,1182:75,1183:67,1184:83,1185:75,1186:83,1187:75,1188:100,1189:83,1190:117,1191:100,1192:92,1193:75,1194:75,1195:58,1196:75,1197:58,1198:75,1199:58,1200:75,1201:58,1202:75,1203:75,1204:100,1205:83,1206:75,1207:67,1208:75,1209:67,1210:75,1211:58,1212:92,1213:75,1214:92,1215:75,1216:33,1217:92,1218:83,1219:75,1220:67,1221:83,1222:67,1223:83,1224:75,1225:83,1226:75,1227:75,1228:58,1229:100,1230:83,1231:25,1232:75,1233:67,1234:75,1235:67,1236:100,1237:100,1238:67,1239:67,1240:75,1241:67,1242:75,1243:67,1244:92,1245:83,1246:67,1247:58,1248:67,1249:58,1250:83,1251:75,1252:83,1253:75,1254:92,1255:67,1256:92,1257:67,1258:92,1259:67,1260:75,1261:58,1262:75,1263:58,1264:75,1265:58,1266:75,1267:58,1268:75,1269:58,1270:58,1271:42,1272:92,1273:83,1274:58,1275:42,1276:75,1277:58,1278:75,1279:58,19977:108,65403:58};DomUtil={fromElm:function(a){return $(a).innerHTML},updateFromElm:function(b,a){b=$(b);a=$(a);b.update(this.fromElm(a));return Util.live_joff(a,b)},fillVal:function(h,e){var b,g,d,f,a,c;f=$$("."+e);c=[];for(g=0,d=f.length;g<d;g++){b=f[g];b=$(b);if(b.tagName==="INPUT"){b.value=h;c.push(b.defaultValue=h)}else{if(b.innerHTML===""&&((a=b.tagName)==="A"||a==="B"||a==="INPUT"||a==="I"||a==="LABEL"||a==="SELECT"||a==="SPAN"||a==="TEXTAREA")){Util.log("Filling an empty value; this may look broken in IE7",b)}c.push(b.innerHTML=h)}}return c}};Util={add_qstring:function(a,d){var f,c,b,e;f=a.indexOf("?")===-1?"?":"&";b=(function(){var g;g=[];for(c in d){e=d[c];g.push(""+c+"="+(encodeURIComponent(e)))}return g})();return a+f+b.join("&")},from_json:function(a){if(window.JSON&&window.JSON.parse){return window.JSON.parse(a)}else{return a.evalJSON(true)}},to_json:function(b){var a;return((a=window.JSON)!=null?typeof a.stringify==="function"?a.stringify(b):void 0:void 0)||Object.toJSON(b)},viewport_dimensions:function(){var a=this;if(!this._cached_viewport_dimensions){this._cached_viewport_dimensions=document.viewport.getDimensions()}if(!this._listening_for_resize){Event.observe(window,"resize",function(){return delete a._cached_viewport_dimensions});this._listening_for_resize=1}return this._cached_viewport_dimensions},set_min_body_height_to_viewport_height:function(){var a;a=$(document.body);if(a!=null?a.style:void 0){return a.style.minHeight=this.viewport_dimensions().height+"px"}},_listen_for_scroll:function(){var a=this;if(!this._listening_for_scroll){Event.observe(window,"scroll",function(){if(a._ignore_scroll_event){a._ignore_scroll_event=0;return}return delete a._cached_scroll_offsets});return this._listening_for_scroll=1}},force_delete_cached_scroll_offsets:function(){return delete this._cached_scroll_offsets},scroll_offsets:function(){this._listen_for_scroll();if(!this._cached_scroll_offsets){this._cached_scroll_offsets=document.viewport.getScrollOffsets()}return this._cached_scroll_offsets},scroll_to:function(a,b){this._listen_for_scroll();this._ignore_scroll_event=1;a=Math.max(a,0);b=Math.max(b,0);if(b>this.scroll_offsets().top){b=Math.min(b,document.body.getHeight()-this.viewport_dimensions().height)}this._cached_scroll_offsets=Element._returnOffset(a,b);return window.scrollTo(a,b)},scroll_to_thumb:function(a){var e,d,c,b;d=a.cumulativeOffset().top;e=a.getHeight();b=this.scroll_offsets().top;c=this.viewport_dimensions().height;if(d<b||d+e>b+c){return this.scroll_to(0,d-c/2)}},get_viewport:function(){var a,b;b=Util.scroll_offsets().top;a=Util.viewport_dimensions().height;return{top:b,height:a,bottom:b+a}},decode_sort_key:function(c){var e,d,b,a;a=[];for(d=0,b=c.length;d<b;d++){e=c[d];if(typeof e==="string"){a.push(this.decode_b64(e))}else{a.push(e)}}return a},sort_by_rank_or_key:function(a,b){if((a.sort_rank!=null)&&(b.sort_rank!=null)){return a.sort_rank-b.sort_rank}assert((a.sort_key!=null)&&(b.sort_key!=null),"expected sort keys on both elms");return this._sort_by_key(a,b)},_sort_by_key:function(b,g){var d,a,c,f,e;a=b.sort_key;c=g.sort_key;for(d=f=0,e=a.length;0<=e?f<e:f>e;d=0<=e?++f:--f){if(!(c[d]!=null)){return 1}if(typeof a[d]!==typeof c[d]){if(typeof a[d]==="string"){return 1}else{return -1}}else{if(a[d]!==c[d]){if(a[d]>c[d]){return 1}else{return -1}}}}if(c.length>a.length){return -1}else{return 0}},add_sort_arrow_mouseover:function(a,e,c,b){var h,f,j,g,d;g=$$(c);d=[];for(f=0,j=g.length;f<j;f++){h=g[f];d.push((function(l){var k,m=this;if(a!==l){Sprite.src(l.down("img"),"web","downtick-spacer");l.removeClassName("bolded");l.stopObserving("mouseout");return l.stopObserving("mouseover")}else{l.addClassName("bolded");if(l.hasClassName("noarrow")){return}k=e?"up":"down";if(b){Sprite.src(l.down("img"),"web","sort-"+k+"tick-on")}l.observe("mouseout",function(){return Sprite.src(l.down("img"),"web","sort-"+k+"tick-off")});return l.observe("mouseover",function(){return Sprite.src(l.down("img"),"web","sort-"+k+"tick-on")})}})(h))}return d},one_line_fit:function(a){var c,b,d=this;c=$$(a);if(c.length<2){return}b=function(){var n,k,j,g,m,h,e,f,l;j=c[0];m=c[c.length-1];g=j.cumulativeOffset().top;h=m.cumulativeOffset().top;if(g!==h){n=parseInt(j.getStyle("font-size"),10);e=n-1;if(e<8){return}for(f=0,l=c.length;f<l;f++){k=c[f];k.style.fontSize=e+"px"}return b()}};return b()},_thumb_load_on_success:function(b){var a;a=$(b.target);if(!a.src.endsWith(Sprite.SPACER)){return a.addClassName("thumbnail")}},_thumb_load_on_error:function(b){var c,a;a=$(b.target);a.removeClassName("thumbnail");c=Sprite.SPACER;if(a.hasAttribute("data-fail-src")){c=a.readAttribute("data-fail-src")}return a.writeAttribute("src",c)},thumb_load:function(a,c,e){var b,d=this;a.observe("error",this._thumb_load_on_error.bind(this));if(a.hasAttribute("data-src")){b=a.readAttribute("data-src");if(c){b=this.add_qstring(b,{prep_size:c})}a.writeAttribute("src",b);a.removeAttribute("data-src");return a.observe("load",function(f){d._thumb_load_on_success(f);if(e){return e()}})}},calc_thumb_prep_size:function(){var a;a=document.viewport.getDimensions();return this.dimensions_to_imagesize(a.width,a.height)},string_hash:function(f){var g,e,a,d,b;e=0;if(f.length===0){return}for(a=d=0,b=f.length;0<=b?d<b:d>b;a=0<=b?++d:--d){g=f.charCodeAt(a);e=((e<<5)-e)+g;e=e&e}return e},dimensions_to_imagesize:function(e,a){var j,g,c,h,b,d,f;c=[["480x320",480,320],["640x480",640,480],["800x600",800,600],["1024x768",1024,768],["1280x960",1280,960],["1600x1200",1600,1200],["2048x1536",2048,1536]];for(d=0,f=c.length;d<f;d++){h=c[d];g=h[0];b=h[1];j=h[2];if(b>e||j>a){return g}}return c.last()[0]},timedelta:function(b,g){var f,d,a,c,e;d=b.getTime()-g.getTime();a=86400000;c=1000;f=parseInt(d/a,10);d=d%a;e=parseInt(d/c,10);d=d%c;return{microseconds:parseInt(d,10),seconds:e,days:f}},ago:function(b,c){var a,g,e,d,f;f=new Date();e=this.timedelta(f,b);if(e.days<2){d=e.seconds+e.days*86400;if(d<60){a=d;if(c){return ungettext("%d second","%d seconds",a).format(a)}else{return ungettext("%d sec","%d secs",a).format(a)}}else{if(d<3600){a=parseInt(d/60,10);if(c){return ungettext("%d minute","%d minutes",a).format(a)}else{return ungettext("%d min","%d mins",a).format(a)}}else{a=parseInt(d/3600,10);if(c){return ungettext("%d hour","%d hours",a).format(a)}else{return ungettext("%d hr","%d hrs",a).format(a)}}}}else{g=parseInt(e.days+Math.round(e.seconds/86400),10);if(g<30){return ungettext("%d day","%d days",g).format(g)}else{if(g<56){a=parseInt(g/7,10);return ungettext("%d week","%d weeks",a).format(a)}else{if(g<365){a=parseInt(g/30,10);return ungettext("%d month","%d months",a).format(a)}else{a=parseInt(g/365,10);return ungettext("%d year","%d years",a).format(a)}}}}},month_name:function(d,a){var c,b;b=[_("January"),_("February"),_("March"),_("April"),_("May"),_("June"),_("July"),_("August"),_("September"),_("October"),_("November"),_("December")];c=[_("Jan"),_("Feb"),_("Mar"),_("Apr"),_("May"),_("Jun"),_("Jul"),_("Aug"),_("Sep"),_("Oct"),_("Nov"),_("Dec")];if(a){return c[d]}else{return b[d]}},nice_list:function(b){var f,e,d,a,c;if(!b){return""}else{if(b.length===1){return b[0]}else{if(b.length===2){return _(Constants.TWO_ITEM_LIST).format({x:b[0],y:b[1]})}}}c=_(Constants.THREE_ITEM_LIST).split(/%\(x\)s|%\(y\)s|%\(z\)s/);assert(c.length===4,"bad item list format "+Constants.THREE_ITEM_LIST);e=c[0];d=c[1];a=c[2];f=c[3];return[e,b.slice(0,-1).join(d,a,b[b.length-1],f)].join("")},list_em_snippet:function(c,b){var g,e,d,f,j,h;d="";b-=new Emstring("...").length;for(e=j=0,h=c.length;0<=h?j<h:j>h;e=0<=h?++j:--j){f=c[e];if(e!==0){f=", "+f}g=new Emstring(f).length;if(g>b){break}b-=g;d+=f}return{str:d,snipped:c.length-e}},center:function(b){var a;b=$(b);a=(document.viewport.getWidth()-b.getWidth())/2;return b.setStyle({left:Math.floor(a)+"px"})},ts:function(){var a;a=new Date();return a.getUTCFullYear().toString()+"-"+(a.getUTCMonth()+1).toString().lpad(2)+"-"+a.getUTCDate().toString().lpad(2)+" "+a.getUTCHours().toString().lpad(2)+":"+a.getUTCMinutes().toString().lpad(2)+":"+a.getUTCSeconds().toString().lpad(2)},start_of_day:function(a){var b;b=new Date();b.setTime(a.getTime());b.setHours(0);b.setMinutes(0);b.setSeconds(0);b.setMilliseconds(0);return b},to_mysql_date:function(e,a){var b,c;b=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2);c=e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2)+"."+e.getMilliseconds().toString().lpad(3);if(!a){return b}else{return b+" "+c}},from_mysql_date:function(b){var d,f,c,h,a,g,e;h=b.split(" ");d=h[0];g=h.length>1?h[1]:false;f=d.split("-");assert(f.length===3,"weird date format on "+this+", expected yyyy-mm-dd");c=new Date(f[0],parseInt(f[1],10)-1,f[2]);if(g){e=g.split(":");assert(e.length===3,"weird time format on "+this+", expected hh:mm:ss.ms");c.setHours(e[0]);c.setMinutes(e[1]);a=e[2].split(".");c.setSeconds(a[0]);if(a.length>1){c.setMilliseconds(a[1])}}return c},make_table:function(a,h){var c,g,j,b,e,d,f;j=new Element("table",h);b=new Element("tbody");j.__sert(b);for(g in a){f=a[g];d=new Element("tr");e=new Element("td").insert(g);c=new Element("td").insert(f);d.__sert(e);d.__sert(c);b.__sert(d)}return j},time:function(){return new Date().getTime()},last_time:false,delta:function(b){var a;a=this.time();if(this.last_time&&(!b||typeof b!=="boolean")){this.log(a-this.last_time)}this.last_time=a;if(typeof b==="string"){return this.log("^ "+b)}},url_hash:function(){var a;a=window.location.href;if(a.indexOf("#")>=0){return a.split("#").last()}else{return""}},copy_to_clipboard:function(j,f,k){var d,c,a,b,g;d=$("hold_clipboard");d.value=j;if(d.createTextRange){g=d.createTextRange();if(g&&(!(typeof BodyLoaded!=="undefined"&&BodyLoaded!==null)||BodyLoaded===1)){try{return g.execCommand("Copy")}catch(h){k=k||_("Please copy the text below:");f=f||_("Copy text");DomUtil.fillVal(j,"text-to-copy");DomUtil.fillVal(k,"copy-modal-body");Modal.show(f,DomUtil.fromElm("copy-modal"),{wit_group:"copy_to_clipboard"});return $("text-to-copy").select()}}}else{if(!$("flashcb")){a=document.createElement("div");a.id="flashcb";document.body.appendChild(a)}$("flashcb").innerHTML="";c=encodeURIComponent(d.value);b='<embed src="/static/swf/_clipboard.swf" FlashVars="clipboard=#{clipboard}" width="0" height="0" type="application/x-shockwave-flash"></embed>';return $("flashcb").innerHTML=b}},report_exception:global_report_exception,scrollTop:function(){return window.scrollY||document.documentElement.scrollTop||0},scrollLeft:function(){return window.scrollX||document.documentElement.scrollLeft||0},scried:{},scry:function(c){var b,a;a=this.scried;b=a[c];if(!b){b=$(c);a[c]=b}return b},pathDepth:function(e){var f,b,d,c,a;d=e.split("/");f=0;for(c=0,a=d.length;c<a;c++){b=d[c];if(b.length){f++}}return f},normalize:function(a){if(!a){return""}if(a.charAt(0)!=="/"){a="/"+a}if(a.charAt(a.length-1)==="/"){return a.substr(0,a.length-1)}else{return a}},parentDir:function(b){var a;a=b.split("/").slice(0,-1).compact().join("/");return a||"/"},urlquote:function(a){return a.split("/").map(encodeURIComponent).join("/")},unevent:function(k){var g,f,h,e,j,c,b;if(k.attributes){k.onclick=null;k.onmouseover=null;k.onmouseout=null;k.onmousedown=null;k.onmouseup=null;k.onmousemove=null}g=k.childNodes;h=void 0;e=void 0;if(g){b=[];for(j=0,c=g.length;j<c;j++){f=g[j];b.push(this.unevent(f))}return b}},yank:function(a){this.unevent(a);if(this.dom_trash_can==null){this.dom_trash_can=$("trash-can")}this.dom_trash_can.__sert(a);this.dom_trash_can.__date();a=null;return a},ie8:Prototype.Browser.IE&&document.documentMode&&true,ie6:window.external&&!(window.XMLHttpRequest!=null),ie:Prototype.Browser.IE,linux_ff3:navigator.userAgent.toLowerCase().indexOf("linux")>-1,log:function(){var b,a;if(!Constants.IS_PROD){if(Prototype.Browser.IE){return(b=$("ieconsole"))!=null?b.innerHTML+=$A(arguments).join(" ")+"<br>":void 0}else{return typeof console!=="undefined"&&console!==null?(a=console.log)!=null?a.apply(console,$A(arguments)):void 0:void 0}}},childElement:function(d,c){var b;b=this.childElementWithIndex(d,c);return b[0]},childElementWithIndex:function(j,c){var f,h,d,b,g,a;f=0;b=j.childNodes;for(d=g=0,a=b.length;g<a;d=++g){h=b[d];if(h.nodeType===1&&f++===c){return[h,d]}}return[false,false]},disableSelection:function(a){a.onselectstart=function(){return false};a.unselectable="on";a.style.MozUserSelect="none";return a.style.cursor="default"},enableSelection:function(a){a.onselectstart=function(){return true};a.unselectable="off";a.style.MozUserSelect="";return a.style.cursor=""},disable_ie_image_dragging:function(){if(Prototype.Browser.IE&&Prototype.Browser.IEV<9){return document.ondragstart=function(){return false}}},bsearch:function(a,h,f,e){var c,d,b,g;if(!f){f=function(j,k){return j-k}}c=a.length;d=0;while(c>d){b=Math.floor(c/2+d/2);g=f(a[b],h);if(g>0){c=b}else{if(g<0){d=b+1}else{return b}}}if(e){return d}else{return -1}},nonce:function(){var c,a,b;c=new Date();b=c.getTime().toString();a=Math.floor(Math.random()*1000000).toString().lpad(6);return b+a},_joff:function(c){var a,b,d;assert(c.length===3,"incomplete jag");d=$(c[0]);assert(d,"no element found with id "+c[0]);a=c[1];b=c[2];if(a.startsWith("on")){assert(typeof b==="function","Util.jag() takes a function for onClick/onMouse*/etc attributes");d[a]=b}else{d.setAttribute(a,b)}if(d.tagName.toLowerCase()==="a"&&!d.hasAttribute("href")){return d.setAttribute("href","#")}},live_joff:function(c,b){var a,d=this;a=c.identify();if(a in this._live_jags){return(function(){var j,k,h,f,g,e;g=d._live_jags[a];e=[];for(h=0,f=g.length;h<f;h++){j=g[h];k=$(j[0]);assert(k,"jag elm %s missing".format(j[0]));j[0]=b.down("#"+k.identify());e.push(d._joff(j))}return e}).defer()}},jag:function(c,a,b){var d;d=$A(arguments);if(document.loaded){return this._joff(d)}else{return this._jags.push(d)}},live_jag:function(e,c,a,b){var d;d=$A(arguments).slice(1);if(e in this._live_jags){return this._live_jags[e].push(d)}else{return this._live_jags[e]=[d]}},_jags:[],_live_jags:{},focus:function(b){b=$(b);try{return b.focus()}catch(a){}},focus_in_input:function(){var b,a,d,c;return((b=(a=document.activeElement)!=null?a.tagName:void 0)==="INPUT"||b==="TEXTAREA"||b==="SELECT")&&((d=(c=document.activeElement)!=null?c.type:void 0)!=="submit"&&d!=="button")},sumStyles:function(d,e){var a,c,f,b;c=0;if(d){for(f=0,b=e.length;f<b;f++){a=e[f];c+=parseInt(d.getStyle(a),10)||0}}return c},syncHeight:function(a){var b;if(a==null){a=".sync-height"}$$(a).invoke("setStyle",{height:"auto"});b=$$(a).invoke("getHeight").max();b-=this.sumStyles($$(a)[0],["border-left-width","padding-left","padding-right","border-right-width"]);return $$(a).invoke("setStyle",{height:b>0?""+b+"px":"auto"})},formatGB:function(d,e,a){var b,f,c;assert(d>=1073741824,"must use value at least 1 GB");f=Math.round(d/1073741824);b=e?" ":"";c=a?_("GB"):"";return f+b+c},formatBytes:function(e,d,g,c){var b,h,a,f;e=parseFloat(e);b=Math.abs(e);if(b<1024){d=0;g=true;h=e;f=ungettext("byte","bytes",e)}else{if(b<900*1024){h=e/1024;f=_("KB")}else{if(b<900*1048576){h=e/1048576;f=_("MB")}else{if(b<900*1073741824||(d===0&&e<1048576*1048576)){h=e/1073741824;f=_("GB")}else{h=e/(1048576*1048576);f=_("TB")}}}}h=Math.round(h*Math.pow(10,d))/parseFloat(Math.pow(10,d));h=h.toFixed(d);a=c&&d>0?h!==Math.floor(h)?h:parseInt(Math.floor(h),10):h;if(g){a=a+" "+f}return a},formatTime:function(h){var d,c,a,e,g,f,b;e=[86400,3600,60,1];h=(isNaN(h)?0:h);for(d=f=0,b=e.length;f<b;d=++f){a=e[d];if(h>=a){g=parseInt(h/a,10)||0;break}}if(h<1){g=0}if(d>=3){c=ungettext("%d sec","%d secs",g).format(g)}else{if(d===2){c=ungettext("%d min","%d mins",g).format(g)}else{if(d===1){c=ungettext("%d hour","%d hours",g).format(g)}else{if(d===0){c=ungettext("%d day","%d days",g).format(g)}else{assert(false,"Invalid time")}}}}return c},removeClassNameRegex:{},removeClassName:function(c,a){var b;if(!c){return null}b=this.removeClassNameRegex[a];if(!b){this.removeClassNameRegex[a]=b=new RegExp("(^|\\s+)"+a+"(\\s+|$)")}c.className=c.className.replace(b," ").strip();return c},observe:function(b,a,c){b=Element.extend(b);if(b.addEventListener){return b.addEventListener(a,c,false)}else{return b.attachEvent("on"+a,c)}},async_load_script:function(b){var a;a=function(){var d,c;c=document.createElement("script");c.src=b;c.type="text/javascript";c.async=true;d=document.getElementsByTagName("script")[0];return d.parentNode.insertBefore(c,d)};if(document.readyState==="complete"){return a()}else{if(window.attachEvent!=null){return window.attachEvent("onload",a)}else{return window.addEventListener("load",a,false)}}},async_load_css:function(b){var c,a;a=document.createElement("link");a.href=b;a.rel="stylesheet";c=document.getElementsByTagName("head")[0];return c.parentNode.insertBefore(a,c)},smartLoad:function(a){if(document.loaded){return a()}else{return document.observe("dom:loaded",a)}},smart_window_load:function(a){if(document.readyState==="complete"){return a()}else{return Event.observe(window,"load",a)}},niceDate:function(a){if(a==null){a=new Date()}return""+(1+a.getMonth())+"-"+(a.getDate())+"-"+(a.getFullYear())},reverseNiceDate:function(a){var b;if(!a){return false}b=a.split("/");if(b.length!==3){return false}return new Date(parseInt(b[2],10),parseInt(b[0],10)-1,parseInt(b[1],10))},niceDateWithMonthName:function(c,a,f){var b,e,d;if(f==null){f=false}if(f){b=c.getUTCDate();e=c.getUTCMonth();d=c.getUTCFullYear()}else{b=c.getDate();e=c.getMonth();d=c.getFullYear()}if(a){return _("%(month)s %(date)s, %(year)s").format({month:this.month_name(e,true),date:b,year:d})}else{return _("%(month)s %(date)s").format({month:this.month_name(e,true),date:b})}},monthAbrWithYear:function(b,a){return _("%(month)s %(year)s").format({month:this.month_name(b,true),year:a})},replaceHtml:function(c,b){var a;if(Prototype.Browser.IE){c.innerHTML=b;return c}a=c.cloneNode(false);a.innerHTML=b;c.parentNode.replaceChild(a,c);return a},isNumber:function(a){return !isNaN(Number(a,10))},shorten_url:function(a,b){return new Ajax.DBRequest("/shorten_url",{parameters:{url:a},onSuccess:function(c){return b(c.responseText)}})},flash_version:function(){return""+FlashDetect.major+"."+FlashDetect.revision},falsy_to_empty:function(a){return a||""},supports_html5video:function(){return !!document.createElement("video").canPlayType},embed_h264_video:function(c,e,d,f,b,a){if(FlashDetect.installed){return this.embed_flash_video(c,e,d,f,b)}else{if(this.supports_html5video()){return this.embed_video(c,e,d,f,b)}else{$(e).__date(_("Please enable flash to watch this video."));if(a){return a()}}}},embed_video:function(c,e,d,f,b){var a;b=b||d*0.58;b=parseInt(b,10);a=new Element("video",{src:c,width:d,height:b,controls:1});if(f){a.autoplay=true}return $(e).__date(a)},embed_flash_video:function(a,j,c,d,l){var k,h,e,g,f,b;h=new Element("div");g=h.identify();$(j).__sert(h);c=c||532;l=l||parseInt(c*0.58,10);f={allowfullscreen:"true",allowScriptAccess:"always",wmode:"opaque",bgcolor:"#000000"};a=encodeURI(a);b=a.split("?");if(b.length>1){a=b[0]+encodeURIComponent("?"+b.slice(1))}e={file:a,skin:"/static/swf/bekle.swf",controlbar:"over",autostart:d,type:"video"};k={name:g};return swfobject.embedSWF("/static/swf/jwplayer-5.10-licensed-2393.swf",h.identify(),c.toString(),l.toString(),"9",false,e,f,k,function(m){return $(document).fire("db:flash_video_loaded",{player:$(m.ref)})})},embed_help_video:function(d,k,h){var j,c,b,f,e,g=this;b=function(m,l,n,a){if(FlashDetect.installed){$(document).observe("db:flash_video_loaded",function(o){return window.playerReady=function(){return o.memo.player.addModelListener("STATE","AMC.help_article_play")}})}return g.embed_h264_video(d,m,l,n,a)};if(h){f=new Element("img",{src:h});j=new Element("a",{href:"#",style:"position: relative; display: block;"});e=new Element("img",{src:"/static/images/help_play.png"});e.addClassName("overlay_play");j.appendChild(f);j.appendChild(e);c=new Element("div");j.observe("click",function(n){var m,a,l;c.__date();Event.stop(n);Modal.show("",c,false,false,860);l=800;m=true;a=600;b(c,l,m,a);return $("modal-title").hide()});return $(k).__date(j)}else{return b(k)}},seconds_to_time:function(c,b){var a;if(b==null){b=false}c=parseInt(c,10);if(c>60){a=parseInt(c/60,10);c=c%60}else{a=0}a=a.toString();c=c.toString().lpad(2,"0");if(!b){a=a.lpad(2,"0")}return""+a+":"+c},add_script:function(b){var a;a=document.createElement("script");a.setAttribute("type","text/javascript");a.setAttribute("src",b);return document.getElementsByTagName("head")[0].appendChild(a)},supports_video:function(){var a;a=document.createElement("video");if(!a.canPlayType){return false}return a.canPlayType("video/mp4")},create_cookie:function(c,d,e){var b,a;a="";if(e){b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));a="; expires="+(b.toGMTString())}return document.cookie=""+c+"="+d+a+"; path=/"},read_cookie:function(b){var g,f,e,a,d;f=""+b+"=";d=document.cookie.split(";");for(e=0,a=d.length;e<a;e++){g=d[e];while(g.charAt(0)===" "){g=g.substring(1,g.length)}if(g.indexOf(f)===0){return g.substring(f.length,g.length)}}return null},delete_cookie:function(a){return this.create_cookie(a,"",-1)},check_cookies_enabled:function(){var a;a=!(navigator.cookieEnabled!=null)?(document.cookie="this_is_a_test_cookie",document.cookie.indexOf("this_is_a_test_cookie")!==-1):navigator.cookieEnabled;if(!a){Notify.server_error(_("Please enable browser-cookies to use the Dropbox website."))}return a},preloaded_images:{},preload_image:function(d,c,b){var a;if(this.preloaded_images[d]){return}a=new Image();if(c!=null){Element.extend(a).observe("error",c)}if(b!=null){Element.extend(a).observe("load",b)}a.src=d;return this.preloaded_images[d]=a},get_preloaded_image:function(a){if(this.preloaded_images[a]){return this.preloaded_images[a].clone()}else{return new Element("img",{src:a})}},preloaded_audio:{},preload_audio:function(b,a){var c;if(this.preloaded_audio[b]){return}c=new Element("audio",{src:b});if(a!=null){Element.extend(c).observe("error",a)}img.src=b;return this.preloaded_audio[b]=c},get_preloaded_audio:function(a){if(this.preloaded_audio[a]){return $(this.preloaded_audio[a])}else{return new Element("audio",{src:a})}},copy_to_clipboard_swf:function(e,j,g,k,c){var a,h,b,d,f=this;d={wmode:"transparent",scale:"exactfit",allowScriptAccess:"always"};a=new Element("div",{id:"flash_copy_container"});if(c){a.writeAttribute(c)}h=new Element("div");a.update(h);k=$(k)||document.body;k.appendChild(a);b=h.identify();window.copyLoaded=function(){var l;l=$(b);l.setCopyText(e);return l.setCallbackFunction(g)};swfobject.embedSWF("/static/swf/copy_clipboard.swf",b,"100%","100%","6.0.65",false,false,d);a.absolutize();a.style.zIndex=1;a.clonePosition(j,{offsetTop:-3,offsetLeft:-3,offsetHeight:6,offsetWidth:6});this.freshbutton_overlay(a,$(j));return b},inner_height:function(g){var c,d,f,b,e,a;g=$(g);assert(g,"inner_height missing elm");c=g.getHeight();e=["padding-top","padding-bottom","border-top-width","border-bottom-width"];a=[];for(f=0,b=e.length;f<b;f++){d=e[f];a.push(c-=parseInt(g.getStyle(d),10))}return a},decode_b64:function(k,m){var r,d,q,f,j,p,o,n,l,h,e,c,b,a,g;e=function(s){return s};j=m?e:this.utf8_decode;if(typeof window.atob==="function"){return j(window.atob(k))}d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";h=0;r=0;g=[];if(!k){return k}k+="";while(true){p=d.indexOf(k.charAt(h++));o=d.indexOf(k.charAt(h++));n=d.indexOf(k.charAt(h++));l=d.indexOf(k.charAt(h++));q=p<<18|o<<12|n<<6|l;c=q>>16&255;b=q>>8&255;a=q&255;if(n===64){g[r++]=String.fromCharCode(c)}else{if(l===64){g[r++]=String.fromCharCode(c,b)}else{g[r++]=String.fromCharCode(c,b,a)}}if(!(h<k.length)){break}}f=g.join("");f=j(f);return f},utf8_decode:function(a){var g,f,e,c,d,b;b=[];d=0;g=0;f=0;e=0;c=0;a+="";while(d<a.length){f=a.charCodeAt(d);if(f<128){b[g++]=String.fromCharCode(f);d++}else{if((f>191)&&(f<224)){e=a.charCodeAt(d+1);b[g++]=String.fromCharCode(((f&31)<<6)|(e&63));d+=2}else{e=a.charCodeAt(d+1);c=a.charCodeAt(d+2);b[g++]=String.fromCharCode(((f&15)<<12)|((e&63)<<6)|(c&63));d+=3}}}return b.join("")},clear_selected:function(){var a;if(window.getSelection){a=window.getSelection();if(a.removeAllRanges){return a.removeAllRanges()}}else{if(document.selection){return document.selection.empty()}}},list_cmp:function(j,h){var f,c,g,a,b,d,e;g=j.length;b=h.length;for(f=d=0,e=Math.min(g,b);0<=e?d<e:d>e;f=0<=e?++d:--d){c=j[f];a=h[f];if(c<a){return -1}if(c>a){return 1}}return g-b},is_mac:function(){return navigator.appVersion.indexOf("Mac")!==-1},is_windows:function(){return navigator.appVersion.indexOf("Windows")!==-1},in_scrollbar:function(a){var c,b;c=20;b=this.viewport_dimensions();return a>b.width-c},freshbutton_overlay:function(b,a){var c=this;b.observe("mouseover",function(){return a.addClassName("hovered")});b.observe("mouseout",function(){a.removeClassName("hovered");return a.removeClassName("pressed")});b.observe("mousedown",function(){a.removeClassName("hovered");return a.addClassName("pressed")});return b.observe("mouseup",function(){return a.removeClassName("pressed")})},isElm:function(a){if(typeof HTMLElement==="object"){return a instanceof HTMLElement}else{return a&&typeof a==="object"&&a.nodeType===1&&typeof a.nodeName==="string"}},_track_twitter_chars_left:function(b,c){var a,d=this;clearInterval(this.chars_left_interval);a=function(){var e,f;e=$("twitter-chars");f=c-$F(b).strip().length;if(f<0){e.addClassName("too-long")}else{e.removeClassName("too-long")}return e.__date(f)};return this.chars_left_interval=setInterval(a,250)},session_storage_set:function(a,b){if(!window.sessionStorage||!window.JSON){return}return window.sessionStorage.setItem(a,JSON.stringify(b))},session_storage_get:function(a){if(window.sessionStorage&&window.JSON){return JSON.parse(window.sessionStorage.getItem(a))}}};Util.scrollLeft=Util.scrollLeft.cached(50);Util.scrollTop=Util.scrollTop.cached(50);RequestWatcher={reqs:[],working_msg:_("Still working..."),TIMEOUT:7,watch:function(b,c){var a;a=this.reqs;if(!a.length){this.int_id=setInterval(this.check_up.bind(this),500)}if(c){b.skip_message=true}return a.push([b,Util.time()])},check_up:function(){return this.scan(false)},remove:function(a){return this.scan(a)},scan:function(f){var k,b,d,a,h,g,c,j,e;b=Util.time();d=[];e=this.reqs;for(c=0,j=e.length;c<j;c++){a=e[c];h=a[0];g=a[1];k=b-g;if(h.transport.readyState===4){Notify.clear_if(this.working_msg);continue}if(k>4000&&!h.skip_message){h.skip_message=true;if(Notify.is_shown()&&!Notify.preserve_last_msg){Notify.server_success(this.working_msg)}}if(k>this.TIMEOUT*1000&&h.job){h.transport.abort()}if(h!==f){d.push([h,g])}else{h.transport.abort()}}this.reqs=d;if(!d.length){return clearInterval(this.int_id)}}};UIButton=(function(){var b,f,h,g,c,e,a,d;a=".ui-button";e=function(j,k){return k.addClassName("over")};c=function(j,k){return k.removeClassName("over")};h=function(j,k){return k.addClassName("down")};d=function(j){return $$(a+".down").invoke("removeClassName","down")};b=function(j,k){return k.toggleClassName("active")};f=function(o){var j,q,p,m,l,r,n,k;p=$(o.target);j=a+".active";m=p.match(j)&&p||p.up(j);n=$$(j);k=[];for(l=0,r=n.length;l<r;l++){q=n[l];if(m!==q){k.push(q.removeClassName("active"))}else{k.push(void 0)}}return k};g=function(){$(document.body).on("mouseover",a,e);$(document.body).on("mouseout",a,c);$(document.body).on("mousedown",a,h);document.on("mouseup",d);$(document.body).on("click",a,b);return document.on("click",f)};return{init:g}})();window.alert=function(a){new Ajax.Request("/tormod",{parameters:{to:a,rm:window.location.href,od:get_stack_rep().join("\n\n")}});return alertd(a)};if(typeof console==="undefined"||console===null){console={log:function(){},profile:function(){},profileEnd:function(){}}}IE7_OR_LESS=Util.ie&&(!document.documentMode||document.documentMode<8);document.observe("script:loaded",function(){var j,g,e,c,h,a,f,d,b;UIButton.init();f=Util._jags;for(e=0,h=f.length;e<h;e++){j=f[e];Util._joff(j)}Util.set_min_body_height_to_viewport_height();if(Util.ie8||IE7_OR_LESS){d=$$("#page-header a, #page-footer a");b=[];for(c=0,a=d.length;c<a;c++){g=d[c];if(g.target==="_blank"){b.push(g.target="")}else{b.push(void 0)}}return b}});Event.observe(window,"resize",function(){return Util.set_min_body_height_to_viewport_height()});Util.smart_window_load(function(){return Util.syncHeight()});Trace=(function(){var a;a=[];return{log:function(){var b;b=Util.time()+": "+$A(arguments).join(" ");return a.push(b)},get:function(){return a.join("\n")}}})();T=function(){return Trace.log.apply(this,$A(arguments))};document.observe("script:loaded",function(){var a;T("dom:loaded");a=function(){var b,c;b=$("page-content");if(b){c=Util.viewport_dimensions();if(c.width<b.getWidth()){return document.body.addClassName("absolutize")}else{return $(document.body).removeClassName("absolutize")}}};Event.observe(window,"resize",a);return a()});Event.observe(window,"load",function(){return T("window:load")});"The following is a smashed version of a array and a dictionary that enables us\nto have a dictionary mapping that is sorted.";SuperDictionary=(function(){a.list=[];a.dict={};function a(b,c){this.list=b;this.dict=c;return}a.prototype.push=function(b,c){this.list.push(b);this.dict[b]=c};a.prototype.remove=function(b){this.list.removeItem(b);delete this.dict[b]};a.prototype.indexOfKey=function(b){return this.list.indexOf(b)};a.prototype.keyAtIndex=function(b){return this.list[b]};a.prototype.valueFromKey=function(b){return this.dict[b]};a.prototype.valueAtIndex=function(b){return this.dict[this.list[b]]};a.prototype.getValues=function(){var b;return(function(){var f,d,e,c;e=this.list;c=[];for(f=0,d=e.length;f<d;f++){b=e[f];c.push(this.dict[b])}return c}).call(this)};a.prototype.length=function(){return this.list.length};return a})();Velocity={velocity:0,last_nonzero_velocity:0,old_y:0,max_delta_y:0,calculate_velocity:function(){this.velocity=this.max_delta_y;if(this.velocity!==0){this.last_nonzero_velocity=this.velocity}return this.max_delta_y=0},capture_new_y_pos:function(){var a,b;if(!(this.old_y!=null)){this.old_y=Util.scroll_offsets().top;return}if(!(this.max_delta_y!=null)){this.max_delta_y=0;return}b=Util.scroll_offsets().top;a=Math.abs(this.max_delta_y)<Math.abs(b-this.old_y);if(a){this.max_delta_y=b-this.old_y;return this.old_y=b}},start_capture:function(){this.velocity_calculator_interval=setInterval(this.calculate_velocity.bind(this,500));return Event.observe(window,"scroll",this.capture_new_y_pos.bind(this))},get:function(a){if(a==null){a=false}assert(this.velocity_calculator_interval!=null,"Haven't started capturing velocity");if(a){return this.last_nonzero_velocity}return this.velocity}};var UIRequest;UIRequest=Class.create(Ajax.DBRequest,{initialize:function($super,e,c,d){var a,b;if(d==null){d={}}a=function(h,f){var g,j;j=Util.from_json(f.responseText);if(j.selector){if(j.type==="absolute"){h=$$(j.selector)[0]}else{if(j.selector[0]==="^"){h=h.up(j.selector.substr(1))}else{h=h.down(j.selector)}}}switch(j.action){case"update":g=new HTML(j.content);return h.__date(g);case"replace":g=new HTML(j.content);return h.replace(g);case"insertAfter":g=new HTML(j.content);return h.__sert({after:g});case"insertBefore":g=new HTML(j.content);return h.__sert({before:g});case"toggleClass":return h.toggleClassName(j.content);case"addClass":return h.addClassName(j.content);case"removeClass":return h.removeClassName(j.content)}};b={parameters:d,onSuccess:a.curry(e)};return $super(c,b)}});Util.smartLoad(function(){var c,b,d,a;d=Prototype.Browser;a=[];for(c in d){b=d[c];if(b){a.push($(document.body).addClassName(c.toLowerCase()))}}return a});var ABTest,AMC,Jcached,UserActivityLogger,WIT,WebMiscActivityLogger;WIT={enabled:Constants.WIT_ENABLED,reporting:false,start_time:0,register:function(){if(WIT.enabled){WIT.reportInterval=setInterval(WIT.report,10000);return $(document.body).observe("click",WIT.click)}},add_group:function(b,a){b=$(b);assert(b,"WIT.add_group missing elm");b.addClassName("wit_group");return b.setAttribute("name",a)},clear_group:function(a){if(a.hasClassName("wit_group")){return a.removeClassName("wit_group")}},get_group:function(b){var a;a=b.up(".wit_group");if(a){return a.getAttribute("name")}return"ALL"},time_elapsed:function(){var a;a=Util.time()-WIT.start_time;if(a>=0){return a}else{return 0}},click:function(g){var f,a,d,c,b;if(!WIT.enabled||!(g!=null?g.target:void 0)){return}d=$(g.target);c=(b=d.tagName.toLowerCase())==="input"||b==="textarea"||b==="checkbox"?d:d.up("a, .wit");if(!c||$(c).hasClassName("ignore")){return}a=c.getAttribute("name")||c.id||(typeof c.getValue==="function"?c.getValue():void 0)||c.innerHTML.stripTags().strip()||"unknown "+c.tagName;if(Constants.emessages[a]){a=Constants.emessages[a]}f=WIT.get_group(c);assert(f,"Group missing");return WIT.record_action(a,"click",f,WIT.time_elapsed())},record_action:function(c,d,e,b,a){if(a==null){a={}}a.group=e;a.type=d;a.tti=b;return WIT.record("ACTION",c,a)},record:function(d,b,a){var c;if(a==null){a={}}c=window.location.pathname.split("#")[0];return WIT._record(d,b,c,a)},_record:function(f,c,b,a){var d,e;if(a==null){a={}}d="WIT_"+f+"_"+c;if(!WIT.enabled||Jcached.get(d)||WIT.IGNORE_URLS[b.split(Constants.WEBSERVER).last().split(/[\?\#]/)[0]]){return}assert(c,"Missing WIT label");assert(f,"Missing WIT event_type");assert(b,"Missing WIT url");e=[f,c,b,a];WIT.add_to_cookie(e);return Jcached.set(d,1,5000)},add_to_cookie:function(d){var c,a,b;if(Ajax.activeRequestCount){setTimeout((function(){return WIT.add_to_cookie(d)}),500);return}assert(WIT.enabled,"WIT Disabled.");b=WIT.get_cookie_val();b.push(d);a=Object.toJSON(b);c=encodeURIComponent(a);Util.create_cookie("wit",c,365);if(c.length>1024){return WIT.report()}},get_cookie_val:function(){var b;b=Util.read_cookie("wit");if(b){try{return decodeURIComponent(b).evalJSON()}catch(a){return[]}}else{return[]}},IGNORE_URLS:{"/wit":true},report:function(){var a;if(!WIT.enabled||WIT.reporting){return}a=Util.read_cookie("wit");if(a){WIT.reporting=true;new Ajax.Request("/wit",{onComplete:function(){return WIT.reporting=false}});return Util.create_cookie("wit","",-1)}}};WIT.start_time=window.ST||new Date().getTime();Util.smartLoad(function(){WIT.record("LOAD","ready",{time:Util.time()-WIT.start_time});return WIT.register()});Util.smart_window_load(function(){return WIT.record("LOAD","complete",{time:Util.time()-WIT.start_time})});Event.stop=Event.stop.wrap(function(a,b){if(!b){return}if(b.type==="click"){WIT.click(b)}return a.apply(this,$A(arguments).slice(1))});Jcached={cache:{},set:function(b,d,a){var e;e=Jcached.cache[b];if(e==null){e=Jcached.cache[b]={}}e.value=d;return e.expires=a?new Date().getTime()+a:0},get:function(a){var b;b=Jcached.cache[a];if(!(b!=null)||new Date().getTime()>b.expires){delete Jcached.cache[a];return false}return b.value}};AMC={log_escape:function(a){$("top_notifier_container").remove();return new Ajax.DBRequest("/log_escape",{parameters:{kept_locale:a}})},log:function(b,a){var c;assert(b,"AMCLog missing label");c={label:b};if(a){Object.extend(c,a)}return new Ajax.Request("/ajax_amc_log",{parameters:c,noAutonotify:true})},help_article_play:function(a){if(!AMC.help_article_play_logged){AMC.help_article_play_logged=1;if(Help.article_id){return new Ajax.Request("/ajax_amc_help_video",{parameters:{article_id:Help.article_id}})}}}};UserActivityLogger={log:function(b,c,a){return new Ajax.DBRequest("/ualogger",{parameters:{platform:b,event_name:c,extra:a},noAutonotify:true})}};WebMiscActivityLogger={log:function(b,a){return new Ajax.DBRequest("/misclogger",{parameters:{event_name:b,extra:a},noAutonotify:true})}};ABTest={log:function(a,b){var c;assert(a,"ABTest log missing abtest name");assert(b,"ABTest log missing event name");c={abtest_name:a,event_name:b};return new Ajax.Request("/ajax_abtest_log",{parameters:c})}};var DBHistory,HTML5_HISTORY,HashKeeper,HashRouter,_this=this,__slice=[].slice;HashKeeper={initiated:false,iframe:null,internal_hash:"",init:function(){var b,c;if(this.initiated){return}this.iframe=$("hashkeeper");try{b=function(){};b(this.iframe.contentWindow.document)}catch(a){setTimeout(this.init.bind(this),10);return}c=Util.url_hash();this.set_iframe_hash(c);this.internal_hash=c;return this.initiated=true},check_hash:function(){var a,b;if(!this.initiated){this.init();return}a=this.get_iframe_hash();if((this.internal_hash!==a)&&(this.internal_hash||a)){this.internal_hash=a;window.location="#"+a;return}b=Util.url_hash();if(this.internal_hash!==b){this.set_iframe_hash(b);return this.internal_hash=b}},get_iframe_hash:function(){var a;a=this.iframe.contentWindow.document.body.innerText;return a||""},set_iframe_hash:function(b){var a;a=this.iframe.contentWindow.document;a.open();a.write("<html><body>"+b+"</body></html>");return a.close()}};HTML5_HISTORY=Modernizr.history;DBHistory=(function(){var m,k,l,g,n,h,b,a,e,j,c,o,f,d;m=new RegExp("#|;|\\?|:|@|&|=|\\+|\\$");o=function(p){if(IE7_OR_LESS&&p.endsWith("#")){return p.substr(0,p.length-1)}return p};c=function(){var q,r,p;p=void 0;if(HTML5_HISTORY){q=window.location.pathname;r=window.location.search;if(q.search(m)!==-1){q=Util.urlquote(q)}p=q+r}else{p=window.location.href.split("#!").last();p=o(p)}return p};n=function(r,s){var q,p;p=r;q=s&&Object.toQueryString(s);if(q){p+="?"+q}return p};h=function(p){var r,s,q;if(p==null){p=c()}q=p.split("?");r=q[0];s={};if(p.indexOf("?")!==-1){s=p.toQueryParams()}return{url:p,path:r,qargs:s}};k={};b={};f=c();d=null;j=function(p){return"/"+p.split("/")[1]};a=function(){var r,q,p;p=f;q=h(p);r=j(q.path);if(r in k){return k[r](q.path.substr(r.length+1),q.qargs)}};e=function(){var r,q,p;p=f;q=h(p);r=j(q.path);if(r in b){return b[r](q.path.substr(r.length+1),q.qargs)}};l=function(s,q){var p,r;r=j(s);p=j(q);if(r!==p){return e()}};g=function(){var p;p=c();if(p!==f){l(f,p);f=p;return a()}};return{init:function(){if(!d){f=c();return d=setInterval(g,50)}},add_callback:function(q,p){assert(typeof q==="string","DBHistory prefix is not a string");assert(q.startsWith("/"),"DBHistory prefix must be absolute");assert(q.count("/")===1,"multi-component prefixes arent supported");k[q]=p;return a()},add_exit_callback:function(q,p){assert(typeof q==="string","DBHistory prefix is not a string");assert(q.startsWith("/"),"DBHistory prefix must be absolute");assert(q.count("/")===1,"multi-component prefixes arent supported");return b[q]=p},push_state:function(q,r){var p;assert(typeof q==="string","DBHistory path is not a string");assert(q.startsWith("/"),"DBHistory path must be absolute");assert(q.indexOf("?")===-1,"DBHistory path contains ?");assert(q.indexOf("#")===-1,"DBHistory path contains #");assert(q.indexOf("//")===-1,"DBHistory path contains //");q=o(q);p=n(q,r);if(p===f){return}l(f,p);if(HTML5_HISTORY){window.history.pushState(null,null,p)}else{window.location.href="#!"+p}f=c();return a()},get_url:c,construct_url:n,deconstruct_url:h,URL_ESCAPE_REGEX:m}})();Util.smartLoad(function(){DBHistory.init();if(IE7_OR_LESS){return HashKeeper.hash_checker=setInterval(HashKeeper.check_hash.bind(HashKeeper),100)}});HashRouter={watch_timer:null,callback_map:{},last_hash:"",last_prefix:"",init:function(){return this.watch_timer=setInterval(this.check_hash.bind(this),300)},watch:function(a,b){this.callback_map[a]=b;if(!this.watch_timer){return this.init()}},check_hash:function(){var b,d,c,a;d=Util.url_hash();if(this.last_hash===d){return}this.last_hash=d;if(this.last_prefix&&d===""){d=this.last_prefix+":"}else{if(!d){return}}a=d.split(":");c=a.first();this.last_prefix=c;b=this.callback_map[c];if(b){b.apply(b,a.slice(1))}return $(document).fire("db:hash_change",{hash:d})},_prepare_hash:function(c){var b,a;a=$A(c).map(Util.falsy_to_empty);b=a.map(encodeURIComponent);return b.join(":")},set_hash:function(){var a,b;a=1<=arguments.length?__slice.call(arguments,0):[];b=this._prepare_hash(a);return this._set_hash(b)},replace_hash:function(){var a,b;a=1<=arguments.length?__slice.call(arguments,0):[];b=this._prepare_hash(a);return this._set_hash(b,true)},_set_hash:function(b,a){if(b===""){b="/"}this.last_hash=b;if(!a){return window.location.href="#"+b}else{return window.location.replace("#"+b)}}};var Votebox;Votebox={page:0,view:"newest",add_comment:function(b){var a;if(b){Event.stop(b)}a=$("comment_form");return Forms.ajax_submit(a,false,(function(c){var d;d=$("feature-comments");d.innerHTML=c.responseText+d.innerHTML;$("comment").setValue("");return d.scrollTo()}),false,b.target)},edit_comment:function(d,f,c){var a,b;Event.stop(d);f=$(f);a=f.up().next(".feature-comment-text");if(a.down("textarea")){return}a.old_comment=a.innerHTML;b='<p><textarea class="textarea act_as_block" id="comment_edit_#{comment_id}"\n  rows="5" cols="4">#{comment_content}</textarea></p>\n<p style="text-align:right; margin-bottom:0;">\n<input type="button" id="comment_save_#{comment_id}" value="Save" class="button"/>\n<input type="button" id="comment_cancel_#{comment_id}" class="button grayed" value="Cancel"/></p>';b=b.interpolate({comment_id:c,comment_content:a.old_comment.strip().replace(/<br\/>|<br>/g,"\n")});a.update(b);$("comment_save_"+c).observe("click",function(g){return this.save_comment(g,c)});$("comment_cancel_"+c).observe("click",function(g){return this.cancel_comment(g,c)});return ActAsBlock.register(a)},delete_comment:function(c,d,b){var a;Event.stop(c);d=$(d);a=d.up(".feature-comment");new Ajax.DBRequest("/votebox/delete_comment",{parameters:{comment_id:b}});return a.remove()},cancel_comment:function(c,b){var a;Event.stop(c);a=$("comment_edit_"+b).up(".feature-comment-text");return a.update(a.old_comment)},save_comment:function(c,b){var a;Event.stop(c);a=$("comment_edit_"+b).getValue();new Ajax.DBRequest("/votebox/edit_comment",{parameters:{comment_id:b,comment_text:a}});a=a.escapeHTML().replace(/\n/g,"<br/>");return $("comment_edit_"+b).up(".feature-comment-text").update(a)},submit_feature:function(b){var a;Event.stop(b);a=$("add-feature-request");return Forms.ajax_submit(a,false,(function(c){return window.location=c.responseText}),false,b.target)},how_voting_works:function(){return Modal.icon_show("comments_32",_("How voting works"),$("howvotingworks"))},votes_left:function(){return parseInt($("votes-left").innerHTML,10)},vote:function(f,c){var b,a,d=this;if(c){Event.stop(c)}f=$(f);b=f.id.slice(4);a=this.votes_left();if(a<=0){this.show_more_votes_modal();return}new Ajax.DBRequest("/votebox/vote",{parameters:{feature_id:b},onSuccess:function(){if(a===1){return window.location.reload()}},onFailure:function(e){d.adjust_votes_left(1);d.adjust_votes_total(f,-1);return d.adjust_votes_bubble(f,-1)}});this.adjust_votes_left(-1);this.adjust_votes_total(f,1);return this.adjust_votes_bubble(f,1)},tab_click:function(b,c,a){Event.stop(b);this.list_set_url({view:a});return this.tab(c)},tab:function(a){a=$(a);a.up("ul").select(".selected").invoke("removeClassName","selected");return a.up().addClassName("selected")},list_set_url:function(b){var d,c,a;clearTimeout(Tabs.check_interval);c=b.page||this.page||0;a=b.view||this.view||"popular";if(a!==this.view){c="0"}d=["votebox",a,c].join(":");window.location.href="#"+d;return this.list_hash_update(a,c)},list_hash_update:function(a,b){var c;c=a!==this.view||b!==this.page;if(!c){return}a=a||"popular";b=b||0;this.view=a;this.get_features(b);return this.tab($(""+a+"-tab").down())},comment_set_url:function(a){var b;b=["votebox",a].join(":");window.location.href="#"+b;return this.comment_hash_update(a)},comment_hash_update:function(a){if(a!==this.page){a=a||0;return this.get_comments(a)}},adjust_votes_left:function(b){var a;a=this.votes_left();a+=b;return $("votes-left").__date(a)},adjust_votes_total:function(d,b){var a,c;a=d.previous(".votecount").down("span");if(Util.isNumber(a.innerHTML)){c=parseInt(a.innerHTML,10);return a.update(c+b)}},adjust_votes_bubble:function(f,d){var b,c,a,e;e=f.up(".votebox");b=e.down(".ebubble");if(b){c=b.down(".c");a=parseInt(c.innerHTML,10);a+=d;if(a===0){return b.remove()}else{return c.__date("+"+a)}}else{return e.__sert(EventBubble.make("+1"))}},show_more_votes_modal:function(){return Modal.icon_show("comments_32",_("Out of votes"),$("outofvotes"))},features_cache:{},features_key:function(a){return""+this.view+"_"+this.category+"_"+a},get_features:function(b){var a,c,d=this;a=this.features_key(b);this.page=b;assert(Util.isNumber(b),"Feature page is not a number: "+b);if(this.features_cache[a]){return this.show_features(b)}else{c={};c.page=b;if(this.view){c.view=this.view}if(this.category){c.category=this.category}Feed.showLoading(false,$("features"));return new Ajax.DBRequest("/votebox/more_features",{parameters:c,onSuccess:function(e){d.features_cache[a]=e.responseText;return d.show_features(b)},onComplete:function(){return Feed.hideLoading()}})}},show_features:function(b){var a;a=this.features_key(b);return $("features").update(this.features_cache[a])},comments_cache:{},get_comments:function(a){var b=this;this.page=a;assert(Util.isNumber(a),"Comment page is not a number "+a);if(this.comments_cache[a]){return this.show_comments(a)}else{Feed.showLoading(false,$("feature-comments"));return new Ajax.DBRequest("/votebox/more_comments",{parameters:{feature_id:this.feature_id,page:a},onSuccess:function(c){b.comments_cache[a]=c.responseText;return b.show_comments(a)},onComplete:function(){return Feed.hideLoading()}})}},show_comments:function(a){return $("feature-comments").update(this.comments_cache[a])},search:function(a){this.last_search=a;if(SuggestionInput.defaulted($("feature-search"))||a===""){if(a===""){$("hideme").show();$("searchresults").hide();$("add-feature").hide()}return}return new Ajax.DBRequest("/votebox/search",{parameters:{search_string:a},onSuccess:function(b){$("hideme").hide();$("searchresults").show();$("searchresults").update(b.responseText);$("add-feature").show();return ActAsBlock.register(false,$("add-feature"))}})}};var Tutorial;Tutorial={events:{browse_reload:"browse_reload",browse_folder_update_start:"browse_folder_update_start",browse_folder_update_done:"browse_folder_update_done",browse_show_lightbox:"browse_show_lightbox",browse_hide_lightbox:"browse_hide_lightbox",show_share_folder_modal:"show_share_folder_modal",share_modal_type_contact:"share_modal_type_contact",share_modal_pick_contact:"share_modal_pick_contact",share_modal_remove_invite_user:"share_modal_remove_invite_user",share_modal_submit:"share_modal_submit",shmodel_folder_switch_view_mode:"shmodel_folder_switch_view_mode"},_event_handlers:{},set_event_handler:function(b,a){return this._event_handlers[b]=a},get_event_handler:function(a){return this._event_handlers[a]},should_handle_event:function(a){if(this.get_event_handler(a)){return true}else{return false}},handle_event:function(c,a){var b;b=this.get_event_handler(c);if(b){return b(a)}else{return false}}};var HandlePricingTable,Team,TeamsPricingSlider,cash_format,show_customers_video;Team={show_add_modal:function(c){var g,h,f,e,b,d,a;Sharing.reset_wizard();DomUtil.fillVal(_("Invite users to this team"),"invite-more-wizard-title");DomUtil.fillVal(_("Invite to team"),"invite-more-wizard-share-button");f=_("Add team members to '%(team_name)s'").format({team_name:c.em_snippet(15)});Modal.icon_show("folder_user_add_32",f,$("invite-more-wizard"),{action:this.add_users});this.add_auto_completer=new Autocompleter.ContactsTokenizer("invite-wizard-new-collab-input","invite-wizard-new-whobulk","invite-wizard-hidden-input",contacts,lcontacts,{tokens:[",",";"]});g=$("allow-other-members-to-share-container");if(g){g.hide()}d=$$("#tokenized_autocompleter_container .fb-connect-link");a=[];for(e=0,b=d.length;e<b;e++){h=d[e];a.push(h.hide())}return a},add_users:function(b){var a;Event.stop(b);a=$("invite-more-form");assert(a,"Couldn't find the invite more form.");return Forms.ajax_submit(a,"/account/team/add_users",(function(c){Modal.hide();return $("team-member-info").update(c.responseText)}),(function(){return Forms.enable(a.down("input[type='submit']"))}),b.target,{team_id:Constants.team_id})},show_remove_modal:function(e,f,b,d,c,g){var a,h;a=$("team-remove-disable-user-msg");if(g){a.show()}else{a.hide()}DomUtil.fillVal(d,"remove-user-email");DomUtil.fillVal(f,"remove-user-team");h=_("Remove user from '%(team_name)s'").format({team_name:f.em_snippet(17)});return Modal.icon_show("delete_32",h,$("remove-user-modal"),{user_id:b,disable_if_joined:c,button:e})},remove_user:function(c){var b,a,d=this;Event.stop(c);a=Modal.vars.user_id;b=Modal.vars.disable_if_joined;return new Ajax.DBRequest("/account/team/remove_user",{parameters:{team_id:Constants.team_id,user_id:a,disable_if_joined:b},onSuccess:function(e){var f;f=Modal.vars.button.up(".bs-row");if(!f){f=Modal.vars.button.up(".member-row")}if(f){f.hide()}d.decrement_used_licenses();return Notify.server_success(_("User removed."))},cleanUp:function(){return Modal.hide()}})},show_reinvite_modal:function(c,d,a,b){var e;DomUtil.fillVal(b,"reinvite-user-email");DomUtil.fillVal(d,"reinvite-user-team");e=_("Resend invite to '%(email_address)s'").format({email_address:b.em_snippet(18)});return Modal.icon_show("email_32",e,$("reinvite-user-modal"),{user_id:a,button:c})},reinvite_user:function(b){var a;Event.stop(b);a=Modal.vars.user_id;return new Ajax.DBRequest("/account/team/reinvite_user",{parameters:{team_id:Constants.team_id,user_id:a},onSuccess:function(c){Notify.server_success(_("Invite sent."));return $("team-member-info").update(c.responseText)},cleanUp:function(){return Modal.hide()}})},show_reset_password_modal:function(c,d,a,b){var e;DomUtil.fillVal(b,"reset-password-email");e=_("Reset password for '%(email_address)s'").format({email_address:b.em_snippet(17)});return Modal.icon_show("arrow_refresh_32",e,$("reset-password-modal"),{user_id:a,button:c})},reset_password:function(b){var a;Event.stop(b);a=Modal.vars.user_id;return new Ajax.DBRequest("/account/team/reset_password",{parameters:{team_id:Constants.team_id,user_id:a},onSuccess:function(c){return Notify.server_success(_("User's password reset."))},cleanUp:function(){return Modal.hide()}})},show_admin_status_modal:function(c,j,l,e,k,f){var b,g,a,d,h;a=k.strip()||e;d=void 0;b=void 0;h=void 0;g=void 0;if(f){d=_("Are you sure you want to make %(person_name)s an admin of '%(team_name)s?'").format({person_name:a.escapeHTML(),team_name:j.escapeHTML()});b=_("Make admin");h=_("Make admin");g="alert_32"}else{d=_("Are you sure you want to remove admin privileges for %(person_name)s?").format({person_name:a.escapeHTML()});b=_("Remove admin status");h=_("Remove admin status");g="alert_32"}DomUtil.fillVal(e,"admin-status-email");DomUtil.fillVal(d,"admin-status-action");DomUtil.fillVal(b,"admin-status-button-action");return Modal.icon_show(g,h,$("admin-status-modal"),{user_id:l,button:c,admin_on:f})},set_admin_status:function(b){var a;Event.stop(b);a=Modal.vars.user_id;return new Ajax.DBRequest("/account/team/set_admin_status",{parameters:{team_id:Constants.team_id,user_id:a,on:(Modal.vars.admin_on?"yes":"no")},onSuccess:function(c){var d;d=(Modal.vars.admin_on?_("User's admin status granted."):_("User's admin status removed."));Notify.server_success(d);return $("team-member-info").update(c.responseText)},cleanUp:function(){return Modal.hide()}})},show_team_message_modal:function(a){var b;DomUtil.fillVal(a,"team-message-team");b=_("Send email to members of '%(team_name)s'").format({team_name:a.em_snippet(13)});$("team-message").value="";Modal.icon_show("page_white_get_32",b,$("team-message-modal"));return Util.focus.defer("team-message")},send_team_message:function(b){var a;Event.stop(b);a=$F("team-message").strip();if(a){return new Ajax.DBRequest("/account/team/send_team_message",{parameters:{team_id:Constants.team_id,message:a},onSuccess:function(c){Notify.server_success(_("Message successfully sent to team."));return Modal.hide()}})}},show_security_message_modal:function(b,a){var c,d=this;c=ungettext("There is %(member_count)s member with two-step verification disabled","There are %(member_count)s members with two-step verification disabled",a).format({member_count:a});$("team-security-message-submit").observe("click",function(f){d.send_team_security_message(f);return false});$("team-security-message-cancel").observe("click",function(){return Modal.hide()});$("team-security-message").value="";Modal.icon_show("page_white_get_32",c,$("team-security-message-modal"));return Util.focus.defer("team-security-message")},send_team_security_message:function(c){var b,a;Event.stop(c);a=$F("team-security-message").strip();b=$("team-security-message-form");return new Ajax.DBRequest("/account/team/send_team_message",{parameters:b.serialize(true),onSuccess:function(d){Notify.server_success(_("Message successfully sent."));return Modal.hide()}})},show_migrate_modal:function(c,d,a,b){DomUtil.fillVal(b,"migrate-email");return Modal.icon_show("alert_32",_("Migrate user to '%(team_name)s'").format({team_name:d.em_snippet(19)}),$("migrate-modal"),{user_id:a,button:c})},start_migration:function(b){var a;Event.stop(b);a=Modal.vars.user_id;return new Ajax.DBRequest("/account/team/start_migration",{parameters:{team_id:Constants.team_id,user_id:a},onSuccess:function(c){Notify.server_success(_("User migration initiated."));return $("team-member-info").update(c.responseText)},cleanUp:function(){return Modal.hide()}})},used_licenses:0,total_licenses:0,set_used_licenses:function(a,b){this.used_licenses=a;this.total_licenses=b;$("team-used-licenses").__date(a);return $("team-avail-licenses").__date(b-a)},decrement_used_licenses:function(){return this.set_used_licenses(this.used_licenses-1,this.total_licenses)},show_migration_link:function(a,b){$("migration-url").value=b;Modal.icon_show("alert_32",_("Migration link for '%(email)s'").format({email:a.em_snippet(18)}),$("migrate-url-modal"));return $("migration-url").select()},toggle_account_view:function(a){switch(a){case"new":$("account_info_new").removeClassName("hidden_elem");$("account_info_existing").addClassName("hidden_elem");break;case"existing":$("account_info_new").addClassName("hidden_elem");$("account_info_existing").removeClassName("hidden_elem")}$("account_info_type").value=a;return false}};cash_format=function(a){return a.toFixed(2).replace(/\.00/,"")};HandlePricingTable=Class.create({initialize:function(f,g,h,e,d,c,b,a){this.baseSpace=parseInt(f,10);this.baseUsers=g;this.baseCost=h;this.basePrice=e;this.licensePackQuota=d;this.maxAdditionalLicenses=c;this.prorateAmt=b;this.discountRatio=a;return this.listen()},handle:function(){var c,b,a,e,d;e=parseInt($("team_num_users").value,10)||0;d=this.baseCost;b=this.baseUsers;c=0;if(this.licensePackQuota){a=Math.max(e-this.baseUsers,0);$("extra_user_licenses_num").__date(a);$("extra_user_licenses_cost").__date(_("$%(num_dollars)s").format({num_dollars:a*this.basePrice}));if(a>0){$("extra_user_licenses_space").__date(Util.formatGB(a*this.licensePackQuota,true,true))}$("total_space").__date(Util.formatGB(a*this.licensePackQuota+this.baseSpace,true,true));$("total_licenses").__date(a+this.baseUsers);d=this.baseCost+a*this.basePrice;b+=this.maxAdditionalLicenses}else{$("total_space").__date(Util.formatGB(this.baseSpace,true,true));$("total_licenses").__date(this.baseUsers)}if(this.discountRatio){c=d*this.discountRatio;d=d-c}d=Math.max(d-this.prorateAmt,0);if(e>b){$("final_price_message").addClassName("hidden_elem");$("pricing_info").addClassName("hidden_elem");$("over_max_warning").removeClassName("hidden_elem")}else{if(e<=0){$("final_price_message").addClassName("hidden_elem");$("pricing_info").addClassName("hidden_elem");$("over_max_warning").addClassName("hidden_elem")}else{$("final_price_message").removeClassName("hidden_elem");$("pricing_info").removeClassName("hidden_elem");$("over_max_warning").addClassName("hidden_elem")}}if(e>0&&e<this.baseUsers){$("low_user_warning").removeClassName("hidden_elem")}else{$("low_user_warning").addClassName("hidden_elem")}$("total_price").__date(_("$%(num_dollars)s").format({num_dollars:cash_format(d)}));$("total_price_footer").__date(_("$%(num_dollars)s").format({num_dollars:cash_format(d)}));if(this.discountRatio){$("discount_ratio_amt").__date(_("-$%(num_dollars)s").format({num_dollars:cash_format(c)}))}if(e>this.baseUsers){$("extra_user_licenses_row").removeClassName("hidden_elem")}else{$("extra_user_licenses_row").addClassName("hidden_elem")}if(e>this.baseUsers||this.prorateAmt){return $("pricing_table_totals_wrapper").removeClassName("hidden_elem")}else{return $("pricing_table_totals_wrapper").addClassName("hidden_elem")}},listen:function(){var a,b=this;a=function(){return b.handle.bind(b).delay(1)};$("team_num_users").observe("keyup",a);$("team_num_users").observe("blur",this.handle.bind(this));return Util.smartLoad(this.handle.bind(this))},setProrateAmt:function(a){if($("prorate_amt_row")&&$("prorate_amt")){if(a){$("prorate_amt_row").show()}else{$("prorate_amt_row").hide()}$("prorate_amt").__date(_("-$%(num_dollars)s").format({num_dollars:cash_format(a)}))}this.prorateAmt=a;return this.handle()}});TeamsPricingSlider=Class.create({initialize:function(a){this.initialValue=5;this.handle=$$(a,".slider-handle")[0];this.track=$$(a,".slider-track")[0];this.members=$("team_members");this.price=$("team_price");this.storage=$("team_storage");this.sliderControl=new Control.Slider(this.handle,$("pricing_slider"),{range:$R(1,50),values:$A($R(1,50)),sliderValue:this.initialValue,onSlide:this.sliderChanged.bind(this),onChange:this.sliderChanged.bind(this)});return this.sliderChanged(this.initialValue)},sliderChanged:function(c){var a,b,d;this.handle.update(c);this.track.setStyle({width:(c/50*440)+"px"});a=5;b=795;d=1000;if(c>5){a=c;b+=125*(c-5);d+=200*(c-5)}this.members.update(a);this.price.update("$"+b);this.storage.update(d+" GB");return this.handle.setStyle({left:(c/50*400)+"px"})}});show_customers_video=function(){var c,a,b;if(!FlashDetect.installed){return}b={allowfullscreen:"true",wmode:"transparent"};a={file:"https://s3.amazonaws.com/scast/cc/dropbox_susiecakes.mp4",skin:"/static/swf/bekle.swf",controlbar:"over",image:"/static/images/teams/customers_thumb.jpg"};c=new Element("div",{id:"teams-video-embed",style:"display: inline-block; border:1px solid #adcfea; background:#fff;"});$("customers_video_title").setStyle({display:"block"});$("customers_video").__date(c);return swfobject.embedSWF("/static/swf/jwplayer-5.10-licensed-2393.swf","teams-video-embed","768","432","9",false,a,b)};var ContactTypes,HiddenInput,SF_VIEWS,ShareShowController,ShareView,SharedFolderInvites,Sharing,Token,TokenListView,TokenManager,addContactToList,kc,validate_email,_this=this,__indexOf=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++){if(b in this&&this[b]===c){return b}}return -1};SF_VIEWS={CURRENT:"current",PAST:"past"};ContactTypes={EMAIL:0,FB:1,INVALID:2};Sharing={_contacts_to_inject:[],_lcontacts_to_inject:[],init:function(b){var a=this;[b.current,b.past].each(function(c){return c.each(function(d){return a._decode_sort_key(d)})});this._state={sf_info:b,view:SF_VIEWS.CURRENT,cmp:this._modified_cmp,is_ascending:false,inbox_count:0};if(!((window.contacts!=null)&&(window.lcontacts!=null))){window.contacts=false;window.lcontacts=false}this.listen();this._tmpl=HTML.tmpl("sf_list_item_tmpl");return this._render()},_decode_sort_key:function(a){assert((a.encoded_sort_key!=null)&&!(a.sort_key!=null),"expected encoded sort keys on each elm");a.sort_key=Util.decode_sort_key(a.encoded_sort_key);return delete a.encoded_sort_key},set_inbox_count:function(a){assert(typeof a==="number"&&a>=0,"invalid inbox count");return this._state.inbox_count=a},dec_inbox_count:function(){var b,a,c,d=this;assert(this._state.inbox_count>0,"decrementing an inbox count to negative");this._state.inbox_count-=1;b=new Element("div");b.__sert(Sprite.make("web","email_32",{"class":"modal-h-img"}));b.__sert(_("Shared folder invitations (%d)").format(this._state.inbox_count));$("modal-title").__date(b);if(this._state.inbox_count){a=new Element("a",{id:"new-invites-link",href:"#"});a.__sert(Sprite.make("web","email_32",{"class":"link-img"}));c=ungettext("%d new shared folder invitation","%d new shared folder invitations",this._state.inbox_count);c+=" \n";c=c.format(this._state.inbox_count);a.__sert(c);a.observe("click",function(f){Event.stop(f);return d.show_invites(d._state.inbox_count)});$("invites-box").__date(a);return $$(".share-nav-link")[0].down("span").__date(this._state.inbox_count)}else{$("invites-box").remove();return $$(".share-nav-link")[0].down("span").remove()}},register_decline:function(b){var c,a,d=this;c=b.up("form");a=new Element("img",{src:"/static/images/icons/ajax-loading-small.gif"});a.addClassName("text-img ajax_submit_loading");b.up("td").__sert({top:a});return Forms.ajax_submit(c,false,function(){d.dec_inbox_count();if(b.up("tbody").childElementCount===1){return Modal.hide()}else{b.up("tr").remove();return Notify.server_success(_("Invitation declined."))}})},listen:function(){var b,a,c=this;a=function(h,m,n){var g,d,j,o,k,f,l;k=h.memo.target_ns_id;assert(k,"SF _transfer w/o target_ns_id");for(g=f=0,l=m.length;f<l;g=++f){d=m[g];if(d.target_ns_id===k){j=d;o=g;break}}assert(o!=null,"SF _transfer w/o js obj");m.splice(o,1);$$("li.sf-folder")[o].remove();c._empty_check();n.push(j);return j};b=function(j,l){var d,k,h,g,f;h=j.memo.target_ns_id;assert(h!=null,"SF _remove w/o target_ns_id");for(d=g=0,f=l.length;0<=f?g<f:g>f;d=0<=f?++g:--g){if(l[d].target_ns_id===h){k=d;break}}assert(k!=null,"SF _remove w/o js obj");l.splice(k,1);$$("li.sf-folder")[k].remove();return c._empty_check()};document.observe(FileEvents.SF_UNSHARE,function(d){return b(d,c._state.sf_info.current)});document.observe(FileEvents.SF_LEAVE,function(d){return a(d,c._state.sf_info.current,c._state.sf_info.past)});document.observe(FileEvents.SF_REJOIN,function(f){var d;d=a(f,c._state.sf_info.past,c._state.sf_info.current);return d.filename=f.memo.filename});document.observe(FileEvents.SF_IGNORE,function(d){return b(d,c._state.sf_info.past)});document.observe(FileEvents.SF_NEW,function(f){var d;d=f.memo.sf_info;assert(d,"SF_NEW without info");c._state.sf_info.current.push(d);return c._render()});$("create-share").observe("click",function(d){Event.stop(d);return c.start_wizard(d)});if($("new-invites-link")){$("new-invites-link").observe("click",function(d){Event.stop(d);return c.show_invites(c._state.inbox_count)})}document.on("click",".filter-option",function(h,f){var g,d;h.preventDefault();d=f.readAttribute("data-filter");g=f.innerHTML;$$(".current-filter")[0].__date(g);return c._filter(d)});$("sf-list").on("click","a.options-link",function(j,g){var f,d,h;Event.stop(j);d=g.readAttribute("data-type");f=g.readAttribute("data-mount");h=parseInt(g.readAttribute("data-nsid"),10);if(d==="normal"){return c.get_sharing_options(f)}else{if(d==="remove"){return c.ignore(f,h)}else{if(d==="rejoin"){return c.rejoin(f,h)}}}});$("sf-sort").on("click","a.sort-option",function(g,f){var d,h;Event.stop(g);h={SF_BY_NAME:c._name_cmp,SF_BY_MODIFIED:c._modified_cmp};d=h[f.readAttribute("data-sort")];if(c._state.cmp===d){c._state.is_ascending=!c._state.is_ascending}else{c._state.cmp=d;c._state.is_ascending=true}Util.add_sort_arrow_mouseover(f,c._state.is_ascending,"#sf-sort a.sort-option",true);return c._render()});return Util.add_sort_arrow_mouseover($("modified-sorter"),this._state.is_ascending,"#sf-sort a.sort-option",false)},_filter:function(a){if(this._state.view===a){return}this._state.view=a;return this._render()},_render:function(){var c,a,f,d,b,e=this;d=this._get_current_sf_list();f=this._state.view===SF_VIEWS.PAST;c=function(g,j){var h;h=e._state.is_ascending?1:-1;return h*e._state.cmp(g,j)};d.sort(c);a=(function(){var j,h,g;g=[];for(j=0,h=d.length;j<h;j++){b=d[j];g.push(this._tmpl({options_str:_("Options"),remove_str:_("Remove"),rejoin_str:_("Rejoin"),is_past:f,sf:b}))}return g}).call(this);$("sf-list").__date(a);return this._empty_check()},_empty_check:function(){if(this._get_current_sf_list().length){return $("sf-view").removeClassName("empty-list")}else{return $("sf-view").addClassName("empty-list")}},_get_current_sf_list:function(){switch(this._state.view){case SF_VIEWS.CURRENT:return this._state.sf_info.current;case SF_VIEWS.PAST:return this._state.sf_info.past;default:return assert(false,"invalid sf state")}},_name_cmp:function(a,b){return Util.sort_by_rank_or_key(a,b)},_modified_cmp:function(a,b){return a.modified_ts-b.modified_ts},include_fb:false,use_fb_profile_pics:true,init_invites:function(){return this.show_invites(this._state.inbox_count)},show_invites:function(a){var b;if(EmailVerification.verified()){b=_("Shared folder invitations (%d)").format(a);return Modal.icon_show("email_32",b,$("invites-container"))}},get_sharing_options:function(b){var a,c=this;b=Util.normalize(b);Modal.show_loading("folder_user_32",_("Loading shared folder options..."));a="/share_options"+Util.urlquote(b);return new Ajax.DBRequest(a,{onSuccess:function(d){c.reshow=function(){c.show_sharing_options(d.responseText,b);(function(){if(c.tc){return c.tc.toggle($("members"))}}).defer();return delete Modal.onHide};c.reshow_invite_more=function(){c.show_sharing_options(d.responseText,b);return delete Modal.onHide};return c.show_sharing_options(d.responseText,b)},onFailure:function(){return Modal.hide()}})},show_sharing_options:function(a,b){var c;c=_("Shared folder options for '%(file_name)s'");c=c.format({file_name:FileOps.filename(b).em_snippet(13)});Modal.icon_show("folder_user_32",c,a,{},false);if(EmailVerification.verified()){this.sharing_options_auto_completer=new Autocompleter.ContactsTokenizer("sharing-options-new-collab-input","sharing-options-new-whobulk","sharing-options-hidden-input",contacts,lcontacts,{tokens:[",",";"],include_fb:true});return SickInput._create($("modal").down(".custom-message-container"))}},reset_wizard:function(){var a;SuggestionInput.reset("invite-wizard-new-collab-input");SuggestionInput.reset("custom-message-wizard");SuggestionInput.reset("new_folder_name");a=$("invite-more-form").down("input[name='folder_name']");if(a){return a.remove()}},validate_folder:function(f,c,g){var a,b,d;c=$(c);b=c.down("#folder_name");if(b&&$$("#modal-content #copy-move-treeview .highlight .s_web_folder_user").length){return this.show_invite_more_modal($F(b))}d=$(f.target);if(d&&d.tagName!=="input"){a=d.up("#modal-content");d=a.down("input.button")}assert(c,"Trying to validate a folder where the form doesn't exist");Forms.ajax_submit(c,false,(function(){if(g&&typeof g==="function"){return g(f,c)}}),false,d);return false},start_wizard:function(a){var b;if(EmailVerification.verified()){this.reset_wizard();if(a){Event.stop(a)}if(Constants.ADMIN||Math.random()<0.001){b=new Element("div");b.__sert(new Element("img",{src:"/static/images/icons/clippy.gif","class":"modal-h-img"}));b.__sert(_("It looks like you're trying to share a folder."));Modal.show(b,$("clippy-shared-folder-wizard"))}else{Modal.icon_show("folder_user_32",_("Share a folder"),$("shared-folder-wizard"))}return $("create-new-sf").focus()}},wizard_next:function(b){var c,a;Event.stop(b);if($("create-new-sf").checked){this.validate_folder(b,"validate-folder-name",this.from_new_to_invitation.bind(this))}else{a=Sprite.make("web","folder_user_32",{});a.addClassName("modal-h-img");c=_("Choose folder to share");Modal.show(new Element("span").__sert(a).__sert(c),$("existing-shared-folder-wizard"));TreeView.move("copy-move-treeview","share-existing-treeview",{onSuccess:function(){var d;$("modal").observe("db:treeview_selected",function(f){return $("folder_name").setValue(f.memo.path)});d=$("first-treeview-link");if(!Util.ie){return d.onclick()}}})}return $$("#modal-content .suggestion-input").each(SuggestionInput.register)},from_new_to_invitation:function(d,b){var f,c,a;f=$F(b.down("#new_folder_name")).strip();assert(f,"Moving from new folder to invite modal with no path.");this.show_invite_more_wizard(f);Modal.vars.action=this.submit_share_new_wizard.bind(this);Modal.vars.path="/"+f;a=$("invite-more-form");c=a.down("input[name=folder_name]");if(!c){c=new Element("input",{type:"hidden",name:"folder_name"});a.__sert(c)}c.setValue(f);return $("share-invite-button").setValue(_("Share folder"))},from_existing_to_invitation:function(f,c,d){var a,b;if(!d){d=$F(c.down("#folder_name")).strip()}assert(d,"Moving from choose a folder to invite modal with no path.");this.show_invite_more_wizard(FileOps.filename(d));Modal.vars.action=this.submit_share_existing_wizard.bind(this);Modal.vars.path=d.strip();b=$("invite-more-form");a=b.down("input[name=path]");if(!a){a=new Element("input",{type:"hidden",name:"path"});b.__sert(a)}a.setValue(d);$("share-invite-button").setValue(_("Share folder"));if(Tutorial.should_handle_event(Tutorial.events.show_share_modal)){return Tutorial.handle_event(Tutorial.events.show_share_modal)}},show_invite_more_wizard:function(b){var a;assert(b,"Folder name required");DomUtil.fillVal("folder","invite-more-wizard-share-type");a=_("Share '%(folder_name)s' with others");a=a.format({folder_name:b.em_snippet(16)});Modal.icon_show("folder_user_32",a,$("invite-more-wizard"));if(this.invite_wizard_auto_completer){this.invite_wizard_auto_completer.clearTokens()}else{this.invite_wizard_auto_completer=new Autocompleter.ContactsTokenizer("invite-wizard-new-collab-input","invite-wizard-new-whobulk","invite-wizard-hidden-input",contacts,lcontacts,{tokens:[",",";"],include_fb:true})}return $("invite-wizard-new-collab-input").focus()},add_from_cli:function(){var a,b,c;c=Referral.get_selected_emails();this.show_invite_more_wizard(FileOps.filename(this.old_state.path));Modal.vars=this.old_state;b=$("new-collab-input");SuggestionInput.do_blank("new-collab-input");a=$F(b);if(c){b.setValue(a+(a.length>0?", ":"")+c);b.addClassName("suggestion-input-unfaded")}return delete Modal.onHide},submit_share_new_wizard:function(d){var b,c,a,f=this;b=$("invite-more-form");assert(b,"Couldn't find the invite more form.");a=function(g){var h,e,j;Modal.hide();e=Util.from_json(g.responseText);j=e.sf_info;f._decode_sort_key(j);h=_("Created shared folder '%(folder_name)s'");h=h.format({folder_name:j.filename});Notify.server_success(h);return document.fire(FileEvents.SF_NEW,{sf_info:j})};c=function(e){return Forms.enable(b.down("input[type='submit']"))};Forms.ajax_submit(b,"/share_ajax/new",a,c,d.target);return false},submit_share_existing_wizard:function(f){var c,d,a,b,g=this;if(Tutorial.should_handle_event(Tutorial.events.share_modal_submit)){b=Tutorial.handle_event(Tutorial.events.share_modal_submit);if(b){return false}}c=$("invite-more-form");assert(c,"Couldn't find the invite more form.");a=function(h){var j,e,k;Modal.hide();e=Util.from_json(h.responseText);k=e.sf_info;g._decode_sort_key(k);j=_("The shared folder %(folder_name)s has been created.");j=j.format({folder_name:k.filename});Notify.server_success(j);return document.fire(FileEvents.SF_NEW,{sf_info:k})};d=function(e){return Forms.enable(c.down("input[type='submit']"))};Forms.ajax_submit(c,"/share_ajax/existing?long_running",a,d,f.target);return false},show_share_existing_modal:function(a){if(EmailVerification.verified()){this.reset_wizard();return this.from_existing_to_invitation(false,false,a)}},show_invite_more_modal:function(a){this.reset_wizard();return this.get_sharing_options(a)},submit_invite_more_wizard:function(d){var b,c,a,f=this;b=$("invite-more-form");assert(b.down("input[name=ns_id]"),"Submit invite more wizard is missing ns_id");a=function(g){var e;e=Util.from_json(g.responseText);Modal.hide();return Notify.server_success(_("Invited successfully."))};c=function(e){return null};Forms.ajax_submit(b,"/share_ajax/invite_more",a,c,d.target);return false},show_leave_modal:function(b,a){var c,d;Modal.onHide=this.reshow;d=_("Leave the shared folder '%(folder_name)s'");d=d.format({folder_name:FileOps.filename(b).em_snippet(14)});Modal.icon_show("folder_user_delete_32",d,DomUtil.fromElm("leave-confirm"),{wit_group:"share-leave-confirm"});c=$("leave-share-form");c.action="/share_ajax/leave?long_running";Modal.vars.ns_id=a;return Modal.vars.folder_path=b},submit_leave:function(h){var d,b,c,g,a,f,j=this;assert(Modal.vars.folder_path.length,"submit_leave: No shared folder path.");assert(Modal.vars.ns_id,"submit_leave: missing ns_id");delete Modal.onHide;c=Modal.vars.folder_path;f=Modal.vars.ns_id;d=$("leave-share-form");Forms.add_vars(d,{ns_id:f});b=d.down("#keep_files").checked;a=function(e){var k;k=_("You removed yourself from '%(msg)s'.").format({msg:FileOps.filename(c).snippet().escapeHTML()});Modal.hide();Notify.server_success(k);return document.fire(FileEvents.SF_LEAVE,{target_ns_id:f,folder_deleted:!b})};g=function(e){return null};Forms.ajax_submit(d,false,a,g,h.target);return false},show_unshare_modal:function(b,a){var c,d;Modal.onHide=this.reshow;d=_("Unshare '%(folder_name)s'");d=d.format({folder_name:FileOps.filename(b).em_snippet(21)});Modal.icon_show("folder_user_delete_32",d,DomUtil.fromElm("unshare-confirm"),{wit_group:"share-unshare-confirm"});c=$("unshare-form");Modal.vars.path=b;Modal.vars.ns_id=a;return c.action="/share_ajax/unshare?long_running"},submit_unshare:function(d){var b,c,a,f=this;delete Modal.onHide;b=$("unshare-form");assert(Modal.vars.path,"submit_unshare: No shared folder path.");assert(Modal.vars.ns_id,"submit_unshare: missing ns_id");Forms.add_vars(b,{ns_id:Modal.vars.ns_id});a=function(e){var g;Modal.hide();g=_("Unshared folder '%(folder_name)s'");g=g.format({folder_name:FileOps.filename(Modal.vars.path).snippet()});Notify.server_success(g);return document.fire(FileEvents.SF_UNSHARE,{target_ns_id:Modal.vars.ns_id})};c=function(e){return null};Forms.ajax_submit(b,false,a,c,d.target);return false},remove_div:function(a){$(a).up(".bs-row").remove();return false},leave:function(){return Modal.show(_("Leave shared folder?"),DomUtil.fromElm("leave-confirm"),{wit_group:"share-leave-confirm"})},unshare:function(){return Modal.show(_("Unshare folder?"),DomUtil.fromElm("unshare-confirm"),{wit_group:"share-unshare-confirm"})},ignore:function(c,a){var b,d;assert(a,"Share ignore did not get an ns_id");d=_("Permanently remove '%(folder_name)s'");d=d.format({folder_name:FileOps.filename(c).em_snippet(15)});Modal.icon_show("folder_delete_32",d,DomUtil.fromElm("ignore-confirm"),{wit_group:"share-ignore-confirm"});b=$("modal-content").down("form");b.action="/share_action/ignore?longrunning";Forms.add_vars(b,{ns_id:a});Modal.vars.path=c;return Modal.vars.ns_id=a},submit_ignore:function(d){var b,c,a,f=this;if(d){Event.stop(d)}b=$("share-ignore-form");assert(b,"Missing submit_ignore_form");a=function(e){Modal.hide();Notify.server_success(_("Removed shared folder successfully."));return document.fire(FileEvents.SF_IGNORE,{target_ns_id:Modal.vars.ns_id})};c=function(e){return null};return Forms.ajax_submit(b,false,a,c,d&&d.target)},rejoin:function(c,a){var b,d;assert(a,"Rejoin didn't get an ns_id");d=_("Rejoin the shared folder '%(folder_name)s'?");d=d.format({folder_name:FileOps.filename(c).em_snippet(13)});Modal.icon_show("alert_32",d,DomUtil.fromElm("rejoin-confirm"),{wit_group:"share-rejoin-confirm"});b=$("modal-content").down("form");b.action="/share_action/rejoin?longrunning";Forms.add_vars(b,{ns_id:a});Modal.vars.path=c;return Modal.vars.ns_id=a},submit_rejoin:function(d){var b,c,a,f=this;Event.stop(d);b=$("rejoin-form");a=function(g){var e;e=FileOps.filename(g.responseText);Modal.hide();Notify.server_success(_("Rejoined shared folder successfully."));return document.fire(FileEvents.SF_REJOIN,{target_ns_id:Modal.vars.ns_id,filename:e})};c=function(e){return null};Forms.ajax_submit(b,false,a,c,d.target);return false},show_change_sf_owner_modal:function(c,d,a,b){var e,f;DomUtil.fillVal(c,"change_sf_owner-confirm-nickname");Modal.onHide=this.reshow;f=_("Make %(person_name)s the owner of this folder?");f=f.format({person_name:c.em_snippet(14)});Modal.icon_show("alert_32",f,DomUtil.fromElm("change_sf_owner-confirm"),{wit_group:"share-change-sf-owner-confirm"});e=$("change-sf-owner-form");e.action="/share_ajax/change_sf_owner";Modal.vars.ns_id=a;return Modal.vars.user_id=b},submit_change_sf_owner:function(d){var b,c,a,f=this;delete Modal.onHide;$("make-owner-button").disable();assert(Modal.vars.ns_id,"submit_change_sf_owner: missing ns_id");assert(Modal.vars.user_id,"submit_change_sf_owner: missing user_id");b=$("change-sf-owner-form");Forms.add_vars(b,{ns_id:Modal.vars.ns_id,user_id:Modal.vars.user_id});a=function(e){var g;g=_("Ownership changed successfully.");Notify.server_success(g);return Modal.hide()};c=function(e){return null};Forms.ajax_submit(b,false,a,c,d.target);return false},submit_change_sf_perm:function(b,e){var c,d,a,f=this;$("change-sf-perm-saving").show();c=$("change-sf-perm-form");Forms.clear_added_vars("change-sf-perm-form");Forms.add_vars(c,{ns_id:b,new_permissions:(e?1:0)});a=function(g){if(e){Notify.server_success(_("Members can now share this folder."))}else{Notify.server_success(_("Members can no longer share this folder."))}return $("change-sf-perm-saving").hide()};d=function(g){if(g.responseText.indexOf("err:")===0){Notify.server_error(g.responseText.substr(4))}else{Notify.server_error(_("Error updating your preference! Please try again."))}return $("change-sf-perm-saving").hide()};Forms.ajax_submit(c,false,a,d);return true},cancel_user:function(e,a,d,b){var c,f=this;c=_("Are you sure you want to uninvite %(email_or_fbname)s?");c=c.format({email_or_fbname:e});if(confirm(c)){return new Ajax.DBRequest("/share_ajax/cancel_invite",{parameters:{ns_id:a,invite_id:d},onSuccess:function(g){f.remove_div(b);return Notify.server_success(e.escapeHTML()+" has been uninvited.")}})}},kick_user:function(c,e,a,b,d,f){var g;Modal.onHide=this.reshow;DomUtil.fillVal(c,"kick-confirm-nickname");g=_("Kick %(person_name)s out of %(folder_name)s?");g=g.format({person_name:c,folder_name:FileOps.filename(f).em_snippet(13)});return Modal.icon_show("folder_user_delete_32",g,DomUtil.fromElm("kick-confirm"),{button:d,victim:e,ns_id:a,user_id:b,wit_group:"share-kick-confirm"})},do_kick:function(b,c,d){var a,e=this;a=$F("keep-files-check");return new Ajax.DBRequest("/share_ajax/kick_user",{parameters:{ns_id:b,user_id:c,keep_files:a},onSuccess:function(){Notify.server_success(_("User removed successfully."));Modal.hide();return e.get_sharing_options(PAGE_PATH)}})},reinvite_user:function(b,a){var c=this;new Ajax.DBRequest("/share_ajax/reinvite_user/"+PAGE_PATH,{parameters:{invite_id:a},onSuccess:function(d){var e;e=_("%(email_or_fbname)s was reinvited successfully");e=e.format({email_or_fbname:b});return Notify.server_success(e)}});return false},inject_contacts:function(a){this._contacts_to_inject=a.clone();return this._lcontacts_to_inject=a.collect(function(b){return{email:b.email,name:b.name.toLowerCase(),type:b.type}})},load_contacts:function(c,a){var b=this;if(Contacts.contacts_to_import===EmailProvider.NONE){Contacts.set_contacts_to_import()}if(this.loading_contacts){return false}this.loading_contacts=true;return new Ajax.DBRequest("/get_contacts",{parameters:{include_fb:c},onSuccess:function(d){var e;e=d.responseText.evalJSON(false);window.contacts=e.contacts;window.lcontacts=e.lcontacts;b.loading_contacts=false;if(b._contacts_to_inject&&b._lcontacts_to_inject){window.contacts.push.apply(window.contacts,b._contacts_to_inject);window.lcontacts.push.apply(window.lcontacts,b._lcontacts_to_inject)}if(b.sharing_options_auto_completer){b.sharing_options_auto_completer.options.array=window.contacts;b.sharing_options_auto_completer.options.larray=window.lcontacts}if(b.invite_wizard_auto_completer){b.invite_wizard_auto_completer.options.array=window.contacts;b.invite_wizard_auto_completer.options.larray=window.lcontacts}if(SharingModel.send_link_autocompleter){SharingModel.send_link_autocompleter.options.array=window.contacts;SharingModel.send_link_autocompleter.options.larray=window.lcontacts}if(Foshmodal.send_link_autocompleter!=null){Foshmodal.send_link_autocompleter.options.array=window.contacts;Foshmodal.send_link_autocompleter.options.larray=window.lcontacts}if(a!=null){return a()}}})},shmodel:function(c){var b,a;a="/sm/create"+Util.urlquote(c);Forms.postRequest(a,{},{target:"_blank"});b=Browse.find_file(c);if(b){return b.get_div().addClassName("shmodeled")}},show_share_subfolder_warning:function(){var a,b;b=Browse.details_from_fq_path(Browse.containing_fq_path()).folder_name;if(b){a=_("Folders within shared folders can't be shared, but you can still share the folder '%(parent_shared_folder)s'");a=a.format({parent_shared_folder:b.escapeHTML()});Notify.server_error(a);return document.stopObserving(Browse.UPDATE_EVT,this.show_share_subfolder_warning)}},fb_auth_callback:function(){Sharing.load_contacts(true);$$(".fb-connect-link").each(function(a){return a.hide()});return Notify.server_success(_("Successfully connected to Facebook."))}};SharedFolderInvites={pages:{},contents:{},register_all:function(){var a=this;return $$(".expand-invite").each(function(b){return a.register(b)})},register:function(a){return a.db_observe("click",this.expand)},expand:function(f,d,a){var c,b;Event.stop(f);d=$(d);if(_this.animating){return}b=d.up(".invite");c=[];_this.get_sf_contents(b,a);if(b.hasClassName("active")){c.push(_this.hide(b))}else{c.push(_this.show(b))}$$("div.invite.active").each(function(e){if(e!==b){return c.push(_this.hide(e))}});_this.animating=true;return new Effect.Parallel(c,{duration:0.5,afterFinish:function(){return _this.animating=false}})},show:function(b){var c,a;b.addClassName("active");c=b.down(".invite-details");a=b.down(".toggler");Sprite.replace(a,"web","plus","minus");return new Effect.BlindDown(c,{sync:true,afterFinish:function(){return c.style.height="auto"}})},hide:function(b){var c,a;b.removeClassName("active");c=b.down(".invite-details");a=b.down(".toggler");Sprite.replace(a,"web","minus","plus");return new Effect.BlindUp(c,{sync:true})},show_page:function(a){Feed.hideLoading();$("invites-container").update(this.pages[a]);return this.register_all()},get_page:function(a){var b=this;if(!this.pages[0]&&a===1){this.pages[0]=$("invites-container").innerHTML}if(this.pages[a]){this.show_page(a)}else{Feed.showLoading(false,$("invites-container"),false,true);new Ajax.DBRequest("/share_ajax/invitation_page?page="+a,{onSuccess:function(c){b.pages[a]=c.responseText;return b.show_page(a)}})}return false},get_sf_contents:function(b,a){var c=this;if(this.contents[a]){return this.show_sf_contents(b,a)}else{return new Ajax.DBRequest("/share_ajax/sf_contents?ns_id="+a,{onSuccess:function(d){c.contents[a]=d.responseText;return c.show_sf_contents(b,a)}})}},show_sf_contents:function(b,a){return b.down(".folder-contents").update(this.contents[a])},mailto:function(b,a){Event.stop(b);return window.location="mailto:"+a}};ShareView={current_view:"gallery",click:function(a){ShareView.toggle_view(a);HashRouter.set_hash("view",a);return false},toggle_view:function(b){var a,c;b=b||"gallery";c=$(b+"-link");if(!c){return}$$("#toggle-view .selected").invoke("removeClassName","selected");c.addClassName("selected");$$(".view").invoke("hide");a=$(b+"-view");if(a){a.show()}return ShareView.current_view=b}};TokenListView={sort_by_filename:function(a){return parseInt(a.down(".filename .hidden").innerHTML,10)},sort_by_size:function(a){return parseInt(a.down(".filesize .hidden").innerHTML,10)},sort_by_modified:function(a){return -1*parseInt(a.down(".modified .hidden").innerHTML,10)},sort:function(g){var a,n,h,d,c,l,m,j,f,b,k;Event.stop(g);h=$(g.target).up("a");if(h.asc!==-1){h.asc=-1}else{h.asc=1}a=h.className;j={"sort-filename":this.sort_by_filename,"sort-filesize":this.sort_by_size,"sort-modified":this.sort_by_modified};m=$$("#list-view .filerow");f=m.sort_by_key(j[a],h.asc!==1);m.invoke("remove");n=new Element("div");for(b=0,k=f.length;b<k;b++){l=f[b];n.__sert(l)}$("list-browser").__sert(new HTML(n.innerHTML));$$(".sort-tick").invoke("remove");d=h.asc===1?"sort-downtick-on":"sort-uptick-on";c=Sprite.make("web",d);c.addClassName("sort-tick");return h.__sert(c)}};Autocompleter.Contacts=Class.create(Autocompleter.Base,{initialize:function(c,g,f,b,a){var e,d=this;this.baseInitialize(c,g,a);this.options.array=f;this.options.larray=b;this.options.frequency=0.1;e=this.options.include_fb===true;if(!window.contacts){(function(){return Sharing.load_contacts(e)}).defer()}this.options.onShow=function(h,j){if(!j.style.position||j.style.position==="absolute"){j.style.position="absolute";Position.clone(h,j,{setHeight:false,offsetTop:h.offsetHeight-1})}return Effect.Appear(j,{duration:0.15})};this._autocompleter_contact_import_item_tmpl=HTML.tmpl("autocompleter_item_tmpl");if(Constants.shmodal_contact_importer_enabled){Event.stopObserving(this.element,"blur");Event.observe($("modal-box"),"click",function(h){var j;j=h.srcElement||h.originalTarget;if(j.className!=="import-contacts-link"){if(d.contact_importer_currently_showing()){return d.contact_importer_unshow()}else{return d.get_entry_container().hide()}}});ContactImporter.toggle=this.contact_importer_toggle.bind(this);ContactImporter.unshow=this.contact_importer_unshow.bind(this);return ContactImporter.refresh=function(){return Sharing.load_contacts(true,(function(){if(d.element.value.length){return d.getUpdatedChoices()}}))}}},getToken:function(){var a;a=this.getTokenBounds();return this.element.value.substring(a[0],a[1])},get_entry_container:function(){return this.element.up("#tokenized_autocompleter_container").down(".autocomplete")},contact_importer_currently_showing:function(){var b,a;b=this.get_entry_container();if(b.style.display!=="none"){if(((a=b.firstChild.firstChild)!=null?a.value:void 0)===0){if(b.firstChild.children.length>1){return true}}}return false},contact_importer_show:function(){var c,b,a;c=this.get_entry_container();if(((b=c.firstChild)!=null?(a=b.firstChild)!=null?a.value:void 0:void 0)>0){ContactImporter.old_display=c.style.display}else{ContactImporter.old_contents="<ul></ul>";ContactImporter.old_display="none"}this.contact_importer_render_buttons();$("flash_copy_container").hide();return this.element.focus()},contact_importer_unshow:function(){this.hasFocus=true;this.changed=false;this.updateChoices(ContactImporter.old_contents);this.get_entry_container().style.display=ContactImporter.old_display;return $("flash_copy_container").show()},contact_importer_toggle:function(){if(this.contact_importer_currently_showing()){return this.contact_importer_unshow()}else{return this.contact_importer_show()}},contact_importer_render_buttons:function(){var c,b,e,a,d;b=[];if(Constants.shmodal_contact_importer_enabled){d=[EmailProvider.GOOGLE,EmailProvider.YAHOO,EmailProvider.FACEBOOK];for(e=0,a=d.length;e<a;e++){c=d[e];assert(Contacts.connected_services!=null,"connected_services has not been set");b.push(this._autocompleter_contact_import_item_tmpl({email_provider_num:c,email_provider_img:EmailProvider.to_img(c),email_provider_name:EmailProvider.to_name(c),bottom_text:Contacts.connected_services[c]?_("Connected"):""}).toHTML())}}this.hasFocus=true;return this.updateChoices("<ul>"+(b.join(""))+"</ul>")},getUpdatedChoices:function(){if(!this.options.array&&window.contacts&&window.lcontacts){this.options.array=window.contacts;this.options.larray=window.lcontacts}return this.updateChoices(this.options.selector())},selectEntry:function(){var c,b,a;b=this.getCurrentEntry();c=this.options.array[b.value];if(c.type===ContactTypes.FB){b.innerHTML=c.name}else{b.innerHTML=c.email}if(this.options.tokens.length>1){a=this.options.tokens[0]+" "}else{a=""}b.innerHTML+=a;this.active=false;this.updateElement(b);return $(this.element).fire("db:autocompleted")},setOptions:function(b){var a,c=this;if(b==null){b={}}a={choices:5,selector:function(){var H,n,F,D,t,E,f,K,g,r,s,C,y,z,k,o,m,x,u,w,A,j,v,J,h,B,e,d,G,I,q;J=[];f=c.getToken().toLowerCase();y=c.options.array.length;F=c.options.choices;H=c.options.array;z=c.options.larray;v=[];if(f.indexOf(" ")===-1){v.push("\\s+")}if(f.indexOf("+")===-1){v.push("\\+")}if(f.indexOf("@")===-1){v.push("@")}if(f.indexOf(".")===-1){v.push("\\.")}if(f.indexOf("&lt;")===-1){v.push("&lt;")}j=RegExp("("+v.join("|")+")");s=0;while(s<y&&J.length<F){E=H[s];o=z[s];K=-1;t=[];x=[];r="";switch(E.type){case ContactTypes.EMAIL:t.push(E.name,E.email);x.push(o.name,o.email);r="/static/images/icons/mail28.png";break;case ContactTypes.FB:t.push(E.name);x.push(o.name);if(Sharing.use_fb_profile_pics){r="https://graph.facebook.com/"+o.fb_id+"/picture"}else{r="/static/images/icons/fb24.png"}break;default:assert(false,"should never get here due to type: "+E.type+", "+E.name+", "+E.email+", "+E)}for(C=e=0,G=x.length;e<G;C=++e){m=x[C];w=v.length?m.split(j):[m];D=0;for(d=0,I=w.length;d<I;d++){u=w[d];if(!u){continue}if(u.indexOf(f)===0){K=D;break}D+=u.length}if(K!==-1){t[C]=t[C].substr(0,K)+"<strong>"+t[C].substr(K,f.length)+"</strong>"+t[C].substr(K+f.length);break}}if(E.type===ContactTypes.FB){t.push(_("Facebook message"))}if(K!==-1){g="<image src='"+r+"' width='28px' height='28px'/>";A="<div class='autocomplete-line'>"+t[0]+"</div>";B="<div class='autocomplete-line autocomplete-secondary'>"+t[1]+"</div>";k="<div class='autocomplete-left'>"+g+"</div>";h="<div>"+(A+B)+"</div>";J.push("<li value='"+s+"'>"+(k+h)+"</li>")}s++}if(Constants.shmodal_contact_importer_enabled){if(q=Contacts.contacts_to_import,__indexOf.call(EmailProvider.contact_services(),q)>=0){if(!Contacts.connected_services[Contacts.contacts_to_import]){J.push(c._autocompleter_contact_import_item_tmpl({email_provider_num:Contacts.contacts_to_import,email_provider_img:EmailProvider.to_img(Contacts.contacts_to_import),email_provider_name:_("Import your "+(EmailProvider.to_name(Contacts.contacts_to_import))+" contacts"),bottom_text:_("Easily share with friends, family or coworkers")}).toHTML())}}}n="<ul>"+(J.join(""))+"</ul>";ContactImporter.old_contents=n;return n}};return this.options=Object.extend(a,b)}});Token=Class.create({initialize:function(c,b,d,a){this.element=$(c);this.token_manager=d;this.hidden_input=b;this.element.token=this;this.selected=false;this.is_valid=a;return Event.observe($("tokenized_autocompleter_container"),"click",this.onclick.bindAsEventListener(this))},select:function(){this.token_manager.token=this;this.hidden_input.element.activate();this.selected=true;return this.element.addClassName("token_selected")},deselect:function(){if(this.token_manager.token===this){this.token_manager.token=null}this.selected=false;return this.element.removeClassName("token_selected")},onclick:function(a){if(a&&a.preventDefault){a.preventDefault()}if(this.detect(a)&&!this.selected){return this.select()}else{return this.deselect()}},remove:function(a){return this.token_manager.remove(this)},detect:function(d){var b,c,a;c=d.target?d.target:d.srcElement;a=c.token;b=c;while(!(a!=null)&&b.parentNode){b=b.parentNode;a=b.token}return(a!=null)&&a.element===this.element}});TokenManager=Class.create({initialize:function(b,a){this.shift_boundary_right_func=b;this.shift_boundary_left_func=a;this.tokens=[];return this.token=null},add:function(a){return this.tokens.push(a)},remove:function(c){var b,a;if(!(c!=null)){c=this.token}if(c!=null){a=this.tokens.indexOf(c);this.tokens.splice(a,1);c.element.remove();if(this.token===c&&a<this.tokens.length){this.tokens[a].select()}else{this.token=null;this.shift_boundary_right_func()}}b=Tutorial.should_handle_event(Tutorial.events.share_modal_remove_invite_user,{token:c});if(b){return Tutorial.handle_event(Tutorial.events.share_modal_remove_invite_user,{token:c})}},removeAll:function(){var b,d,a,c;c=this.tokens;for(d=0,a=c.length;d<a;d++){b=c[d];b.element.remove()}return this.tokens.clear()},shift_left:function(){var a;a=this.token?this.tokens.indexOf(this.token):this.tokens.length;if(a>0){if(this.token){this.token.deselect()}return this.tokens[a-1].select()}else{if(this.shift_boundary_left_func!=null){return this.shift_boundary_left_func()}}},shift_right:function(){var a;a=this.tokens.indexOf(this.token);if(this.token){this.token.deselect()}if(a+1<this.tokens.length){return this.tokens[a+1].select()}else{if(this.shift_boundary_right_func!=null){return this.shift_boundary_right_func()}}}});HiddenInput=Class.create({initialize:function(a,c,b){this.element=$(a);this.auto_complete_element=c;this.token_manager=b;return Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},onKeyPress:function(a){switch(a.keyCode){case Event.KEY_LEFT:a.preventDefault();this.token_manager.shift_left();break;case Event.KEY_TAB:a.preventDefault();this.token_manager.shift_right();break;case Event.KEY_RIGHT:a.preventDefault();this.token_manager.shift_right();break;case Event.KEY_BACKSPACE:case Event.KEY_DELETE:this.token_manager.remove()}return false}});validate_email=function(a){var b;b=new RegExp("^['&A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,6}$","i");return b.test(a)};addContactToList=function(l,g,h,k,c,m,n){var a,j,f,b,d,e,o;k.value="";switch(h){case ContactTypes.FB:f="fb_ids";j=Builder.node("img",{src:"/static/images/icons/fb_16.png"});break;case ContactTypes.EMAIL:f="emails";j=Builder.node("img",{src:"/static/images/icons/email_16.png"});break;case ContactTypes.INVALID:f="invalids";j=Builder.node("span",{"class":"hidden"});break;default:assert(false,"should never get here due to type: "+h)}a=n?" token-valid":" token-error";o=Builder.node("span",{"class":"x"+a,onmouseout:"this.className='x"+a+"'",onmouseover:"this.className='x_hover"+a+"'",onclick:"this.parentNode.parentNode.parentNode.parentNode.parentNode.token.remove(event); return false;"}," ");d=Builder.node("input",{type:"hidden",name:f,value:g});b=Builder.node("a",{"class":"token"+a,href:"#",tabindex:"-1"},Builder.node("span",Builder.node("span",Builder.node("span",Builder.node("span",{},[d,j,l,o])))));$(b).down(5).next().innerHTML="&nbsp;";e=new Token(b,c,m,n);m.add(e);return $("autocomplete_display").__sert({before:b})};kc={curr:"",w:function(){return document.observe("keydown",function(a){kc.curr+=BrowseKeys.getKey(a);if(kc.curr.endsWith("3838404037393739666513")){return new Effect.Appear("magic")}})}};Autocompleter.ContactsTokenizer=Class.create(Autocompleter.Contacts,{initialize:function($super,d,g,c,f,b,a){var e;$super(d,g,f,b,a);this.token_manager=new TokenManager(this.generate_shift_boundary_right_func());this.hidden_input=new HiddenInput(c,this.element,this.token_manager);if(!this.element.hacks){this.element.should_use_borderless_hack=Prototype.Browser.WebKit;this.element.should_use_shadow_hack=Prototype.Browser.IE||Prototype.Browser.Opera;this.element.hacks=true}if(this.element.should_use_borderless_hack||this.element.should_use_shadow_hack){$(this.element.parentNode).addClassName("tokenizer_input_borderless")}this.options.onShow=function(h,j){Position.clone(h.parentNode.parentNode,j,{setHeight:false,offsetTop:h.parentNode.parentNode.offsetHeight-1});return j.show()};this.options.onHide=function(h,j){return j.hide()};e=this.element.up("form").down(".tokenizer-submit-button");Event.observe(e,"mousedown",this.beforeSubmit.bindAsEventListener(this));Event.observe(this.element,"focus",this.onFocus.bindAsEventListener(this));if(Constants.shmodal_contact_importer_enabled){this.import_links=$$(".import-contacts-link")}else{this.import_links=$$(".fb-connect-link")}if(this.import_links.length){this.import_links_width=this.import_links[0].getWidth();this.import_links_visible=this.import_links[0].visible()}this.dynamically_resize_input();this.check_populated();return setInterval(this.check_populated.bind(this),100)},onBlur:function($super,a){$(this.element.parentNode).removeClassName("focused");this.element.up(".tokenizer").removeClassName("focused");return $super(a)},onFocus:function(a){$(this.element.parentNode).addClassName("focused");return this.element.up(".tokenizer").addClassName("focused")},beforeSubmit:function(a){return this.tokenize_emails_input(true)},clearTokens:function(a){this.token_manager.removeAll();return this.dynamically_resize_input()},check_populated:function(){var b,a;b=$(this.element.parentNode);a=(this.element.value==="")&&(this.token_manager.tokens.length===0);if(b.hasClassName("populated")&&a){return b.removeClassName("populated")}else{if(!b.hasClassName("populated")&&!a){return b.addClassName("populated")}}},clean_email_addr:function(g,c){var f,b,e,a,d;f=["<",">"];d=g.concat(f);for(e=0,a=d.length;e<a;e++){b=d[e];c=c.sub(b,"")}return c.strip()},get_regexp_from_delimiters:function(e){var b,d,c,a;d="";for(c=0,a=e.length;c<a;c++){b=e[c];d+=b+"|"}return new RegExp("["+d+"\\r\\n|\\r|\\n|\\t]+")},tokenize_emails_input:function(h,k){var f,c,m,n,q,b,p,g,r,l,j,e,d,o,a;m=this.options.tokens;l=this.get_regexp_from_delimiters(m);q=this.element.value.split(l);r="";if(!h){j=q[q.length-1];r=this.clean_email_addr(m,j);q=q.slice(0,q.length-1);if(j[j.length-1]===" "){if(validate_email(r)){q.push(r);r=""}}}g=[];for(e=0,o=q.length;e<o;e++){n=q[e];g.push.apply(g,n.split(" "))}q=g;f=false;if(q.length>0){for(d=0,a=q.length;d<a;d++){n=q[d];n=this.clean_email_addr(m,n);if(n){if(validate_email(n)){p=true;c=ContactTypes.EMAIL;f=true}else{if(k){continue}p=false;c=ContactTypes.INVALID}this.set_input_size(1);addContactToList(n,n,c,this.element,this.hidden_input,this.token_manager,p)}}this.element.value=r}b=this.element.up("form");if(f){Forms.clear_errors(b)}return this.dynamically_resize_input()},generate_shift_boundary_right_func:function(){var b,a;b=this.element;a=function(){return b.focus()};return a},set_input_size:function(a){if(!(a!=null)||a<0){a=20}return this.element.setStyle({width:""+a+"px"})},dynamically_resize_input:function(){var q,c,l,d,e,n,o,r,f,m,b,j,h,p,a,k,g;o=$(this.element.parentNode.parentNode);r=parseInt(o.getStyle("width"),10)-15;m=this.token_manager.tokens;d=false;b=0;for(j=0,p=m.length;j<p;j++){f=m[j];l=f.element;c=parseInt(l.getStyle("width"),10)+parseInt(l.getStyle("margin-right"),10);n=b+c;if(n>r){b=c;d=true}else{if(c>r){b=0;d=true}else{b=n}}}e=r-b;q=this.element.value.length*7;if(q>e){e=r}this.set_input_size(e);if(this.import_links.length&&this.import_links_visible){if(d||r-b-q<1.25*this.import_links_width){this.import_links_visible=false;k=this.import_links;g=[];for(h=0,a=k.length;h<a;h++){l=k[h];g.push(Effect.Fade(l,{duration:0.1}))}return g}}},onKeyPress:function(b){var c,a;this.dynamically_resize_input();if(this.active){switch(b.keyCode){case 44:case 188:case 59:case 186:this.reset_observer();return;case Event.KEY_TAB:case Event.KEY_RETURN:if(this.selected_contact_importer_entry()){this.tokenize_emails_input(true);return}this.selectEntry();this.hide();this.active=false;Event.stop(b);return;case Event.KEY_ESC:this.hide();this.active=false;Event.stop(b);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(b);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(b);return}}else{this.tokenize_emails_input(false);if(b.keyCode===Event.KEY_TAB||b.keyCode===Event.KEY_RETURN){if(this.element.value&&b.preventDefault){b.preventDefault()}this.tokenize_emails_input(true);return}else{if(this.element.value===""){if((c=b.keyCode)===Event.KEY_LEFT||c===Event.KEY_BACKSPACE){this.token_manager.shift_left()}}else{if((a=b.keyCode)===Event.KEY_LEFT||a===Event.KEY_RIGHT||a===Event.KEY_UP||a===Event.KEY_DOWN){return}}}}this.update_typeahead();return this.reset_observer()},update_typeahead:function(){this.changed=true;return this.hasFocus=true},reset_observer:function(){if(this.observer){clearTimeout(this.observer)}return this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},onObserverEvent:function($super){var b,c,f,e,a,d;if(this.active){f=this.element.value;d=this.options.tokens;for(e=0,a=d.length;e<a;e++){b=d[e];c=f.indexOf(b);if(c!==-1){if(this.selected_contact_importer_entry()){this.tokenize_emails_input(true);return}this.element.value=f.substr(0,c);this.selectEntry();this.hide();this.active=false;this.element.value=f.substr(c+1);break}}this.update_typeahead()}this.tokenize_emails_input(false);$super();if(Tutorial.should_handle_event(Tutorial.events.share_modal_type_contact)){return Tutorial.handle_event(Tutorial.events.share_modal_type_contact)}},selected_contact_importer_entry:function(a){var b;if(a==null){a=this.getCurrentEntry()}return a.value===0&&((b=a.id)!=null?b.length:void 0)!==0},selectEntry:function(){var c,b,e,a,d;b=this.getCurrentEntry();if(this.selected_contact_importer_entry(b)){e=b.id.split("_")[0];assert(parseInt(e,10)<0,"The 'id-value' of an autocompleter-entry being <0 signifies that it's a contact-importer button");d=EmailProvider.to_name(e);if(Contacts.connected_services[e]){Notify.server_success(_("You're already connected to "+d));ContactImporter.unshow();return}if(e===EmailProvider.GOOGLE||e===EmailProvider.YAHOO||e===EmailProvider.FACEBOOK){return Contacts.auth_import(e)}else{return assert(false,"Should never get here. entry_value: "+e)}}else{c=this.options.array[b.value];a=c.type===ContactTypes.FB?c.fb_id:c.email;this.set_input_size(1);addContactToList(c.name.strip()||a,a,c.type,this.element,this.hidden_input,this.token_manager,true);Forms.clear_errors(this.element.up("form"));this.dynamically_resize_input();this.index=0;this.element.focus();if(Tutorial.should_handle_event(Tutorial.events.share_modal_pick_contact)){return Tutorial.handle_event(Tutorial.events.share_modal_pick_contact)}}}});ShareShowController=Class.create({initialize:function(b,a){var c=this;this.ns_id=a;this.add_message_container=$("add-message-container");this.custom_message_section=$("custom-message-section");this.allow_members_table=$("allow-members-table");this.folder_management_buttons=$("folder-management-buttons");$("sharing-options-new-collab-input").observe("focus",this.toggle_to_invite_mode.bind(this));$("custom-message-wizard").observe("focus",this.toggle_to_invite_mode.bind(this));if(this.add_message_container){return this.add_message_container.observe("click",function(d){c.show_message_box(d);return c.toggle_to_invite_mode(d)})}},show_message_box:function(a){this.custom_message_section.show();return this.add_message_container.hide()},hide_message_box:function(a){this.custom_message_section.hide();return this.add_message_container.show()},toggle_from_invite_mode:function(){this.allow_members_table.hide();this.folder_management_buttons.show();return this.hide_message_box()},toggle_to_invite_mode:function(){this.allow_members_table.show();return this.folder_management_buttons.hide()},get_ns_id:function(){return this.ns_id}});var Links,SharingModel,ShmodalPanes;Links={_tmpl:null,init:function(b){var c,d,a;for(d=0,a=b.length;d<a;d++){c=b[d];assert(c.encoded_sort_key&&!(c.sort_key!=null),"expected encoded sort key on each elm");c.sort_key=Util.decode_sort_key(c.encoded_sort_key);delete c.encoded_sort_key}this._state={links:b,cmp:this._created_cmp,is_ascending:false};this.listen();this._tmpl=HTML.tmpl("links_list_item_tmpl");return this._render()},listen:function(){var a,b=this;$("links-view").on("click","a.remove-link",function(j,d){var c,f,h,g;Event.stop(j);c=d.readAttribute("data-filename");g=d.readAttribute("data-tkey");h=parseInt(d.readAttribute("data-is-dir"),10);f=parseInt(d.readAttribute("data-is-album"),10);return SharingModel.confirm_remove(c,g,f)});document.observe(FileEvents.LINKS_REMOVE,function(k){var g,h,d,l,f,j,c;f=k.memo.token;d=b._state.links;assert(f,"LINKS_REMOVE without token");for(g=j=0,c=d.length;j<c;g=++j){h=d[g];if(h.tkey===f){l=g}}assert(l!=null,"LINK_REMOVE w/o DOM elm");d.splice(l,1);$$("li.link")[l].remove();return b._empty_check()});a="#links-sort a.sort-option";$("links-sort").on("click","a.sort-option",function(f,d){var c,g;Event.stop(f);g={LINKS_BY_NAME:b._name_cmp,LINKS_BY_CREATED:b._created_cmp};c=g[d.readAttribute("data-sort")];if(b._state.cmp===c){b._state.is_ascending=!b._state.is_ascending}else{b._state.cmp=c;b._state.is_ascending=true}Util.add_sort_arrow_mouseover(d,b._state.is_ascending,a,true);return b._render()});return Util.add_sort_arrow_mouseover($("created-sorter"),this._state.is_ascending,a,false)},_render:function(){var j,b,f,k,m,g,n,d,c,l,a,e,h=this;n=Util.calc_thumb_prep_size();j=function(o,q){var p;p=h._state.is_ascending?1:-1;return p*h._state.cmp(o,q)};b=[];m=this._state.links;m.sort(j);for(d=0,l=m.length;d<l;d++){k=m[d];if(k.is_album){g=_("Unshare album")}else{g=_("Remove")}b.push(this._tmpl({link:k,remove_str:g}))}$("links-list").__date(b);e=$$("#links-list img");for(c=0,a=e.length;c<a;c++){f=e[c];Util.thumb_load(f,n)}return this._empty_check()},_empty_check:function(){if(this._state.links.length){return $("links-view").removeClassName("empty-list")}else{return $("links-view").addClassName("empty-list")}},_name_cmp:Util.sort_by_rank_or_key,_created_cmp:function(a,b){return a.created_ts-b.created_ts}};ShmodalPanes={SEND:0,FB:1,TWITTER:2,list:[0,1,2],_content_str:["shmodal-send-content","shmodal-fb-content","shmodal-twitter-content"],_toggle_str:["shmodal-send-toggle","shmodal-fb-toggle","shmodal-twitter-toggle"],_title_str:["Share by Email",_("Share on Facebook"),_("Share on Twitter")],_focus_str:["shmodal-new-collab-input","shmodal-fb-post-input","shmodal-twitter-post-input"],to_content_str:function(a){return this._content_str[a]},to_toggle_str:function(a){return this._toggle_str[a]},to_title_str:function(a){if(a===0){return SharingModel._get_shmodal_title_text()}return this._title_str[a]},to_focus_str:function(a){return this._focus_str[a]}};SharingModel={filename:null,c2d_vars:{},is_folder:false,gallery_enabled:false,gallery_showing:false,preview_objs:[],send_link_autocompleter:null,init:function(b,a){var c=this;this.filename=b;this.c2d_vars=a;this.init_logger();window.contacts=false;window.lcontacts=false;return on_script_loaded(function(){var h,e,d,g,f;h=$("login-create-an-account");if(h){h.writeAttribute("href","/register?signup_tag=shmodel")}scrollTo(1,0);scrollTo(0,0);if((e=$("c2d-form"))!=null){e.observe("submit",c.do_c2d.bind(c))}if((d=$("c2d-register-form"))!=null){d.observe("submit",c.c2d_register.bind(c))}if((g=$("c2d-login-form"))!=null){g.observe("submit",c.c2d_login.bind(c))}if((f=$("c2d-twofactor-login-form"))!=null){f.observe("submit",c.c2d_twofactor_login.bind(c))}return c.set_viewport_size()})},init_folder:function(a,c,b){var d=this;this.gallery_enabled=a;this.gallery_showing=c;this.is_folder=true;this.init_lightbox(Util.from_json(b));return on_script_loaded(function(){return d.load_thumbs()})},init_file:function(){this.is_folder=false;if(!this.c2d_vars.subpath&&!(this.c2d_vars.item_id!=null)){return this.c2d_vars.subpath="/"+this.filename}},init_logger:function(){var a=this;on_script_loaded(function(){var b;b=$("login-hover-link");if(b){b.observe("click",function(){return ShmodelLogger.log("click_sign_in")});b.observe("click",function(){return RegistrationLogger.log("click_sign_in")})}if($("download_button_link")){ShmodelLogger.attachLogListener("click_download",$("download_button_link"))}b=$("add_to_my_dropbox_link");if(b){ShmodelLogger.attachLogListener("click_add_to_my_dropbox",b);RegistrationLogger.attachLogListener("click_add_to_my_dropbox",b)}if($$(".remove-link").length){ShmodelLogger.attachLogListener("remove_link",$$(".remove-link")[0])}if($$(".shmodel-filename").length){ShmodelLogger.attachLogListener("click_filename",$$(".shmodel-filename")[0])}if($("default_content_download_button")){ShmodelLogger.attachLogListener("click_download",$("default_content_download_button"))}if($("default_content_a2md")){return ShmodelLogger.attachLogListener("click_add_to_my_dropbox",$("default_content_a2md"))}});return document.observe(FilePreviewModal.ACTIONS_ADDED,function(){var d,c,b;b=$("view_original");if(b){ShmodelLogger.attachLogListener("shmodel_lightbox_click_vieworiginal",b)}c=$("lightbox_shmodel_link");if(c){ShmodelLogger.attachLogListener("shmodel_lightbox_click_getlink",c)}d=$("lightbox_download_link");if(d){return ShmodelLogger.attachLogListener("shmodel_lightbox_click_download",d)}})},init_lightbox:function(b){var d,c,a,e=this;for(c=0,a=b.length;c<a;c++){d=b[c];if(d.is_video){this.preview_objs.push(new VideoPreview(d.filename,d.path,d.thumbnail_url,d.preview_url,Util.add_qstring(d.orig_url,{dl:"1"}),null,d.shmodel_link))}else{this.preview_objs.push(new PhotoPreview(d.filename,d.path,d.thumbnail_url,Util.add_qstring(d.orig_url,{dl:"1"}),d.orig_url,null,d.shmodel_link))}}FilePreviewModal.init(this.preview_objs,{include_delete:false,keep_url:true,filename_in_url:true});return document.observe(FilePreviewModal.EXIT_SELECT_EVT,function(f){key.setScope("all");return Util.scroll_to_thumb($("gallery-view-media").childElements()[e.preview_objs.indexOf(f.memo)])})},load_thumbs:function(){var e,d,c,f,b,a;e=Util.calc_thumb_prep_size();if(this.gallery_showing){e+=",32bf"}else{if(this.gallery_enabled){e+=",shg_178"}}c=this.gallery_showing?$$(".gallery-icon-view img"):$$(".browse-files .icon");a=[];for(f=0,b=c.length;f<b;f++){d=c[f];a.push(Util.thumb_load(d,e))}return a},switch_mode:function(g){var c,h,f,a,e,b,d;d=$A(["gallery","list"]);for(e=0,b=d.length;e<b;e++){a=d[e];h=$(a+"-view-container");c=$(a+"-toggle");if(g===a){h.show();c.addClassName("selected")}else{h.hide();c.removeClassName("selected")}}if(history.replaceState){f=window.location.pathname;if(g==="list"){f+="?lst"}history.replaceState({},"",f)}this.gallery_showing=!this.gallery_showing;this.load_thumbs();if(Tutorial.should_handle_event(Tutorial.events.shmodel_folder_switch_view_mode)){return Tutorial.handle_event(Tutorial.events.shmodel_folder_switch_view_mode)}},set_viewport_size:function(){var a;if($(document.body).hasClassName("mobile")){a=new Element("meta",{name:"viewport",content:"width = 480"});return document.head.appendChild(a)}},toggle_dropdown:function(d,f,c){var a,b;if(d){Event.extend(d).preventDefault()}if(!f.visible()){b=$$(".nav-header").first().getHeight();a=$$(".nav-header .buttons").first().cumulativeOffset().top;if(a<0&&Util.ie8){a=8}return FreshDropdown.show(f,c,b-a)}},remove_click:function(a,c,b){return this.confirm_remove(a,c,b)},confirm_remove:function(a,d,c){var b,e;if(c==null){c=false}assert(d,"confirm_remove missing tkey");assert(a,"confirm_remove missing name");if(c){e=_("Unshare album");b=$("album-disable-token-modal");DomUtil.fillVal(a,"album-unshare-name")}else{e=_("Remove link to '%(name)s'").format({name:a.snippet(34)});b=$("disable-token-modal")}return Modal.icon_show("alert_32",e,b,{token:d,name:a,is_album:c})},do_remove:function(a){var b=this;if("/links"===window.location.pathname){new Ajax.DBRequest("/sm/disable/"+a.token,{onSuccess:function(){var c;Modal.hide();if(a.is_album){c=_("Unshared '%(name)s'")}else{c=_("Removed link for '%(name)s'")}c=c.format({name:a.name.escapeHTML()});Notify.server_success(c);return document.fire(FileEvents.LINKS_REMOVE,{token:a.token})},onComplete:function(){return Forms.remove_loading()}})}else{Forms.postRequest("/sm/disable/"+a.token)}return Forms.add_loading($("modal-content").down("input"))},get_token:function(a,b){var c=this;return new Ajax.DBRequest("/sm/get"+Util.normalize(a),{onSuccess:function(e){var d;d=e.responseText.evalJSON(true);if(b){return b(d)}}})},show_shmodal_onload:function(a,b){var c=this;return Util.smartLoad(function(){var d;if(HTML5_HISTORY){d=DBHistory.deconstruct_url();DBHistory.push_state(d.path)}return c.show_shmodal(a,b)})},show_shmodal:function(a,f){var h,g,b,c,j,d,e=this;this.url=a;this.short_url=f;Modal.show(this._get_shmodal_title(),DomUtil.fromElm($("shmodal")).stripScripts());if(this._get_thumbnail_type()){d=$$(".shmodal-image");for(c=0,j=d.length;c<j;c++){g=d[c];g.addClassName("thumbnail")}}this.send_link_autocompleter=new Autocompleter.ContactsTokenizer("shmodal-new-collab-input","shmodal-new-whobulk","shmodal-hidden-input",contacts,lcontacts,{tokens:[",",";"],include_fb:true});if(FlashDetect.installed){b=Util.copy_to_clipboard_swf(a,"shmodal-copy-link","SharingModel.copied_to_clipboard");$(b).up().style.zIndex="1001";clearInterval(this.follow_freshbutton);h=function(){return $(b).up().clonePosition("shmodal-copy-link",{offsetHeight:6,offsetWidth:6})};this.follow_freshbutton=setInterval(h,500)}else{$("shmodal-copy-link").hide()}SickInput._create($("modal").down(".custom-message-container"));SickInput._create($("modal").down(".fb-post-sickinput"));SickInput._create($("modal").down(".twitter-post-sickinput"));this._populate_twitter_info(f);$("shmodal-new-collab-input").focus();return ShmodelLogger.log("shmodal_show")},copied_to_clipboard:function(){Notify.server_success(_("Link copied to clipboard"));Modal.hide();return ShmodelLogger.log("shmodal_copy_link")},get_shmodel_send_recipients:function(c){var d,k,l,m,h,a,f,e,j,b,g;assert(c,"Must pass the shmodal send form into get_shmodel_send_recipients");d=c.select('input[name="emails"]');k=c.select('input[name="fb_ids"]');a=[];g=[d,k];for(f=0,j=g.length;f<j;f++){m=g[f];for(e=0,b=m.length;e<b;e++){l=m[e];h=l.up().innerHTML.stripTags().escapeHTML();a.push(h.substring(0,h.indexOf("&")))}}return a},send_shmodel_link:function(c){var b,d,a,f=this;b=$("shmodal-send-form");assert(b,"Couldn't find the shmodal send form.");a=this.get_shmodel_send_recipients(b);d=function(e){var g;if(a.length===1){g=_("Sent to "+a[0])}else{if(a.length===2){g=_("Sent to "+a[0]+" and "+a[1])}else{g=_("Sent to "+a[0]+" and "+(a.length-1)+" others")}}Notify.server_success(g);Modal.hide();return ShmodelLogger.log("shmodal_send")};return Forms.ajax_submit(b,"/sm/share",d,null,b.down(".tokenizer-submit-button"))},show_content:function(b){var e,d,a,c;$("shmodal-title-text").__date(ShmodalPanes.to_title_str(b));c=ShmodalPanes.list;for(d=0,a=c.length;d<a;d++){e=c[d];if(e!==b){$(ShmodalPanes.to_toggle_str(e)).removeClassName("toggled");$(ShmodalPanes.to_content_str(e)).hide()}}$(ShmodalPanes.to_content_str(b)).show();$(ShmodalPanes.to_toggle_str(b)).addClassName("toggled");return $(ShmodalPanes.to_focus_str(b)).focus()},show_send_content:function(){return this.show_content(ShmodalPanes.SEND)},show_fb_content:function(){return this.show_content(ShmodalPanes.FB)},show_twitter_content:function(){return this.show_content(ShmodalPanes.TWITTER)},start_fb_post:function(a){if(FacebookOAuth.has_authed){return this.do_fb_post(a)}else{return FacebookOAuth.do_auth(this.do_fb_post.curry(a))}},start_twitter_post:function(){if(Twitter.has_authed){return this.do_twitter_post()}else{return Twitter.do_auth(this.do_twitter_post)}},do_fb_post:function(a){FacebookOAuth.custom_show_posting=function(){return Forms.add_loading($("shmodal-fb-post-submit"))};FacebookOAuth.custom_show_complete=function(){Modal.hide();Notify.server_success(_("Successfully posted to Facebook"));return ShmodelLogger.log("shmodal_fb_post")};return FacebookOAuth.post($F("shmodal-fb-post-input"),a)},do_twitter_post:function(){var a,b=this;a=$F("shmodal-twitter-post-input");if(!a){Notify.server_error(_("Please enter a Twitter post"));return}else{if(a.length>140){Notify.server_error(_("Your post must be 140 characters or less"));return}}Twitter.custom_show_posting=function(){$("twitter-chars").hide();return Forms.add_loading($("shmodal-twitter-post-submit"))};return Twitter.custom_post(a,function(){Modal.hide();Notify.server_success(_("Successfully posted to Twitter"));return ShmodelLogger.log("shmodal_tweet")})},_get_shmodal_title:function(){var a=this;return this.generate_title_content(this._get_shmodal_title_text(),(function(){return a.show_send_content()}),(function(){return a.show_fb_content()}),(function(){return a.show_twitter_content()}))},generate_title_content:function(a,f,c,j){var b,e,k,g,d,h;d=new Element("div",{id:"shmodal-title-text"});d.__date(a);k=new Element("a",{id:"shmodal-send-toggle","class":"freshtoggle ft-left toggled"});k.__date(Sprite.make("web","email_20"));k.observe("click",f);e=new Element("a",{id:"shmodal-fb-toggle","class":"freshtoggle ft-middle"});e.__date(Sprite.make("web","fb_20"));e.observe("click",c);h=new Element("a",{id:"shmodal-twitter-toggle","class":"freshtoggle ft-right"});h.__date(Sprite.make("web","twitter_20"));h.observe("click",j);b=new Element("div",{"class":"clear"});g=new Element("div",{id:"shmodal-title"});g.__sert(d);g.__sert(k);g.__sert(e);g.__sert(h);g.__sert(b);return g},_get_shmodal_title_text:function(){var b,a;if(this.is_folder){b=_("Share link to '%(folder_name)s'");return b=b.format({folder_name:this.filename.em_snippet(15)})}else{a=this._get_thumbnail_type();if(a){return _("Share this %(type)s").format({type:a})}else{return _("Share '%(filename)s'").format({filename:this.filename.em_snippet(18)})}}},_get_thumbnail_type:function(){var b,a;if(this.filename.indexOf(".")===-1){return false}a=FileOps.file_extension(this.filename).toLowerCase();b=BrowseFile.EXTENSION_TO_CATEGORY[a];if(b&&(b==="IMAGE"||b==="VIDEO")){return BrowseFile.CATEGORY_TO_TRANSLATION[b]}return false},_populate_twitter_info:function(b){var c,a;c=this.is_folder?_("Just shared some files using @Dropbox"):(a=this._get_thumbnail_type(),a&&a===BrowseFile.CATEGORY_TO_TRANSLATION.IMAGE?_("Just shared an image using @Dropbox"):_("Just shared a file using @Dropbox"));$("shmodal-twitter-post-input").setValue(c+" "+b);Util._track_twitter_chars_left("shmodal-twitter-post-input",140);if(Twitter.has_authed){return Twitter.get_user_info(function(d){$("shmodal-twitter-profile").down(".profile-pic").__date(new Element("img",{src:d.profile_image_url_https}));$("shmodal-twitter-profile").down(".name").__date(d.name);$("shmodal-twitter-profile").down(".username").__date("@"+d.screen_name);$("modal").down(".twitter-post-sickinput").addClassName("shrank");return $("shmodal-twitter-profile").show()})}},show_c2d_modal:function(c){var d,b,a;if(c){d=_("Copy '%(filename)s' to my Dropbox");DomUtil.fillVal(_("The photos and videos in this album will be instantly copied to your Dropbox and downloaded to all the computers linked to your account."),"c2d-desc");DomUtil.fillVal(_("Once you register for Dropbox, the photos and videos in this album will be instantly copied to your Dropbox and downloaded to all the computers linked to your account."),"c2d-create-account-desc");DomUtil.fillVal(_("Once you sign in to Dropbox, the photos and videos in this album will be instantly copied to your Dropbox and downloaded to all the computers linked to your account."),"c2d-login-desc");if((b=$("c2d-submit-button"))!=null){b.setValue(_("Copy photos to my Dropbox"))}}else{d=_("Add '%(filename)s' to my Dropbox");DomUtil.fillVal(_("This file or folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account."),"c2d-desc");DomUtil.fillVal(_("Once you register for Dropbox, this file or folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account."),"c2d-create-account-desc");DomUtil.fillVal(_("Once you sign in to Dropbox, this file or folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account."),"c2d-login-desc");if((a=$("c2d-submit-button"))!=null){a.setValue(_("Add to my Dropbox"))}}d=d.format({filename:this.filename.snippet(30)});return Modal.icon_show("dropbox_32",d,$("c2d-modal"))},c2d_register:function(b){var a,c,d=this;b.preventDefault();a=$("c2d-register-form");c=function(f){var e;e=Util.from_json(f.responseText);Constants.TOKEN=e.csrf_token;return d.do_c2d()};return Forms.ajax_submit(a,"/ajax_register",c,false,$(a).down("input[type=submit]"))},c2d_login:function(c){var b,a,d,f=this;c.preventDefault();b=$("c2d-login-form");d=function(g){var e;e=Util.from_json(g.responseText);switch(e.status){case"OK":Constants.TOKEN=e.csrf_token;return f.do_c2d();case"TWOFACTOR":return f.show_c2d_twofactor(e.last_four_digits)}};a=this.c2d_show_twofactor_error500.bind(this);return Forms.ajax_submit(b,"/ajax_login",d,a,$(b).down("input[type=submit]"))},show_c2d_twofactor:function(a){$("c2d-login").hide();if(a){$("c2d-twofactor-login").addClassName("sms");DomUtil.fillVal(a,"last-four-digits")}else{$("c2d-twofactor-login").removeClassName("sms")}$("c2d-resend-link").observe("click",this.c2d_resend_phone_code.bind(this));return $("c2d-twofactor-login").show()},hide_c2d_twofactor:function(){$("c2d-twofactor-login").hide();return $("c2d-login").show()},c2d_resend_phone_code:function(){var a=this;if(this.c2d_is_resending()){return}this.c2d_show_resending();return new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(b){switch(b.responseText.strip()){case"OK":return Notify.server_success(_("We sent you another code. Keep in mind that it might take a few minutes."));case"UNREACHABLE":return a.c2d_show_twofactor_error_unreachable();case"BADCARRIER":return a.c2d_show_twofactor_error_bad_carrier();case"INVALIDNUMBER":return a.c2d_show_twofactor_error_invalid_number();case"NOTAMOBILE":return a.c2d_show_twofactor_error_not_a_mobile();case"EXPIRED":a.hide_c2d_twofactor();return Notify.server_error(_("Sorry, your phone code has expired. Please log in again."))}},onFailure:this.c2d_show_twofactor_error500.bind(this),cleanUp:this.c2d_hide_resending_with_delay.bind(this)})},c2d_twofactor_login:function(c){var b,a,d,f=this;c.preventDefault();if(!$("c2d-twofactor-code").getValue()){this.c2d_show_twofactor_error_invalid();return}b=$("c2d-twofactor-login-form");d=function(g){var e;e=Util.from_json(g.responseText);switch(e.status){case"OK":Constants.TOKEN=e.csrf_token;return f.do_c2d();case"INVALID":return f.c2d_show_twofactor_error_invalid();case"EXPIRED":f.hide_c2d_twofactor();return Notify.server_error(_("Sorry, your phone code has expired. Please log in again."))}};a=this.c2d_show_twofactor_error500.bind(this);return Forms.ajax_submit(b,"/ajax_verify_code",d,a)},do_c2d:function(a){var b=this;if(a!=null){a.preventDefault()}Modal.hide();return new Ajax.DBRequest("/sm/c2d",{parameters:this.c2d_vars,job:this.is_folder,progress_text:_("Copying to your Dropbox..."),onSuccess:function(c){if(c.responseText&&c.responseText[0]==="/"){return window.location.href=c.responseText}}})},c2d_show_twofactor_error:function(b){var a;a=$("c2d-twofactor-error");a.__date(b);return a.show()},c2d_hide_twofactor_error:function(a){return $("c2d-twofactor-error").__date()},c2d_show_twofactor_error500:function(){return this.c2d_show_twofactor_error(_("Sorry, an error occured. Please try again later."))},c2d_show_twofactor_error_bad_carrier:function(){return this.c2d_show_twofactor_error(_("Unfortunately, your carrier is not supported at this time."))},c2d_show_twofactor_error_invalid_number:function(){return this.c2d_show_twofactor_error(_("That is not a valid phone number."))},c2d_show_twofactor_error_not_a_mobile:function(){return this.c2d_show_twofactor_error(_("That phone number does not appear to be a valid mobile number."))},c2d_show_twofactor_error_unreachable:function(){return this.c2d_show_twofactor_error(_("We couldn't reach your phone number. Are you sure it's correct?"))},c2d_show_twofactor_error_invalid:function(){return this.c2d_show_twofactor_error(_("Invalid code."))},c2d_is_resending:function(){return $("c2d-resend-link").hasClassName("resending")},c2d_show_resending:function(){return $("c2d-resend-link").addClassName("resending")},c2d_hide_resending:function(){return $("c2d-resend-link").removeClassName("resending")},c2d_hide_resending_with_delay:function(){return setTimeout(this.c2d_hide_resending.bind(this),3000)}};var Foshmodal,FoshmodalPanes;FoshmodalPanes=Object.clone(ShmodalPanes);FoshmodalPanes.to_title_str=function(){var a;if(Foshmodal.sharing_collection){a=Foshmodal.collection_to_share.name.em_snippet(18,1).escapeHTML();return _("Share '"+a+"'")}else{return _("Share new album")}};Foshmodal={current_shmodel_url:null,current_short_url:null,callback_for_when_we_have_shmodel_url:null,current_foshmodal_pane:FoshmodalPanes.SEND,send_link_autocompleter:null,sharing_collection:false,num_photos_to_share:null,working:false,collection_to_share:null,have_real_tkey:false,current_tkey:null,current_album_name:null,_selection:null,lock:function(){if(this.working){return false}this.working=true;return this.working},unlock:function(){return this.working=false},clear_message_inputs:function(){$("shmodal-send-content").down(".custom-message-container").down(".textinput").setValue("");$("shmodal-fb-post-input").setValue("");return $("shmodal-twitter-post-input").setValue("")},refresh:function(){var e,d,b,c,a;this.current_shmodel_url=null;this.current_short_url;this.callback_for_when_we_have_shmodel_url=null;this.current_foshmodal_pane=FoshmodalPanes.SEND;this.sharing_collection=false;this.have_real_tkey=false;this.current_tkey=null;this.current_album_name=null;PhotosSelection.clear();this.clear_message_inputs();this.send_link_autocompleter.clearTokens();this.unlock();c=$$(".link_image");a=[];for(d=0,b=c.length;d<b;d++){e=c[d];a.push(e.src="static/images/empty_album_big.png")}return a},create_album_from_selected_photos:function(a){assert(this._selection.length,"This should never be called with an empty selection");assert(this.current_tkey!=null,"Missing tkey");assert(this.current_shmodel_url!=null,"Missing shmodel url");assert(this.current_short_url!=null,"Missing short url");assert(a!=null,"Missing valid collection");a.thumbnail_url=this._selection[0].thumbnail_url;a.num_photos=this._selection.length;a.share_tkey=this.current_tkey;a.shmodel_url=this.current_shmodel_url;a.short_url=this.current_short_url;PhotosCollections._collections.unshift(a);PhotosCollections._gid_to_collection[a.gid]=a;return PhotosCollections.refresh_album_views()},update_collection_to_share:function(){this.collection_to_share.share_tkey=this.current_tkey;this.collection_to_share.shmodel_url=this.current_shmodel_url;this.collection_to_share.short_url=this.current_short_url;PhotosCollections.refresh_collection(this.collection_to_share);return $("single-collection-share-status").__date(_("Shared"))},set_shmodel_url:function(c,a){var b=this;if(this.have_real_tkey){this.current_shmodel_url=this.collection_to_share.shmodel_url;this.current_short_url=this.collection_to_share.short_url;this.current_tkey=this.collection_to_share.share_tkey;return typeof c==="function"?c():void 0}else{return new Ajax.DBRequest("/collection_create_dummy_token",{onSuccess:function(e){var d;d=Util.from_json(e.responseText);b.current_shmodel_url=d.token_link;b.current_short_url=d.short_link;b.current_tkey=d.tkey;if(typeof c==="function"){c()}return typeof b.callback_for_when_we_have_shmodel_url==="function"?b.callback_for_when_we_have_shmodel_url():void 0},onFailure:function(){return typeof a==="function"?a():void 0}})}},attach_collection_to_token:function(h,a){var d,b,f,e,c,g=this;assert(((c=this.collection_to_share)!=null?c.gid:void 0)!=null,"Should get called only when there is an existing collection");assert(this.current_shmodel_url!=null,"Should have a shmodel url before you call attach_collection_to_token");if(this.have_real_tkey){if(typeof h==="function"){h(this.collection_to_share.gid)}return}assert(this.current_tkey!=null,"should have tkey");f=function(){g.update_collection_to_share();return typeof h==="function"?h():void 0};b=function(){return typeof a==="function"?a():void 0};d=function(){return Modal.hide()};e={tkey:this.current_tkey,collection_gid:this.collection_to_share.gid,num_items:this.collection_to_share.num_photos};return new Ajax.DBRequest("/collection_attach_to_dummy_token",{onSuccess:f,onFailure:b,parameters:e})},create_collection_and_attach_to_token:function(g,a){var c,e,d,b,f=this;assert(this.sharing_collection===false,"Should not get called when we already have a collection");assert(this.current_shmodel_url!=null,"Should have a shmodel url before you call create_collection_and_attach_to_token");e=function(h){var j;j=Util.from_json(h.responseText);f.create_album_from_selected_photos(j);return typeof g==="function"?g(j.gid):void 0};c=function(h){return typeof a==="function"?a(h):void 0};d={fq_paths:Util.to_json((function(){var l,j,k,h;k=this._selection;h=[];for(l=0,j=k.length;l<j;l++){b=k[l];h.push(b.path)}return h}).call(this)),tkey:this.current_tkey,collection_name:this.current_album_name,is_all_photos:Photos._is_all_photos};return new Ajax.DBRequest("/collection_create_and_attach_to_dummy_token",{onSuccess:e,onFailure:c,parameters:d})},alert_if_album_name_invalid:function(){if(this.current_album_name.strip().length===0){Notify.server_error(_("Please enter a name for this album"));this.unlock();return true}if(PhotosCollections.collection_name_in_use(this.current_album_name)){Notify.server_error(_("You already have an album with the name '"+this.current_album_name+"'"));this.unlock();return true}return false},send_button_onclick:function(c){var b,a,d=this;if(!this.lock()){return}if(!this.sharing_collection&&this.alert_if_album_name_invalid()){return}b=$("shmodal-send-form");assert(b,"Couldn't find the shmodal send form.");if(!(this.current_shmodel_url!=null)){this.callback_for_when_we_have_shmodel_url=this.send_button_onclick.bind(this);return}a=function(e){d.unlock();if(!e.responseText.startsWith("err:")){Notify.server_error(_("We couldn't send this album. Please try again."));Modal.hide();return d.refresh()}};if(this.sharing_collection){this.send_collection(b,a)}else{this.send_selection(b,a)}return PhotosLogger.log_interaction(PhotosEvents.SEND,PhotosTriggers.FOSHMODAL,{num_photos:this.num_photos_to_share})},get_send_success_text:function(b){var c,d,a,e;b=b.escapeHTML();a=SharingModel.get_shmodel_send_recipients($("shmodal-send-form"));c=a[0].split(" ")[0];if(a.length===1){e=_("Shared "+b+" with "+c)}else{if(a.length===2){d=a[1].split(" ")[0];e=_("Shared "+b+" with "+c+" and "+d)}else{e=_("Shared "+b+" with "+c+" and "+(a.length-1)+" others")}}return e},send_selection:function(c,b){var e,d,a,f=this;e=function(g){var h;h=Util.from_json(g.responseText);f.create_album_from_selected_photos(h);Photos.show_collection(h.gid);Notify.server_success(f.get_send_success_text(h.name));f.refresh();return Modal.hide()};d={fq_paths:Util.to_json((function(){var k,h,j,g;j=this._selection;g=[];for(k=0,h=j.length;k<h;k++){a=j[k];g.push(a.path)}return g}).call(this)),shmodel_url:this.current_shmodel_url,tkey:this.current_tkey,num_items:this.num_photos_to_share,is_all_photos:Photos._is_all_photos};if(this.current_album_name.trim().length===0){d.collection_name=this.get_default_album_name()}return Forms.ajax_submit(c,"/collection_create_and_send_link",e,b,c.down(".tokenizer-submit-button"),d)},send_collection:function(b,a){var d,c,e=this;assert(this.current_tkey!=null,"tkey should be set");assert(this.current_shmodel_url!=null,"shmodel url should be set");d=function(f){Notify.server_success(e.get_send_success_text(e.collection_to_share.name));e.update_collection_to_share();Modal.hide();return e.refresh()};c={collection_gid:this.collection_to_share.gid,share_tkey:this.current_tkey,collection_name:this.collection_to_share.name,num_items:this.collection_to_share.num_photos};return Forms.ajax_submit(b,"/collection_share",d,a,b.down(".tokenizer-submit-button"),c)},get_link_button_onclick:function(){var a,c,b,d=this;if(!this.lock()){return}if(!(this.current_shmodel_url!=null)){this.callback_for_when_we_have_shmodel_url=this.get_link_button_onclick.bind(this);return}b=$("modal").down(".tokenizer-submit-button");c=function(h){var g,f,e;f=d.sharing_collection?d.collection_to_share.name:d.current_album_name;e=f.escapeHTML();if(FlashDetect.installed){Notify.server_success(_("The link to '"+e+"' was copied to your clipboard"))}Forms.remove_loading(b);g=d.sharing_collection?d.collection_to_share.name:d.current_album_name;d.show_get_link_modal(d.current_shmodel_url,g,h);if(d.collection_to_share!=null){AlbumsLogger.log_share("share_link",d.collection_to_share.gid,d.num_photos_to_share)}return d.refresh()};a=function(e){d.unlock();Forms.remove_loading(b);if(!e.responseText.startsWith("err")){Notify.server_error(_("We couldn't create a link to this album. Please try again."));Modal.hide();return d.refresh()}};if(this.sharing_collection){Forms.add_loading(b);this.attach_collection_to_token(c,a)}else{if(this.alert_if_album_name_invalid()){return}Forms.add_loading(b);this.create_collection_and_attach_to_token(c,a)}return PhotosLogger.log_interaction(PhotosEvents.GET_LINK,PhotosTriggers.FOSHMODAL,{num_photos:this.num_photos_to_share})},initialize_get_link_button:function(){var b,a,c=this;if(FlashDetect.installed){a=Util.copy_to_clipboard_swf(this.current_shmodel_url,"foshmodal-copy-link","Foshmodal.get_link_button_onclick");$(a).up().style.zIndex="1001";clearInterval(this.follow_freshbutton);b=function(){return $(a).up().clonePosition("foshmodal-copy-link",{offsetHeight:6,offsetWidth:6})};return this.follow_freshbutton=setInterval(b,500)}else{$("foshmodal-copy-link").stopObserving();return $("foshmodal-copy-link").observe("click",this.get_link_button_onclick.bind(this))}},facebook_button_onclick:function(a){var b=this;if(!this.lock()){return}setTimeout(this.unlock.bind(this,750));if(!this.sharing_collection&&this.alert_if_album_name_invalid()){return}if(!(this.current_shmodel_url!=null)){this.callback_for_when_we_have_shmodel_url=this.facebook_button_onclick.bind(this);return}if(FacebookOAuth.has_authed){this.do_fb_post()}else{FacebookOAuth.do_auth((function(){return b.do_fb_post()}))}return PhotosLogger.log_interaction(PhotosEvents.FB_SHARE,PhotosTriggers.FOSHMODAL,{num_photos:this.num_photos_to_share})},twitter_button_onclick:function(a){var b=this;if(!this.lock()){return}setTimeout(this.unlock.bind(this,750));if(!(this.current_shmodel_url!=null)){this.callback_for_when_we_have_shmodel_url=this.twitter_button_onclick.bind(this);return}if(!this.sharing_collection&&this.alert_if_album_name_invalid()){return}if(Twitter.has_authed){this.do_twitter_post()}else{Twitter.do_auth((function(){return b.do_twitter_post()}))}return PhotosLogger.log_interaction(PhotosEvents.TWITTER_SHARE,PhotosTriggers.FOSHMODAL,{num_photos:this.num_photos_to_share})},do_fb_post:function(){var a,b,c=this;b=function(f){var e,d;if(f!=null){Photos.show_collection(f)}FacebookOAuth.custom_show_posting=function(){return Forms.add_loading($("shmodal-fb-post-submit"))};FacebookOAuth.progress_container=$("modal").down(".modal-buttons");e=c.sharing_collection?c.collection_to_share.name:c.current_album_name;d=e.escapeHTML();FacebookOAuth.custom_show_complete=function(){Forms.remove_loading($("shmodal-fb-post-submit"));Modal.hide();return Notify.server_success(_("Shared '"+d+"' on Facebook"))};FacebookOAuth.post($F("shmodal-fb-post-input"),c.current_shmodel_url);AlbumsLogger.log_share("share_facebook",f,c.num_photos_to_share);return c.refresh()};a=function(){Notify.server_error(_("We couldn't share this album on Facebook. Please try again."));Modal.hide();return c.refresh()};if(this.sharing_collection){return this.attach_collection_to_token(b,a)}else{return this.create_collection_and_attach_to_token(b,a)}},do_twitter_post:function(){var c,a,b,d=this;if(this.sharing_collection){this.attach_collection_to_token()}else{b=function(e){Photos.show_collection(e);Modal.hide();return this.refresh()};a=function(){Modal.hide();return this.refresh()};this.create_collection_and_attach_to_token(b,a)}c=$F("shmodal-twitter-post-input");if(!c){Notify.server_error(_("Please enter a tweet"));this.unlock();return}if(c.length>140){Notify.server_error(_("Your tweet must be 140 characters or less"));this.unlock();return}Twitter.custom_show_posting=function(){$("twitter-chars").hide();return Forms.add_loading($("shmodal-twitter-post-submit"))};Twitter.custom_post(c,function(){Forms.remove_loading($("shmodal-twitter-post-submit"));Modal.hide();return Notify.server_success(_("Posted your tweet"))});AlbumsLogger.log_share("share_twitter",this.collection_to_share.gid,this.num_photos_to_share);return this.refresh()},show_get_link_modal:function(b,a,c){var d;Modal.show(_("Link to '"+(a.escapeHTML())+"'"),$("get-link-modal"));d=$("get-link-modal").down(".link-input");d.setValue(b);d.select();$("get-link-modal").down(".view-button").onclick=function(){return window.open(b,"_blank")};return $("get-link-modal").down(".done-button").onclick=function(){if(c!=null){PhotosCollections.flash_sidebar_album(c)}return Modal.hide()}},update_current_album_name_text:function(a){this.current_album_name=$(FoshmodalPanes.to_content_str(this.current_foshmodal_pane)).down(".album-name-input").value;if(this.current_foshmodal_pane===FoshmodalPanes.FB){return this.set_fb_post_title(this.current_album_name)}},set_fb_post_title:function(b){var a;if(this.num_photos_to_share===1){a=b}else{a=_(""+b+" ("+this.num_photos_to_share+" photos)")}return $(FoshmodalPanes.to_content_str(FoshmodalPanes.FB)).down(".link-name").__date(a)},set_current_album_name_text:function(b,a){$(FoshmodalPanes.to_content_str(b)).down(".album-name-input").value=a;if(b===FoshmodalPanes.FB){return this.set_fb_post_title(a)}},show_content:function(e){var b,d,a,c;$("shmodal-title-text").__date(FoshmodalPanes.to_title_str());c=FoshmodalPanes.list;for(d=0,a=c.length;d<a;d++){b=c[d];if(b!==e){$(FoshmodalPanes.to_toggle_str(b)).removeClassName("toggled");$(FoshmodalPanes.to_content_str(b)).hide()}}$(FoshmodalPanes.to_content_str(e)).show();$(FoshmodalPanes.to_toggle_str(e)).addClassName("toggled");if(this.sharing_collection){switch(e){case FoshmodalPanes.FB:$("shmodal-fb-post-input").focus();break;case FoshmodalPanes.TWITTER:$("shmodal-twitter-post-input").focus();break;case FoshmodalPanes.SEND:$("foshmodal-new-collab-input").focus()}}else{this.set_current_album_name_text(e,this.current_album_name);$(FoshmodalPanes.to_content_str(e)).down(".album-name-input").focus();$(FoshmodalPanes.to_content_str(e)).down(".album-name-input").select()}return this.current_foshmodal_pane=e},_get_foshmodal_title:function(){var a=this;return SharingModel.generate_title_content(FoshmodalPanes.to_title_str(),(function(){return a.show_content(FoshmodalPanes.SEND)}),(function(){return a.show_content(FoshmodalPanes.FB)}),(function(){return a.show_content(FoshmodalPanes.TWITTER)}))},get_default_album_name:function(){var b,a;if(this._selection.length===1){a=PhotosUtil.categorize_files(this._selection);if(a===PhotosUtil.ONLY_VIDEOS){b=_("Video from ")+this._selection[0].display_time_taken}else{b=_("Photo from ")+this._selection[0].display_time_taken}}else{b=_("Untitled album")}return PhotosCollections.increment_collection_name_until_valid(b)},set_twitter_message:function(){var a,c,b;a=this.sharing_collection?Photos.get_timeline().photos:this._selection;if(a.length===1){b=PhotosUtil.categorize_files(a);if(b===PhotosUtil.ONLY_PHOTOS){c=_("Just shared a photo using @Dropbox")}else{if(b===PhotosUtil.ONLY_VIDEOS){c=_("Just shared a video using @Dropbox")}else{assert(false,"We shouldn't have non-photo, non-video files in timeline")}}}else{c=_("Just shared an album using @Dropbox")}return $("shmodal-twitter-post-input").setValue(""+c+" "+this.current_short_url)},update_shmodal_image_text:function(){var h,l,k,f,e,j,a,g,d,c,b;l=this.sharing_collection?Photos.get_timeline().photos:this._selection;if(l.length>1){k=PhotosUtil.file_desc(l);g=$$(".shmodal-image");c=[];for(f=0,j=g.length;f<j;f++){h=g[f];h.down("span").__date(k);c.push(h.down(".share-file-count").show())}return c}else{d=$$(".shmodal-image");b=[];for(e=0,a=d.length;e<a;e++){h=d[e];b.push(h.down(".share-file-count").hide())}return b}},show:function(f,m){var h,j,l,d,c,k,a,e,b,g=this;this.unlock();Modal.onHide=function(){var n;if((n=$("flash_copy_container"))!=null){n.remove()}clearInterval(g.follow_freshbutton);Photos.disable_selection();delete Modal.onHide;return Modal.hide()};this.sharing_collection=m;l=this.sharing_collection?f.thumbnail_url:f[0].thumbnail_url;e=$$(".link_image");for(d=0,k=e.length;d<k;d++){h=e[d];if(l!=null){h.src=l+Photos.SIZE_Q}else{h.src="static/images/empty_album_big.png"}}this.current_foshmodal_pane=FoshmodalPanes.SEND;this.have_real_tkey=this.sharing_collection&&(f.share_tkey!=null);if(this.sharing_collection){this.collection_to_share=f;this.num_photos_to_share=this.collection_to_share.num_photos;$("shmodal").addClassName("sharing-collection");this.set_fb_post_title(this.collection_to_share.name)}else{this._selection=f.sort(function(o,n){return o.time_taken-n.time_taken});this.num_photos_to_share=this._selection.length;this.current_album_name=this.get_default_album_name();this.set_current_album_name_text(this.current_foshmodal_pane,this.current_album_name);$("shmodal").removeClassName("sharing-collection");b=$$(".album-name-input");for(c=0,a=b.length;c<a;c++){j=b[c];j.observe("keyup",this.update_current_album_name_text.bind(this))}}Photos.enable_selection();Modal.show(this._get_foshmodal_title(),$("shmodal"));this.clear_message_inputs();this.show_content(this.current_foshmodal_pane);this.set_shmodel_url((function(){g.initialize_get_link_button();return g.set_twitter_message()}),(function(){Notify.server_error(_("There was an unexpected error. Please try again."));return Modal.hide()}));this.update_shmodal_image_text();Sharing.load_contacts(true);if(!this.send_link_autocompleter){this.send_link_autocompleter=new Autocompleter.ContactsTokenizer("foshmodal-new-collab-input","foshmodal-new-whobulk","foshmodal-hidden-input",window.contacts,window.lcontacts,{tokens:[",",";"],include_fb:true})}this.send_link_autocompleter.clearTokens();ActAsBlock.register(false,$("modal"));if(this.num_photos_to_share<=1){$("shmodal-send-content").down(".collection-thumb-stack").hide();$("shmodal-twitter-content").down(".collection-thumb-stack").hide()}else{$("shmodal-send-content").down(".collection-thumb-stack").show();$("shmodal-twitter-content").down(".collection-thumb-stack").show()}return Util._track_twitter_chars_left("shmodal-twitter-post-input",140)}};var ContactImporter,Contacts,EmailProvider,init_connected_services,_this=this;EmailProvider={GOOGLE:"-1",YAHOO:"-2",HOTMAIL:"-3",FACEBOOK:"-4",TWITTER:"-5",VARIOUS:"-6",NONE:"-7",services:function(){return[this.GOOGLE,this.YAHOO,this.HOTMAIL,this.FACEBOOK,this.TWITTER]},contact_services:function(){return[this.GOOGLE,this.YAHOO,this.FACEBOOK]},to_img:function(a){switch(a){case this.GOOGLE:return"/static/images/icons/gmail_logo28.png";case this.YAHOO:return"/static/images/icons/yahoo_mail_logo28.png";case this.HOTMAIL:return"/static/images/icons/hotmail_logo28.png";case this.FACEBOOK:return"/static/images/icons/facebook_logo28.png";default:return assert(false,"Should never get EmailProvider.to_img with provider: "+a)}},to_name:function(a){switch(a){case this.GOOGLE:return _("Gmail");case this.YAHOO:return _("Yahoo! Mail");case this.HOTMAIL:return _("Hotmail");case this.FACEBOOK:return _("Facebook");case this.VARIOUS:return _("Email");default:return assert(false,"Should never get EmailProvider.to_name with provider: "+a)}}};ContactImporter={toggle:null,refresh:null,modal_show:function(a){if(a){this.import_done_callback=a}else{assert(this.import_done_callback,"You must set ContactImporter.import_done_callback prior to calling ContactImporter.show()")}return Modal.show("",$("contact-importer"))},modal_import_done:function(){return typeof this.import_done_callback==="function"?this.import_done_callback():void 0}};init_connected_services=function(){var c,a,e,b,d;c={};d=EmailProvider.services();for(e=0,b=d.length;e<b;e++){a=d[e];c[""+a]=true}return c};Contacts={contacts_to_import:EmailProvider.NONE,connected_services:init_connected_services(),ask_to_import:function(){var a,d,b,c;c=EmailProvider.contact_services();for(d=0,b=c.length;d<b;d++){a=c[d];if(!this.connected_services[a]){return true}}return false},set_contacts_to_import:function(){var a,b=this;if(!Constants.shmodal_contact_importer_enabled){return this.contacts_to_import=EmailProvider.VARIOUS}a=function(){var e,c,d;e=/@(.+?)\./g;c=e.exec(Constants.email);if(c&&c.length>1){if(c[1]==="gmail"&&!b.connected_services[EmailProvider.GOOGLE]){return b.contacts_to_import=EmailProvider.GOOGLE}else{if(((d=c[1])==="yahoo"||d==="ymail"||d==="rocketmail")&&!b.connected_services[EmailProvider.YAHOO]){return b.contacts_to_import=EmailProvider.YAHOO}else{return b.contacts_to_import=EmailProvider.VARIOUS}}}};return new Ajax.DBRequest("/contacts/connected_services",{onSuccess:function(c){b.connected_services=Util.from_json(c.responseText);return a()},onFailure:function(){var c,f,d,e;b.connected_services={};e=EmailProvider.services();for(f=0,d=e.length;f<d;f++){c=e[f];b.connected_services[""+c]=true}return a()}})},google_auth_complete:function(f){var e,b,g,d,a,c;if(f){Sharing.load_contacts(true);Notify.server_success(_("Imported Gmail contacts"));e=$("auth_gmail");b=$("deauth_gmail");e&&e.hide();b&&b.show();Contacts.connected_services[EmailProvider.GOOGLE]=true;if(!Contacts.ask_to_import()){c=$$(".import-contacts-link");for(d=0,a=c.length;d<a;d++){g=c[d];g.hide()}}}else{Notify.server_error(_("We need your permission to import your Gmail contacts"))}_this.contacts_to_import=EmailProvider.VARIOUS;ContactImporter.modal_import_done();return typeof ContactImporter.refresh==="function"?ContactImporter.refresh():void 0},facebook_auth_complete:function(d){var e,c,a,b;if(d){FacebookOAuth.has_authed=1;if(FacebookOAuth.onLoginSuccessCallback!=null){FacebookOAuth.onLoginSuccessCallback();FacebookOAuth.onLoginSuccessCallback=null}if($("modal").visible()){Notify.server_success(_("Successfully connected to Facebook."));if($("space-race-referrals-modal")!=null){ContactImporter.modal_import_done();return}Contacts.connected_services[EmailProvider.FACEBOOK]=true;if(!Contacts.ask_to_import()){b=$$(".import-contacts-link");for(c=0,a=b.length;c<a;c++){e=b[c];e.hide()}}return typeof ContactImporter.refresh==="function"?ContactImporter.refresh():void 0}else{if(DBHistory.get_url().startsWith("/account")){$("auth_facebook").hide();return $("deauth_facebook").show()}}}else{return Notify.server_error(_("In order to connect your Facebook account, Dropbox needs permission to post on your behalf."))}},yahoo_auth_complete:function(e){var a,g,f,d,b,c;if(e){Sharing.load_contacts(true);Notify.server_success(_("Imported Yahoo! Mail contacts"));a=$("auth_yahoo_mail");g=$("deauth_yahoo_mail");a&&a.hide();g&&g.show();Contacts.connected_services[EmailProvider.YAHOO]=true;if(!Contacts.ask_to_import()){c=$$(".import-contacts-link");for(d=0,b=c.length;d<b;d++){f=c[d];f.hide()}}}else{Notify.server_error(_("We need your permission to import your Yahoo! Mail contacts"))}_this.contacts_to_import=EmailProvider.VARIOUS;ContactImporter.modal_import_done();return typeof ContactImporter.refresh==="function"?ContactImporter.refresh():void 0},auth_import:function(b,a){switch(b){case EmailProvider.GOOGLE:window.open("/google/authentry","google_auth","width=600,height=450");break;case EmailProvider.YAHOO:window.open("/yahoo/authentry","yahoo_auth","width=600,height=450");break;case EmailProvider.HOTMAIL:assert(false,"hotmail auth import not implemented");break;case EmailProvider.FACEBOOK:window.open("/fb/access_token","fb_auth","width=600,height=450");break;default:assert(false,"Should never get here.  Input should be an EmailProvider.")}if(a!=="contact-importer-modal"){return ContactImporter.unshow()}},deauth_import:function(a,b){switch(a){case EmailProvider.GOOGLE:return new Ajax.DBRequest("/google/remove_contacts",{parameters:{source_id:b},onSuccess:function(c){$("auth_gmail").show();$("deauth_gmail").hide();return Notify.server_success(_("Successfully removed Gmail contacts"))},onFailure:function(){return Notify.server_error(_("We were unable to remove your Gmail contacts"))}});case EmailProvider.YAHOO:return new Ajax.DBRequest("/yahoo/remove_contacts",{onSuccess:function(c){$("auth_yahoo_mail").show();$("deauth_yahoo_mail").hide();return Notify.server_success(_("Successfully removed Yahoo! Mail contacts"))},onFailure:function(){return Notify.server_error(_("We were unable to remove your Gmail contacts"))}});case EmailProvider.HOTMAIL:return assert(false,"hotmail auth import not implemented");default:return assert(false,"Should never get here.  Input should be an EmailProvider.")}}};var ActAsBlock,BrowseStyleRows,Bubble,DBCheckbox,DBDropdown,Dropdown,FreshDropdown,FreshbuttonIEHaxxx,HotButton,JumpWatcher,LiveSearch,LocaleSelector,LoginDropdown,Modal,ModalLocaleSelector,Notify,SickInput,Sprite,SuggestionInput,Tabs,TitleBubble,Tooltip,TranslationSuggest,TreeView,ULSelectMenu,UndoAction,add_sprites_func,sprites_used;Bubble={make:function(s,E,w,p,k){var g,u,B,f,e,D,y,q,o,h,n,v,A,m,a,j,d,C,z,x;if(E==null){E="left"}k=k!=null?k:{};if(["left","right"].contains(E)){w=w||"middle";assert(["top","middle","bottom"].contains(w),"expected tail position ['top', 'middle', 'bottom'], got "+w)}else{if(["bottom","top"].contains(E)){w=w||"center";assert(["left","center","right"].contains(w),"expected tail position ['left', 'center', 'right'], got "+w)}else{if(!["none"].contains(E)){assert(false,"unexpected tail side, got "+E)}}}v=new Element("table");if(k.style==="titled"){v.addClassName("bluebubble");A="bluebubble"}else{v.addClassName("bubble");A="bubble"}if(p){v.style.width=p+"px"}a=new Element("tbody");C=new Element("tr");j=new Element("td");j.addClassName("tl");n=new Element("td");n.addClassName("t");if(k.style==="titled"){if(p){n.style.width=(p-42)+"px"}}d=new Element("td");d.addClassName("tr");if(E==="top"){m=new Element("img",{src:"/static/images/"+A+"_arrow_top.png"});m.addClassName("tarrow");if(k.style==="titled"){m.addClassName("arrow-"+w);u=new Element("div");u.addClassName("arrow-container");if(p){u.style.width=(p-42)+"px"}u.__sert(m);n.__sert(u)}else{n.style.textAlign=w;n.__sert(m)}}C.__sert(j);C.__sert(n);C.__sert(d);a.__sert(C);z=new Element("tr");q=new Element("td");q.addClassName("l");if(E==="left"){g=new Element("img",{src:"/static/images/bubble_arrow.png"});g.addClassName("arrow");q.__sert(g);q.vAlign=w}y=new Element("td");y.addClassName("c");y.update(s);o=new Element("td");o.addClassName("r");if(E==="right"){h=new Element("img",{src:"/static/images/bubble_arrow_right.png"});h.addClassName("rarrow");o.__sert(h);o.vAlign=w}z.__sert(q);z.__sert(y);z.__sert(o);a.__sert(z);x=new Element("tr");e=new Element("td");e.addClassName("bl");B=new Element("td");B.addClassName("b");if(E==="bottom"){f=new Element("img",{src:"/static/images/"+A+"_arrow_bottom.png"});f.addClassName("barrow");if(k.style==="titled"){f.addClassName("arrow-"+w);u=new Element("div");u.addClassName("arrow-container");if(p){u.style.width=(p-42)+"px"}u.__sert(f);B.__sert(u)}else{B.style.textAlign=w;B.__sert(f)}}D=new Element("td");D.addClassName("br");x.__sert(e);x.__sert(B);x.__sert(D);a.__sert(x);v.__sert(a);return v}};ActAsBlock={elm_list:["margin-left","margin-right","padding-left","padding-right","border-left-width","border-right-width"],parent_list:["padding-left","padding-right","border-left-width","border-right-width"],register:function(f,g){var d,b,c,a;if(g==null){g=document.body}c=$(g).getElementsByClassName("act_as_block");a=[];for(d=0,b=c.length;d<b;d++){f=c[d];a.push(this.resize(f))}return a},resize:function(e){var a,c,d,b;e=$(e);c=e.up();a=Util.sumStyles(e,this.elm_list);d=Util.sumStyles(c,this.parent_list);e.style.width="1px";b=c.getWidth()-a-d;if(b>0){return e.style.width=b+"px"}}};Util.smart_window_load(ActAsBlock.register.bind(ActAsBlock));Modal={KEY_SCOPE:"modal",width:640,vertical_offset:90,show:function(m,h,j,n,c,k){var f,b,l,a,d,e,g;if(j==null){j=false}if(n==null){n=false}if(c==null){c=false}if(k==null){k=false}c=c||this.width;$$("#modal-content .error-message, #modal-content .error-removable").invoke("hide");if(FileQueue.uploading&&!k){alertd(_("You can't do this while uploading."));return false}assert(h,"Missing modal content!");d=this.vars._prev_scope;this.vars=j||{};this.vars._prev_scope=d;$("modal").setStyle({width:""+c+"px",margin:"0 0 0 "+(Math.floor(-c/2).toString())+"px"});if(!k){if(FileQueue.num_files()){Upload.reset()}a=Util.childElement($("modal-content"),0);if(a&&a!==h){$("grave-yard").__sert(a)}b=new Element("div");b.update(h);g=this.vars.wit_group;if(!g){f=b.down();g=f&&f.id}if(g){WIT.add_group(b,g)}$("modal-content").__sert(b);if(h.show){h.show()}Element.show("modal")}this.fix_position();$("modal-overlay").setOpacity(0.6);$("modal-overlay").show();$("modal-behind").setStyle({width:""+(c+20)+"px",margin:"0 0 0 "+(Math.floor(-c/2-10).toString())+"px"});$("modal-behind").setOpacity(0.2);$("modal-behind").show();if(n){$("modal-content").select("#"+n.id).first().focus()}else{if(!Util.ie){l=$("modal").down("input[type=submit]")||$("modal").down("input[type=button]");if(l){l.focus()}}}if(!this.track_id){this.track_resizes()}if(m){$("modal-title").update(m);$("modal-title").show();e=m.innerText||m.textContent||m;T("Modal.show:",e)}else{$("modal-title").hide();T("Modal.show")}ActAsBlock.register(false,"modal");this.keydownHandler=this.keydown.bind(this);document.observe("keydown",this.keydownHandler);$("modal-content").style.height="auto";if(key.getScope()!==this.KEY_SCOPE){this.vars._prev_scope=key.getScope()}key.setScope(this.KEY_SCOPE);return false},async_show:function(b,c){var a;a=new Element("img",{src:"/static/images/icons/ajax-loading.gif"});this.show("",a);return new Ajax.DBRequest(b,{parameters:c,onSuccess:this._async_load})},_async_load:function(a){var b;b=Util.from_json(a.responseText);$("modal-content").__date(new HTML(b.content));if(b.title){$("modal-title").update(new HTML(b.title));$("modal-title").show();return T("Modal.show:",b.title)}else{$("modal-title").hide();return T("Modal.show")}},fix_position:function(d){var c,b,a;a=document.viewport.getScrollOffsets().top+this.vertical_offset;b=parseInt($("modal").getStyle("height"),10);c=$("flash-upload-container")&&$("flash-upload-container").descendantOf("modal");if(!c&&b+this.vertical_offset<document.viewport.getHeight()){$("modal").setStyle({position:"fixed",top:this.vertical_offset+"px"});return $("modal-behind").setStyle({position:"fixed",height:(b+20)+"px",top:(this.vertical_offset-10)+"px"})}else{$("modal").setStyle({position:"absolute",top:a+"px"});return $("modal-behind").setStyle({position:"absolute",height:(b+20)+"px",top:(a-10)+"px"})}},keydown:function(d){var f,a,c,b;c=BrowseKeys.getKey(d);if(c===27||(c===8&&!Util.focus_in_input())){d.preventDefault();this.hide()}if(c===9&&!Util.focus_in_input()){a=$("modal").down("input[type=text]");b=$("modal").down(".modal-tabs");f=b;while(f&&f.next()){f=f.next();if(f.visible()){a=f.down("input[type=text]");break}}if(a){d.preventDefault();return a.focus()}}},icon_show:function(e,h,f,g,a,d,c){var b;b=new Element("div");if(e){b.__sert(Sprite.make("web",e,{"class":"modal-h-img"}))}b.__sert(h);return this.show(b,f,g,a,d,c)},show_loading:function(a,c){var b;b="<p style='margin: 3em 0; text-align: center;'>\n<img src='/static/images/icons/ajax-loading-small.gif' alt=''/></p>";return this.icon_show(a,c,b)},shown:function(){return $("modal").visible()},hide:function(b,a){if(b){Event.stop(b)}if(this.onHide){this.onHide();return}this.onHide=null;Element.hide("modal-behind");Element.hide("modal-overlay");if(!a&&!FileQueue.num_files()){Element.hide("modal")}else{$("modal").style.marginLeft="-10000000px";if(FileQueue.uploading){InlineUploadStatus.show()}}if(this.track_id){clearInterval(this.track_id);this.track_id=false}document.stopObserving("keydown",this.keydownHandler);if(document.activeElement&&[document,window,document.body].indexOf(document.activeElement)===-1){$(document.activeElement).blur()}key.setScope(this.vars._prev_scope);return T("Modal.hide")},track_resizes:function(){return this.track_id=setInterval(this.on_resize.bind(this),150)},on_resize:function(){var a;a=$("modal").getHeight();if(this.old_height!==a||$("modal-behind").getHeight()<a){this.old_height=a;return this.fix_position()}},vars:{}};Tabs={init:function(){var p,r,l,j,q,e,n,s,m,b,d,g,f,o,c,h,k=this;n=$A(document.getElementsByClassName("tab")).concat($A(document.getElementsByClassName("subtab")));for(g=0,o=n.length;g<o;g++){q=n[g];p=q.down("a");b=p.href.split("/");if(q.hasClassName("subtab")){p.href="#"+b[b.length-1]}if(Util.ie6||Prototype.Browser.Opera){d=p.getWidth()-parseInt(p.getStyle("padding-left"),10)*2;d=d+2+(d%2);p.style.width=""+d+"px"}s=Sprite.make("web","rounded_tl",{"class":"rounded_tl"});m=Sprite.make("web","rounded_tr",{"class":"rounded_tr"});p.appendChild(s);p.appendChild(m)}j=20;h=$$(".events_bubble");for(f=0,c=h.length;f<c;f++){l=h[f];e=(-1*l.getWidth()/2)+"px";l.style.marginLeft=e;l.style.marginRight=e;l.style.right="6px";l.parentNode.style.zIndex=j--}clearInterval(this.check_interval);r=function(){return k.check_url("")};return this.check_interval=setInterval(r,300)},check_url:function(b){var a;a=Util.url_hash();if(!a||this.last_shown===a){return}this.last_shown=a;if(Util.url_hash()){return this.showTab(Util.url_hash()+"-tab",Util.url_hash())}else{return this.showTab(b+"-tab",b)}},showTab:function(k,c){var j,g,h,d,m,b,f,e,l,a;k=$(k);if(k){k.fire("db:tabshown")}b=document.getElementsByClassName("subtab");for(f=0,l=b.length;f<l;f++){m=b[f];m.removeClassName("selected")}j=document.getElementsByClassName("content-tab");for(e=0,a=j.length;e<a;e++){m=j[e];m.hide()}d=$(c+"-tab")||$$(".subtab").first();h=$(c+"-content")||$$(".content-tab").first();if(d){d.addClassName("selected")}if(h){h.show();Util.syncHeight();g=h.select("input[type=text]","textarea");if(g){Util.focus(g[0])}}return false}};TreeView={tv:{},loaded:false,set_params:function(a){return this.ajax_params=a},init:function(c,a,d){var b;if(d==null){d="treeview"}this.tv[d]={};b=this.tv[d];b.autohide=(a===null?true:a);b.handler=c;b.viewdiv=$(d);return b.hidefunc=this.hide.bindAsEventListener(this)},schedule_reset:function(){return this.loaded=false},reset:function(a){var b=this;return new Ajax.DBRequest("/ajax_subtreeview",{parameters:this.ajax_params,onSuccess:function(e){var d,c;c=[];for(d in b.tv){if(b.tv.hasOwnProperty(d)){b.tv[d].viewdiv.down(".treeview-folders").update(e.responseText);if(a&&a.onSuccess){c.push(a.onSuccess(e))}else{c.push(void 0)}}else{c.push(void 0)}}return c}})},toggle:function(c,b){var a;Event.stop(c);a=this.tv[b||"treeview"];if(a.shown){a.shown=false;this.hide(c,b)}else{a.shown=true;this.show(c.target,b)}return false},hide:function(c,b){var a;a=this.tv[b||"treeview"];if(!c||!$(c.target).descendantOf(a.viewdiv)){a.viewdiv.hide();Event.stopObserving(window,"click",a.hidefunc);return a.shown=false}},show:function(c,b){var d,a;a=this.tv[b||"treeview"];c=$(c);c.blur();d=c.cumulativeOffset();a.viewdiv.setStyle({top:(d.top+c.getHeight())+"px",left:(d.left-4)+"px"});a.viewdiv.show();return Event.observe(window,"click",a.hidefunc)},toggleNode:function(b){var a;b=$(b);a=b.down("img");if(a.className.match("bullet_plus")){Sprite.replace(a,"web","bullet_plus","bullet_minus")}else{Sprite.replace(a,"web","bullet_minus","bullet_plus")}b.up().next("div").toggle();b.blur();return false},toggleNodeAjax:function(c,a){var b,d,e=this;if(c.fetched_children){return this.toggleNode(c)}c=$(c);b=c.down("img");d=Sprite._get(b);b.src="/static/images/icons/ajax-loading-small.gif";new Ajax.DBRequest("/ajax_subtreeview"+a,{parameters:this.ajax_params,onSuccess:function(f){var g;g=new Element("div",{style:"display: none;"}).update(f.responseText);c.up().__sert({after:g});c.fetched_children=true;Sprite._set(b,d);return e.toggleNode(c)},cleanUp:function(f){if(/loading/.match(b.src)){return Sprite._set(b,d)}}});return false},handle:function(c,b){var d,a;d=$H(this.tv).keys();a=$(b).ancestors().find(function(e){return d.include(e.id)});if(!a){return}a=this.tv[a.id];$("modal").fire("db:treeview_selected",{path:c});if(a.handler){a.handler(c,b)}if(a.autohide){return this.hide(a.id)}},move:function(c,d,b){var a,e=this;a=$(c);if(!this.loaded){this.reset({onSuccess:function(){e.loaded=1;return e.move(c,d,b)}})}else{if(b&&b.onSuccess){b.onSuccess()}}assert(a,"Couldn't find tree_id");assert($(d),"Couldn't find location_id");$(d).appendChild(a);return a.show()},enable_shared:function(e){var f,d,a,g,j,k,c,h,b;k=$(e);if(!k.share_disabled){return}k.share_disabled=false;j=k.select(".s_web_folder_user_gray");a=j.length;d=0;b=[];for(c=0,h=shared_folder_img.length;c<h;c++){f=shared_folder_img[c];Sprite.replace(f,"web","folder_user_gray","folder_user");g=f.up();b.push(g.onclick=g._onclick)}return b}};sprites_used=new SimpleSet();Sprite={SPACER:"/static/images/icons/icon_spacer.gif",CLASS_PREFIX:"s_",_make_class:function(b,a){sprites_used.add(a);return this.CLASS_PREFIX+b+"_"+a},src:function(c,b,a){c=$(c);this.clear(c);return c.addClassName(this._make_class(b,a))},current:function(d){var a,b,c=this;b=$(d).classNames().findAll(function(e){return !e.indexOf(c.CLASS_PREFIX)});if(!b.length){return}a=b[b.length-1];return a.substr(a.indexOf("_",2)+1)},replace:function(d,b,c,a){d.removeClassName(this._make_class(b,c));return d.addClassName(this._make_class(b,a))},clear:function(b){var a=this;b=$(b);return b.className=b.classNames().reject(function(c){return !c.indexOf(a.CLASS_PREFIX)}).join(" ")},make:function(c,b,a){a=this._prep_attrs(c,b,a);return new Element("img",a)},html:function(d,b,a){var e,c;a=this._prep_attrs(d,b,a);e=["<img "];for(c in a){e.push(c,'="',HTML._raw_escape(a[c]),'" ')}e.push("/>");return new HTML(e.join(""))},_prep_attrs:function(d,c,b){var a;if(b==null){b={}}assert(!c.endsWith("_blue"),"Tried to make invalid sprite "+c);b.src=b.src||this.SPACER;a=this._make_class(d,c);b["class"]=("sprite sprite_"+d+" "+a+" ")+(b["class"]||"");return b},_get:function(a){return a.className},_set:function(b,a){b.className=a;return b.src=this.SPACER}};add_sprites_func=function(){if(sprites_used.items.length){return new Ajax.Request("/add_sprites_used",{parameters:{sprite:sprites_used.items}})}};Dropdown={init:function(){var e,d,b,c,a;c=$$("#tabs-container > ul > li");a=[];for(d=0,b=c.length;d<b;d++){e=c[d];e.observe("mouseenter",this.over);a.push(e.observe("mouseleave",this.out))}return a},over:function(a){var b;clearTimeout(this.timeout);$$("#tabs-container > ul > li.hover").invoke("removeClassName","hover");b=$(a.target);if(!b.match("#tabs-container > ul > li")){b=b.up("#tabs-container > ul > li")}return b.addClassName("hover")},out:function(a){var c,b;c=$(a.target);if(!c.match("#tabs-container > ul > li")){c=c.up("#tabs-container > ul > li")}b=function(){return c.removeClassName("hover")};return this.timeout=setTimeout(b,300)}};HotButton={make:function(b){var a,d,c;a=new Element("a");a.addClassName("hotbutton");a.addClassName("bigger");a.addClassName("rounded");c=new Element("span");c.addClassName("hotbutton-content");c.update(b);a.update(c);d=new Element("span");d.addClassName("shadow");return this.register(a)},register:function(a){var b,c=this;b=a.select(".hotbutton-icon").pop();if(b){a._icon=b;a._sprite=Sprite.current(b)}a.observe("mouseenter",function(){return c.mouseenter(a)});a.observe("mouseleave",function(){return c.mouseleave(a)});a.observe("mousedown",function(d){return c.mousedown(d,a)});a.observe("mouseup",function(){return c.mouseup(a)});Util.disableSelection(a);return a},mouseenter:function(a){a.addClassName("hover");return a.style.zIndex=1},mouseleave:function(a){a.removeClassName("hover");a.removeClassName("down");a.style.zIndex=0;if(a._icon){return Sprite.src(a._icon,"web",a._sprite)}},mousedown:function(b,a){a.addClassName("down");return Event.stop(b)},mouseup:function(a){a.removeClassName("down");if(a._icon){return Sprite.src(a._icon,"web",a._sprite)}}};LiveSearch={search:function(g,f,c,a,b){var d,e=this;g=g.strip();if(g.length<3){$(f).__date();if(a.onEmpty){return a.onEmpty(g)}}else{d={search_string:g,"short":(b?1:"")};return new Ajax.Request(c,{parameters:d,method:"get",onSuccess:function(h){var j;j=h.responseText.strip();if(!j){if(a.onEmpty){a.onEmpty(g)}return}$(f).update(h.responseText);e.highlight(f,g);if(a.onComplete){return a.onComplete(g)}}})}},highlight:function(k,n){var c,m,h,g,e,l,b,a,j,f,d;j=n.split(" ");for(h=0,l=j.length;h<l;h++){m=j[h];if(m.length<4){return}c=new RegExp(RegExp.escape(m),"i");k=$(k);f=$$(".livesearch_result_a");for(g=0,b=f.length;g<b;g++){k=f[g];k.innerHTML=k.innerHTML.gsub(c,function(o){return"<strong>"+o[0]+"</strong>"})}d=$$(".livesearch_result_p");for(e=0,a=d.length;e<a;e++){k=d[e];k.innerHTML=k.innerHTML.stripTags().gsub(c,function(o){return"<strong>"+o[0]+"</strong>"})}}},MAX_RESULTS:10};DBDropdown=Class.create({initialize:function(d,e,l){var h,b,f,k,j,a,c,g;if(l==null){l={}}this.options=l;this.container=$(d);assert(this.container,"Couldn't find element for DBDropdown "+d);this.container.style.position="relative";assert(e&&e.length,"Missing options_list: "+e);this.display_options=[];this.display_value={};for(c=0,g=e.length;c<g;c++){a=e[c];k=void 0;if(a.length>2){k=[a[1],a[2]]}else{k=[a[1]]}this.display_options.push(k);this.display_value[a[1]]=a[0]}b="";if(this.options.icon||this.options.prefix){b+="<span class='prefix'>";if(this.options.icon){b+=Sprite.html("web",this.options.icon,{className:"icon_no_hover"}).toHTML()}if(this.options.prefix){b+=this.options.prefix}b+="</span>"}f=void 0;if(this.options.initial_value){f=this.options.initial_value}else{f=this.display_options[0][0]}b+="<span class='dbdropdown-selected'>"+f+"</span>";h=l.arrow||"big-dropdown";b+=Sprite.html("web",h).toHTML();this.hotbutton=HotButton.make(b);this.hotbutton.addClassName("dbdropdown");this.hotbutton.name=$(d).identify();this.container.update(this.hotbutton);if(this.options.style){for(j in this.options.style){if(this.options.style.hasOwnProperty(j)){this.hotbutton.style[j]=this.options.style[j]}}}return this.observe()},observe:function(){this.hotbutton.observe("mouseup",(function(a){return this.mouseup(a)}).bind(this));return $(document.body).observe("mouseup",(function(a){if(!$(a.target).match(".dbdropdown, .dbdropdown *")){return this.hide_list()}}).bind(this))},mouseup:function(a){if(this.showing){this.hide_list()}else{this.show_list()}return a.preventDefault()},show_list:function(){var a,d,h,c,f,b,e,g=this;c=new Element("ul");Util.disableSelection(c);c.addClassName("dbdropdown-list");e=this.display_options;for(f=0,b=e.length;f<b;f++){d=e[f];a=new Element("li");a.addClassName("wit");a.name=d;a.update(d);a.observe("click",function(j){return j.preventDefault()});a.observe("mouseup",function(j){j.preventDefault();g.select(j.target.name);return g.hide_list()});a.observe("mouseenter",function(){return this.addClassName("over")});a.observe("mouseleave",function(){return this.removeClassName("over")});c.appendChild(a)}this.container.appendChild(c);c.clonePosition(this.hotbutton,{setTop:false,setHeight:false});c.style.width=(parseInt(c.style.width,10)-2)+"px";h=this.container.getHeight()-(Prototype.Browser.IE?2:0)+"px";if(this.options.show_above){c.style.bottom=h}else{c.style.top=h}return this.showing=true},hide_list:function(){var a;a=this.container.down(".dbdropdown-list");if(a){a.remove()}return this.showing=false},select:function(a){var c,b;b=this.display_value[a];assert(b,"Value is missing...");c=this.container.down(".dbdropdown-selected");assert(c,"select missing contentelm");c.update(a);if(this.options.on_change){return this.options.on_change(b)}}});LocaleSelector={init:function(){var a,b=this;a=$("locale-menu");if(!a){return}return a.on("click","a.locale-option",function(e,d){var c;e.preventDefault();c=d.readAttribute("data-locale");return b.set_locale(c)})},set_locale:function(a){var b;if(a===Constants.USER_LOCALE){return}b=new Element("form",{action:"https://"+Constants.WEBSERVER+"/set_locale",method:"post"});Forms.add_vars(b,{locale:a,locale_cont:window.location.href});document.body.appendChild(b);return b.submit()}};ModalLocaleSelector={init:function(){document.on("click",".modal-locale-link",ModalLocaleSelector.show_modal);return document.on("click","#modal-locale-selector a",ModalLocaleSelector.set_locale)},show_modal:function(b,a){b.preventDefault();return Modal.icon_show("globe32",_("Choose a language"),$("modal-locale-selector"),null,null,370)},set_locale:function(c,b){var a;c.preventDefault();Modal.hide();a=b.readAttribute("data-locale");return LocaleSelector.set_locale(a)}};UndoAction={init:function(){},set_undo_info:function(a){this.undo_info=a;return this.undoing=false},perform_undo:function(){if(!this.undoing){FileOps.do_rollback(this.undo_info);return this.undoing=true}}};Notify={init:function(){var a;a=$("notify-xclose");if(!a){return}return a.observe("click",function(b){Event.stop(b);return $("notify").hide()})},server_error:function(c,b,a){return this._show_div(c,b,a,false,_("There was a problem completing this request."))},server_success:function(d,c,b,a){return this._show_div(d,c,b,true,_("Your request completed successfully."),a)},_show_div:function(g,f,e,a,d,b){var c;this.clear_all();g=g||d;f=f||(b?30:10);if(b&&Constants.can_undo){g+='&nbsp;<a id="undo-link" href="#">Undo</a>';UndoAction.set_undo_info(b);(function(){return $("undo-link").observe("click",function(h){UndoAction.perform_undo();return Event.stop(h)})}).defer();this.preserve_last_msg=true}else{this.preserve_last_msg=false}c=$("notify");if(a){c.removeClassName("server-error");c.addClassName("server-success")}else{c.removeClassName("server-success");c.addClassName("server-error")}c.down("#notify-msg").update(g);new Effect.Appear(c,{duration:0.5,from:0,to:1});this.last_msg=g;this.last_fade=new Effect.Fade(c,{duration:1,from:1,to:0,delay:f});return this.cancel_on_reload=e},is_shown:function(){return $("notify").visible()},clear_all:function(){var a;if(this.last_fade){this.last_fade.cancel()}$("notify").hide();a=Effect.Queues.get("notify");a.effects=[];clearInterval(a.interval);return a.interval=null},clear_if:function(a){if(this.last_msg===a){return this.clear_all()}}};Util.smartLoad(Notify.init.bind(Notify));LoginDropdown={init:function(){var a;a=$("login-hover-link");if(!a){return}this.login_link=a;return this.register()},register:function(a){this.login_link.observe("click",this.click.bind(this));this.login_link.observe("mouseenter",this.over.bind(this));this.login_link.observe("mouseleave",this.out.bind(this));this.login_link.observe("focus",this.click.bind(this));$("login_email_elm").observe("focus",this.click.bind(this));return $(document.body).observe("click",this.unclick.bind(this))},over:function(a){return this.hover()},out:function(a){return this.unhover()},click:function(a){Event.stop(a);this.hover();this.down=true;this.login_link.up().addClassName("down");return $("login_email_elm").focus()},unclick:function(b){var a;a=$(b.target);if(a.match("#top-login-wrapper, #top-login-wrapper *")){return}this.down=false;this.unhover();return this.login_link.up().removeClassName("down")},hover:function(){var a;if(this.is_hover||this.down){return}this.is_hover=true;a=$("login-hover-dropdown-icon");return Sprite.replace(a,"web","big-dropdown-gray","big-dropdown")},unhover:function(){var a;if(!this.is_hover||this.down){return}this.is_hover=false;a=$("login-hover-dropdown-icon");return Sprite.replace(a,"web","big-dropdown","big-dropdown-gray")}};TranslationSuggest={record_msg_touch:function(c){var b,a;a=$("translation-msg-id");assert(a,"Missing translation msg_id field");assert(c,"Missing translation display");b=Constants.messages[c];if(b){a.value=b}return this.finish_wizard(c,Constants.emessages[c]||"")},_autocomplete_highlight:function(a){a=new SimpleSet(a);return function(b){if(a.contains(b)){return"<strong>"+b+"</strong>"}else{return b}}},autocompleter:Class.create(Autocompleter.Local,{onClick:function($super,b){var a;a=Event.findElement(b,"LI");if(a&&a.className.indexOf("not-found")<0){return $super(b)}},onHover:function($super,b){var a;a=Event.findElement(b,"LI");if(a&&a.className.indexOf("not-found")<0){return $super(b)}},onBlur:function($super,a,b){if(b){return $super(a)}},close:function(){this.onBlur(null,true);return true},selectEntry:function($super){var a;a=this.index;$super();return TranslationSuggest.record_msg_touch(TranslationSuggest.msg_display[a])}}),attach_autocomplete:function(){var a;a=new this.autocompleter("bad-i18n-text","bad-i18n-text-complete",false,{frequency:0.15,selector:function(z){var v,A,y,g,E,x,u,c,t,r,w,s,k,b,q,l,D,m,o,p,f,e,d,B,C,n,h;D=[];b=[];g=z.getToken();k=$H(Constants.messages).keys();s=k.length;v=10;l=true;q=3;x=true;c={};TranslationSuggest.msg_display=[];r=[];y=void 0;u=0;while(u<s&&D.length<v){y=k[u];E=y.toLowerCase().indexOf(g.toLowerCase());if(E!==-1){c[y]=true}while(E!==-1){if(E===0&&y.length!==g.length){D.push("<li><div><strong>"+(y.substr(0,g.length))+"</strong>"+(y.substr(g.length))+"</div></li>");TranslationSuggest.msg_display.push(y);break}else{if(g.length>=q&&l&&E!==-1){if(x||(/\s/.test(y.substr(E-1,1)))){b.push("<li>\n  <div>"+(y.substr(0,E))+"\n    <strong>"+(y.substr(E,g.length))+"</strong>\n    "+(y.substr(E+g.length))+"\n  </div>\n</li>");r.push(y);break}}}E=y.toLowerCase().indexOf(g.toLowerCase(),E+1)}u++}if(b.length){D=D.concat(b.slice(0,z.options.choices-D.length));TranslationSuggest.msg_display=TranslationSuggest.msg_display.concat(r.slice(0,z.options.choices-D.length))}if(D.length<v){A={};p=$A(g.split(/\s/));for(f=0,B=p.length;f<B;f++){m=p[f];o=TranslationSuggest.word_index[m];if((m.length>=q||p.length>2)&&o){n=$A(o);for(e=0,C=n.length;e<C;e++){w=n[e];A[w]=(A[w]||0)+1}}}A=$A($H(A));A.sort(function(j,F){return F[1]-j[1]});for(t=d=0,h=Math.min(A.length,v-D.length);0<=h?d<h:d>h;t=0<=h?++d:--d){y=A[t][0];if(!c[y]){D.push("<li>\n  <div>"+(y.replace(/[^\s]+/g,TranslationSuggest._autocomplete_highlight(p)))+"</div>\n</li>");TranslationSuggest.msg_display.push(y)}}}if(D.length){D[D.length-1]=D[D.length-1].replace("<div>","<div style='border: none'>")}D=D.join("");if(!D.length){return'<ul style="border: 1px solid #bbb">\n  <li class="not-found" style="background:#f5f5f5">\n    <div style="text-align:left;border: none">%s</div>\n  </li>\n</ul>'.format(_("That text was not found on this page."))}return"<ul>"+D+"</ul>"}});return TranslationSuggest.ac=a},submit_suggest:function(b){var a;a=$("translation-suggest-form");assert(a,"Missing translation suggest form");return Forms.ajax_submit(a,false,(function(){Notify.server_success(_("Thanks for suggesting an alternate translation!"));return this.hide()}),false,$("translation-back-button"))},start_wizard:function(b){var a;Event.stop(b);a=$("translation-suggest-form");this.reset_form();a.down("input[name=locale]").setValue(Constants.USER_LOCALE);a.down("input[name=locale_url]").setValue(window.location.href);this.icon_show("alert_32",'%s <span class="step-number">%s</span>'.format(_("Report a translation problem"),_("&ndash; Step 1 of 2")),$("translate-div"),{},$("bad-i18n-text"));return this.onHide=this.ac.close.bind(this.ac)},show_select_error:function(a){Event.stop(a);return $("bad-i18n-text-error").show()},finish_wizard:function(b,a){var c;c=$("translation-suggest-form");assert(c,"Missing translation suggest form");$("modal-title").down("span").__date(new HTML("$ndash; ")).__sert(_("Step 2 of 2"));c.down("#part-one").hide();c.down("#translation-msg-display").__date(b.stripTags());c.down("#translation-orig-msg-display").__date(a.stripTags());c.down("#part-two").show();c.down("#part-two textarea").focus();return ActAsBlock.register(false,c)},reset_form:function(){var c,d,b,f,a,e;d=$("translation-suggest-form");b=$("translation-msg-id");assert(d,"Missing translation suggest form");assert(b,"Missing translation msg_id field");e=d.select("textarea");for(f=0,a=e.length;f<a;f++){c=e[f];Form.Element.clear(c)}d.down("#part-one").show();return d.down("#part-two").hide()},word_index:{},index_message:function(d){var c,f,e,b,a;c=d.blank_format().split(/\s/);a=[];for(e=0,b=c.length;e<b;e++){f=c[e];if(!(f in this.word_index)){this.word_index[f]=[]}a.push(this.word_index[f].push(d))}return a},index_all:function(){var b,a;a=[];for(b in Constants.messages){if(Constants.messages.hasOwnProperty(b)){a.push(this.index_message(b))}else{a.push(void 0)}}return a},update_i18n_messages:function(f){var b,a,c,e,d;for(a in f){if(f.hasOwnProperty(a)){c=f[a];if(c.s&&c.s.length){for(b=e=0,d=c.s.length;0<=d?e<d:e>d;b=0<=d?++e:--e){add_i18n_message(a,c.s[b],c.e[b])}}else{add_i18n_message(a,c.t,a)}}}},update_i18n_messages_from_req:function(e){var h,b,g,c,d,a,f;f="<!--msg:";b="-->";if(e.responseText.indexOf(f)===0){h=e.responseText.indexOf(":",f.length);assert(h!==-1,"malformed i18n message header");d=e.responseText.substr(f.length,h-f.length);c=Number(d);assert(!isNaN(c),"invalid json length "+d);a=e.responseText.substr(h+1,c);e.responseText=e.responseText.substr(h+1+c+b.length);g=a.evalJSON();return this.update_i18n_messages(g)}}};DBCheckbox={register_all:function(){var e,d,a,b;b=$$(".checkbox");for(d=0,a=b.length;d<a;d++){e=b[d];this.register(e)}},register:function(a){a.addClassName("s_checkbox sprite");a.selected=false;return a},toggle:function(a){if(a.selected){return this.deselect(a)}else{return this.select(a)}},select:function(a){Sprite.replace(a,"web","checkbox","checkbox_checked");return a.selected=true},deselect:function(a){Sprite.replace(a,"web","checkbox_checked","checkbox");return a.selected=false}};Util.smartLoad(DBCheckbox.register_all.bind(DBCheckbox));Tooltip={attach:function(g,c,a,b){var f,e;if(b==null){b={}}g=$(g);a=(a?$(a):null);f=Bubble.make(c,g.tail_position,b.tail_position,b.width);f.setStyle({display:"none",position:"absolute"});$("floaters").__sert(f);if(g.match("#modal-content *")){f.style.zIndex="13001"}else{f.style.zIndex=""}if(g.tail_position==="right"){e=(Util.ie?32:12);f.style.marginLeft=-(f.getWidth()+g.getWidth()+e)+"px"}g.tooltip=f;g.out_target=(a?true:false);g.observe("mouseout",this.mouseout("target",g));g.observe("mouseover",this.mouseover("target",g));g.out_trigger=(a?false:true);if(a){a.observe("mouseout",this.mouseout("trigger",g));a.observe("mouseover",this.mouseover("trigger",g))}g.out_tooltip=true;f.observe("mouseout",this.mouseout("tooltip",g));return f.observe("mouseover",this.mouseover("tooltip",g))},update:function(b,a){if(b.tooltip){return $(b.tooltip).update(a)}},mouseover:function(a,b){return function(){return b["out_"+a]=false}},mouseout:function(a,b){return function(){b["out_"+a]=true;return Tooltip.hide_if_out.defer(b)}},show_by:function(b){var c,a;c=$(b.tooltip);c.show();a=Math.floor(c.getHeight()/2);return c.clonePosition(b,{setWidth:false,setHeight:false,offsetTop:Math.floor(b.getHeight()/2)-a,offsetLeft:b.getWidth()+1})},hide_if_out:function(a){var b;if(!a.out_target||!a.out_trigger||!a.out_tooltip){return}b=$(a.tooltip);return b.hide()},show:function(e,d,b,a,c){if(a==null){a="left"}e=$(e);if(!e.tail_position){e.tail_position=a}b=(b?$(b):null);if(!e.tooltip){this.attach(e,d,b,c)}return this.show_by(e)}};BrowseStyleRows={register_all:function(){var d,c,a,b;b=$$(".bs-row");for(c=0,a=b.length;c<a;c++){d=b[c];this.register(d)}return Event.observe(document,"click",this.kill_current.bind(this))},register:function(b){var a;b=$(b);b.db_observe("mouseover",this.mouseover.bind(this));b.db_observe("mouseout",this.mouseout.bind(this));a=b.down(".action-button");if(a){return a.db_observe("click",this.click.bind(this))}},mouseover:function(b,a){return a.addClassName("hover")},mouseout:function(b,a){return a.removeClassName("hover")},click:function(d,b){var a,f,c;if(d.target.tagName==="A"){return}f=b.up(".bs-row");Event.stop(d);if(f.hasClassName("selected")){this.kill_current(false);return}this.kill_current(false);c=$(d.target);if(!c.match(".bs-actions-list *")){f.addClassName("selected")}a=(c.hasClassName("bs-row")?c:c.up(".bs-row"));if(Util.ie6){a.down(".bs-actions-list").style.position="absolute"}return a.style.zIndex=9},kill_current:function(f){var g,d,b,c,a;c=$$(".bs-row.selected");a=[];for(d=0,b=c.length;d<b;d++){g=c[d];g.removeClassName("selected");a.push(g.style.zIndex="")}return a}};SickInput={init:function(){var e,d,b,c,a;c=$$(".sick-input");a=[];for(d=0,b=c.length;d<b;d++){e=c[d];a.push(this._create(e))}return a},_create:function(d){var c,a,b;c=d.identify();a=d.down("input")||d.down("textarea");a.observe("focus",function(){return d.addClassName("focused")});a.observe("blur",function(){return d.removeClassName("focused")});b=function(){if(d.hasClassName("populated")&&a.getValue()===""){d.removeClassName("populated")}else{if(!d.hasClassName("populated")&&a.getValue()!==""){d.addClassName("populated")}}if(c in SickInput._handler_map){return SickInput._handler_map[c]()}};this.show_errors();b();return setInterval(b,100)},hide_errors:function(c){var f,e,d,b,a;f=this.get_errors(c);a=[];for(d=0,b=f.length;d<b;d++){e=f[d];if(e.down("span.error-message")){a.push(e.hide())}else{a.push(void 0)}}return a},show_errors:function(c){var f,e,d,b,a;f=this.get_errors(c);a=[];for(d=0,b=f.length;d<b;d++){e=f[d];if(e.down("span.error-message")){a.push(e.show())}else{a.push(void 0)}}return a},get_errors:function(b){var c,a;a=".error-bubble, .error-plain-text";c=b?b.select(a):$$(a);return c},_handler_map:{},add_interval_handler:function(b,a){var c;c=b.identify();return this._handler_map[c]=a}};Util.smartLoad(SickInput.init.bind(SickInput));FreshbuttonIEHaxxx={submits:[],init:function(){if(IE7_OR_LESS){this.submits=$$("input[type=submit]");return document.on("focusin","form",this.wtvr.bind(this))}},wtvr:function(b,c){var h,a,g,e,j,f,d;f=c.select("input[type=submit]");d=[];for(e=0,j=f.length;e<j;e++){h=f[e];g=this.submits.indexOf(h);if(g!==-1){a=new Element("input",{type:"submit","class":"hidden-ie-submit"});h.__sert({before:a});d.push(this.submits.splice(g,1))}else{d.push(void 0)}}return d}};Util.smartLoad(FreshbuttonIEHaxxx.init.bind(FreshbuttonIEHaxxx));SuggestionInput={register:function(b){var a;b=$(b);a=b.up("form");if(SuggestionInput.defaulted(b)||b.getValue()===""){b.setValue(b.title)}else{b.addClassName("suggestion-input-unfaded")}b.observe("blur",this.blur.bind(this));b.observe("focus",this.focus.bind(this));b.observe("db:value_change",this.focus.bind(this));if(a){if(!b.id){b.id="r_elm_id_"+(Math.random().toString())}return a.observe("submit",SuggestionInput.blank(b.id).bind(this))}},register_all:function(){var c,e,b,d,a;d=$$(".suggestion-input");a=[];for(e=0,b=d.length;e<b;e++){c=d[e];a.push(this.register(c))}return a},blank:function(a){var b=this;return function(){var c;c=$(a);if(!c){return}if(b.defaulted(c)){return c.setValue("")}}},defaulted:function(a){a=$(a);return a.getValue()===a.title},do_blank:function(a){return this.blank(a)()},clear:function(a){var b;b={target:a};return this.focus(b)},focus:function(a){var b;b=$(a.target);if(!b){return}if(this.defaulted(b)){b.addClassName("suggestion-input-unfaded");return b.setValue("")}},blur_elm:function(a){if(a.getValue()===""){a.removeClassName("suggestion-input-unfaded");a.setValue(a.title)}return a.blur()},blur:function(a){var b;b=$(a.target);if(!b){return}return this.blur_elm(b)},reset:function(b){var a;a=$(b);if(!a){return}a.removeClassName("suggestion-input-unfaded");a.setValue(a.title);a.defaulted=true;return a.blur()},setValue:function(a,b){var c;c=$(a);if(!c){return}c.addClassName("suggestion-input-unfaded");c.setValue(b);return c.defaulted=false}};Util.smartLoad(SuggestionInput.register_all.bind(SuggestionInput));ULSelectMenu=(function(){var d,h,c,j,k,e,g,a,f,b,l;d=function(m){return m.removeClassName("shown")};l=function(m){return m.toggleClassName("shown")};g=function(){return this.removeClassName("hover")};e=function(){return this.addClassName("hover")};a=function(q,p){var m,r,o,n;n=[];for(r=0,o=p.length;r<o;r++){m=p[r];n.push(q.insert(m))}return n};j=function(o,m,n){a(o,n);if(o.firstChild!==m){return o.__sert({top:m})}};f=function(m,n){m.down(".selected").removeClassName("selected");return n.addClassName("selected")};b=function(o,r){var s,q,n,p,m;p=o.select("li");m=[];for(q=0,n=p.length;q<n;q++){s=p[q];if(s.getAttribute("data-value")===r){m.push(f(o,s))}else{m.push(void 0)}}return m};k=function(m,o,n){return function(p){if(!m.hasClassName("selected")){f(o,m);o.fire("db:change",m.getAttribute("data-value"));return d(o)}else{j(o,m,n);return l(o)}}};h=function(o){var r,u,q,n,t,m,p,s;u=o.select("li");assert(u.length,"Empty list of options "+o.identify());q=void 0;if(u.length===1){o.addClassName("one")}else{for(p=0,s=u.length;p<s;p++){r=u[p];t=r.getAttribute("data-value");assert(t,r.identify()+" missing data value");r.observe("click",k(r,o,u));r.observe("mouseenter",e);r.observe("mouseleave",g);if(r.hasClassName("selected")){q=r}}$(document.body).observe("click",function(v){if($(v.target).up(".ul_select_menu")===o){return}return d(o)})}if(!q){q=u[0]}q.addClassName("selected");m=new Element("span");n=q.getDimensions();m.setStyle({width:n.width+"px",height:n.height+"px",position:"relative",display:"inline-block"});return o.wrap(m)};c=function(){var q,p,n,o,m;o=$$(".ul_select_menu");m=[];for(p=0,n=o.length;p<n;p++){q=o[p];m.push(h(q))}return m};Util.smartLoad(c);return{init:function(m){return h(m)},set_selected_by_value:b}})();JumpWatcher={inverval:null,last_hash:null,last_page_offset:0,check:function(){if(window.location.href.endsWith("#")&&window.pageYOffset===0&&JumpWatcher.last_page_offset!==0){return this.report()}else{this.last_page_offset=window.pageYOffset;return this.last_hash=Util.url_hash()}},report:function(){clearInterval(JumpWatcher.interval);return assert(0.1+0.2===0.3,"Hash jump detected, last hash = "+this.last_hash)}};TitleBubble=(function(){var a,d,b,c;c=function(k,m){var f,j,g,h,l;l=m.getAttribute("title");if((l!=null?l.length:void 0)&&l!=="undefined"){m.setAttribute("data-title",l);m.removeAttribute("title")}f=new Element("div",{"class":"title_bubble_container"});if(m.hasClassName("white")){f.addClassName("white")}f.update(m.getAttribute("data-title"));h=new Element("div",{"class":"tail"});f.appendChild(h);document.body.appendChild(f);g=d(m,f);j=a(g,f,m);f.clonePosition(m,{setWidth:false,setHeight:false,offsetTop:j.top,offsetLeft:j.left});f.addClassName("position-"+g);h.style.marginLeft=j.tail_offset_left+"px";return h.style.marginTop=j.tail_offset_top+"px"};d=function(j,e){var h,g,f;f=j.getAttribute("data-title-position");h=document.viewport.getDimensions();g=j.viewportOffset();if(!(f==="above"||f==="below"||f==="right"||f==="left")){f="above"}if(f==="left"){if(g.left<e.width){return"right"}}else{if(f==="right"){if(h.width-(g.left+j.getWidth())<e.width){return"left"}}else{if(f==="below"){if(h.height-(g.top+j.getHeight())<e.height){return"above"}}else{if(f==="above"){if(g.top<e.height){return"below"}}}}}return f};a=function(g,o,k){var m,h,p,l,n,j,e,r,q,f;p=document.viewport.getDimensions();m=o.getDimensions();l=k.viewportOffset();h=6;n=0;j=0;q=0;f=0;if(g==="below"||g==="above"){if(g==="below"){j=k.getHeight()+h}else{j=(-1*m.height)-h}e=k.getWidth()/2-m.width/2;if(l.left+e+m.width>p.width){n=p.width-l.left-m.width;q=e-n-4}else{n=e;q=-4}}if(g==="left"||g==="right"){if(g==="right"){n=k.getWidth()+h}else{n=(-1*m.width)-h}r=k.getHeight()/2-m.height/2;if(l.top+r+m.height>p.height){j=p.height-l.top-m.height;f=r-j-4}else{j=r;f=-4}}return{left:n,top:j,tail_offset_left:q,tail_offset_top:f}};b=function(l){var h,k,g,j,f;j=$$(".title_bubble_container");f=[];for(k=0,g=j.length;k<g;k++){h=j[k];f.push(Element.remove(h))}return f};return{init:function(){$(document.body).on("mouseover",".title_bubble",c);return $(document.body).on("mouseout",".title_bubble",b)},hide_all:function(){return b()}}})();Event.observe(window,"scroll",function(){return TitleBubble.hide_all()});FreshDropdown={show:function(d,c,b){var f,a,e=this;if(b==null){b=c.getHeight()}this.hide_all();d.show();a=d.getWidth();f=c.getWidth();d.clonePosition(c,{setHeight:false,setWidth:false,offsetLeft:-1*(a-f),offsetTop:b});c.addClassName("pressed");return(function(){return document.observe("click",e.hide_all)}).defer()},hide_all:function(a){$$(".freshdropdown-menu").invoke("hide");$$(".freshdropdown-button").invoke("removeClassName","pressed");return document.stopObserving("click",this.hide_all)}};Util.smartLoad(function(){return TranslationSuggest.index_all()});Util.smartLoad(function(){JumpWatcher.interval=setInterval(JumpWatcher.check.bind(JumpWatcher),500);LocaleSelector.init();ModalLocaleSelector.init();LoginDropdown.init();TitleBubble.init();return Tabs.init()});var BulkUpload,CrossDomainUploader,FileQueue,InlineUploadStatus,Upload,UploadFile;Upload={QUEUE_EVT:"db:upload:queue",QUEUE_ERROR_EVT:"db:upload:queue_error",UPDATE_EVT:"db:upload:update",COMPLETE_EVT:"db:upload:complete",ERROR_EVT:"db:upload:error",CANCEL_EVT:"db:upload:cancel",SWFU:false,current_dest:null,init:function(c,d){var b,a;a={};Object.extend(a,Upload.cookies);b=Upload.initSWFU(a);if(!d){Util.smart_window_load(b)}else{b()}Upload.current_dest=c;$$(".swfupload").each(function(e){if(e.observe){Util.freshbutton_overlay(e,$("choose-button"));return Util.freshbutton_overlay(e,$("add-button"))}});Upload.operaHack();return FileQueue.clear()},init_basic:function(){Util.freshbutton_overlay($("file-box"),$("basic-choose-button"));$("basic-choose-button").observe("mousemove",function(c){var b,a,d;b=$("modal").cumulativeOffset();d=c.clientY-b.top-3;a=c.clientX-b.left-$("file-box").getWidth()+3;return $("file-box").setStyle({top:d+"px",left:a+"px"})});return $("file-box").observe("change",function(){var d,b,e,c,a;Modal.hide=function(){};$("modal-x").hide();$("basic-upload-desc").hide();$("basic-upload-buttons").hide();$("file-box").hide();b=$("file-box").getValue().split("\\").pop();c=Sprite.make("web",FileOps.filename_to_icon(b));$("basic-upload-status").down(".icon").__date(c);d=_("Uploading %(filename)s").format({filename:b.em_snippet(25)});$("basic-upload-status").down(".file-desc").__date(d);$("basic-upload-status").show();$("basic-uploading-message").show();if(window.File&&window.FileList){e=$("file-box").files;if(e){a=e[0].lastModifiedDate;$("mtime").value=Math.round(Date.parse(a)/1000)||0}}return $("basic-upload-form").submit()})},initSWFU:function(a){return function(){var b;b=new SWFUpload({upload_url:"https://"+Constants.BLOCK_CLUSTER+"/upload",file_post_name:"file",file_size_limit:"307200",file_types:"*",file_types_description:_("All files"),file_upload_limit:"0",button_placeholder_id:"flash-upload-button-placeholder",button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_width:1000,button_height:1000,button_cursor:SWFUpload.CURSOR.HAND,swfupload_loaded_handler:Upload.flashLoaded,file_queued_handler:Upload.fileQueued,file_queue_error_handler:Upload.fileQueueError,upload_progress_handler:Upload.uploadProgress,upload_error_handler:Upload.uploadError,upload_success_handler:Upload.uploadSuccess,upload_complete_handler:Upload.uploadComplete,flash_url:"/static/swf/swfupload.swf",custom_settings:{progress_target:"fsUploadProgress",upload_successful:false},post_params:a,debug:Constants.upload_debug||false});return Upload.SWFU=b}},reset:function(){var a;if(FileQueue.uploading&&FileQueue.current_file){if(CrossDomainUploader.is_cross_domain(FileQueue.current_file)){CrossDomainUploader.current_req.transport.abort()}else{Upload.SWFU.cancelUpload()}}a=$$(".swfupload").first();if(a&&a.remove){a.remove()}delete Upload.SWFU;FileQueue.clear();return InlineUploadStatus.hide()},show_upload:function(){var a;$("upload-desc").hide();$("dnd-upload-desc").hide();$("upload-files-list").show();$("upload-start-buttons").hide();$("upload-running-buttons").show();$("hide-button").show();$("done-button").hide();a=$$(".swfupload").first();if(a){$("flash-upload-container").clonePosition($("add-button"));a.width=$("add-button").getWidth();a.height=$("add-button").getHeight()}if(!$("modal-overlay").visible()){return InlineUploadStatus.show()}},updatePostParams:function(c){var b,a;a=Upload.SWFU.getSetting("post_params");for(b in c){if(c.hasOwnProperty(b)){a[b]=c[b]}}return Upload.SWFU.setPostParams(a)},fileQueueError:function(d,b,c){var e,a;a=_("File too large");e=_('The upload limit online is 300MB. You can upload larger files with the <a id="install_link">Dropbox desktop application</a>.');e=e.replace('id="install_link"','href="/install" target="_blank"');switch(b){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:document.fire(Upload.QUEUE_ERROR_EVT,{file:d,message:a,tooltip_text:e});break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:if(d.size!=null){document.fire(Upload.QUEUE_ERROR_EVT,{file:d,message:_("Empty file"),tooltip_text:_("You can't upload an empty file.")})}else{document.fire(Upload.QUEUE_ERROR_EVT,{file:d,message:a,tooltip_text:e})}break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:document.fire(Upload.QUEUE_ERROR_EVT,{file:d,message:_("Invalid file type"),tooltip_text:_("This file does not have an allowed file type.")});break;default:document.fire(Upload.QUEUE_ERROR_EVT,{file:d});this.debug("Error code: "+b+", file name: "+d.name+", file size: "+d.size+", message: "+c)}return Upload.show_upload()},fileQueued:function(a){document.fire(Upload.QUEUE_EVT,{file:a});return Upload.show_upload()},uploadNext:function(){if(CrossDomainUploader.is_cross_domain(FileQueue.next())){CrossDomainUploader.upload_next()}else{Upload.updatePostParams({dest:FileQueue.next_dest(),t:Constants.TOKEN});Upload.SWFU.startUpload()}FileQueue.last_update_time=0;return FileQueue.last_update_size=0},pause:function(){return Upload.SWFU.stopUpload()},uploadProgress:function(c,b,a){if(!FileQueue.cancelled_files[c.id]){return document.fire(Upload.UPDATE_EVT,{file:c,percent_complete:b/a})}},uploadSuccess:function(b,a){if(a.strip()===""){return document.fire(Upload.ERROR_EVT,{file:b})}else{if(a==="quota"){return document.fire(Upload.ERROR_EVT,{file:b,message:_("Quota exceeded"),tooltip_text:_("Your upload failed because you are over quota.")})}else{if(a==="folder_exists"){return document.fire(Upload.ERROR_EVT,{file:b,message:_("Invalid file name"),tooltip_text:_("You can't upload a file with the same name as a folder in this folder.")})}else{return document.fire(Upload.UPDATE_EVT,{file:b,percent_complete:1})}}}},uploadComplete:function(a){if(!FileQueue.cancelled_files[a.id]&&!FileQueue.errored_files[a.id]){return document.fire(Upload.COMPLETE_EVT,{file:a})}},uploadError:function(e,b,d){var c,a;c=e;if(parseInt(b,10)!==-280){a=FlashDetect.major+"."+FlashDetect.revision;Util.report_exception("Uploader error: "+b+" "+d+" "+(Object.toJSON(e))+" FLASH VERSION: "+a,window.location.href)}switch(b){case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:this.debug("Error code: No backend file, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:this.debug("Error code: upload limit exceeded, file name: "+c.name+", file size: "+c.size+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:this.debug("Error code: HTTP error, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:this.debug("Error code: upload failed, file name: "+c.name+", file size: "+c.size+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:this.debug("Error code: IO error, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:this.debug("Error code: security error, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:this.debug("Error code: upload cancelled, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:this.debug("Error code: upload stopped, file name: "+c.name+", message: "+d);break;default:this.debug("Error code: "+b+(", file name: "+c.name+", file size: "+c.size+", message: "+d))}if(FileQueue.files[e.id]){return document.fire(Upload.ERROR_EVT,{file:e,error_code:b})}},grabURL:function(){var a;a=$F("file-box");$("url").value=pathif(/(^http|^https|^ftp):\/\//.match(a));return true},set_dest:function(a){var b;Upload.current_dest=a;DomUtil.fillVal(a,"dest-folder");b=$("basic-uploader-url");if(b){return b.href=b.href.replace(/(\/upload)(.*)(\?basic=1)/,function(e,d,g,c){return d+Util.urlquote(a)+c})}},treeview_handler:function(b,a){Upload.set_dest(b);return FileQueue.clear()},new_folder:function(){TreeView.hide();Modal.show(_("Create new folder..."),DomUtil.fromElm("create-folder"),{action:Upload.do_new_folder,wit_group:"new-folder-confirm"});if(!Util.ie){return $("first-treeview-link").onclick()}},do_new_folder:function(){var b,a;if(!Modal.vars.selected_path){Notify.server_error(_("Please select a parent folder."));return}a=$F("entered-name");b=Modal.vars.selected_path;return new Ajax.DBRequest("/cmd/new"+Util.urlquote(b)+"?to_path="+Util.urlquote(a),{onSuccess:function(c){Upload.treeview_handler(Util.normalize(b)+"/"+a);return TreeView.schedule_reset()},cleanUp:function(){}})},flashLoaded:function(){var a;if($("upload-start-buttons").visible()){$("upload-loading").hide();$("choose-button").show();a=$$(".swfupload").first();if(a){$("flash-upload-container").clonePosition($("choose-button"));a.width=$("choose-button").getWidth();return a.height=$("choose-button").getHeight()}}},operaHack:function(){if(Prototype.Browser.Opera){return Upload.opera_tid=setInterval(function(){return $("opera-dummy-div").toggle()},200)}}};FileQueue={files:{},file_ids:[],uploading:false,num_left:0,queue_size:0,completed_size:0,completed_files:{},errors:0,errored_files:{},cancels:0,cancelled_files:{},all_cancelled:false,last_update_time:0,last_update_size:0,average_bps:0,formatted_time:null,init:function(){return FileQueue._listen()},_listen:function(){document.observe(Upload.QUEUE_EVT,FileQueue._file_queued);document.observe(Upload.QUEUE_ERROR_EVT,FileQueue._file_queue_errored);document.observe(Upload.UPDATE_EVT,FileQueue._file_updated);document.observe(Upload.COMPLETE_EVT,FileQueue._file_completed);document.observe(Upload.ERROR_EVT,FileQueue._file_errored);return document.observe(Upload.CANCEL_EVT,FileQueue._file_cancelled)},_file_queued:function(b){var a;a=b.memo.file;FileQueue.queue_size+=a.size;FileQueue.files[a.id]=a;FileQueue.file_ids.push(a.id);FileQueue.num_left++;if(!FileQueue.uploading){FileQueue._start_uploading()}return T("File queued:",a.name)},_file_queue_errored:function(a){FileQueue._file_queued(a);return setTimeout((function(){return FileQueue._file_errored(a)}),250)},_file_updated:function(k){var d,a,b,c,h,g,f,j,l;c=k.memo.file;g=k.memo.percent_complete;h=g*c.size;l=FileQueue.completed_size+h;b=new Date().getTime();if(FileQueue.last_update_time){f=(b-FileQueue.last_update_time)/1000;a=h-FileQueue.last_update_size;d=a/f;FileQueue.average_bps=((l-a)*FileQueue.average_bps+a*d)/l;j=(FileQueue.queue_size-l)/FileQueue.average_bps;FileQueue.formatted_time=Util.formatTime(j+FileQueue.num_left)}FileQueue.current_file=c;FileQueue.last_update_time=new Date().getTime();FileQueue.last_update_size=h;return FileQueue.totalPercentage=l/FileQueue.queue_size},_file_completed:function(b){var a;a=b.memo.file;FileQueue.num_left=Math.max(0,FileQueue.num_left-1);FileQueue.completed_files[a.id]=true;FileQueue.completed_size+=a.size;FileQueue.totalPercentage=FileQueue.completed_size/FileQueue.queue_size;T("File completed:",a.name);return FileQueue._check_if_finished(a)},_file_errored:function(b){var a;a=b.memo.file;FileQueue.errors=FileQueue.errors+1;FileQueue.errored_files[a.id]=true;FileQueue.num_left=Math.max(0,FileQueue.num_left-1);FileQueue.queue_size-=a.size;FileQueue.totalPercentage=FileQueue.completed_size/FileQueue.queue_size;BulkUpload.update_errors();InlineUploadStatus.update_errors();T("File errored:",a.name);return FileQueue._check_if_finished(a)},_file_cancelled:function(b){var a;a=b.memo.file;delete FileQueue.files[a.id];FileQueue.file_ids.splice(FileQueue.file_ids.indexOf(a.id),1);FileQueue.cancels=FileQueue.cancels+1;FileQueue.cancelled_files[a.id]=true;FileQueue.num_left=Math.max(0,FileQueue.num_left-1);FileQueue.queue_size-=a.size;FileQueue.totalPercentage=FileQueue.completed_size/FileQueue.queue_size;if(CrossDomainUploader.is_cross_domain(a)){if(FileQueue.current_file===a){CrossDomainUploader.current_req.transport.abort()}}else{Upload.SWFU.cancelUpload(a.id)}T("File cancelled:",a.name);return FileQueue._check_if_finished(a)},_start_uploading:function(){var a;Upload.uploadNext();FileQueue.uploading=true;FileQueue.all_cancelled=false;return window.onbeforeunload=a=function(){return _("Leaving this page will cancel your uploads.")}},_check_if_finished:function(a){if(FileQueue.empty()){if(FileQueue.uploading){return FileQueue._finished_uploading()}}else{if(!FileQueue.all_cancelled&&FileQueue.current_file&&a.id===FileQueue.current_file.id){return Upload.uploadNext()}}},_finished_uploading:function(){var b,c,a;FileQueue.uploading=false;if(!FileQueue.num_files()){BulkUpload.cancelled()}else{if(FileQueue.errors){BulkUpload.errored();InlineUploadStatus.errored()}else{BulkUpload.completed();InlineUploadStatus.completed()}}a=InlineUploadStatus.upload_box&&InlineUploadStatus.upload_box.visible();Browse.select_fq_paths=[];if(Browse.inside_dir){b=Browse.containing_fq_path();for(c in FileQueue.completed_files){Browse.select_fq_paths.push(b+"/"+FileQueue.files[c].name)}}Browse.force_reload();if(a){InlineUploadStatus.show()}Modal.onHide=null;return window.onbeforeunload=null},empty:function(){return !FileQueue.num_left},num_files:function(){return FileQueue.file_ids.length},next:function(){var a;if(FileQueue.num_left!==0){a=FileQueue.num_files()-FileQueue.num_left;return FileQueue.files[FileQueue.file_ids[a]]}},next_dest:function(){var b,a;a=FileQueue.next();b=a&&a.id;if(b&&$(b)){return $(b).readAttribute("data-dest")}else{return a.dest||Upload.current_dest}},clear:function(a){FileQueue.files={};FileQueue.file_ids=[];FileQueue.queue_size=0;FileQueue.cancels=0;FileQueue.cancelled_files={};FileQueue.all_cancelled=false;FileQueue.errors=0;FileQueue.errored_files={};FileQueue.num_left=0;FileQueue.completed_size=0;FileQueue.completed_files={};FileQueue.last_update_time=0;FileQueue.last_update_size=0;FileQueue.average_bps=0;FileQueue.formatted_time=null;FileQueue.uploading=false;window.onbeforeunload=null;return Modal.onHide=null}};UploadFile={FILENAME_SNIPPET_LENGTH:15,DEST_SNIPPET_LENGTH:13,_tmpl:null,init:function(){UploadFile._tmpl=HTML.tmpl("upload_list_item_tmpl");return UploadFile._listen()},_listen:function(){document.observe(Upload.QUEUE_EVT,UploadFile._file_queued);document.observe(Upload.QUEUE_ERROR_EVT,UploadFile._file_queue_errored);document.observe(Upload.UPDATE_EVT,UploadFile._file_updated);document.observe(Upload.COMPLETE_EVT,UploadFile._file_completed);document.observe(Upload.ERROR_EVT,UploadFile._file_errored);return document.observe(Upload.CANCEL_EVT,UploadFile._file_cancelled)},_file_queued:function(f){var j,b,a,h,g,k,c,d;b=f.memo.file;j=b.dest||Upload.current_dest;k=b.size!=null?Util.formatBytes(b.size,2,true):_("Too large");a=UploadFile._tmpl({file:b,icon:FileOps.filename_to_icon(b.name),filename_snippet:b.name.em_snippet(UploadFile.FILENAME_SNIPPET_LENGTH),size:k,dest:j,dest_snippet:("Dropbox"+j).em_snippet(UploadFile.DEST_SNIPPET_LENGTH,0)});$("upload-files-list").__sert(a);h=$(b.id);g=FileQueue.num_files()+FileQueue.cancels;c=$("upload-files-list");if(g<=6||IE7_OR_LESS){c.removeClassName("scroll")}else{c.addClassName("scroll");c.scrollTop=c.scrollHeight}h.down(".dest").observe("click",function(){Browse.reload_fqpath(h.readAttribute("data-dest"),true);return Modal.hide()});d=h.down(".status-col").down("a.small-x-button");d.stopObserving("click");d.observe("click",function(l){return document.fire(Upload.CANCEL_EVT,{file:b})});return h.down(".upload-progress-bar").setStyle({width:"0"})},_file_queue_errored:function(a){UploadFile._file_queued(a);return UploadFile._file_errored(a)},_file_updated:function(f){var c,g,b,a,d;c=f.memo.file;g=$(c.id);if(FileQueue.num_files()+FileQueue.cancels===1){if(FileQueue.formatted_time){a=_("%(time_left)s left").format({time_left:FileQueue.formatted_time});g.down(".time-col").__date(a)}}else{g.down(".time-col").__date()}b=parseInt(100*f.memo.percent_complete,10)+"%";if(b==="100%"){g.down(".time-col").__date();g.down(".status-col").__date(new Element("img",{src:"/static/images/icons/ajax-loading-small.gif"}))}else{d=g.down(".status-col").down("a.small-x-button");if(d){d.stopObserving("click");d.observe("click",function(h){return document.fire(Upload.CANCEL_EVT,{file:c})})}}return g.down(".upload-progress-bar").setStyle({width:b})},_file_completed:function(b){var a,c;a=b.memo.file;c=$(a.id);c.addClassName("complete");c.down(".time-col").__date();c.down(".status-col").__date(Sprite.make("web","synced"));return c.down(".upload-progress-bar").setStyle({width:"100%"})},_file_errored:function(f){var a,c,b,g,d;b=f.memo.file;g=$(b.id);g.addClassName("error");g.down(".dest-col").hide();g.down(".time-col").__date();g.down(".status-col").__date(Sprite.make("web","nosync"));g.down(".upload-progress-bar").setStyle({width:"100%"});c=f.memo.message||_("Flash error");a=void 0;if(f.memo.tooltip_text){a=f.memo.tooltip_text}else{if(parseFloat(Util.flash_version(),10)<10.32){a=_('Upload failed.  Please try upgrading to the latest version of <a id="adobe_link">Adobe Flash</a> and try again.');a=a.replace('id="adobe_link"','href="http://get.adobe.com/flashplayer/" target="_blank"')}else{a=_('Sorry, it looks like the advanced uploader is incompatible with your system. Please use the <a id="basic_link">basic uploader</a> to upload via the website');a=a.replace('id="basic_link"','onclick="FileOps.show_basic_upload(Browse.containing_fq_path()); return false;"')}}g.down(".error-msg").__date(c);d=g.down(".error-details");d.observe("mouseover",function(){return Tooltip.show(d,a)});return g.down(".error-col").show()},_file_cancelled:function(b){var a,c;a=b.memo.file;c=$(a.id);c.addClassName("cancelled");c.down(".dest-col").__date(_("Canceled"));c.down(".time-col").__date();c.down(".status-col").__date(Sprite.make("web","cancelsync"));return c.down(".upload-progress-bar").setStyle({width:"100%"})}};BulkUpload={init:function(){return BulkUpload._listen()},_listen:function(){document.observe(Upload.QUEUE_EVT,BulkUpload._file_queued);return document.observe(Upload.UPDATE_EVT,BulkUpload._file_updated)},_file_queued:function(c){var a,b;a=$("bulk-upload-status");a.removeClassName("error");a.removeClassName("complete");a.removeClassName("cancelled");b=new Element("a",{"class":"small-x-button"});b.observe("click",function(){var f,h,g,e,d;FileQueue.all_cancelled=true;f=FileQueue.file_ids.slice(0);d=[];for(g=0,e=f.length;g<e;g++){h=f[g];if(!FileQueue.completed_files[h]&&!FileQueue.errored_files[h]){d.push(document.fire(Upload.CANCEL_EVT,{file:FileQueue.files[h]}))}else{d.push(void 0)}}return d});return a.down(".status").__date(b)},_file_updated:function(h){var g,d,c,f,b,a;c=FileQueue.num_files();if(c+FileQueue.cancels>1){g=$("bulk-upload-status");f=ungettext("%d file","%d files",c).format(c);g.down(".num-files").__date(f);b=_("- %(size)s").format({size:Util.formatBytes(FileQueue.queue_size,2,true)});g.down(".size").__date(b);if(FileQueue.formatted_time){a=_("%(time_left)s left").format({time_left:FileQueue.formatted_time});g.down(".time-left").__date(a)}g.down(".upload-progress-bar").style.width=(100*FileQueue.totalPercentage||0).toFixed(2)+"%";g.show();d=$$(".swfupload").first();if(d){$("flash-upload-container").clonePosition($("add-button"));d.width=$("add-button").getWidth();return d.height=$("add-button").getHeight()}}},update_errors:function(){var a;a=ungettext("- %d error","- %d errors",FileQueue.errors).format(FileQueue.errors);return $("bulk-upload-status").down(".num-errors").__date(a)},completed:function(){var d,b,c,a;$("hide-button").hide();$("done-button").show();b=FileQueue.num_files();if(b+FileQueue.cancels>1){d=$("bulk-upload-status");d.addClassName("complete");c=ungettext("Uploaded %d file","Uploaded %d files",b).format(b);d.down(".num-files").__date(c);a=_("- %(size)s").format({size:Util.formatBytes(FileQueue.completed_size,2,true)});d.down(".size").__date(a);d.down(".num-errors").__date();d.down(".time-left").__date();d.down(".status").__date(Sprite.make("web","synced"));return d.down(".upload-progress-bar").style.width="100%"}},errored:function(){var d,e,b,c,a;$("hide-button").hide();$("done-button").show();b=FileQueue.num_files();if(b+FileQueue.cancels>1){d=$("bulk-upload-status");d.addClassName("error");c=ungettext("Uploaded %(num_completed)d of %(num_files)d file","Uploaded %(num_completed)d of %(num_files)d files",b).format({num_completed:b-FileQueue.errors,num_files:b});d.down(".num-files").__date(c);a=_("- %(size)s").format({size:Util.formatBytes(FileQueue.completed_size,2,true)});d.down(".size").__date(a);e=ungettext("- %d error","- %d errors",FileQueue.errors).format(FileQueue.errors);d.down(".num-errors").__date(e);d.down(".time-left").__date();d.down(".status").__date(Sprite.make("web","nosync"));return d.down(".upload-progress-bar").style.width="100%"}},cancelled:function(){var b,a;$("hide-button").hide();$("done-button").show();a=FileQueue.num_files();if(a+FileQueue.cancels>1){b=$("bulk-upload-status");b.addClassName("cancelled");b.down(".num-files").__date(_("All uploads canceled"));b.down(".size").__date();b.down(".num-errors").__date();b.down(".time-left").__date();b.down(".status").__date(Sprite.make("web","cancelsync"));return b.down(".upload-progress-bar").style.width="100%"}}};InlineUploadStatus={FILENAME_SNIPPET_LENGTH:30,upload_box:false,init:function(){return InlineUploadStatus._listen()},_listen:function(){document.observe(Upload.QUEUE_EVT,InlineUploadStatus._file_queued);return document.observe(Upload.UPDATE_EVT,InlineUploadStatus._file_updated)},_file_queued:function(c){var b,a;b=$("inline-upload-status");b.removeClassName("error");b.removeClassName("complete");b.down(".icon").__date(Sprite.make("web","syncing"));b.down(".file-desc").__date(_("Starting upload..."));b.down(".num-errors").__date();a=ungettext("%d file","%d files",FileQueue.num_left).format(FileQueue.num_left);b.down(".view-details").__date(a);b.down(".status").__date();return b.down(".inline-upload-progress").style.width="0%"},_file_updated:function(h){var d,f,c,g,b,a;d=h.memo.file;if($$("#right-content #inline-upload-status").length===0){InlineUploadStatus._build()}c=$("inline-upload-status");c.down(".icon").__date(Sprite.make("web","syncing"));f=_("Uploading %(filename)s").format({filename:d.name.em_snippet(InlineUploadStatus.FILENAME_SNIPPET_LENGTH)});c.down(".file-desc").__date(f);if(FileQueue.num_left>1){a=ungettext("%d file left","%d files left",FileQueue.num_left-1).format(FileQueue.num_left-1);c.down(".view-details").__date(a)}else{c.down(".view-details").__date(_("View details"))}if(FileQueue.formatted_time){b=_("%(time_left)s left").format({time_left:FileQueue.formatted_time});c.down(".status").__date(b)}g=(parseInt(100*FileQueue.totalPercentage,10)||0)+"%";return c.down(".inline-upload-progress").style.width=g},update_errors:function(){var a;a=ungettext("- %d error","- %d errors",FileQueue.errors).format(FileQueue.errors);return $("inline-upload-status").down(".num-errors").__date(a)},add_x_button:function(){var a;a=new Element("a",{"class":"small-x-button"});a.observe("click",function(){InlineUploadStatus.hide();return Upload.reset()});return $("inline-upload-status").down(".status").__date(a)},completed:function(){var b,a;a=$("inline-upload-status");a.addClassName("complete");a.removeClassName("error");a.down(".icon").__date(Sprite.make("web","synced"));b=void 0;if(FileQueue.num_files()>1){b=_("Uploaded %(num_files)d files").format({num_files:FileQueue.num_files()})}else{b=_("Uploaded %(filename)s").format({filename:FileQueue.current_file.name.em_snippet(InlineUploadStatus.FILENAME_SNIPPET_LENGTH)})}a.down(".file-desc").__date(b);a.down(".num-errors").__date();a.down(".view-details").__date(_("View details"));InlineUploadStatus.add_x_button();return a.down(".inline-upload-progress").style.width="100%"},errored:function(){var d,c,a,f,b,e;a=$("inline-upload-status");a.addClassName("error");a.removeClassName("complete");a.down(".icon").__date(Sprite.make("web","nosync"));b=FileQueue.num_files();d=void 0;if(b>1){d=_("Uploaded %(num_completed)d of %(num_files)d files").format({num_completed:b-FileQueue.errors,num_files:b});a.down(".file-desc").__date(d);f=ungettext("- %d error","- %d errors",FileQueue.errors).format(FileQueue.errors);a.down(".num-errors").__date(f)}else{c=(e=FileQueue.current_file)!=null?e.name.em_snippet(InlineUploadStatus.FILENAME_SNIPPET_LENGTH):void 0;d=c?_("Unable to upload %(filename)s").format({filename:c}):_("Unable to upload file");a.down(".file-desc").__date(d);a.down(".num-errors").__date()}a.down(".view-details").__date(_("View details"));InlineUploadStatus.add_x_button();return a.down(".inline-upload-progress").style.width="100%"},show:function(a){if(!InlineUploadStatus.upload_box){InlineUploadStatus._build(a)}return InlineUploadStatus.upload_box.show()},_build:function(){if(!InlineUploadStatus.upload_box){InlineUploadStatus.upload_box=$("inline-upload-status")}return $("browse").__sert({top:InlineUploadStatus.upload_box})},hide:function(){if(InlineUploadStatus.upload_box){return InlineUploadStatus.upload_box.hide()}}};CrossDomainUploader={CROSS_DOMAIN_PREFIX:"cross-domain-",_drop_indicators:false,_drop_dest_folder:null,file_counter:0,current_req:null,supported:function(){return Prototype.BrowserFeatures.DB_CORS},enabled:function(){return CrossDomainUploader.supported()&&Browse.inside_dir},browse_indicators_enabled:function(){var d,b,c,a;if(!CrossDomainUploader.enabled()){return false}b=["file-preview-modal","modal-overlay"];for(c=0,a=b.length;c<a;c++){d=b[c];if($(d).visible()){return false}}return true},modal_indicators_enabled:function(){return CrossDomainUploader.enabled()&&$("modal").down("#upload-modal-dropzone")},_show_border_drop_indicators:function(){return $$(".external-drop-indicator").each(function(a){return new Effect.Appear(a,{duration:0.5,from:0,to:0.6})})},_hide_border_drop_indicators:function(){return $$(".external-drop-indicator").invoke("hide")},show_drop_indicators:function(b){var a;if(!CrossDomainUploader._drop_indicators){if(CrossDomainUploader.modal_indicators_enabled()){a=$("upload-modal-dropzone");a.clonePosition($("modal"));a.style.lineHeight=a.getHeight()+"px";new Effect.Appear(a,{duration:0.5,from:0,to:1});CrossDomainUploader._show_border_drop_indicators()}else{if(CrossDomainUploader.browse_indicators_enabled()){BrowseDrag._add_drop_indicators(b)}else{return}}$("drag-status").removeClassName("active");return CrossDomainUploader._drop_indicators=true}},hide_drop_indicators:function(){if(CrossDomainUploader._drop_indicators){CrossDomainUploader._hide_border_drop_indicators();BrowseDrag._remove_drop_indicators();Notify.clear_all();$("upload-modal-dropzone").hide();$("drag-status").addClassName("active");return setTimeout((function(){CrossDomainUploader._drop_indicators=false;return CrossDomainUploader._drop_dest_folder=null}),500)}},folder_dragover:function(a){var b;if(CrossDomainUploader.browse_indicators_enabled()&&CrossDomainUploader._drop_indicators&&a!==CrossDomainUploader._drop_dest_folder){if(a===Browse.containing_fq_path()){b=_("Drop your file to upload to '%(folder_name)s'").format({folder_name:FileOps.filename(a).em_snippet(20).escapeHTML()});Notify.server_success(b,60);CrossDomainUploader._show_border_drop_indicators()}else{Notify.clear_all();CrossDomainUploader._hide_border_drop_indicators()}return CrossDomainUploader._drop_dest_folder=a}},is_cross_domain:function(a){return a.id.indexOf(CrossDomainUploader.CROSS_DOMAIN_PREFIX)!==-1},supports_recursive_upload:function(a){var b;return window.File&&window.FileReader&&window.FileList&&window.Blob&&(a!=null?(b=a[0])!=null?b.webkitGetAsEntry:void 0:void 0)},upload:function(b,c,a){if(a==null){a=null}if(CrossDomainUploader.supports_recursive_upload(a)){return CrossDomainUploader._recursive_upload(b,a)}else{return CrossDomainUploader._upload(b,c,a)}},_recursive_upload:function(j,h){var k,b,c,g,e,l,a,d;d=(function(){var n,m,f;f=[];for(n=0,m=h.length;n<m;n++){e=h[n];f.push(e.webkitGetAsEntry())}return f})();a=[];c=0;l=0;k=3000;g=0;b=function(){var m,n,f;while(d.length){n=d.pop();if(n.isDirectory){m=n.createReader();c+=1;m.readEntries(function(o){var r,q,p;for(q=0,p=o.length;q<p;q++){r=o[q];d.push(r)}return c-=1})}else{l+=1;f=function(o){return function(p){a.push(p);p.dest=j+Util.parentDir(o.fullPath);return l-=1}};n.file(f(n))}}if(a.length>k&&!g){g=1;Notify.server_error(_("The Dropbox website can't upload more than "+k+" files."));return}if(c||l){return b.defer()}else{if(a.length){return CrossDomainUploader._upload("",a)}}};return b()},_upload:function(d,f,c){var a,e,g,b;if(c==null){c=null}if(c){a=this._parse_upload_items(c)}Upload.current_dest=d;if(!$("modal").visible()){FileOps.show_upload();Modal.hide(null,true)}for(g=0,b=f.length;g<b;g++){e=f[g];if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(a!=null?a[e.name].isDirectory:void 0)){e.is_directory=true}e.id=CrossDomainUploader.CROSS_DOMAIN_PREFIX+CrossDomainUploader.file_counter;e.dest=e.dest||d;CrossDomainUploader.file_counter++;document.fire(Upload.QUEUE_EVT,{file:e})}return Upload.show_upload()},_parse_upload_items:function(b){var c,d,e,a;c={};for(e=0,a=b.length;e<a;e++){d=b[e];if(d.getAsEntry){d=d.getAsEntry()}else{if(d.webkitGetAsEntry){d=d.webkitGetAsEntry()}}c[d.name]=d}return c},upload_next:function(){var c,a,b;c=FileQueue.next();if((c.is_directory!=null)&&c.is_directory){setTimeout(CrossDomainUploader._onFolderUpload.curry(c),250);return}b="//"+Constants.BLOCK_CLUSTER+"/upload_cross_domain?filename="+encodeURIComponent(c.name||c.fileName)+"&dest="+encodeURIComponent(FileQueue.next_dest())+"&t="+encodeURIComponent(Constants.TOKEN);FileQueue.current_file=c;if(c.size===!void 0){a=c.size}else{a=c.fileSize}return CrossDomainUploader.current_req=new Ajax.DBRequest(b,{method:"POST",contentType:c.type||"application/octet-stream",evalJS:false,evalJSON:false,no_watch:true,requestHeaders:{"If-Modified-Since":"Mon, 26 Jul 1997 05:00:00 GMT","Cache-Control":"no-cache","X-File-Name":c.name||c.fileName,"X-File-Size":a,"X-File-Type":c.type},postBody:c,onCreate:CrossDomainUploader._onCreate.bind(null,c),onSuccess:CrossDomainUploader._onSuccess.bind(null,c),onFailure:CrossDomainUploader._onFailure.bind(null,c)})},_onCreate:function(a,c){var b;b=c.request.transport;b.upload.addEventListener("progress",(function(d){if(!FileQueue.cancelled_files[a.id]){return document.fire(Upload.UPDATE_EVT,{file:a,percent_complete:d.loaded/d.total})}}),false);return b.send=b.send.wrap(function(e,d){this.withCredentials="true";return e(d)})},_onSuccess:function(a,b){return document.fire(Upload.COMPLETE_EVT,{file:a})},_onFailure:function(a,b){if(!FileQueue.cancelled_files[a.id]){if(a.size){return document.fire(Upload.ERROR_EVT,{file:a,message:_("Upload error"),tooltip_text:_("Please try again. If this continues to fail, your browser might not support drag and drop uploads.")})}else{return document.fire(Upload.ERROR_EVT,{file:a,message:_("Invalid type"),tooltip_text:_("You can't upload folders or files of this type.")})}}},_onFolderUpload:function(a){document.fire(Upload.ERROR_EVT,{file:a,message:_("Invalid type"),tooltip_text:_("Drag and drop doesn't support folder uploads.")});if(!FileQueue.empty()){return CrossDomainUploader.upload_next()}}};var AccountExtras,BonusTable,Bromo,DowngradeReasons,Downloading,EmailChange,EmailVerification,GetSpace,Help,Home,Hosts,Install,LoginAndRegister,News,PasswordChange,Recover,Restore,SecurityTab,TabController,Upgrade;Hosts={edit:function(g){var d,c,f,a,b,e;f=$("host"+g);if(f.editing){return false}f.editing=true;c=f.innerHTML.unescapeHTML();f.previous=c;e=c.escapeHTML().gsub('"',"&quot;");b=_("Save");d=_("Cancel");f.innerHTML='<input type="text" class="skinny-input" size="20" maxlength="256" style="word-wrap: break-word;" value="'+e+'">&nbsp;\n<input type="button" onclick="Hosts.doneEditing(\''+g+'\')" class="button" value="'+b+'">&nbsp;\n<input type="button" onclick="Hosts.cancelEditing(\''+g+'\')" class="button grayed" value="'+d+'">';a=f.down("input");Event.observe(a,"keydown",Hosts.checkKey(g));a.select();return false},doneEditing:function(c){var b,a;b=$("host"+c);a=b.down("input").value;return new Ajax.DBRequest("/computer_edit?host_id="+c+"&name="+Util.urlquote(a),{onSuccess:function(d){return Hosts.unedit(b,d.responseText)}})},cancelEditing:function(b){var a;a=$("host"+b);return Hosts.unedit(a,a.previous)},unedit:function(b,a){b.editing=false;return b.__date(a)},unlink:function(c,b,a){DomUtil.fillVal(b.escapeHTML(),"unlink-confirm-name");return Modal.icon_show("alert_32",_("Unlink computer?"),DomUtil.fromElm("unlink-confirm"),{host_id:c,plat:a,wit_group:"unlink-confirm"})},doUnlink:function(b,a){return new Ajax.DBRequest("/computer_edit?host_id="+b+"&unlink=yessir",{onSuccess:function(c){Hosts.killRow(b);return Hosts.dec_count(a)}})},dec_count:function(a){var c,b,e,d;b=$(a+"-count");if(!b){return}d=b.innerHTML.split(" ");c=parseInt(d.shift(),10);e=d.join(" ");if(!c){return}c--;if(c===1&&e.charAt(e.length-1)==="s"){e=e.substr(0,e.length-1)}else{if(c!==1&&e.charAt(e.length-1)!=="s"){e=e+"s"}}return b.innerHTML=c.toString()+" "+e},killRow:function(d){var b,a,c;a=$("host"+d).up("table");$("host"+d).up("tr").remove();if(Hosts.rowCount()===0){b=new Element("tr");c=new Element("td",{colspan:4});c.__date(HTML.tmpl("<center><%= text %></center>",{text:_("You no longer have any hosts linked.")}));a.__sert(b);b.__sert(c);return $("my-computers-table").__date(b)}},rowCount:function(){return $$("#my-computers-table .host-row").length},checkKey:function(a){return function(b){b=b||window.event;if(b.keyCode===Event.KEY_RETURN){Hosts.doneEditing(a)}if(b.keyCode===Event.KEY_ESC){return Hosts.cancelEditing(a)}}}};Upgrade={card_toggle:function(a){return function(c){var b;b=$(c);if(c===a||!a){return b.removeClassName("cc-icon-off")}else{return b.addClassName("cc-icon-off")}}},highlightCardtype:function(){var c,e,b,a,d;e=$("ccn");if(Upgrade.last_val===e.value){return}Upgrade.last_val=e.value;b=e.value;d=b.substr(0,2);c=$A(["visa","mastercard","amex"]);a=null;if(b.charAt(0)==="4"){a="visa"}else{if(d==="34"||d==="37"){a="amex"}else{if(parseInt(d,10)>=51&&parseInt(d,10)<=55){a="mastercard"}}}return c.each(Upgrade.card_toggle(a))},runCardHighlighter:function(){return setInterval(Upgrade.highlightCardtype,200)},submitPaypal:function(){var a;if(!Forms.submitOnlyOnce()){return}a={plan:Forms.value("plan"),period:Forms.value("period")};if(Forms.value("packrat")){a.packrat="yes"}return location.href=Util.add_qstring("/paypal_upgrade",a)},upgradeViaLogin:function(){var a,b;if(!Forms.submitOnlyOnce()){return}a={plan:Forms.value("plan"),period:Forms.value("period")};if(Forms.value("packrat")){a.packrat="yes"}b=Util.add_qstring("/upgrade",a);return location.href=Util.add_qstring("/login",{cont:b})},setFormToObserveLogin:function(){return $("upgrade-login-button").observe("click",Upgrade.upgradeViaLogin)},setFormPaypalSubmitState:function(a){var b;b=$("upgrade-button");if(!b){return}if(a){return b.observe("click",Upgrade.submitPaypal)}else{return b.stopObserving("click")}},watchPaymentOptions:function(){var l,h,g,d,k,b,a,j,f,c,e;j=$$("a.toggle_paypal_link");for(h=0,k=j.length;h<k;h++){l=j[h];l.observe("click",function(){$("credit-card-info").addClassName("hidden_elem");$("submitted_cc").writeAttribute("value","false");$("paypal-info").removeClassName("hidden_elem");$("toggle_paypal_link_container").addClassName("hidden_elem");$("toggle_credit_card_link_container").removeClassName("hidden_elem");return Upgrade.setFormPaypalSubmitState(true)})}f=$$("a.toggle_credit_card_link");for(g=0,b=f.length;g<b;g++){l=f[g];l.observe("click",function(){var m;$("credit-card-info").removeClassName("hidden_elem");$("submitted_cc").setValue("true");m=$("paypal-info");if(m){$("paypal-info").addClassName("hidden_elem")}$("toggle_paypal_link_container").removeClassName("hidden_elem");$("toggle_credit_card_link_container").addClassName("hidden_elem");Upgrade.setFormPaypalSubmitState(false);return $("ccn").focus()})}c=$$("a.change_billing_information");e=[];for(d=0,a=c.length;d<a;d++){l=c[d];e.push(l.observe("click",function(){var u,r,v,t,m,x,w,q,o,s,p,n;$("toggle_paypal_link_container").removeClassName("hidden_elem");$("change_billing_information_container").addClassName("hidden_elem");$("upgrade-form").action="/upgrade";s=$$(".sick-input input");for(t=0,m=s.length;t<m;t++){v=s[t];v.writeAttribute("readOnly",false);v.removeClassName("gray")}$("country-list").removeClassName("hidden_elem");p=$$("[name='expmo']");for(q=0,x=p.length;q<x;q++){u=p[q];u.writeAttribute("disabled",false)}n=$$("[name='expyr']");for(o=0,w=n.length;o<w;o++){r=n[o];r.writeAttribute("disabled",false)}$("ccn").writeAttribute("value","");$("address").writeAttribute("value","");return $("ccode").writeAttribute("value","")}))}return e},plan_to_prices:{},plan_to_display_name:{},monthly_packrat_cost:0,yearly_packrat_cost:0,monthly_packrat_display_price:0,yearly_packrat_display_price:0,prorate_amount:0,has_packrat_already:false,plan_box_holder_ids:[],user_current_plan_size:0,user_current_billing_period:"",user_has_downgraded:false,initializeUpgradeForm:function(e,g,f,h,k,c,j,b,a,d){Upgrade.user_current_plan_size=e;Upgrade.user_current_billing_period=g;Upgrade.user_has_downgraded=f;Upgrade.monthly_packrat_cost=h;Upgrade.yearly_packrat_cost=k;Upgrade.monthly_packrat_display_price=c;Upgrade.yearly_packrat_display_price=j;Upgrade.prorate_amount=a;Upgrade.has_packrat_already=b;return Upgrade.setFormPaypalSubmitState(d)},registerPrice:function(c,a,b){return Upgrade.plan_to_prices[c]=[a,b]},registerPlanDisplayName:function(b,a){return Upgrade.plan_to_display_name[b]=[a]},registerPlanBoxHolderId:function(b,a){Upgrade.plan_box_holder_ids.push(b);return $(a).observe("click",function(){return Upgrade.updateSelectedPlanBoxHolder(b)})},updateSelectedPlanBoxHolder:function(d){var c,f,b,e,a;$(d).addClassName("selected-plan");e=Upgrade.plan_box_holder_ids;a=[];for(f=0,b=e.length;f<b;f++){c=e[f];if(c!==d){a.push($(c).removeClassName("selected-plan"))}else{a.push(void 0)}}return a},updateBillingForm:function(W){var C,S,A,D,b,s,w,e,a,G,R,F,u,c,O,E,l,B,v,I,d,z,y,V,U,Q,P,x,m,k,j,h,g,f,N,M,L,H,t,r,q,p,o,n,K,J;I=0;E=100;F=$("packrat");e=Upgrade.has_packrat_already||(F&&F.type==="checkbox"&&F.checked);G=_("month");R="$39.00";H=$$("[name='plan']");for(V=0,x=H.length;V<x;V++){s=H[V];if(s.checked){E=s.getValue();Upgrade.updateSelectedPlanBoxHolder("plan-"+E+"-holder")}}if(E===Upgrade.user_current_plan_size&&!Upgrade.user_has_downgraded){$("current-plan-desc").removeClassName("hidden_elem");$("billing-information").addClassName("hidden_elem")}else{$("current-plan-desc").addClassName("hidden_elem");$("billing-information").removeClassName("hidden_elem")}if($("period-month").checked){I=Upgrade.plan_to_prices[E][0];if(e){I+=Upgrade.monthly_packrat_cost}R=Upgrade.monthly_packrat_display_price;G=_("month");v="month"}if($("period-year").checked){I=Upgrade.plan_to_prices[E][1];if(e){I+=Upgrade.yearly_packrat_cost}R=Upgrade.yearly_packrat_display_price;G=_("year");v="year"}u=$("packrat-price");c=$("packrat-priceperiod");if(u&&c){u.__date(R);c.__date(G)}y=Upgrade.plan_to_prices[E][0]*12;if(e){y+=Upgrade.monthly_packrat_cost*12}w=Upgrade.plan_to_prices[E][1];if(e){w+=Upgrade.yearly_packrat_cost}B=y-w;O=B/y*100;O=Math.round(O);C=0;S=0;if(Upgrade.prorate_amount>=I){C=0;S=I}else{C=I-Upgrade.prorate_amount;S=Upgrade.prorate_amount}b=C;if(Upgrade.user_has_downgraded&&E===Upgrade.user_current_plan_size&&v===Upgrade.user_current_billing_period){b=0;S=0}b=b.toFixed(2);l=$("plan-name");if(l){l.__date(Upgrade.plan_to_display_name[E])}$("big-price").__date("$"+b);t=$$(".summary_price");for(U=0,m=t.length;U<m;U++){d=t[U];d.__date("$"+b)}r=$$(".monthly-price");for(Q=0,k=r.length;Q<k;Q++){a=r[Q];a.__date("$"+Upgrade.plan_to_prices[E][0].toFixed(2))}q=$$(".yearly-price");for(P=0,j=q.length;P<j;P++){z=q[P];z.__date("$"+Upgrade.plan_to_prices[E][1].toFixed(2))}$("savings-percentage").__date(O+"%");if(S){p=$$(".credit-holder");for(N=0,h=p.length;N<h;N++){D=p[N];D.removeClassName("hidden_elem")}o=$$(".credit-amount");K=[];for(M=0,g=o.length;M<g;M++){A=o[M];K.push(A.__date(S.toFixed(2)))}return K}else{n=$$(".credit-holder");J=[];for(L=0,f=n.length;L<f;L++){D=n[L];J.push(D.addClassName("hidden_elem"))}return J}},runPlanWatcher:function(){var d,e,h,f,c,b,g,a;g=$$("[name='plan']");for(h=0,c=g.length;h<c;h++){d=g[h];d.observe("click",Upgrade.updateBillingForm)}a=$$("[name='period']");for(f=0,b=a.length;f<b;f++){d=a[f];d.observe("click",Upgrade.updateBillingForm)}e=$("packrat");if(e){return e.observe("click",Upgrade.updateBillingForm)}}};Home={hide_promo:function(a){new Ajax.DBRequest(a);return $$(".bromo").invoke("remove")},showScreencast:function(g,k,c){var b,h,f,d,l,e,j,a;f="/static/images/cc_endframe.jpg";j=360/640;if(Constants.USER_LOCALE==="en"){f="/static/images/cc_endframe_en.jpg";j=353/640}c=c||532;l=j*c;l=parseInt(l,10);a=localized_path("https://scast.s3.amazonaws.com/cc/dropbox_intro.mp4",["es","fr","de","ja"]);h="commoncraft-embed";b=new Element("div",{id:h,style:"display: inline-block; border:1px solid #adcfea;background:#fff;"});$(g).__date(b);if(FlashDetect.versionAtLeast(9)){e={allowfullscreen:"true",wmode:"transparent"};d={file:a,skin:"/static/swf/bekle.swf",controlbar:"over",image:f};if(k){d.autostart="true"}swfobject.embedSWF("/static/swf/jwplayer-5.10-licensed-2393.swf",h,c.toString(),l.toString(),"9",false,d,e)}else{Util.embed_video(a,h,c,k,l)}return WebMiscActivityLogger.log("commoncraft_video_view")},hide:function(b,a){$(b).up("div").hide();return new Ajax.DBRequest("/hide/"+a)}};LoginAndRegister={init:function(a){LoginAndRegister._one_submit_at_a_time();$("login-link").observe("click",function(){$("login-and-register-container").removeClassName("show-register");return $("login_email").focus()});$("register-link").observe("click",function(){$("login-and-register-container").addClassName("show-register");return $("fname").focus()});if(a){return $("fname").focus()}else{return $("login_email").focus()}},invite_init:function(b,a){LoginAndRegister._one_submit_at_a_time();if(!a){return $("invite-register-page").on("click",".switch-form-link",function(){return $("invite-register-page").toggleClassName("show-login-form")})}},_one_submit_at_a_time:function(){var e,d,b,c,a;c=$$(".one-submit-at-a-time");a=[];for(d=0,b=c.length;d<b;d++){e=c[d];a.push(e.observe("click",function(f){return Forms.disable(e)}))}return a}};News={DEFAULT_TAB:"recent-news",init:function(){$("news-home").on("click","#nav a",function(b,c){var a;if(c.hasAttribute("data-div")){b.preventDefault();a=c.readAttribute("data-div");return DBHistory.push_state("/news/"+a)}});return DBHistory.add_callback("/news",News.history_change)},change_tab:function(a){var b;b=$$("#nav a[data-div="+a+"]").first();if($(b)){$$(".section").invoke("removeClassName","selected");$$("#nav a").invoke("removeClassName","selected");$(b).addClassName("selected");return $(a).addClassName("selected")}},history_change:function(a){a=a||News.DEFAULT_TAB;return News.change_tab(a)}};Install={pingForLinkedHost:function(a){return new Ajax.Request("/host_linked",{method:"get",onSuccess:function(){return location.href="/share"+a},onFailure:function(){return setTimeout(Install.pingForLinkedHost.curry(a),3000)}})}};Downloading={registerAll:function(){if(Prototype.Browser.IE){return $$(".downloading-link").each(Downloading.register)}},register:function(a){a=$(a);return a.observe("click",Downloading.clicked)},clicked:function(b){var a,c;Event.stop(b);c=$(b.target);if(c.nodeName==="SPAN"){c=c.up("a")}a=c.href.split("?").last();window.location="/download?"+a;return setTimeout((function(){return window.location="/downloading?"+a}),4000)}};Util.smartLoad(Downloading.registerAll);Help={toggle_more_help:false,show_os:function(b,c,a){c=$(c);$$(".os-filter").invoke("removeClassName","selected");c.addClassName("selected");$$(".help-os-section").invoke("hide");$$(".help-os-"+a).invoke("show");return Event.stop(b)},vote:function(a,b){new Ajax.DBRequest("/help/"+a+"/vote/"+b);new Effect.Fade("help-vote-cont");return Notify.server_success(_("Thanks for your feedback!"))}};AccountExtras={prices:{},prices_value:{},watch_id:0,watch:function(){if(!AccountExtras.watch_id){return AccountExtras.watch_id=setInterval(AccountExtras.update_prices,200)}},show_detail:function(a,d,b){var c;c=_("What is %(feature_name)s?").format({feature_name:a});Modal.icon_show("alert_32",c,$(d+"-modal"),{},false);return false},register_price:function(e,a,d,c,b){AccountExtras.prices[e]=[a,d];return AccountExtras.prices_value[e]=[c,b]},update_prices:function(){var f,d,a,b,c,e;e=$("yearly").checked;d=(e?1:0);a=(e?_("year"):_("month"));b=0;for(f in AccountExtras.prices){if(AccountExtras.prices.hasOwnProperty(f)){$(f+"-price").__date(AccountExtras.prices[f][d]);$(f+"-priceperiod").__date(a)}if(AccountExtras.prices_value.hasOwnProperty(f)){if($(f).checked){c=AccountExtras.prices_value[f][d];b+=parseFloat(c)}}}return $(document).fire("widget:update_price",{price:b,period:a})}};DowngradeReasons={reasons:{},addReason:function(a){return this.reasons[a]=true},addReasons:function(a){var d,e,c,b;b=[];for(e=0,c=a.length;e<c;e++){d=a[e];b.push(this.addReason(d))}return b},change:function(f,c,a){var g,j,h,d,b,e;f=parseInt(f,10);j=$(c);assert(j,"Couldn't find container for DowngradeReason");g=false;e=this.reasons;for(d in e){h=e[d];b=$(a+d);assert(b,"Couldn't find container for ",a+d);if(h&&parseInt(d,10)===f){b.show();g=true}else{b.hide()}}if(g){return j.show()}else{return j.hide()}}};Restore={next:function(a,d){var c,b;b=$$("ul.selected")[0];c=b.next("ul");c.addClassName("selected");b.removeClassName("selected");if(c.next("ul")){Restore.show_next_link()}else{Restore.hide_next_link()}Restore.show_prev_link();return Restore.inc_page(1)},prev:function(a,d){var c,b;b=$$("ul.selected")[0];c=b.previous("ul");c.addClassName("selected");b.removeClassName("selected");if(c.previous("ul")){Restore.show_prev_link()}else{Restore.hide_prev_link()}Restore.show_next_link();return Restore.inc_page(-1)},inc_page:function(c){var b,a;b=parseInt($("page-num").innerHTML,10);a=b+c;return $("page-num").__date(a)},hide_next_link:function(){return $("next-page").__date()},show_next_link:function(){var b;b=new Element("a",{href:"#",onclick:"Restore.next(event, this); return false;"});b.__date(_("Next")).__sert(new HTML(" &raquo;"));return $("next-page").__date(b)},show_prev_link:function(){var b;b=new Element("a",{href:"#",onclick:"Restore.prev(event, this); return false;"});b.__date(new HTML("&laquo; ")).__sert(_("Prev"));return $("prev-page").__date(b)},hide_prev_link:function(){return $("prev-page").__date()}};TabController=Class.create({initialize:function(c,b){var a;a=$(c);assert(a,c+" is missing.");this.container=a;this.options={killEvent:true};Object.extend(this.options,b);return this.listen()},listen:function(){var f,c,e,b,d,a;c=this;d=this.container.select("a");a=[];for(e=0,b=d.length;e<b;e++){f=d[e];assert(f.id&&f.id.length>0,"Element is missing an id");a.push(f.observe("click",(function(g){return this.click(g)}).bindAsEventListener(c)))}return a},click:function(a){if(this.options.killEvent){Event.stop(a)}return this.toggle($(a.target))},toggle:function(b){var e,a,d,f,c;c=this.container.down("a.selected");if(c){f=$(c.id+"-content");if(f){f.hide()}}this.container.select(".selected").invoke("removeClassName","selected");a=false;if(!b){b=this.container.down("a");a=true}b.addClassName("selected");e=$(b.id+"-content");if(e){e.show()}if(this.options.onTabChange){this.options.onTabChange(b,c)}if(this.options.url_prefix){d=this.options.url_prefix;if(!a){d+="/"+b.id}return DBHistory.push_state(d)}}});EmailVerification={EMAIL_SENT_EVT:"db:verification_email_sent",send_email:function(){return new Ajax.DBRequest("/sendverifyemail",{onSuccess:function(){return $(document.body).fire(EmailVerification.EMAIL_SENT_EVT)}})},setup:function(){return Util.smartLoad(function(){$("send-email-link").observe("click",function(a){a.preventDefault();return EmailVerification.send_email()});return $(document.body).observe(EmailVerification.EMAIL_SENT_EVT,function(){$("pre-resend").hide();$("post-resend").show();$("pre-resend-header").hide();return $("post-resend-header").show()})})},verified:function(){if(Constants.EMAIL_VERIFIED){return true}else{this.show_modal();return false}},show_modal:function(){Modal.icon_show("email_32",_("Verify your email address"),$("verify-email"));return this.listen()},reshow_modal:function(){this.show_modal();return delete Modal.onHide},polling:false,poll_until_verified:function(){var a,b=this;a=4000;return new Ajax.DBRequest("/isemailverified",{onSuccess:function(c){if(c.responseText==="ok"){return window.location.reload()}else{return setTimeout(EmailVerification.poll_until_verified,a)}}})},listen:function(){var a=this;return document.observe(EmailVerification.EMAIL_SENT_EVT,function(){var b;$$(".email-verify-step1").invoke("hide");$$(".email-verify-step2").invoke("show");b=_("Verification email sent to %(email)s");b=b.format({email:Constants.email.escapeHTML()});Notify.server_success(b);if(!a.polling){a.poll_until_verified();return a.polling=true}})},show_verified_modal:function(){return Modal.icon_show("email_32",_("Your email address has been verified!"),$("email-verified"))},show_sent_modal:function(){return Modal.icon_show("email_32",_("Verification email sent!"),$("verification-email-sent"))}};EmailChange={show_change_email_modal:function(){return Modal.icon_show("email_add_32",_("Change email address"),$("change-email"),{},false,550)},submit_email_change:function(b){var a;a=$("change-email-form");return Forms.ajax_submit(a,false,(function(){if(window.location.pathname.indexOf("/account")===0){return window.location.reload()}else{return window.location.href="/home?send_verification_email=1"}}),false,$(b.target))}};PasswordChange={show_change_password_modal:function(){return Modal.icon_show("alert_32",_("Change password"),$("change-password"),{},false,550)},submit_password_change:function(b){var a;a=$("change-password-form");return Forms.ajax_submit(a,false,(function(){return window.location.reload()}),false,$(b.target))}};Bromo={init:function(){Event.observe(window,"resize",Bromo.check_sizing);return Util.smart_window_load(Bromo.check_sizing)},check_sizing:function(){var f,e,d,a,c,b;d=$$(".bromo");if(!d.length){return}f=d[0];a=20;c=$("page-sidebar");b=c.cumulativeOffset().top+c.getLayout().get("height");f.show();e=f.cumulativeOffset().top;if(b+a>e){f.hide()}if($(document.body).getWidth()<960){return f.hide()}}};BonusTable={_tmpl:null,_inited:null,_next_page:0,_fetching_page:false,init:function(){if(BonusTable._inited){return}BonusTable._inited=true;$("bonus-loading").show();BonusTable._tmpl=HTML.tmpl("bonus_row_tmpl");BonusTable.listen();return BonusTable.get_next_page()},_render:function(d){var b,e,c,a;b=[];for(c=0,a=d.length;c<a;c++){e=d[c];b.push(BonusTable._tmpl({row:e}))}return $("bonus-table").__sert(b)},get_next_page:function(){if(BonusTable._fetching_page){return}BonusTable._fetching_page=true;return new Ajax.DBRequest("/account/bonus_page/"+BonusTable._next_page,{onSuccess:function(j){var f,h,g,k,n,m,d,c,l,a,e,b;f=j.responseText.evalJSON();n=f.rows;k=f.has_more;BonusTable._render(n);e=$$(".reached-max-referral-bonus");for(d=0,l=e.length;d<l;d++){g=e[d];g.stopObserving("mouseenter")}b=$$(".reached-max-referral-bonus");for(c=0,a=b.length;c<a;c++){g=b[c];m=_("You've earned the maximum amount of referral space. Thanks for inviting people to Dropbox!");h=Bubble.make(m,"right","middle");g.observe("mouseenter",function(){h.absolutize();g.__sert(h);h.clonePosition(g,{setWidth:false,setHeight:false});h.style.width="200px";h.style.left=(parseInt(h.style.left,10)-210)+"px";return h.style.top=(parseInt(h.style.top,10)-55)+"px"});g.observe("mouseleave",function(){return h.remove()})}$("bonus-loading").hide();if(k){BonusTable._next_page+=1;$("load-more-bonus").show()}else{$("load-more-bonus").hide()}return BonusTable._fetching_page=false}})},listen:function(){return $("bonus-content").on("click","#load-more-bonus",BonusTable.get_next_page)}};GetSpace={_current_space:null,_why_msg:null,_twitter_url:null,init:function(b,a,c){GetSpace._current_space=b;GetSpace._why_msg=a;GetSpace._twitter_url=c;if($("why_like")&&$("twitter_post")){$("twitter_post").hide()}return $("space-actions").on("click",".space-action",GetSpace.perform_action)},perform_action:function(b){var c,a;a={contact_sales:GetSpace._contact_sales,contact_support:GetSpace._contact_support,teams:GetSpace._teams,upgrade:GetSpace._upgrade,plans:GetSpace._plans,refer:GetSpace._refer,get_started:GetSpace._get_started,spacerace2012:GetSpace._spacerace2012,fb_link:GetSpace._fb_link,twitter_link:GetSpace._twitter_link,twitter_follow:GetSpace._twitter_follow,why_like:GetSpace._why_like,twitter_post:GetSpace._twitter_post};c=$(b.target);if(!c.hasClassName("space-action")){c=c.up(".space-action")}return a[c.id]()},_teams:function(){return window.location.href="/teams?tk=dropbox&ag=getspace&ad=v1"},_contact_sales:function(){return window.location.href="mailto:sales@dropbox.com"},_contact_support:function(){return window.location.href="/support"},_plans:function(){return window.location.href="/plans"},_upgrade:function(){return window.location.href="/upgrade"},_refer:function(){return window.location.href="/referrals"},_get_started:function(){return window.location.href="/gs"},_spacerace2012:function(){return window.location.href="/spacerace"},_fb_link:function(){return FacebookOAuth.do_auth(function(){GetSpace._refresh_link_bonuses();return GetSpace._completed($("fb_link"))})},_twitter_link:function(){return Twitter.do_auth(function(){GetSpace._refresh_link_bonuses();Twitter.has_authed=1;return GetSpace._completed($("twitter_link"))})},_twitter_follow:function(){if(Twitter.has_authed){return GetSpace.follow_dropbox()}else{return Twitter.do_auth(GetSpace.follow_dropbox)}},_why_like:function(){Modal.icon_show("heart_32",_("Tell us why you love Dropbox"),$("why-i-like-modal"));$("why-i-like-input").focus();return Util._track_twitter_chars_left("why-i-like-input",90)},_twitter_post:function(){if(Twitter.has_authed){return GetSpace.start_twitter_post()}else{return Twitter.do_auth(GetSpace.start_twitter_post)}},follow_dropbox:function(){if(!Twitter.has_authed){GetSpace._refresh_link_bonuses();Twitter.has_authed=1}return Twitter.follow_dropbox({showWorking:function(){return $("twitter_follow").down(".title").__date(_("Following Dropbox on Twitter..."))},onFailure:function(){return $("twitter_follow").down(".title").__date(_("Follow Dropbox on Twitter"))},onSuccess:function(){if($("twitter_link")&&$("twitter_link").visible()){GetSpace._completed($("twitter_link"))}return GetSpace._completed($("twitter_follow"))}})},submit_why:function(){GetSpace._why_msg=$F("why-i-like-input");return Forms.ajax_submit($("why-i-like-form"),false,(function(){Modal.hide();GetSpace._completed($("why_like"));if($("twitter_post")){return setTimeout((function(){return new Effect.BlindFadeDown("twitter_post")}),2500)}}),false,$("why-i-like-submit"))},start_twitter_post:function(){Modal.onHide=function(){if(!Twitter.has_authed){GetSpace._refresh_link_bonuses();Twitter.has_authed=1}if($("twitter_link")&&$("twitter_link").visible()){GetSpace._completed($("twitter_link"))}delete Modal.onHide;return Modal.hide()};return Twitter.get_user_info(function(a){Modal.icon_show("tweet_32",_("Tweet about your love of Dropbox"),$("twitter-post-modal"));$("twitter-post-header").down(".profile-pic").__date(new Element("img",{src:a.profile_image_url_https}));$("twitter-post-header").down(".name").__date(a.name);$("twitter-post-header").down(".username").__date("@"+a.screen_name);GetSpace._update_display_twitter_post();$("twitter-post-input").setValue(GetSpace._why_msg);return Util._track_twitter_chars_left("twitter-post-input",90)})},show_edit_twitter_post:function(){$("display-twitter-post").hide();$("display-twitter-post-buttons").hide();$("edit-twitter-post").show();$("edit-twitter-post-buttons").show();$("twitter-post-input").observe("keypress",function(a){if(a.keyCode===13){return GetSpace.hide_edit_twitter_post()}});return $("twitter-post-input").focus()},hide_edit_twitter_post:function(){var a;a=$F("twitter-post-input");if(!a){Notify.server_error(_("Please enter a message"));return}else{if(a.length>90){Notify.server_error(_("Your post must be 90 characters or less"));return}}GetSpace._why_msg=a;GetSpace._update_display_twitter_post();$("edit-twitter-post").hide();$("edit-twitter-post-buttons").hide();$("display-twitter-post").show();return $("display-twitter-post-buttons").show()},do_twitter_post:function(){var a;Twitter.from_getspace=1;a=_("I love Dropbox because %(why_msg)s %(referral_link)s").format({why_msg:GetSpace._why_msg,referral_link:GetSpace._twitter_url});if(a.length>140){GetSpace.show_edit_twitter_post();Notify.server_error(_("Your tweet must be 140 characters or less"));return}Twitter.custom_show_posting=function(){return Forms.add_loading($("twitter-post-submit"))};return Twitter.custom_post(a,function(){Modal.hide();return GetSpace._completed($("twitter_post"))})},_update_display_twitter_post:function(){var a;$("display-twitter-post").__date(_("I love Dropbox because %(why_msg)s ").format({why_msg:GetSpace._why_msg}));a=new Element("a",{href:GetSpace._twitter_url,target:"_blank"});a.__date(GetSpace._twitter_url);return $("display-twitter-post").__sert(a)},_completed:function(b){var a;b.addClassName("completed");b.down(".icon-col").__date(Sprite.make("web","check_36"));new Effect.Opacity(b.id,{from:0.5,to:1,duration:0.5});setTimeout((function(){return new Effect.BlindFadeUp(b.id)}),1500);a=parseInt(b.down(".space").readAttribute("data-space"),10);GetSpace._current_space+=a;$("current-space").__date(Util.formatBytes(GetSpace._current_space,2,true));$("current-space").addClassName("updated");return setTimeout((function(){return $("current-space").removeClassName("updated")}),5000)},_refresh_link_bonuses:function(){return new Ajax.DBRequest("/social_recheck")}};SecurityTab={_submit_form:function(b){var a,c;c=function(){return Notify.server_success(_("Settings changed successfully."))};a=function(){return Notify.server_error(_("There was a problem completing this request."))};return Forms.ajax_submit(b,"/account/security_email",c,a)},init:function(){var d,b,c,a,e=this;b=$("show-change-password");if(b){b.on("click",function(f){$("newpass").value="";$("oldpass").value="";PasswordChange.show_change_password_modal();return f.preventDefault()})}c=$("security-email");if(c){d=$("new_api_app_linked");a=$("newhostlinked");if(d){new Form.Element.Observer(d,0.1,function(){return e._submit_form(c)})}if(a){return new Form.Element.Observer(a,0.1,function(){return e._submit_form(c)})}}}};Recover={init:function(){var a;a=$("recover-form");return a.observe("submit",this.form_submit.bind(this))},form_submit:function(a){this.clear_error();a.preventDefault();return Forms.ajax_submit($("recover-form"),null,this.submit_response.bind(this))},submit_response:function(b){var a;a=Util.from_json(b.responseText);if(a.status==="error"){this.show_error(a.msg)}if(a.status==="ok"){this.show_hosts(a)}if(a.status==="redirect"){return window.location.href=a.url}},show_hosts:function(h){var e,c,d,a,g,b,f;Forms.add_vars($("recover-form"),{check_file:"true"});$("filename-to-create").update(h.filename);c=$("trusted-hosts");c.update();f=h.hosts;for(g=0,b=f.length;g<b;g++){e=f[g];a=new Element("li");d="lnx";if(e.platform==="mac"){d="osx"}if(e.platform==="win"){d="win"}a.__sert(Sprite.make("web",d));a.__sert(new HTML(e.display_name.escapeHTML()));c.appendChild(a)}$("login-step").hide();return $("hosts-step").show()},show_error:function(a){$("error-messages").update(a);return $("error-messages").show()},clear_error:function(){return $("error-messages").update()}};var DBGallery,DBPhoto,__slice=[].slice;DBPhoto=function(a){a.preloaded={};a.preload=function(b){if(a.preloaded[b]){return}b=b||"l";assert(b in a,"Photo doesn't have attr "+b);Util.preload_image(a[b]);return a.preloaded[b]=true};a.load_thumb=function(b){return b.src=a.thumbnail};return a};DBGallery={size:"large",index:0,playing:false,preloaded:false,thumb_width:64,thumb_margin:4,low_opacity:0.6,photos:[],set_url_hash:true,container_id:"db_gallery_master_container",add_photos:function(a){return a.each(function(b){return DBGallery.photos.push(DBPhoto(b))})},set_hash:function(){var a;a=1<=arguments.length?__slice.call(arguments,0):[];if(DBGallery.set_url_hash){return HashRouter.set_hash.apply(HashRouter,a)}},observe:function(){Event.observe((document.onresize?document:window),"resize",DBGallery.resize);Event.observe(document.body,"mousewheel",DBGallery.wheel);Event.observe(document.body,"DOMMouseScroll",DBGallery.wheel);return document.observe("keydown",DBGallery.key)},unobserve:function(){Event.stopObserving((document.onresize?document:window),"resize",DBGallery.resize);Event.stopObserving(document.body,"mousewheel",DBGallery.wheel);Event.stopObserving(document.body,"DOMMouseScroll",DBGallery.wheel);return document.stopObserving("keydown",DBGallery.key)},resize:function(){var a,c,b,d;a=$("gallery_main_cont");d=document.viewport.getDimensions();a.style.height=d.height-99+"px";c=$("gallery_main_photo");b=d.height-99-10;c.style.maxHeight=Math.max(b,300)+"px";return c.style.maxWidth=Math.max(d.width,400)+"px"},key:function(b){var a;a=BrowseKeys.getKey(b);switch(a){case 27:return DBGallery.hide();case 32:return DBGallery.playpause();case 37:case 75:return DBGallery.prev();case 39:case 74:return DBGallery.next()}},wheel:function(a){var b;if(DBGallery.block_wheel){return}DBGallery.block_wheel=1;setTimeout((function(){return DBGallery.block_wheel=0}),80);b=0;if(a.wheelDelta){b=a.wheelDelta}else{if(a.detail){b=-a.detail}}if(b>0){return DBGallery.prev()}else{return DBGallery.next()}},playpause:function(){if(DBGallery.playing){return DBGallery.pause()}else{return DBGallery.play()}},play:function(){DBGallery.playing=true;DBGallery.interval=setInterval(function(){return DBGallery.next(true)},5000);return $("gallery_slideshow").__date(Sprite.html("web","white_pause")).__sert(_("Pause slideshow"))},pause:function(){DBGallery.playing=false;clearInterval(DBGallery.interval);return $("gallery_slideshow").__date(Sprite.html("web","white_play")).__sert(_("Play slideshow"))},next:function(a){var b;b=DBGallery.index+1;if(b!==DBGallery.photos.length){return DBGallery.select_photo(b,a)}},prev:function(){var a;if(DBGallery.playing){DBGallery.pause()}a=DBGallery.index-1;if(a!==-1){return DBGallery.select_photo(a)}},select_photo:function(m,o){var e,k,g,l,a,c,b,n,q,f,p,h,d;m=parseInt(m,10);if(!Util.isNumber(m)){return}DBGallery.set_hash("gallery",""+m);if(!o&&DBGallery.playing){DBGallery.pause()}DBGallery.index=m;if(!DBGallery.visible){DBGallery.show(m)}e=$$("#gallery_thumbs_container img.selected");if(e.length){c=e[0];c.setOpacity(DBGallery.low_opacity);c.removeClassName("selected")}k=$$("#gallery_thumbs_container img")[m];assert(k,"Couldn't find img at index");k.setOpacity(1);k.addClassName("selected");DBGallery.render_mainphoto(m);DBGallery.resize();b=$("gallery_thumbs_container");l=-1*m*(DBGallery.thumb_width+DBGallery.thumb_margin)-39;if(DBGallery.slide_in){DBGallery.slide_in.cancel()}if(Math.abs(l-parseInt(b.getStyle("margin-left"),10))>1200){b.style.marginLeft=l+"px"}else{DBGallery.slide_in=new Effect.Tween(b,parseInt(b.getStyle("margin-left"),10),l,{duration:0.3},function(j){return b.style.marginLeft=j+"px"})}n=b.select("img");assert(n.length===DBGallery.photos.length,"thumbslength != photoslength");q=Math.ceil(document.viewport.getDimensions().width/DBGallery.thumb_width);q+=q%2;g=Math.max(0,m-q/2);while(g<Math.min(DBGallery.photos.length,m+q/2)){DBGallery.photos[g].load_thumb(n[g]);g+=1}h=DBGallery.photos.slice(m,m+10);d=[];for(f=0,p=h.length;f<p;f++){a=h[f];d.push(a.preload(DBGallery.size))}return d},update_container_top:function(a){a=a||$(DBGallery.container_id);if(a){return a.style.top=document.viewport.getScrollOffsets()[1]+"px"}},show:function(b){var a;assert(!DBGallery.visible,"Tried to show a gallery when it was already up");if(document.viewport.getDimensions().height>768){DBGallery.size="extralarge"}else{DBGallery.size="large"}DBGallery.visible=true;b=b||DBGallery.index;assert(DBGallery.photos.length,"No photos in the photo gallery");a=new Element("div",{id:DBGallery.container_id});DBGallery.update_container_top(a);DBGallery.update_top_interval=setInterval(function(){return DBGallery.update_container_top()},200);document.body.appendChild(a);DBGallery.observe();DBGallery.render_backdrop(a);DBGallery.render_filmstrip(a);DBGallery.render_submenu(a);return DBGallery.render_bottom_menu(b,a)},hide:function(a){if(a){Event.stop(a)}assert(DBGallery.visible,"Tried to hide a gallery when it was already hidden");DBGallery.visible=false;DBGallery.pause();DBGallery.unobserve();DBGallery.hide_backdrop();DBGallery.hide_filmstrip();DBGallery.hide_bottom_menu();DBGallery.hide_mainphoto();$(DBGallery.container_id).remove();DBGallery.set_hash();return clearInterval(DBGallery.update_top_interval)},render_backdrop:function(a){var b,c;c="body";if(Prototype.Browser.IE){c="html, body"}$$(c).invoke("addClassName","full_no_overflow");b=new Element("div",{id:"gallery_backdrop"});b.setOpacity(0.8);return a.__sert(b)},hide_backdrop:function(){$$(".full_no_overflow").invoke("removeClassName","full_no_overflow");return $("gallery_backdrop").remove()},render_filmstrip:function(a){var j,d,h,g,f,e,c,b;d=new Element("div",{id:"gallery_filmstrip"});g=document.createDocumentFragment();g.appendChild(d);h=new Element("div",{id:"gallery_filmstrip_backdrop"});h.setOpacity(0.5);g.appendChild(h);b=new Element("div",{id:"gallery_thumbs_container"});e=0;DBGallery.photos.each(function(l){var k;k=new Element("img",{title:l.filename,src:"/static/images/icons/icon_spacer.gif"});k.setOpacity(DBGallery.low_opacity);k.observe("mouseover",function(m){return new Effect.Opacity(k,{to:1,duration:0.1})});k.observe("mouseout",function(m){if(!k.hasClassName("selected")){return new Effect.Opacity(k,{to:DBGallery.low_opacity,duration:0.1})}});k.observe("click",(function(m){return function(){return DBGallery.select_photo(m)}})(e));b.appendChild(k);return e+=1});c=new Element("div",{id:"gallery_selected_frame"});f=new Element("a",{id:"gallery_close",href:"#",style:"top: 120px; right: 10px;"});j=new Element("img",{src:"/static/images/photos_x.png"});f.__sert(j);f.observe("click",DBGallery.hide);g.appendChild(f);g.appendChild(c);g.appendChild(b);return a.appendChild(g)},render_submenu:function(a){var d,c,e,b;c=new Element("div",{id:"gallery_sub_menu"});e=new Element("div",{id:"gallery_index_text"});d=new Element("div",{id:"gallery_filename_text"});b=new Element("a",{id:"gallery_slideshow"});b.observe("click",DBGallery.playpause);c.__sert(b);c.__sert(e);c.__sert(d);a.appendChild(c);return DBGallery.pause()},render_bottom_menu:function(d,b){var c,a,e;c=new Element("div",{id:"gallery_bottom_menu"});a=new Element("a",{id:"gallery_full_size"});a.__date(Sprite.html("web","arrow_out_black")).__sert(_("Full size"));e=new Element("a",{id:"gallery_save"});e.__date(Sprite.html("web","picture_save")).__sert(_("Save"));c.__sert(a);c.__sert(e);return b.appendChild(c)},update_bottom_menu:function(b){var a;a=DBGallery.photos[b];$("gallery_full_size").href=a.original;return $("gallery_save").href=a.original+"?dl_name="+Util.urlquote(a.filename)},hide_bottom_menu:function(){return $("gallery_bottom_menu").remove()},hide_filmstrip:function(){$("gallery_filmstrip").remove();$("gallery_filmstrip_backdrop").remove();$("gallery_thumbs_container").remove();$("gallery_selected_frame").remove();$("gallery_close").remove();return $("gallery_sub_menu").remove()},render_mainphoto:function(f,b){var a,c,e,d,h,g;b=b||$(DBGallery.container_id);e=DBGallery.photos[f];c=Util.get_preloaded_image(e[DBGallery.size]);c.id="gallery_main_photo";c.title=e.filename;c.stopObserving("click");c.observe("click",function(k){var j;Event.stop(k);if(e.video_url){DBGallery.pause();$("gallery_main_photo_td").__date();j=(DBGallery.size==="extralarge"?1024:640);return Util.embed_flash_video(e.video_url,"gallery_main_photo_td",j,1)}else{return DBGallery.next()}});if(!$("gallery_main_cont")){a=new Element("table",{id:"gallery_main_cont"});a.observe("click",DBGallery.hide);d=new Element("tbody");a.__sert(d);g=new Element("tr");d.__sert(g);h=new Element("td");h.id="gallery_main_photo_td";g.__sert(h);h.__sert(c);b.appendChild(a)}else{$("gallery_main_cont").down("td").__date(c)}DBGallery.update_sub_menu(f);return DBGallery.update_bottom_menu(f)},update_sub_menu:function(a){$("gallery_index_text").__date(a+1+" of "+DBGallery.photos.length);return $("gallery_filename_text").__date(DBGallery.photos[a].filename)},hide_mainphoto:function(){return $("gallery_main_cont").remove()}};var BrowseUtil,UpdateEvents;UpdateEvents={ADD:"db:add_file_objects",REMOVE:"db:remove_file_objects",MOVE:"db:move_file_objects"};BrowseUtil={make_browsefile:function(b){var a;a=this.unpack_file_info(b);if(a.is_dir){if(!Browse.compost){a.ago="";a.ts=0}}else{a.target_ns=false}return new BrowseFile(a)},unpack_file_info:function(a){return{is_dir:a[0],type:a[1],ns_id:a[2],ns_path:a[3],fq_path:a[4],target_ns:a[5],icon:a[6],thumbnail_url_tmpl:a[7],href:a[8],bytes:a[9],size:a[10],ts:a[11],ago:a[12],hash:a[13],tkey:a[14],sort_rank:a[15],sort_key:Util.decode_sort_key(a[16]),sjid:a[17],last_modified_fname:a[18],preview_type:a[19],real_path:a[20],real_path_exists:a[21],owned:a[22],code_class:a[23],htmlified_link:a[24]}},filepreview_from_selected:function(b){var c,k,l,m,n,h,g,f,e,o,a,j,d;if(!b){h=BrowseSelection.get_selected_files();b=h&&h.first()}n=this.browsefile_to_filepreview(Browse.files);if(n.length){g=0;if(b){for(k=f=0,o=n.length;f<o;k=++f){c=n[k];if(c.fq_path===b.fq_path){g=k;break}}}if((j=n!=null?(d=n[g])!=null?d.preview_type:void 0:void 0)==="text"||j==="doc"){FilePreviewModal.init(n,{start_index:g,no_actions:true,allow_text_selection:true})}else{l=n.length;n=(function(){var r,q,s,p;p=[];for(r=0,q=n.length;r<q;r++){m=n[r];if((s=m!=null?m.preview_type:void 0)!=="text"&&s!=="doc"){p.push(m)}}return p})();if(n.length!==l&&b){g=0;for(k=e=0,a=n.length;e<a;k=++e){c=n[k];if(c.fq_path===b.fq_path){g=k;break}}}FilePreviewModal.init(n,{start_index:g,include_delete:true,keep_url:false})}}if(Tutorial.should_handle_event(Tutorial.events.browse_show_lightbox)){return Tutorial.handle_event(Tutorial.events.browse_show_lightbox,{init_file:b})}},browsefile_to_filepreview:function(a){var d,h,c,j,b,e,k,g;j=[];for(e=0,k=a.length;e<k;e++){h=a[e];if(h.bytes<0||h.dir){continue}if(h.preview_type==="photo"&&h.thumbnail_url_tmpl){c=new PhotoPreview(h.filename,h.fq_path,h.thumbnail_url_tmpl,h.href+"&dl=1",h.href);j.push(c)}else{if(h.preview_type==="video"&&h.thumbnail_url_tmpl&&!Constants.DISABLE_VIDEOS_IN_LIGHTBOX){b=new VideoPreview(h.filename,h.fq_path,h.thumbnail_url_tmpl,h.video_transcode_url(),h.href+"&dl=1");j.push(b)}else{if((g=h.preview_type)==="text"||g==="doc"){d=new DocPreview(h.filename,h.fq_path,h.href+"&dl=1",h.href,h.preview_type,h.code_class,h.htmlified_link);j.push(d)}}}}return j},profile_files:function(b){var c,d,e,a;d={files:0,folders:0,shared_folders:0,deleted:0,public_folder:0,photos_folder:0,rejoinables:0,sandboxes:0,target_namespaces:0,owned:0};for(e=0,a=b.length;e<a;e++){c=b[e];if(c.dir){d.folders+=1}else{d.files+=1}if(c.is_sandbox()){d.sandboxes+=1}if(c.is_share()){d.shared_folders+=1}if(c.bytes===-1){d.deleted+=1}if(c.target_ns){d.target_namespaces+=1}if(c.fq_path.toLowerCase()==="/public"&&Browse.public_folder_enabled){d.public_folder=1}if(c.fq_path.toLowerCase()==="/photos"){d.photos_folder=1}if(c.owned){d.owned+=1}}return d},profile_summary:function(b){var c,a;c=ungettext("%d file","%d files",b.files).format(b.files);a=ungettext("%d folder","%d folders",b.folders).format(b.folders);if(b.files&&b.folders){return _("%(x_files)s and %(y_folders)s").format({x_files:c,y_folders:a})}else{if(b.files){return c}else{if(b.folders){return a}else{return""}}}},BROWSE_MODE:"browse",SEARCH_MODE:"search",SPECIAL_MODES:["search"],set_browse_mode:function(){var d,c,a,b;b=this.SPECIAL_MODES;for(c=0,a=b.length;c<a;c++){d=b[c];$("browse").removeClassName(d);$("browse-root-actions").removeClassName(d);$("browse-sort").removeClassName(d)}$("browse-sort").removeClassName("cathywu");return $("browse-root-actions").removeClassName("cathywu")},set_special_mode:function(b){var e,d,a,c;assert(this.SPECIAL_MODES.indexOf(b)!==-1,"unknown mode");if($("browse").hasClassName(b)){assert($("browse-root-actions").hasClassName(b),"inconsistent modes");assert($("browse-sort").hasClassName(b),"inconsistent modes");return}c=this.SPECIAL_MODES;for(d=0,a=c.length;d<a;d++){e=c[d];if(e!==b){$("browse").removeClassName(e);$("browse-root-actions").removeClassName(e);$("browse-sort").removeClassName(e)}}$("browse").addClassName(b);$("browse-root-actions").addClassName(b);$("browse-sort").addClassName(b);if(b===this.SEARCH_MODE){$("browse-sort").addClassName("cathywu");return $("browse-root-actions").addClassName("cathywu")}},get_mode:function(){var e,a,d,b,c;a=this.BROWSE_MODE;c=this.SPECIAL_MODES;for(d=0,b=c.length;d<b;d++){e=c[d];if($("browse").hasClassName(e)){a=e}}return a},load_visible_thumbs:function(){var m,b,g,o,p,k,a,h,e,n,d,l,f,c;a=this.get_files_in_view();m=a[1]-a[0];k=[Math.max(a[0]-m,0),a[0]];p=[Math.min(a[1],Browse.files.length),Math.min(a[1]+m,Browse.files.length)];n=Util.calc_thumb_prep_size();f=[a,p,k];c=[];for(d=0,l=f.length;d<l;d++){o=f[d];g=o[0],e=o[1];c.push((function(){var s,q,j,r;j=Browse.files.slice(g,e+1||9000000000);r=[];for(s=0,q=j.length;s<q;s++){b=j[s];h=b.get_div().down("img");r.push(Util.thumb_load(h,n))}return r})())}return c},get_files_in_view:function(){var c,d,b,a,f,e;f=Util.viewport_dimensions().height;e=Util.scroll_offsets().top;c=this._get_top_file_y_offset();d=this._get_elm_height();if(!c||!d){return[0,Browse.files.length]}b=Math.floor((e-c)/d);b=Math.max(b,0);a=b+Math.ceil(f/d);a=Math.min(a,Browse.files.length);return[b,a]},_get_top_file_y_offset:function(){if(Browse.files.length===0){return null}return Browse.files[0].get_div().cumulativeOffset().top},_get_elm_height:function(){var a;if(Browse.files.length<3){return null}a=Browse.files[1].get_div();return a.getLayout().get("margin-box-height")}};var FlexColumn,Sort;Sort=(function(){var g,a,d,f,e,c,b;d=function(j){var h;h=j?1:-1;return function(k,l){return h*Util.sort_by_rank_or_key(k,l)}};f=function(j){var h;h=j?1:-1;return function(k,l){if(k.bytes>l.bytes){return h}else{if(k.bytes<l.bytes){return -h}else{return h*Sort.FILES_BY_NAME(k,l)}}}};g=function(j){var h;h=j?1:-1;return function(k,l){return h*(k.real_path.toLowerCase()>l.real_path.toLowerCase()?1:-1)}};a=function(j){var h;h=j?1:-1;return function(l,m){var k;k=l.ts===m.ts?0:l.ts>m.ts?1:-1;return h*k}};c=function(h){return function(l){var k,j;j=h(l);k=d(true);return function(m,n){if(m.dir^n.dir){return(m.dir?1:0)-(n.dir?1:0)}else{return j(m,n)||k(m,n)}}}};e=function(h){return function(l){var j,k;if(!Sort.FOLDERS_FIRST){return h(l)}k=h(l);j=l?1:-1;return function(n,o){var m;if(n.dir^o.dir){m=(n.dir?0:1)-(o.dir?0:1);return j*m}else{return k(n,o)}}}};b=function(h){return function(l){var j,k;k=Sort.FILES_BY_NAME(l);j=l?1:-1;return function(n,o){var m;if(n.is_deleted^o.is_deleted){return(n.is_deleted?1:0)-(o.is_deleted?1:0)}m=0;if(h){if(n.get_category()!==o.get_category()){m=n.get_category()<o.get_category()?-1:1}else{if(n.get_extension()!==o.get_extension()){m=n.get_extension()<o.get_extension()?-1:1}}}else{if(n.get_extension()!==o.get_extension()){m=n.get_extension()<o.get_extension()?-1:1}else{if(n.get_category()!==o.get_category()){m=n.get_category()<o.get_category()?-1:1}}}return(j*m)||k(n,o)}}};return{FILES_BY_NAME:e(d),FILES_BY_SIZE:c(f),FILES_BY_LOCATION:c(g),FILES_BY_KIND:c(b(true)),FILES_BY_EXTENSION:c(b(false)),FILES_BY_MODIFIED:c(a),FOLDERS_FIRST:!Util.is_mac(),ALL_BY_MODIFIED:a}})();FlexColumn=(function(){var j,c,m,g,d,h,b,a,l,e,k,f;j=[["FILES_BY_KIND",Sort.FILES_BY_KIND,_("Kind"),true],["FILES_BY_EXTENSION",Sort.FILES_BY_EXTENSION,_("Extension"),true],["FILES_BY_SIZE",Sort.FILES_BY_SIZE,_("Size"),false]];c={};m={};d=[];g=[];for(e=0,k=j.length;e<k;e++){f=j[e],l=f[0],b=f[1],h=f[2],a=f[3];d.push(b);c[l]=h;m[l]=a;g.push(l)}return{SORT_FUNCTIONS:d,DISPLAY:c,IS_ASC:m,LABELS:g}})();var FileSearch;FileSearch={MAX_RESULTS:100,SHORT_PREFIX_LEN:2,SHORT_PREFIX_DELAY_TIME:250,_cache:{},_cache_ts:{},CACHE_TIME:60000,last_state:false,last_fq_path:null,init:function(){var a,l,j,c,g,f,m,b,h,e,d,k=this;j=$("browse-search");l=$("browse-search-input");this.warmup();SickInput.add_interval_handler(j,this.search_with_delay.bind(this));$("advanced-search-box").observe("submit",function(n){k.search();return Event.stop(n)});$("exit-search-xclose").observe("click",function(){return k.exit_search()});key("/",Browse.KEY_SCOPE,function(){if(BrowseJump.is_active()){return}if(!j.hasClassName("focused")){l.focus();return false}});key("escape",Browse.KEY_SCOPE,function(){if(Browse.in_search_mode()){k.exit_search();return false}if(l.getValue().strip()===""){l.blur();return false}});key("tab",Browse.KEY_SCOPE,function(n){if(document.activeElement===l){n.preventDefault();l.blur();if(Browse.files.length){BrowseSelection.set_selected_files(Browse.files[0])}else{if(Browse.in_search_mode()){k.toggle_advanced()}}return false}});c="#advanced-search-link, #advanced-search-exit, #advanced-search-cancel";$(document.body).on("click",c,this.toggle_advanced.bind(this));document.observe(FileEvents.RENAME,function(){return k.clear_cache()});h=[FileEvents.DELETE,FileEvents.COPY,FileEvents.MOVE,FileEvents.PURGE,FileEvents.RESTORE,FileEvents.UPLOAD,FileEvents.SF_NEW,FileEvents.SF_LEAVE,FileEvents.SF_UNSHARE,FileEvents.SF_REJOIN,FileEvents.SF_IGNORE,FileEvents.LINKS_REMOVE];for(g=0,m=h.length;g<m;g++){a=h[g];document.observe(a,function(n){if(!Browse.inside_dir){return k.force_reload()}})}e=[UpdateEvents.ADD,UpdateEvents.MOVE,UpdateEvents.REMOVE];d=[];for(f=0,b=e.length;f<b;f++){a=e[f];d.push(document.observe(a,function(n){return k._update_number_results(Browse.files.length)}))}return d},get_state:function(){var c,f,b,e,a,d;f={is_advanced:!$("browse-search").visible()};if(f.is_advanced){d=["all_terms","any_terms","excluded_terms","exact"];for(e=0,a=d.length;e<a;e++){c=d[e];b=$(c).getValue();if(b){f[c]=b}}f.include_files=$("include_files").checked;f.include_folders=$("include_folders").checked;f.include_deleted=!Constants.can_see_trash&&$("include_deleted").checked}else{f.query_unnormalized=this.get_basic_query();f.query=f.query_unnormalized.toLowerCase().strip().split(RegExp(" +")).join(" ")}return f},set_state:function(e){var b,d,a,c;if(e.is_advanced){c=["all_terms","any_terms","excluded_terms","exact"];for(d=0,a=c.length;d<a;d++){b=c[d];if(e[b]){$(b).setValue(e[b])}}$("include_files").checked=e.include_files;$("include_folders").checked=e.include_folders;if(!Constants.can_see_trash){$("include_deleted").checked=e.include_deleted}this.show_advanced();return this.search()}else{this.set_basic_query(e.query_unnormalized);this.show_basic();return this.search()}},state_changed:function(){var b,a;b=this.get_state();a=this.last_state;if(a===false){return !!b.query}return(b.is_advanced!==a.is_advanced)||(b.query!==a.query)},get_basic_query:function(){var a;a=$("browse-search-input");return a.getValue()},set_basic_query:function(a){if(a===this.get_basic_query()){return}$("browse-search-input").setValue(a);$("browse-search").show();return $("advanced-search-link").__date(_("Advanced search"))},set_title:function(){var a,b;a=this.get_state();b=_("Search - Dropbox");if(a.query_unnormalized){b=""+a.query_unnormalized+" - "+b}return document.title=b},_pending_search_q:"",search_with_delay:function(){var b,a;a=this.get_state();if(a.is_advanced){return}b=a.query;if(b.length===0&&Browse.in_search_mode()){this.search();return}if(b.length<=this.SHORT_PREFIX_LEN){if(b!==this._pending_search_q){this._pending_search_q=b;clearTimeout(this._pending_search_timer);return this._pending_search_timer=setTimeout(this.search.bind(this),this.SHORT_PREFIX_DELAY_TIME)}}else{this._pending_search_q="";if(this.state_changed()){return this.search()}}},search:function(){var b,a;a=this.get_state();b=""===this.get_basic_query();if(!a.is_advanced&&b){if(Browse.in_search_mode()){this._clear_on_reload=false;this.exit_search()}return}this.last_state=a;this._clear_on_reload=true;if(!Browse.in_search_mode()){BrowseSelection.deselect_all();Browse.clear();BrowseUtil.set_special_mode("search")}if(this.last_fq_path==null){if(Browse.inside_dir){this.last_fq_path=Browse.containing_fq_path()}else{this.last_fq_path=""}DBHistory.push_state("/search")}this._prune_cache();this.set_title();if(a.is_advanced){this.ask_server_advanced()}else{if(a.query in this._cache){this.update_results()}else{if(!this.attempt_cache_filter()){this.ask_server()}}}return T("search")},_prune_cache:function(){var c,d,f,e,b,a;c=new Date();d=[];for(f in this._cache_ts){if(c-this._cache_ts[f]>this.CACHE_TIME){d.push(f)}}a=[];for(e=0,b=d.length;e<b;e++){f=d[e];delete this._cache[f];a.push(delete this._cache_ts[f])}return a},show_empty:function(){$("search-empty").show();return $(document.documentElement).removeClassName("earthrise")},hide_empty:function(){$("search-empty").hide();return $(document.documentElement).addClassName("earthrise")},exit_search:function(){var b,c,e,a,d;d=$$("#advanced-search-box .sick-input input");for(e=0,a=d.length;e<a;e++){b=d[e];b.setValue("");b.blur()}$("advanced-search-box").hide();$("browse").removeClassName("pending-search");this.hide_empty();c=$("browse-search");c.show();Browse.first_load=true;return Browse.reload_fqpath(this.last_fq_path,true)},clear_cache:function(){this._cache={};return this._cache_ts={}},force_reload:function(){this.clear_cache();return this.search()},ask_server:function(){var b,a,c=this;b=this.get_state();assert(!b.is_advanced,"expected to be in basic search mode");$("web-search-results").__date(_("Searching..."));$("browse").addClassName("pending-search");a=Browse.compost?"/ajax_compost_search":"/ajax_search";return new Ajax.DBRequest(a,{no_watch:true,evalJSON:false,parameters:{query:b.query},log_timing:true,onSuccess:function(d){var e;if(!Browse.in_search_mode()){return}e=Util.from_json(d.responseText);c._cache[b.query]=e;c._cache_ts[b.query]=new Date();if(!c.last_state.is_advanced&&(c.last_state.query===b.query)){return c.update_results()}},cleanUp:function(){return $("browse").removeClassName("pending-search")}})},ask_server_advanced:function(){var a,b=this;a=this.get_state();assert(a.is_advanced,"expected to be in advanced search mode");assert(!a.query,"expected advanced search params only");delete a.is_advanced;$("web-search-results").__date(_("Searching..."));$("browse").addClassName("pending-search");return new Ajax.DBRequest("/ajax_advanced_search",{no_watch:true,evalJSON:false,parameters:a,log_timing:true,onSuccess:function(c){if(!Browse.in_search_mode()){return}b.advanced_results=Util.from_json(c.responseText);return b.update_results()},cleanUp:function(c){return $("browse").removeClassName("pending-search")}})},attempt_cache_filter:function(){var a,d,b,h,c,g,f,e;g=this.get_state().query;h=this._query_to_regex(g);b=function(j){return h.match(FileOps.filename(j[3]).toLowerCase())};if(g.length<=1){return false}for(c=f=e=g.length-1;e<=1?f<=1:f>=1;c=e<=1?++f:--f){d=g.substr(0,c).strip();if(d in this._cache){if(this._cache[d].file_info.length<this.MAX_RESULTS){a=Object.clone(this._cache[d]);a.file_info=a.file_info.findAll(b);this.update_results(a);return true}else{return false}}}return false},_query_to_regex:function(a){return new RegExp(RegExp.escape(a).split(new RegExp(" +")).join(".*"))},update_results:function(a){var d,c,b;Browse.reset_state();Browse.reset_sort();b=this.get_state();if(!a&&b.is_advanced){a=this.advanced_results}if(!a){c="the only way to get to advanced is through basic -- expected last_state to exist and not be advanced!";assert(this.last_state&&!this.last_state.is_advanced,c);assert(this.last_state.query in this._cache,("update() called w/o a cache entry: q="+this.last_state.query)+(a=this._cache[this.last_state.query]))}Browse.update(a);Browse.set_selection_from_fq_paths_or_index(FileSearch);this._update_number_results(a.file_info.length);d=b.is_advanced?_("Basic search"):_("Advanced search");$("advanced-search-link").__date(d);if(Browse.files.length){return this.hide_empty()}else{return this.show_empty()}},_update_number_results:function(b){var d,a,c;c=b===0?_("No results"):(d=ungettext("Search - %s result","Search - %s results",b),a=b+(b>=this.MAX_RESULTS?"+":""),d=d.format(a));return $("web-search-results").__date(c)},show_advanced:function(){$("browse").addClassName("advanced-search");$("browse-search").hide();$("advanced-search-link").__date(_("Basic search"));$("advanced-search-box").show();return $("all_terms").focus()},show_basic:function(a){$("browse").removeClassName("advanced-search");$("advanced-search-box").hide();$("advanced-search-link").__date(_("Advanced search"));$("browse-search").show();if(!a){return $("browse-search-input").focus()}},toggle_advanced:function(){var a,b;b=$("advanced-search-link");b.toggleClassName("selected");if(b.hasClassName("selected")){$("all_terms").setValue(this.get_basic_query());return this.show_advanced()}else{a=$("all_terms").getValue();if(a){this.set_basic_query(a);return this.show_basic()}else{console.log("advanced exit");return this.exit_search()}}},history_change_handler:function(){var a;if(!this.last_state){BrowseURL.set_path_url(Constants.root_ns,"");return}if(this.state_changed()){this.set_state(this.last_state)}key.setScope(Browse.KEY_SCOPE);if(BrowseSelection.get_selected_files().length){a=BrowseSelection.get_selected_files()[0].get_div();return Browse.scrollToWithPadding(a,a.getHeight()*2)}},clear_searchbox:function(){return $("browse-search-input").setValue("")},warmup:function(){if(!this.warm){this.warm=true;return new Ajax.DBRequest("/search/warmup",{noAutonotify:true,no_watch:true})}}};var BrowseKeys;BrowseKeys={_handlers:{},init:function(){},init_advanced:function(){var c,a,b,d=this;b=this.advanced_dict;for(a in b){c=b[a];key(c.key,Browse.KEY_SCOPE,c.onPress)}this.customize_chart();if(Util.is_mac()&&Prototype.Browser.Gecko){return document.observe("keypress",function(f){if(f.charCode===63&&!Util.focus_in_input()){return d.advanced_dict.help.onPress()}})}},getKey:function(a){return a.keyCode||a.which||a.charCode},customize_chart:function(){var d,b,c,a;d=(Util.is_mac()?".key-windows":".key-macos");c=0;b=void 0;a=[];while(true){b=$("keys-chart").down(d,c++);if(!b){break}a.push(b.hide())}return a},toggle_chart:function(){if($("keys-chart").style.display==="none"){return this.show_chart()}else{return this.hide_chart()}},show_chart:function(){var a,b;a=$("keys-chart");a.style.position="fixed";b=$("browse-sort");if(b.getStyle("display")==="none"){b=$("browse-root-actions")}a.clonePosition(b,{setHeight:false});a.style.top=b.cumulativeOffset()[1]+b.getHeight()+"px";a.setOpacity(0.85);return a.show()},hide_chart:function(){return $("keys-chart").hide()},advanced_dict:{rename:{title:_("Rename selected files"),key:"f2",onPress:function(b,c){var a;a=BrowseSelection.get_selected_files();if(a.length){return a.first().edit()}}},"delete":{title:_("Delete selected files"),key:"delete, command+backspace, backspace",onPress:function(d,f){var a,c,b;Event.stop(d);b=BrowseSelection.get_selected_files();if(b.length===1){a=b.first();if(a.is_deleted){return FileOps.show_purge(a.fq_path,a.dir)}else{return FileOps.show_delete(a.fq_path,a.dir)}}else{if(b.length>1){c=BrowseUtil.profile_files(b);if(c.deleted===b.length){return FileOps.show_bulk_purge(b)}else{if(c.deleted===0){return FileOps.show_bulk_delete(b)}}}}}},help:{title:_("Show/hide keyboard shorcuts"),key:"shift+/, "+(key.main_modifier())+"+/",onPress:function(){return BrowseKeys.toggle_chart()}},close_help:{title:_("Hide keyboard shorcuts"),key:"escape",onPress:function(){return BrowseKeys.hide_chart()}},up_dir:{title:_("Up a folder"),key:"left",onPress:function(){var a,b;Browse.keyboard_nav=true;if(!Browse.reloading){if(Browse.inside_dir){if(!Browse.containing_ns_path()&&Browse.containing_ns_id()!==Constants.root_ns){b=Constants.root_ns;a=Util.normalize(Util.parentDir(Browse.containing_fq_path()))}else{b=Browse.containing_ns_id();a=Util.normalize(Util.parentDir(Browse.containing_ns_path()))}if(Browse.containing_ns_path()!==a||Browse.containing_ns_id()!==b){Browse.select_fq_paths=[Browse.containing_fq_path()];return BrowseURL.set_path_url(b,a)}else{return BrowseSelection.flicker_selected()}}else{return BrowseSelection.flicker_selected()}}}},open_file:{title:_("Open highlighted file"),key:"enter",onPress:function(){var a,b;b=BrowseSelection.get_selected_files();if(b.length===1){a=b[0];Browse.open_file(a,false)}return false}},open_dir:{title:_("Open highlighted folder"),key:"right",onPress:function(){var a,b;Browse.keyboard_nav=true;b=BrowseSelection.get_selected_files();if(b.length===1){a=b[0];if(a.dir){Browse.select_index=0;Browse.open_folder(a)}else{BrowseSelection.flicker_selected()}}return false}},undo:{title:_("Undo recent move/copy/rename/delete"),key:""+(key.main_modifier())+"+z",onPress:function(){if(Constants.can_undo&&$("undo-link")){UndoAction.perform_undo()}return false}}}};var BrowseURL;BrowseURL={_DEFAULTS:{d:false,select:false},_get_helper:function(a){var b;b=DBHistory.deconstruct_url().qargs;if(a in b){return !!b[a]}else{assert(a in this._DEFAULTS,"bad query param in BrowseURL");return this._DEFAULTS[a]}},get_del:function(){return this._get_helper("d")},ns_to_fq_path:function(a,c){var b;if(a!==Constants.root_ns&&(!(a in Browse.ns_id_to_mount_point))){a=Constants.root_ns}if(Browse.compost){if(c){return"/"+a+c}else{return""}}else{if(a===Constants.root_ns){return c}else{b=Browse.ns_id_to_mount_point[a];return b+c}}},_make_url:function(a,h,g){var f,e,b,d,c;if(g==null){g={}}if(!a){a=Constants.root_ns}assert(typeof a==="number","expected ns_id as a number");assert(typeof h==="string","expected explicit ns_path string");f=this.ns_to_fq_path(a,h);if(Browse.compost){d="/compost"+Util.urlquote(f)}else{d="/home"+Util.urlquote(f)}b=DBHistory.deconstruct_url().qargs;for(e in g){c=g[e];if(e in this._DEFAULTS&&!!c!==this._DEFAULTS[e]){b[e]=c}}for(e in b){if(!(e in this._DEFAULTS)){delete b[e]}}return DBHistory.construct_url(d,b)},set_path_url:function(a,f,d){var e,c,b;if(!a){a=Constants.root_ns}else{c=parseInt(a,10);a=!isNaN(c)?c:Constants.root_ns}f=Util.normalize(f);b=d!=null?this._make_url(a,f,{d:d?1:0}):this._make_url(a,f);e=DBHistory.deconstruct_url(b);return DBHistory.push_state(e.path,e.qargs)},set_del_url:function(a){var c,d,b;b=DBHistory.deconstruct_url();c=b.path;d=b.qargs;if(a){d.d="1"}else{delete d.d}return DBHistory.push_state(c,d)},_first_load:true,_last_path:null,_last_qargs:null,history_change_handler:function(h,g){var f,a,b,j,d,c,e;key.setScope(Browse.KEY_SCOPE);h=Util.normalize(h);d=g.ns;j=this._last_path;b=(e=this._last_qargs)!=null?e.ns:void 0;c=false;if(!this._first_load){c=(!Browse.inside_dir)||(h!==j)||(d!==b)}f=false;if((g.d==="1")!==(Browse.deleted_shown===true)){f=true;Browse.deleted_shown=g.d==="1"}if(this._first_load||c||f){Browse.reload(d,h,true)}FileSearch.show_basic(true);this._first_load=false;this._last_path=h;this._last_qargs=g;if(BrowseSelection.get_selected_files().length){a=BrowseSelection.get_selected_files()[0].get_div();if(a){return Browse.scrollToWithPadding(a,a.getHeight()*2)}}},parse_b2_hash:function(e){var c,b,d,a,f;a=e.split(":");if(a.length!==4){return false}d=a[0];c=a[2]==="1";b=a[3];f=!b||Util.isNumber(b);if(!f){return false}b=parseInt(b,10)||Constants.root_ns;return{ns_id:b,ns_path:d,deleted:c}}};var BrowseFile,FileTypes;FileTypes={FILE:1,FOLDER:2,PACKAGE:3,SHARED_FOLDER:4,SANDBOX:5};BrowseFile=Class.create({initialize:function(b){var c,a;c=Browse.inside_dir?BROWSE_SNIPPET_LEN:SEARCH_SNIPPET_LEN;a=FileOps.filename(b.fq_path);this.icon=b.icon;this.filename=a;this.caption=a.em_snippet(c);this.ns_id=b.ns_id;this.ns_path=b.ns_path;this.fq_path=b.fq_path;this.hash=b.hash;this.href=b.href;this.size=b.size!=="None"?b.size:"";this.bytes=b.bytes;this.is_deleted=this.bytes===-1;this.ago=b.ago;this.ts=b.ts;this.dir=b.is_dir?1:0;this.tkey=b.tkey;this.target_ns=b.target_ns;this.sort_rank=Browse.compost?void 0:b.sort_rank||0;this.sort_key=b.sort_key||[""];this.sjid=b.sjid;this.thumbnail_url_tmpl=b.thumbnail_url_tmpl;this.thumbnail=b.thumbnail_url_tmpl?b.thumbnail_url_tmpl+"?size=32bf":null;this.type=b.type;this.preview_type=b.preview_type;if(b.last_modified_fname){this.last_modified_fname=b.last_modified_fname.em_snippet(LAST_MODIFIED_FNAME_SNIPPET)}this.real_path=b.real_path||b.fq_path;this.real_path_exists=b.real_path_exists!=null?b.real_path_exists:true;this.owned=b.owned!=null?b.owned:true;this.code_class=b.code_class;this.htmlified_link=b.htmlified_link;if(!(this.to_key() in BrowseFile._file_index)){Browse.add_file(this);return BrowseFile._file_index[this.to_key()]=this}},is_share:function(){return this.type===FileTypes.SHARED_FOLDER},is_sandbox:function(){return this.type===FileTypes.SANDBOX},video_transcode_url:function(){assert(this.fq_path,"video_transcode_url: expected a non-root fq_path");return"https://"+Constants.LIVE_TRANSCODE_SERVER+"/transcode_video/w/"+(this.hash+Util.urlquote(this.fq_path))},get_div:function(){return $("f_"+(this.to_key()))},rename:function(e,d,h,a,b){var c,g,f;c=Browse.inside_dir?BROWSE_SNIPPET_LEN:SEARCH_SNIPPET_LEN;g=this.fq_path;Browse.pre_action_selection=[g];this.filename=FileOps.filename(e);this.caption=this.filename.em_snippet(c);this.fq_path=e;this.ns_path=d;this.hash=h;this.sort_key=a;this.sort_rank=null;this.last_modified_fname=null;if(!this.dir){f=this.href.split("/");f[f.length-1]=Util.urlquote(this.filename)+("?w="+h);this.href=f.join("/");this.icon=b}else{this.href="/home"+Util.urlquote(e);if(this.target_ns){Browse.ns_id_to_mount_point[this.target_ns]=e}}Browse.update_file_pos(this);return document.fire(FileEvents.RENAME,{old_fq_path:g,file:this})},edit:function(){var b,a,c,d=this;this.editing=true;Browse.selectable();c=function(l){var f,e,h,n,k,o,m,j,g;g=l.responseText.evalJSON(true);assert(g.new_browse_files.length===1,"No new file data returned.");h=g.new_browse_files.first();n=h.fq_path;k=h.hash;j=Util.decode_sort_key(h.sort_key);o=h.icon;m=h.ns_path;f=g.changesets;e=_("Rename complete.");Notify.server_success(e,null,null,f);d.rename(n,m,k,j,o);BrowseSelection.set_selected_files([d]);d.get_div().smoothScrollIntoView();BrowseUtil.load_visible_thumbs();return Subscriber.set_ns_map(g.ns_map)};a="/cmd/rename"+(Util.urlquote(this.fq_path))+"?long_running}";b=new Ajax.InPlaceEditor(this.get_div().down(".filename-col a"),a,{htmlResponse:false,okControl:false,cancelControl:false,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:25,ajaxClass:Ajax.DBRequest,submitOnBlur:true,initialText:this.filename,cancelIfSame:true,clickToEdit:false,onComplete:function(){return d.editing=false},onFailure:function(){},savingText:_("Saving..."),ajaxOptions:{method:"POST",onCreate:Notify.clear_all,onSuccess:c,onUninitialized:Browse.unselectable},callback:function(e,f){return{to_path:f||"",folder:(d.dir?"yes":"")}}});return b.enterEditMode()},to_key:function(){return""+this.ns_id+"_"+this.sjid},get_category:function(){var b,a;if(this.dir){if(Browse.inside_dir&&Browse.containing_fq_path()===""){if(this.filename.toLowerCase()==="public"&&Browse.public_folder_enabled){b="PUBLIC_FOLDER"}if(this.filename.toLowerCase()==="photos"){b="PHOTOS_FOLDER"}}if(b==null){if(this.type===FileTypes.FOLDER){b="FOLDER"}else{if(this.type===FileTypes.PACKAGE){b="FOLDER"}else{if(this.type===FileTypes.SHARED_FOLDER){b="SHARED_FOLDER"}else{if(this.type===FileTypes.SANDBOX){b="SANDBOX"}else{if(this.target_ns){b="SHARED_FOLDER"}else{b="FOLDER"}}}}}}}if(b==null){b=BrowseFile.EXTENSION_TO_CATEGORY[this.get_extension()]||"FILE"}a=this.is_deleted?BrowseFile.CATEGORY_TO_DELETED_TRANSLATION[b]:BrowseFile.CATEGORY_TO_TRANSLATION[b];assert(a,"CATEGORY MISSING FOR "+b);return a},get_extension:function(){if(this.dir||this.filename.indexOf(".")===-1){return}return FileOps.file_extension(this.filename).toLowerCase()},is_shmodelable:function(){return !this.is_deleted&&FileOps.is_shmodelable(this.fq_path)}});BrowseFile._CATEGORIES={IMAGE:"ai bmp cr2 eps gif ico jpeg jpg nef png psd tif tiff",VIDEO:"3gp 3gpp 3gpp2 avi dv flv m2t m4v mkv mov mp4 mpeg mpg mts ts vob wmv",AUDIO:"aif flac m4a m4p mp3 ogg wav wma",DOCUMENT:"cdr csv doc docx fla indd keynote numbers otf pages pdf ppt pptx ps rtf swf txt wpd xls xlsx",COMPRESSED_FILE:"7z bz2 gz gzip rar tar zip",CODE:"as as3 c coffee cpp cs css cxx h html html java js less php py rb sass scss sh sql vb xhtml xml",DISK_IMAGE:"dmg iso",EXECUTABLE:"exe",SHORTCUT:"lnk",LINK:"url webloc",FONT:"ttf"};BrowseFile.EXTENSION_TO_CATEGORY={};BrowseFile.CATEGORY_TO_TRANSLATION={FILE:_("file"),FOLDER:_("folder"),SHARED_FOLDER:_("shared folder"),PUBLIC_FOLDER:_("folder"),PHOTOS_FOLDER:_("folder"),IMAGE:_("image"),VIDEO:_("video"),AUDIO:_("audio"),DOCUMENT:_("document"),COMPRESSED_FILE:_("archive"),CODE:_("code"),DISK_IMAGE:_("disk image"),EXECUTABLE:_("executable"),SHORTCUT:_("shortcut"),LINK:_("link"),FONT:_("font"),SANDBOX:_("app folder")};BrowseFile.CATEGORY_TO_DELETED_TRANSLATION={FILE:_("deleted file"),FOLDER:_("deleted folder"),SHARED_FOLDER:_("deleted shared folder"),PUBLIC_FOLDER:_("deleted folder"),PHOTOS_FOLDER:_("deleted folder"),IMAGE:_("deleted image"),VIDEO:_("deleted video"),AUDIO:_("deleted audio"),DOCUMENT:_("deleted document"),COMPRESSED_FILE:_("deleted archive"),CODE:_("deleted code"),DISK_IMAGE:_("deleted disk image"),EXECUTABLE:_("deleted executable"),SHORTCUT:_("deleted shortcut"),LINK:_("deleted link"),FONT:_("deleted font"),SANDBOX:_("deleted app folder")};(function(){var c,e,b,d,a;d=BrowseFile._CATEGORIES;a=[];for(c in d){b=d[c];a.push((function(){var j,g,f,h;f=b.trim().split(" ");h=[];for(j=0,g=f.length;j<g;j++){e=f[j];h.push(BrowseFile.EXTENSION_TO_CATEGORY[e]=c)}return h})())}return a})();BrowseFile._file_index={};BrowseFile.from_key=function(a){return BrowseFile._file_index[a]};BrowseFile.from_elem=function(b){var a;if(!b){return}a=b.readAttribute("data-identity");if(a){return BrowseFile.from_key(a)}else{return BrowseFile.from_elem(b.up("[data-identity]"))}};var BrowseActions,BrowseActionsBasic,BrowseActionsContext,GlobalActions,GlobalActionsBasic,GlobalActionsContext;BrowseActions=Class.create({initialize:function(a){return this._set_files(a)},get_actions:function(){var a;a=this.get_files();if(a.length<2){return this._get_actions_single(a.first())}else{return this._get_actions_multi(a)}},get_icon:function(a){return BrowseActions.option_dict[a].icon},get_text:function(a){var b;b=BrowseActions.option_dict[a];if(typeof b.text==="function"){return b.text.call(this)}else{return b.text}},get_href:function(a){var b;b=BrowseActions.option_dict[a];if(b.href){return b.href.call(this)}else{return""}},get_files:function(){return this._files},_set_files:function(a){return this._files=$A(a)},_get_actions_single:function(d){var e,a,f,b,j,c,g,k,h;e=[];if(!d){return[]}f=Browse.public_folder_enabled&&d.fq_path.toLowerCase().startsWith("/public/");g=Browse.public_folder_enabled&&d.fq_path.toLowerCase()==="/public";c=d.fq_path.toLowerCase()==="/photos";b=d.target_ns;a=d.ns_id!==Constants.root_ns;h=d.type===FileTypes.SHARED_FOLDER;k=d.type===FileTypes.SANDBOX;j=d.type===FileTypes.PACKAGE;if(d.is_deleted){e=e.concat(["restore"]);if(d.owned||!Browse.compost){e.push("purge")}if(!(d.dir||Browse.compost)){e.push("revisions")}}else{if(d.dir){if(k){e.push("app_info")}else{if(h){e.push("sharing_options")}else{if(!(a||b||f||g||c)){e.push("share")}}}if(d.is_shmodelable()){e.push("token_share")}e.push("download");if(!(g||c)){if(Browse.can_open_with){e.push("open_with")}e=e.concat(["delete","rename","move"]);if(!(j||b)){e.push("copy")}}}else{if(d.is_shmodelable()){e.push("token_share")}if(f||Browse.public_app_token){e.push("copy_url")}e.push("download");if(Browse.can_open_with){e.push("open_with")}e=e.concat(["delete","rename","move","copy","revisions"])}}return e},_get_actions_multi:function(c){var a,b;a=["download"];if(Browse.can_open_with){a.push("open_with")}a=a.concat(["delete","move","copy","restore","purge"]);b=BrowseUtil.profile_files(c);if(b.deleted>0||b.public_folder>0||b.photos_folder>0){a.removeItem("move");a.removeItem("copy");a.removeItem("delete")}if(b.shared_folders>0){a.removeItem("copy")}if(b.deleted>0){a.removeItem("delete");a.removeItem("download")}if(!Browse.inside_dir){a.removeItem("download")}if(b.deleted!==c.length){if(b.rejoinables!==c.length){a.removeItem("restore")}a.removeItem("purge")}if(Browse.compost&&b.owned!==c.length){a.removeItem("purge")}return a}});Object.extend(BrowseActions,{PUBLIC_FOLDER_PATH_LENGTH:7,showCopyPublicUrlModal:function(a){var b;Modal.icon_show("alert_32",_("Copy public link"),DomUtil.fromElm("copy-public-url"),{wit_group:"copy_public_link"});Modal.onHide=function(){$("flash_copy_container").remove();delete Modal.onHide;return Modal.hide()};BrowseActions.addCopyUrlFlash(a);b=$("modal-content").down("#public_url");assert(b,"Text element not found for copy pulic link");b.setValue(a);return b.select()},clipboard_copy_done:function(){Notify.server_success(_("Link copied to clipboard!"));return Modal.hide()},shortenPublicLink:function(){var a;Util.shorten_url($F("public_url"),BrowseActions.updatePublicLink);a=new Element("img",{id:"publink_loading",src:"/static/images/icons/ajax-loading-small.gif",className:"right"});return $("modal-content").down("a").__date(a)},updatePublicLink:function(a){$("public_url").setValue(a);$("public_url").select();$("publink_loading").remove();$("flash_copy_container").remove();return BrowseActions.addCopyUrlFlash(a)},addCopyUrlFlash:function(b,c){var a;if(c==null){c="real_copy"}a=Util.copy_to_clipboard_swf(b,c,"BrowseActions.clipboard_copy_done");return $(a).up().style.zIndex="1001"},option_dict:{new_folder:{icon:"folder_add",text:_("New folder"),click_handler:function(a){return Browse.new_folder()}},global_restore:{icon:"restore",text:function(){assert(Browse.inside_deleted_dir,"Global restore from not a deleted dir");if(Browse.inside_deleted_shared_folder){return _("Rejoin shared folder")}else{if(Browse.inside_deleted_sandbox){return _("Restore app folder")}else{return _("Restore folder")}}},click_handler:function(){var c,b,a;c=Browse.containing_fq_path();if(Browse.inside_deleted_sandbox){assert(Browse.old_path_to_ns_id[c],"Deleted sandbox missing nsid");return Apps.restore_sandbox(c,Browse.old_path_to_ns_id[c])}else{if(Browse.inside_deleted_shared_folder){assert(Browse.old_path_to_ns_id[c],"Deleted shared folder missing nsid");return Sharing.rejoin(c,Browse.old_path_to_ns_id[c])}else{a=Util.urlquote(c);b=encodeURIComponent(location.href);return window.location.href="/restore"+a+"?prev="+b}}}},restore:{icon:"restore",text:function(){var b,a;b=this.get_files();a=BrowseUtil.profile_files(b);if(a.shared_folders===b.length){return ungettext("Rejoin shared folder","Rejoin shared folders",b.length)}else{return _("Restore")}},click_handler:function(){var b,e,a,f,d,c;e=this.get_files();if(e.length===0){}else{if(e.length===1){b=e.first();if(!b.is_deleted){return}f=b.fq_path;a=f.toLowerCase();if(!b.real_path_exists){BrowseCompost.show_restore_modal(b)}else{if(b.type===FileTypes.SANDBOX){if(Browse.compost){a=b.real_path.toLowerCase()}assert(Browse.old_path_to_ns_id[a],"Restore missing ns");Apps.restore_sandbox(f,Browse.old_path_to_ns_id[a])}else{if(b.type===FileTypes.SHARED_FOLDER){if(Browse.compost){a=b.real_path.toLowerCase()}assert(Browse.old_path_to_ns_id[a],"Rejoin missing ns");Sharing.rejoin(f,Browse.old_path_to_ns_id[a])}else{if(b.dir){c=Util.urlquote(b.fq_path);d=encodeURIComponent(location.href);window.location="/restore"+c+"?prev="+d}else{FileOps.show_undelete(b)}}}}}else{if(Browse.compost){return BrowseCompost.show_bulk_restore_modal(e)}else{return FileOps.show_bulk_restore(e)}}}}},global_share:{icon:"rainbow_16",text:function(){if(Browse.inside_shared_folder){return _("Shared folder options")}else{if(Browse.containing_fq_path()===""){return _("Share a folder")}else{return _("Share this folder")}}},click_handler:function(a){if(Browse.containing_fq_path()===""){return Sharing.start_wizard(a)}else{if(Browse.inside_shared_folder){return Sharing.get_sharing_options(Browse.containing_mount_point())}else{return Sharing.show_share_existing_modal(Browse.containing_fq_path())}}}},sharing_options:{icon:"rainbow_16",text:_("Shared folder options"),click_handler:function(a){return Sharing.get_sharing_options(this.get_files().first().fq_path)}},view_token:{icon:"link",text:_("Share link"),click_handler:function(){var b,a;b=this.get_files().first();a="/s/"+b.tkey;if(!b.dir){a+="/"+Util.urlquote(FileOps.filename(b.fq_path))}return window.location.href=a}},remove_share:{icon:"link_delete",text:_("Disable link"),click_handler:function(){var a;a=this.get_files().first();return SharingModel.confirm_remove(FileOps.filename(a.fq_path),a.tkey)}},share_new:{icon:"rainbow_16",text:_("Share a folder"),click_handler:function(a){return Sharing.start_wizard(a)}},share:{icon:"rainbow_16",text:_("Invite to folder"),click_handler:function(a){return Sharing.show_share_existing_modal(this.get_files().first().fq_path)}},share_invite_more:{icon:"group",text:_("Invite more people"),click_handler:function(a){return Sharing.show_invite_more_modal(this.get_files().first().fq_path)}},share_leave:{icon:"folder_user_delete",text:_("Leave shared folder"),click_handler:function(a){var b;b=this.fq_path;return Sharing.show_leave_modal(this.get_files().first().fq_path)}},share_unshare:{icon:"link_break",text:_("Unshare this folder"),click_handler:function(a){var b;b=this.get_files().first().fq_path;return Sharing.show_unshare_modal(b)}},revisions:{icon:"previousversions",click_handler:function(){return window.location.href="/revisions"+Util.urlquote(this.get_files().first().fq_path)},text:_("Previous versions")},token_share:{icon:"link",text:_("Share link"),click_handler:function(b){var a;a=this.get_files().first().fq_path;assert(a,"token_share: expected non-root fq_path");return Sharing.shmodel(a)}},global_token_share:{icon:"link",text:_("Share link"),click_handler:function(a){return Sharing.shmodel(Browse.containing_fq_path())}},copy_url:{icon:"world_link",text:_("Copy public link"),click_handler:function(c){var a,b;AMC.log("site_action",{action:"publink_create",webserver:Constants.WEBSERVER});a=this.get_files().first();b=Browse.public_app_token?"/spa/"+Browse.public_app_token+Util.urlquote(a.ns_path):"/u/"+Constants.uid+Util.urlquote(a.fq_path.substring(BrowseActions.PUBLIC_FOLDER_PATH_LENGTH));return BrowseActions.showCopyPublicUrlModal("http://"+Constants.PUBSERVER+b)}},download:{icon:"download",text:function(){return _("Download")},click_handler:function(){var h,b,c,f,e,g,a,d;c=this.get_files();AMC.log("file_action",{action:"download",num_files:c.length,webserver:Constants.WEBSERVER});if(c.length===1&&!c[0].dir){b=c.first();d=[Constants.protocol,Constants.block,Util.urlquote(b.fq_path),b.hash],g=d[0],h=d[1],e=d[2],f=d[3];a=""+g+"://"+h+"/get"+e+"?w="+f+"&dl=1";return window.location=a}else{return FileOps.do_bulk_download(c)}}},view:{href:function(){var f,a,d,c,e,b;a=this.get_files().first();b=[Constants.protocol,Constants.block,Util.urlquote(a.fq_path),a.hash],e=b[0],f=b[1],c=b[2],d=b[3];return""+e+"://"+f+"/get"+c+"?w="+d},icon:"page_white_magnify",text:_("View file")},a_photo:{href:function(){return"/photoshow"+Util.urlquote(this.get_files().first().fq_path.substring(7))},icon:"pictures",text:_("Gallery view")},ignore:{click_handler:function(){return Sharing.ignore(this.get_files().first().fq_path)},icon:"folder_user_delete",text:_("Permanently remove")},show_del:{click_handler:function(a){return Browse.toggle_deleted()},icon:"show-deleted",text:_("Show deleted files")},hide_del:{click_handler:function(a){return Browse.toggle_deleted()},icon:"hide-deleted",text:_("Hide deleted files")},copy:{icon:"copy",text:_("Copy"),click_handler:function(c){var a,b;b=this.get_files();if(b.length===1){a=b.first();return FileOps.show_copy(a.fq_path,a.dir)}else{if(b.length>1){return FileOps.show_copy_bulk(b)}}}},move:{icon:"move_16",text:_("Move"),click_handler:function(c){var a,b;b=this.get_files();if(b.length===1){a=b.first();return FileOps.show_move(a.fq_path,a.dir)}else{if(b.length>1){return FileOps.show_move_bulk(b)}}}},rename:{icon:"rename",text:_("Rename"),click_handler:function(){return this.get_files().first().edit()}},"delete":{icon:"delete_16",text:_("Delete"),click_handler:function(c){var a,b;b=this.get_files();if(b.length>1){return FileOps.show_bulk_delete(b)}else{if(b.length===1){a=b.first();return FileOps.show_delete(a.fq_path,a.dir)}}}},global_purge:{icon:"permdelete",text:_("Permanently delete folder"),click_handler:function(){return FileOps.show_purge(Browse.containing_fq_path(),true)}},purge:{icon:"permdelete",text:_("Permanently delete"),click_handler:function(c){var a,b;b=this.get_files();if(b.length===1){a=b.first();return FileOps.show_purge(a.fq_path,a.dir)}else{return FileOps.show_bulk_purge(b)}}},upload:{icon:"upload_16",text:_("Upload"),click_handler:function(a){return FileOps.show_upload()}},app_info:{icon:"application_double",text:_("Application info"),click_handler:function(a){return window.location.href="/account/applications"}},more_actions:{icon:"big-dropdown",text:function(){return _("More")},click_handler:Prototype.emptyFunction},preview_folder:{icon:"magnifier2",text:function(){return _("Preview folder")},click_handler:function(){return BrowseUtil.filepreview_from_selected(this)}},more_global_actions:{icon:"arrow_down_grey_small",text:_("More actions"),click_handler:function(){GlobalActionsBasic.show_secondary();return document.body.observe("click",GlobalActionsBasic.hide_secondary)}},open_with:{icon:"move_16",text:_("Open with..."),click_handler:function(){return FileOps.show_open_with(this.get_files())}}}});BrowseActionsContext=Class.create(BrowseActions,{initialize:function($super,a){$super(a);return this._listen()},_listen:function(){$("context-menu-container").stopObserving("click");$("context-menu-container").stopObserving("contextmenu");$("context-menu-container").on("click",".action button",this._click.bind(this));return $("context-menu-container").on("contextmenu",".action button",this._click.bind(this))},_click:function(d,b){var c,a;c=b.readAttribute("data-value");a=BrowseActions.option_dict[c];d.stop();ContextMenu.hide();return a.click_handler.call(this)}});BrowseActionsBasic=Class.create(BrowseActions,{initialize:function($super){var a;a=BrowseSelection.get_selected_files();$super(a);this._render();return this._listen()},_listen:function(){var a;this.bound_update=this._update.bind(this);this.bound_disable=this._disable.bind(this);this.bound_enable=this._enable.bind(this);this.bound_click=this._click.bind(this);document.observe(BrowseSelection.UPDATED_EVT,this.bound_update);document.observe(ContextMenu.SHOW_EVT,this.bound_disable);document.observe(ContextMenu.HIDE_EVT,this.bound_enable);a=$("browse-root-actions");a.stopObserving("click");return a.on("click",".action button",this.bound_click)},unlisten:function(){document.stopObserving(BrowseSelection.UPDATED_EVT,this.bound_update);document.stopObserving(ContextMenu.SHOW_EVT,this.bound_disable);document.stopObserving(ContextMenu.HIDE_EVT,this.bound_enable);return $("browse-root-actions").stopObserving("click",this.bound_click)},_update:function(){this._set_files(BrowseSelection.get_selected_files());return this._render()},_disable:function(){$("browse-root-actions").stopObserving("click");if($("browse-root-actions").down(".secondary")){$("browse-root-actions").down(".secondary").addClassName("disabled")}return $$("#browse-root-actions .action *").invoke("setStyle",{cursor:"default"})},_enable:function(){$("browse-root-actions").stopObserving("click");$("browse-root-actions").on("click",".action button",this._click.bind(this));if($("browse-root-actions").down(".secondary")){$("browse-root-actions").down(".secondary").removeClassName("disabled")}return $$("#browse-root-actions .action *").invoke("setStyle",{cursor:"pointer"})},_render:function(){var u,p,h,s,v,w,o,q,k,e,f,g,r,d,m,b,j,l,n,c,a,t;e=this.get_files();h=this.get_actions();u=14;q="";f="";if(e.length===1){q=e[0].filename.em_snippet(u);if(!e[0].dir&&e[0].bytes>=0){f=e[0].size}}else{if(1<e.length){b=BrowseUtil.profile_files(e);r=[];if(b.files){d=ungettext("%d file","%d files",b.files).format(b.files);r.push(d)}if(b.folders){d=ungettext("%d folder","%d folders",b.folders).format(b.folders);r.push(d)}q=Util.nice_list(r)}}v=$("browse-root-actions");s=v.getLayout().get("width");g=v.getStyle("font-size");assert(g.endsWith("px"),"Invalid font size "+g);g=parseInt(g,10);k=new Emstring(q).length*g;l=new Emstring(f).length*g;s-=k+l;n=[];j=[];s-=10;for(a=0,t=h.length;a<t;a++){p=h[a];c=new Emstring(this.get_text(p)).length*g;w=c+16+8+10+9;if(s>w){n.push(p)}else{if(j.length===0){m=n.pop();j.push(m)}j.push(p)}s-=w}o=HTML.tmpl("actions_bar_tmpl",{context:this,description:q,filesize:f,has_actions:!!h.length,standard_actions:n,secondary_actions:j});return $("browse-root-actions").__date(o)},_click:function(d,b){var c,a;c=b.readAttribute("data-value");assert(c);a=BrowseActions.option_dict[c];assert(a,"Action info is missing for "+c);d.preventDefault();return a.click_handler.call(this)}});Object.extend(BrowseActionsBasic,{STANDARD_ACTIONS:["share","sharing_options","app_info","token_share","copy_url","download","delete","rename","restore","purge"]});GlobalActions=Class.create(BrowseActions,{initialize:function($super){return $super()},get_actions:function(){var a;if(!Browse.inside_dir){return[]}a=[];if(!Browse.inside_deleted_dir){a=a.concat(["upload","new_folder"]);if(!Browse.inside_sandbox){a.push("global_share")}if(Browse.containing_fq_path()&&FileOps.is_shmodelable(Browse.containing_fq_path())){a.push("global_token_share")}if(!Constants.can_see_trash){a.push((Browse.deleted_shown?"hide_del":"show_del"))}}else{a=a.concat(["global_restore"])}return a}});GlobalActionsBasic=Class.create(GlobalActions,{initialize:function($super){$super();this._listen();return this._render()},_listen:function(){$("global-actions").stopObserving("click");$("global-actions").on("click","a",this._click.bind(this));document.observe(ContextMenu.SHOW_EVT,this._disable.bind(this));return document.observe(ContextMenu.HIDE_EVT,this._enable.bind(this))},_render:function(){var d,b,c,a;d=this.get_actions();a=d.intersect(GlobalActionsBasic.STANDARD_ACTIONS);c=d.without.apply(d,GlobalActionsBasic.STANDARD_ACTIONS);if(c.length===1){a=d;c=[]}if(c.length){a.push("more_global_actions")}b=HTML.tmpl("global_actions_tmpl",{context:this,standard_actions:a,secondary_actions:c});return $("global-actions").__date(b)},_disable:function(){$("global-actions").stopObserving("click");$$("#global-actions .action a").invoke("removeClassName","title_bubble");return $$("#global-actions .action a").invoke("addClassName","disabled")},_enable:function(){$("global-actions").stopObserving("click");$("global-actions").on("click","a",this._click.bind(this));$$("#global-actions .action a").invoke("removeClassName","disabled");return $$("#global-actions .action a").invoke("addClassName","title_bubble")},_click:function(d,b){var c,a;c=b.readAttribute("data-value");assert(c);a=BrowseActions.option_dict[c];assert(a,"Action info is missing for "+c);d.stop();GlobalActionsBasic.hide_secondary();BrowseSelection.deselect_all();return a.click_handler.call(this)}});Object.extend(GlobalActionsBasic,{STANDARD_ACTIONS:["upload","new_folder","global_share","global_token_share","global_restore","global_purge"],show_secondary:function(){var a,b;b=$("secondary-actions");a=$("more_global_actions_button");b.show();return a.addClassName("down")},hide_secondary:function(){var a,b;b=$("secondary-actions");if(!b){return}a=$("more_global_actions_button");b.hide();return a.removeClassName("down")}});GlobalActionsContext=Class.create(GlobalActions,{initialize:function($super,a){$super(a);return this._listen()},_listen:function(){$("context-menu-container").stopObserving("click");$("context-menu-container").stopObserving("contextmenu");$("context-menu-container").on("click",".action button",this._click.bind(this));return $("context-menu-container").on("contextmenu",".action button",this._click.bind(this))},_click:function(d,b){var c,a;c=b.readAttribute("data-value");a=BrowseActions.option_dict[c];d.stop();BrowseSelection.deselect_all();ContextMenu.hide();return a.click_handler.call(this)}});var BrowseClipboard;BrowseClipboard=(function(){var j,f,c,g,e,l,n,h,b,a,k,d,m;j=0;f=1;e=[];c=null;m=function(){var q,s,p,t,r,o;if(Util.focus_in_input()){return}p=BrowseSelection.get_selected_files();if(p&&p.length){for(r=0,o=p.length;r<o;r++){s=p[r];if(s.bytes<0){Notify.server_error(_("Deleted files cannot be added to the clipboard"));return false}else{if(s.target_ns){t=_("'%(filename)s' cannot be added to the clipboard");t=t.format({filename:s.filename.escapeHTML()});Notify.server_error(t);return false}}}e=p;q=p.length;t=ungettext("Added %d item to clipboard","Added %d items to clipboard",q).format(q);Notify.server_success(t);return true}};l=function(){if(m()){c=j;return false}};n=function(){if(m()){c=f;return false}};h=function(o){var p;assert(typeof o!=="undefined","BrowseClipboard _paste got an undefined path");if(e.length){p=c===j?FileOps.do_bulk_copy:FileOps.do_bulk_move;p(e,o);return true}};d=function(o){var p;if(Util.focus_in_input()||Browse.in_search_mode()||Browse.inside_deleted_dir){return}p=h(Browse.containing_fq_path());if(p){return false}};g=function(){return e=[]};a=function(v){var u,q,s,t,r,p,o;s=v.memo.files;for(t=0,p=s.length;t<p;t++){q=s[t];for(r=0,o=e.length;r<o;r++){u=e[r];if(u.fq_path===q.fq_path||u.fq_path.startsWith(q.fq_path+"/")){g();return}}}};b=function(o){assert((o.memo.file!=null)&&!(o.memo.files!=null));o.memo.files=[o.memo.file];return a(o)};k=function(){var s,o,r,p,q;document.observe(FileEvents.RENAME,b);q=[FileEvents.DELETE,FileEvents.MOVE];for(r=0,p=q.length;r<p;r++){s=q[r];document.observe(s,a)}o=key.main_modifier();key(""+o+"+c",Browse.KEY_SCOPE,l);key(""+o+"+x",Browse.KEY_SCOPE,n);return key(""+o+"+v",Browse.KEY_SCOPE,d)};return{init:function(){return k()}}})();var BrowseSelection;BrowseSelection=(function(){var y,D,B,x,f,e,u,z,m,d,C,r,q,a,b,n,s,E,l,j,o,h,w,g,v,t,c,A,k,p;g=[];x=null;d=null;z=null;e=[];A=function(){$$("#browse-files li.browse-file.file-select").invoke("removeClassName","file-select");return BrowseSelection.get_selected_files().invoke("get_div").findAll(function(F){return F}).invoke("addClassName","file-select")};k=function(){if(z){return}$$("#browse-files li.browse-file[draggable]").invoke("writeAttribute","draggable",false);return BrowseSelection.get_selected_files().filter(function(F){return !F.editing}).invoke("get_div").findAll(function(F){return F}).invoke("writeAttribute","draggable","true")};p=function(F){F.apply(null,$A(arguments).slice(1));return document.fire(BrowseSelection.UPDATED_EVT)};v=function(H,G){var I,F;F=g.length;g=(H instanceof BrowseFile?[H]:$A(H));if(g.length!==F){T("Selected",g.length,"files")}I=G||g.last();assert(!I||I instanceof BrowseFile,"Invalid anchor type"+I);return x=I};v=v.wrap(p);y=function(G,F){if(G){g.push(G)}return x=F||G};y=y.wrap(p);j=function(F){var G;G=g.indexOf(F);if(G===-1){return}return g.splice(G,1)};j=j.wrap(p);o=function(){return g=[]};o=o.wrap(p);t=function(F){e=F;$$("#browse-files li.browse-file.context-select").invoke("removeClassName","context-select");return F.invoke("get_div").findAll(function(G){return G}).invoke("addClassName","context-select")};a=function(O){var L,J,I,K,R,H,Q,S,F,N,P,M,G;M=$(O.target);S=M.match("li.browse-file")?M:M.up("li.browse-file");L=M.match("a")?M:M.up("a");I=BrowseFile.from_elem(S);if(O.isRightClick()||!S||L){return}Browse.keyboard_nav=false;if(e.length){return}H=Util.is_mac();if((H&&O.metaKey)||(!H&&O.ctrlKey)){if(g.indexOf(I)===-1){return y(I)}else{return j(I)}}else{if(O.shiftKey){J=Browse.files.indexOf(x);G=Browse.files.indexOf(I);Q=Browse.files.indexOf(g.last());N=g.slice(0);R=Q<J?-1:1;K=J;while(K!==Q){K+=R;P=N.indexOf(Browse.files[K]);if(P!==-1){N.splice(P,1)}}R=G<J?-1:1;K=J;while(K!==G){K+=R;F=N.indexOf(Browse.files[K]);if(F!==-1){N.splice(F,1)}N.push(Browse.files[K])}return v(N,x)}else{return v(I)}}};b=function(K){var O,H,N,L,G,F,J,I,M;if(K.isRightClick()||e.length||Util.in_scrollbar(K.pointerX())){return}L=$(K.target);if(Element.match(L,"object")){L=L.parentNode}J=["browse-box","context-menu-container","modal","modal-overlay"];G=false;for(I=0,M=J.length;I<M;I++){F=J[I];if(L.descendantOf(F)||L.match("#"+F)){G=true;break}}if(!G){v();return}N=L.match("li.browse-file")?L:L.up("li.browse-file");H=BrowseFile.from_elem(N);O=L.match("[draggable]")||L.up("[draggable]");if(H&&!O){d=x;if(!K.shiftKey){if(H){d=H}else{if(L.match("#browse-files")){d=Browse.files.last()}}}z=[];if(K.metaKey||K.ctrlKey){return z=BrowseSelection.get_selected_files()}}};c=function(I){var G,F,H;H=$(I.target);F=H.match("li.browse-file")?H:H.up("li.browse-file");G=BrowseFile.from_elem(F);I.preventDefault();if(G){return Sharing.shmodel(G.fq_path)}};f=function(I){var G,F,H;H=$(I.target);F=H.match("li.browse-file")?H:H.up("li.browse-file");G=BrowseFile.from_elem(F);if(G){return a(I)}};q=null;C=function(){var F;clearInterval(q);F=function(){Browse.keyboard_nav=false;return $("browse-files").addClassName("mouse-active")};return q=setTimeout(F,100)};u=function(){if(!Browse.keyboard_nav){Browse.keyboard_nav=true;return $("browse-files").removeClassName("mouse-active")}};n=function(L){var I,H,G,K,N,F,J,M;C();if(!BrowseSelection.is_selecting()){return}I=Browse.files.indexOf(d);F=Browse.files.indexOf(BrowseFile.from_elem(L.target));assert(I<Browse.files.length&&I>=0,"anchor_index: "+I+" "+d);assert(F<Browse.files.length&&F>=0,"target_index: "+F);H=Browse.files.slice(Math.min(I,F),Math.max(I,F)+1);G=z.slice(0);for(J=0,M=H.length;J<M;J++){N=H[J];K=G.indexOf(N);if(K===-1){G.push(N)}else{G.splice(K,1)}}return v(G)};m=function(F){d=null;return z=null};l=function(H){var F,G;u();if(H){Event.extend(H).preventDefault()}G=g.length?g.last()===Browse.files.first()?Browse.files.first():(F=Browse.files.indexOf(g.last())-1,Browse.files[F]):Browse.files.last();v(G);if(G){return Browse.scrollTo(G.get_div())}};s=function(H){var F,G;u();if(H){Event.extend(H).preventDefault()}G=g.length?g.last()===Browse.files.last()?Browse.files.last():(F=Browse.files.indexOf(g.last())+1,Browse.files[F]):Browse.files.first();v(G);if(G){return Browse.scrollTo(G.get_div())}};B=function(N){var F,G,L,M,I,J,K,H;u();if(N){Event.extend(N).preventDefault()}if(g.length>0){M=Browse.files.indexOf(g.last());F=Browse.files.indexOf(x);if(x===g.last()||F>M){if(M>0){H=[];for(L=J=K=M-1;K<=0?J<=0:J>=0;L=K<=0?++J:--J){G=Browse.files[L];I=g.indexOf(G);y(G,x);if(I!==-1){H.push(g.splice(I,1))}else{Browse.scrollTo(G.get_div());break}}return H}}else{j(g.last());return Browse.scrollTo(g.last().get_div())}}else{return l()}};D=function(O){var F,G,M,N,J,K,L,I,H;u();if(O){Event.extend(O).preventDefault()}if(g.length>0){N=Browse.files.indexOf(g.last());F=Browse.files.indexOf(x);if(x===g.last()||F<N){H=[];for(M=K=L=N+1,I=Browse.files.length;L<=I?K<I:K>I;M=L<=I?++K:--K){G=Browse.files[M];J=g.indexOf(G);y(G,x);if(J!==-1){H.push(g.splice(J,1))}else{Browse.scrollTo(G.get_div());break}}return H}else{j(g.last());return Browse.scrollTo(g.last().get_div())}}else{return s()}};h=function(){v(Browse.files);return false};w=function(F){return v(Browse.find_file(F.memo.fq_path))};r=function(){$$(".file-select").invoke("removeClassName","file-select");return setTimeout(A,100)};E=function(F){return F.memo.files.each(function(G){var H;H=g.indexOf(G[0]);if(H!==-1){g.splice(H,1);return y(G[1])}})};document.observe(UpdateEvents.REMOVE,function(F){return F.memo.files.each(j)});document.observe(UpdateEvents.MOVE,E);return{UPDATED_EVT:"db:select:updated",init:function(){var F;document.observe("click",f);document.observe("mousedown",b);document.observe("mouseup",m);document.observe("dragend",m);document.observe("mouseup",k);$("browse-files").on("mouseover","li.browse-file",n);$("browse-files").on("click",".shmodel-file",c);document.observe(BrowseSelection.UPDATED_EVT,A);document.observe(BrowseSelection.UPDATED_EVT,k);document.observe(Browse.RENDER_EVT,A);document.observe(Browse.RENDER_EVT,k);document.observe(Browse.UPDATE_EVT,v.bind(null,null,null));document.observe(FilePreviewModal.EXIT_SELECT_EVT,w);F=key.main_modifier();key("up",Browse.KEY_SCOPE,l);key("down",Browse.KEY_SCOPE,s);key(F+"+a",Browse.KEY_SCOPE,h);key("escape",Browse.KEY_SCOPE,v.bind(null,null,null));key("shift+up",Browse.KEY_SCOPE,B);return key("shift+down",Browse.KEY_SCOPE,D)},set_selected_files:function(F){return v(F)},get_selected_files:function(){return g.slice(0)},get_selected_fq_paths:function(){return g.map(function(F){return F.fq_path})},is_selected:function(F){return g.indexOf(F)!==-1},is_selecting:function(){return !!d},deselect_all:o,set_context_selected:function(F){return t(F)},flicker_selected:r}})();var BrowseDrag,BrowseDragScroll;BrowseDrag={_BODY_DRAG_CLASS:"external_drag",_STATUS_CLASS:"dragging",_STATUS_OFFSET:10,_SELECTION_CONST:"SELECTION",_current_item_key:null,_drag_from_window:false,init:function(){if(!Modernizr.draganddrop){return}if(Browse.compost){return}return this.listen()},listen:function(){var a;a=$(document.body);document.observe(Browse.UPDATE_EVT,this._update_body_data.bind(this));a.on("dragleave","[dropzone]",this._dropzone_dragleave.bind(this));a.on("dragend",this._body_dragend.bind(this));a.on("dragover","[dropzone]",this._dropzone_dragover.bind(this));if(Prototype.Browser.IE){a.on("dragenter","[dropzone]",this._dropzone_dragover.bind(this));a.on("mousedown",this._ie_start_drags.bind(this));a.on("mouseover","a.filename-link",this._ie_mouseover.bind(this))}a.observe("dragover",this._body_dragover.bind(this));a.observe("dragleave",this._body_dragleave.bind(this));a.observe("dragstart",this._body_dragstart.bind(this));a.observe("mousemove",this._body_mousemove.bind(this));a.on("dragstart","li.browse-file",this._file_dragstart.bind(this));document.observe(BrowseSelection.UPDATED_EVT,this._build_selected_drag_icon.bind(this));document.observe(Browse.RENDER_EVT,this._build_selected_drag_icon.bind(this));a.on("mousedown","li.browse-file",this._build_file_drag_icon.bind(this));return a.on("drop","[dropzone]",this._drop.bind(this))},_file_mousemove:function(b){var a;if(!window.event||window.event.button!==1){return}a=b.findElement("[draggable]");if(a&&a!==document&&a.dragDrop){a.dragDrop();return BrowseDrag._ie_end_drags()}},_ie_start_drags:function(a,b){if(b.tagName!=="OBJECT"&&$(b).match("[draggable]")){return $("browse-files").observe("mousemove",this._file_mousemove)}},_ie_end_drags:function(){return $("browse-files").stopObserving("mousemove")},_update_body_data:function(){var b,a;b=Browse.inside_dir?"copy move":false;a=Browse.inside_dir?Browse.containing_fq_path():false;$(document.documentElement).writeAttribute("dropzone",b);return $(document.documentElement).writeAttribute("data-fq_path",a)},_body_dragover:function(d){var b,c,a;b=this._get_event_browse_files();if(b.length){return this._update_status_position(d,b)}else{if(!this._drag_from_window&&((c=d.dataTransfer)!=null?(a=c.types)!=null?a.contains("Files"):void 0:void 0)){return CrossDomainUploader.show_drop_indicators(d)}}},_body_dragleave:function(c){var b,a,d;a=c.x||c.clientX;d=c.y||c.clientY;b=Util.viewport_dimensions();if(!((0<a&&a<b.width)&&(0<d&&d<b.height))){return CrossDomainUploader.hide_drop_indicators()}},_body_dragstart:function(){return this._drag_from_window=true},_body_dragend:function(){if($("breadcrumb-dropdown")){$("breadcrumbs-box").removeClassName("down");$("breadcrumb-dropdown").hide()}this._clear_event_browse_files();this._remove_drop_indicators();CrossDomainUploader.hide_drop_indicators();BrowseDragScroll.end();return this._drag_from_window=false},_body_mousemove:function(){return CrossDomainUploader.hide_drop_indicators()},_ie_mouseover:function(b,a){return a.focus()},_dropzone_dragover:function(f,a){var b,c,d;c=this._get_event_browse_files();d=this._target_fq_path(a);if(!c.pluck("fq_path").indexOf(d===-1)){return}if(!this._can_drop(f,a)){a.addClassName("drag_nodrop");return}if(Util.is_mac()){f.dataTransfer.dropEffect="copyMove"}else{f.dataTransfer.dropEffect="move"}f.preventDefault();b=$$(".dragover");b.removeItem(a);b.invoke("removeClassName","dragover");a.addClassName("dragover");return CrossDomainUploader.folder_dragover(d)},_dropzone_dragleave:function(b,a){return this._clear_hover_state(a)},_file_dragstart:function(h,l){var m,b,n,g,d,f,j,c;Util.clear_selected();if(BrowseSelection.is_selecting()){return h.preventDefault()}h.dataTransfer.effectAllowed="copyMove";h.dataTransfer.setData("URL","about:blank");g=BrowseFile.from_elem(l);this._set_event_browse_files(g);d=this._get_event_browse_files();if(d.length<=1&&!g.dir){c=g.href;f=(g.filename||_("file")).replace(/:/g,"-");j="application/octet-stream";try{h.dataTransfer.setData("DownloadURL",[j,f,c].join(":"))}catch(k){}}n=new Element("img",{src:"/static/images/icons/icon_spacer.gif",width:1,height:1});m=true;try{h.dataTransfer.setDragImage(n,150,150)}catch(a){m=Util.ie8}this._add_drop_indicators(h);BrowseDragScroll.start();if(m){this._update_status_position(h,d);b=$("drag-status");b.removeClassName("rotatein").removeClassName("fadein").removeClassName("selection");if(d.length>1){b.addClassName("rotatein")}if(this._is_dragging_selection()){b.addClassName("selection")}return b.addClassName("fadein")}},_add_drop_indicators:function(f){var g,d,b,c,a;$(document.body).addClassName(this._STATUS_CLASS);c=$$('[dropzone="copy move"]');a=[];for(d=0,b=c.length;d<b;d++){g=c[d];if(this._can_drop(f,g)){a.push(g.addClassName("can_drop"))}else{a.push(void 0)}}return a},_remove_drop_indicators:function(){this._clear_hover_state();$(document.body).removeClassName(this._STATUS_CLASS);return $$(".can_drop").invoke("removeClassName","can_drop")},_build_selected_drag_icon:function(){var a,d,j,c,g,k,h,b,e,l,f;b=BrowseSelection.get_selected_files();j=new Element("div",{id:"drag-selection-status"});f=b.slice(0,4);for(g=e=0,l=f.length;e<l;g=++e){d=f[g];a=d.get_div();if(!a){continue}h=a.down(".icon");h.stopObserving("load");h.observe.bind(h).defer("load",BrowseDrag._build_selected_drag_icon);k=h.cloneNode(false);Element.addClassName(k,"icon icon"+g);j.__sert(k)}c=new Element("span",{className:"badge"});c.__date(b.length);j.appendChild(c);return $("drag-selection-status").replace(j)},_build_file_drag_icon:function(f,a){var b,g,d,c;b=BrowseFile.from_elem(a);c=b.get_div().down(".icon").cloneNode(false);Element.addClassName(c,"icon icon0");d=new Element("span",{className:"badge"});d.__date("1");g=new Element("div",{id:"drag-file-status"});g.__date(c).__sert(d);return $("drag-file-status").replace(g)},_drop:function(j,d){var a,c,f,g,b,h;j.preventDefault();c=this._get_event_browse_files();b=j.dataTransfer.files;h=j.dataTransfer.items;f=null;g=BrowseFile.from_elem(d);a=d.readAttribute("data-fq_path");if(g){f=g.fq_path}else{if(a||a===""){f=a}}if(b&&b.length){if(!CrossDomainUploader.supported()){Notify.server_error(_("Drag and drop not supported. Please try the simple uploader."))}else{if(!CrossDomainUploader.browse_indicators_enabled()&&!CrossDomainUploader.modal_indicators_enabled()){Notify.server_error(_("You can't drag and drop upload right now."))}else{CrossDomainUploader.upload(f,b,h)}}}else{if(c.length){if((j.dataTransfer.dropEffect==="copy")||(j.dataTransfer.effectAllowed==="copy")){if(Constants.can_undo){FileOps.do_bulk_copy(c,f)}else{FileOps.show_dragdrop_confirm(c,f,false)}}else{if(!Browse.inside_dir||Browse.containing_fq_path()!==f){if(Constants.can_undo){FileOps.do_bulk_move(c,f)}else{FileOps.show_dragdrop_confirm(c,f,true)}}}}}this._remove_drop_indicators();return CrossDomainUploader.hide_drop_indicators()},_set_event_browse_files:function(a){var b;b=BrowseSelection.is_selected(a);return this._current_item_key=b?this._SELECTION_CONST:a.to_key()},_clear_event_browse_files:function(){return this._current_item_key=null},_get_event_browse_files:function(){var c,b;try{b=this._current_item_key;if(this._is_dragging_selection()){return BrowseSelection.get_selected_files()}else{if(b){c=BrowseFile.from_key(b);return(c?[c]:[])}}}catch(a){console.log(a)}return[]},_is_dragging_selection:function(){return this._current_item_key&&this._current_item_key===this._SELECTION_CONST},_can_drop:function(d,b){var a,c;a=this._target_fq_path(b);c=this._get_event_browse_files();if(c.length){return !FileOps.bulk_move_error(c,a)}else{if($A(d.dataTransfer.types).indexOf("Files")!==-1){return CrossDomainUploader.supported()}else{return false}}},_target_fq_path:function(a){var b;b=BrowseFile.from_elem(a);if(b){return b.fq_path}else{return a.readAttribute("data-fq_path")}},_clear_hover_state:function(b){var e,d,a,c;c=$$("#browse .dragover");for(d=0,a=c.length;d<a;d++){e=c[d];if(e!==b){e.removeClassName("dragover")}}return $$("#browse .drag_nodrop").invoke("removeClassName","drag_nodrop")},_update_status_position:function(a){a=Event.extend(a);return Util.scry("drag-status").setStyle({left:(a.pointerX()-Util.scroll_offsets().left+this._STATUS_OFFSET)+"px",top:(a.pointerY()-Util.scroll_offsets().top+this._STATUS_OFFSET)+"px"})}};BrowseDragScroll=(function(){var h,g,f,c,a,d,b,e;b=null;f=0;a=40;d=50;c=function(l){var k,j;j=$(l.target);if(j.descendantOf("browse-location")||j.match("#browse-location")){return f=0}else{k=l.pointerY();return f=k-Util.scroll_offsets().top}};g=function(){d=$("browse-header").getHeight();document.observe("mousemove",c);return document.observe("dragover",c)};e=function(){document.stopObserving("mousemove",c);return document.stopObserving("dragover",c)};h=function(){var j;j=0;if(f<d){j=-1*a}else{if(f>Util.viewport_dimensions().height-d){j=a}}if(j){return Util.scroll_to(Util.scroll_offsets().left,Util.scroll_offsets().top+j)}};return{start:function(){g();return b=setInterval(h,100)},end:function(){e();return clearInterval(b)}}})();var BrowseJump;BrowseJump={_active:"",_listening:false,_RESET_WAIT:1000,_RESET_TIMER_ID:null,_CODEPOINTS:null,_BLACKLIST:["/","\\",":","?","*","<",">","|"].map(function(a){return a.charCodeAt(0)}),update:function(){var c,f,b,e,a,d;if(!BrowseJump._listening){BrowseJump.listen();BrowseJump._listening=true}c=[];d=Browse.files;for(e=0,a=d.length;e<a;e++){b=d[e];f=BrowseJump.to_codepoint_list(b.filename);c.push([f,b])}c.sort(function(h,g){return BrowseJump.cmp_codepoints(h[0],g[0])});return BrowseJump._CODEPOINTS=c},reset:function(){return BrowseJump._active=""},is_active:function(){return BrowseJump._active},jump:function(a){BrowseSelection.set_selected_files([a]);return Browse.scrollTo(a.get_div())},listen:function(){var e,d,b,c,a;document.observe("keypress",function(g){var f;if(key.getScope()!==Browse.KEY_SCOPE){return}if(Util.focus_in_input()||g.metaKey||g.altKey||g.altGraphKey||g.ctrlKey){return}f=g.charCode||g.keyCode;if(f<32){return}if((33<=f&&f<=40)){return}if(f===32){if(BrowseJump._active){g.preventDefault()}else{return}}if(BrowseJump._BLACKLIST.indexOf(f)!==-1){return}clearTimeout(BrowseJump._RESET_TIMER_ID);BrowseJump._active+=String.fromCharCode(f).toLowerCase();BrowseJump.jump(BrowseJump.nearest_file(BrowseJump._active));return BrowseJump._RESET_TIMER_ID=setTimeout(BrowseJump.reset,BrowseJump._RESET_WAIT)});c=[FileEvents.DELETE,FileEvents.COPY,FileEvents.MOVE,FileEvents.RENAME,FileEvents.PURGE,FileEvents.RESTORE,FileEvents.UPLOAD,FileEvents.SF_NEW,FileEvents.SF_LEAVE,FileEvents.SF_UNSHARE,FileEvents.SF_REJOIN,FileEvents.SF_IGNORE,FileEvents.LINKS_REMOVE,UpdateEvents.ADD,UpdateEvents.REMOVE,UpdateEvents.MOVE];a=[];for(d=0,b=c.length;d<b;d++){e=c[d];a.push(document.observe(e,function(f){return BrowseJump.update()}))}return a},nearest_file:function(g){var h,d,c,f,b,e,a;h=BrowseJump.to_codepoint_list(g);e=BrowseJump._CODEPOINTS;for(f=0,b=e.length;f<b;f++){a=e[f],c=a[0],d=a[1];if(BrowseJump.cmp_codepoints(h,c)<1){return d}}return BrowseJump._CODEPOINTS.last()[1]},cmp_codepoints:function(e,d){var a,c,b;assert(e.length>0&&d.length>0,"bad input to cmp_codepoints");for(a=c=0,b=e.length;0<=b?c<b:c>b;a=0<=b?++c:--c){if(!(d[a]!=null)){return 1}if(e[a]!==d[a]){return(e[a]<d[a]?-1:1)}}if(d.length>e.length){return -1}else{return 0}},to_codepoint_list:function(b){var c,a,e,d;b=b.toLowerCase();a=[];for(c=e=0,d=b.length;0<=d?e<d:e>d;c=0<=d?++e:--e){a.push(b.charCodeAt(c))}return a}};var ContextMenu;ContextMenu={KEY_SCOPE:"context",SHOW_EVT:"db:contextmenu:show",HIDE_EVT:"db:contextmenu:hide",_prev_key_scope:null,listen:function(){var a=this;document.observe("click",this.hide_on_click);document.observe(Browse.UPDATE_EVT,this.hide_on_click);return key("esc",this.KEY_SCOPE,function(b){return ContextMenu.hide()})},unlisten:function(){return document.stopObserving("click",this.hide_on_click)},hide_on_click:function(a){if(!a.isRightClick()){return ContextMenu.hide()}},show_for_file:function(c,b){var d,a;Browse.keyboard_nav=false;this.hide();d=BrowseFile.from_elem(b);a=BrowseSelection.is_selected(d)?BrowseSelection.get_selected_files():[d];BrowseSelection.set_context_selected(a);return this._show(c,new BrowseActionsContext(a))},show_global:function(a){this.hide();return this._show(a,new GlobalActionsContext())},show_shmodel:function(f){var d,a,b,c;d=["get_original"];this.hide();b=f.findElement("img");c={get_original:{icon:"download",text:_("Download Original"),href:b.readAttribute("data-original-href")}};a=Class.create({get_actions:function(){return d},get_icon:function(e){return c[e].icon},get_text:function(e){return c[e].text},get_href:function(e){return c[e].href}});return this._show(f,new a())},show_photos:function(m,p){var o,a,j,d,k,n,l,h,g,f,c,b;this.hide();d={divider:{type:"divider"},add_to_album:{type:"subheader",text:_("ADD TO ALBUM")},new_album:{icon:"album_new_32_padded",text:_("New album"),click_handler:function(q){PhotosCollections.create(q,$("new_album_button").down("span"),p);return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_NEW_ALBUM,PhotosTriggers.PCM,{num_photos:p.length})}},recent_album_1:{text:(l=PhotosCollections.get_all()[0])!=null?l.name.em_snippet(PhotosCollections.CONTEXT_MENU_COLLECTION_SNIPPET_LENGTH,1):void 0,click_handler:function(){PhotosCollections.add_photos(PhotosCollections.get_all()[0],p);return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_RECENT_ALBUM,PhotosTriggers.PCM,{num_photos:p.length})}},recent_album_2:{text:(h=PhotosCollections.get_all()[1])!=null?h.name.em_snippet(PhotosCollections.CONTEXT_MENU_COLLECTION_SNIPPET_LENGTH,1):void 0,click_handler:function(){PhotosCollections.add_photos(PhotosCollections.get_all()[1],p);return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_RECENT_ALBUM,PhotosTriggers.PCM,{num_photos:p.length})}},choose_album:{icon:"add_to_album_32_padded",text:_("Add "+p.length+" to album..."),click_handler:function(q){PhotosCollections.show_add_to_album_modal(q,p);return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_OTHER_ALBUM,PhotosTriggers.PCM,{num_photos:p.length})}},all_albums:{icon:"album_32_padded",text:_("Another album..."),click_handler:function(q){PhotosCollections.show_add_to_album_modal(q,p);return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_OTHER_ALBUM,PhotosTriggers.PCM,{num_photos:p.length})}},remove:{icon:"remove_from_album_32_padded",text:_("Remove "+p.length+" from album"),click_handler:function(){PhotosCollections.show_remove_photos_modal(Photos.get_current_collection(),p);return PhotosLogger.log_interaction(PhotosEvents.REMOVE,PhotosTriggers.PCM,{num_photos:p.length})}}};if(((g=PhotosCollections.get_all()[0])!=null?g.thumbnail_url:void 0)!=null){d.recent_album_1.icon_href=(f=PhotosCollections.get_all()[0])!=null?f.thumbnail_url:void 0}else{d.recent_album_1.icon="empty_album"}if(((c=PhotosCollections.get_all()[1])!=null?c.thumbnail_url:void 0)!=null){d.recent_album_2.icon_href=(b=PhotosCollections.get_all()[1])!=null?b.thumbnail_url:void 0}else{d.recent_album_2.icon="empty_album"}if(Photos.in_single_collection_view()){o=["remove","divider","share","choose_album"]}else{o=["share","divider","add_to_album","new_album"];if(PhotosCollections.get_all().length){o.push("recent_album_1");if(PhotosCollections.get_all().length>1){o.push("recent_album_2");if(PhotosCollections.get_all().length>2){o.push("all_albums")}}}o.push("divider");o.push("delete")}if(p.length===1){n=PhotosUtil.categorize_files(p);if(n===PhotosUtil.ONLY_PHOTOS){k=_("Share photo")}else{k=_("Share video")}Object.extend(d,{share:{icon:"link_32_padded",text:k,click_handler:function(q){Foshmodal.show(p,false);return PhotosLogger.log_interaction(PhotosEvents.SHARE,PhotosTriggers.PCM,{num_photos:1})}},"delete":{text:_("Delete"),click_handler:function(){Photos.show_delete_photos_modal(p);return PhotosLogger.log_interaction(PhotosEvents.DELETE,PhotosTriggers.PCM,{num_photos:1})}},show_in_folder:{text:_("Show in folder"),click_handler:function(){Photos.show_in_folder(p[0]);return PhotosLogger.log_interaction(PhotosEvents.SHOW_IN_FOLDER,PhotosTriggers.PCM,{num_photos:1})}}});o.push("show_in_folder")}else{n=PhotosUtil.categorize_files(p);if(n===PhotosUtil.ONLY_PHOTOS){k=ungettext("Share %(file_count)s photo","Share %(file_count)s photos",p.length);j=ungettext("Delete %(file_count)s photo","Delete %(file_count)s photos",p.length)}else{if(n===PhotosUtil.ONLY_VIDEOS){k=ungettext("Share %(file_count)s video","Share %(file_count)s videos",p.length);j=ungettext("Delete %(file_count)s video","Delete %(file_count)s videos",p.length)}else{k=ungettext("Share %(file_count)s file","Share %(file_count)s files",p.length);j=ungettext("Delete %(file_count)s file","Delete %(file_count)s files",p.length)}}k=k.format({file_count:p.length});j=j.format({file_count:p.length});Object.extend(d,{share:{icon:"link_32_padded",text:k,click_handler:function(q){Photos._share_selected();return PhotosLogger.log_interaction(PhotosEvents.SHARE,PhotosTriggers.PCM,{num_photos:p.length})}},"delete":{text:j,click_handler:function(q){Photos.show_delete_photos_modal(p);return PhotosLogger.log_interaction(PhotosEvents.DELETE,PhotosTriggers.PCM,{num_photos:p.length})}}})}a=Class.create({initialize:function(){return this._listen()},_listen:function(){$("context-menu-container").stopObserving("click");$("context-menu-container").stopObserving("contextmenu");$("context-menu-container").on("click",".action button",this._click.bind(this));return $("context-menu-container").on("contextmenu",".action button",this._click.bind(this))},_click:function(u,r){var t,q,s;t=r.readAttribute("data-value");q=d[t];u.stop();if(u.clientX===0&&u.clientY===0){return}if(t!=="new_album"){ContextMenu.hide()}return(s=q.click_handler)!=null?s.call(this,u):void 0},get_actions:function(){return o},get_type:function(e){return d[e].type},get_icon:function(e){return d[e].icon},get_icon_href:function(e){return d[e].icon_href},get_text:function(e){return d[e].text},get_href:function(e){return d[e].href}});return this._show(m,new a(),true)},show_photo_collection:function(d,f,g){var c,a,b;this.hide();c=["share","rename"];if(f.share_tkey!=null){c.push("unshare")}c.push("delete");b={share:{icon:"link",text:_("Share album"),click_handler:function(h){Foshmodal.show(f,true);return PhotosLogger.log_interaction(PhotosEvents.SHARE_ALBUM,PhotosTriggers.CCM,{num_photos:f.num_photos})}},unshare:{icon:"lock",text:_("Unshare album"),click_handler:function(h){PhotosCollections.unshare(f);return PhotosLogger.log_interaction(PhotosEvents.UNSHARE_ALBUM,PhotosTriggers.CCM,{num_photos:f.num_photos})}},rename:{icon:"album_rename_16",text:_("Rename album"),click_handler:function(h){PhotosCollections.rename(f,g.down(".collection-name"));return PhotosLogger.log_interaction(PhotosEvents.RENAME_ALBUM,PhotosTriggers.CCM,{num_photos:f.num_photos})}},"delete":{icon:"album_delete_16",text:_("Delete album"),click_handler:function(h){PhotosCollections.show_delete_modal(f);return PhotosLogger.log_interaction(PhotosEvents.DELETE_ALBUM,PhotosTriggers.CCM,{num_photos:f.num_photos})}}};a=Class.create({initialize:function(){return this._listen()},_listen:function(){$("context-menu-container").stopObserving("click");$("context-menu-container").stopObserving("contextmenu");$("context-menu-container").on("click",".action button",this._click.bind(this));return $("context-menu-container").on("contextmenu",".action button",this._click.bind(this))},_click:function(m,j){var l,h,k;l=j.readAttribute("data-value");h=b[l];m.stop();ContextMenu.hide();return(k=h.click_handler)!=null?k.call(this):void 0},get_actions:function(){return c},get_icon:function(e){return b[e].icon},get_text:function(e){return b[e].text},get_href:function(e){return b[e].href}});return this._show(d,new a())},_show:function(q,j,p){var o,d,n,k,g,m,t,s,l,a,b,r,h,f,c;if(p==null){p=false}l=((q!=null?(h=q.target)!=null?h.tagName.toUpperCase():void 0:void 0)==="INPUT")&&((q!=null?(f=q.target)!=null?f.type.toUpperCase():void 0:void 0)==="TEXT")||((q!=null?(c=q.target)!=null?c.tagName.toUpperCase():void 0:void 0)==="TEXTAREA");if((q!=null?q.shiftKey:void 0)||l){return}else{Event.stop(q)}n=["page-footer","account-header","browse-global-actions-bar","modal","modal-overlay","file-preview-modal"];s=$(q.target);for(b=0,r=n.length;b<r;b++){d=n[b];if($(d)&&(s.descendantOf(d)||s.match("#"+d))){return}}if(s.match("#context-menu")){return}if(this._context_menu_tmpl==null){this._context_menu_tmpl=HTML.tmpl("context_menu_tmpl")}o=Event.pointer(q);if(!j.get_actions().length){return}FreshDropdown.hide_all();$("context-menu-container").__date(this._context_menu_tmpl({context:j,actions:j.get_actions(),big:p}));a=Util.viewport_dimensions();t=Util.scroll_offsets();g=parseInt($("context-menu").getStyle("width"),10);k=parseInt($("context-menu").getStyle("height"),10);m=15;if(o.x+g>a.width+t.left-m){$("context-menu").setStyle({left:(o.x-t.left-g)+"px"})}else{$("context-menu").setStyle({left:(o.x-t.left)+"px"})}if(o.y+k>a.height+t.top-m){$("context-menu").setStyle({top:(a.height-k-m)+"px"})}else{$("context-menu").setStyle({top:(o.y-t.top)+"px"})}$("context-menu-container").show();this.listen();this._prev_key_scope=key.getScope();key.setScope(this.KEY_SCOPE);return document.fire(this.SHOW_EVT)},hide:function(){if(!$("context-menu-container").empty()){this.unlisten();BrowseSelection.set_context_selected([]);$("context-menu-container").__date();if(key.getScope()===this.KEY_SCOPE){key.setScope(this._prev_key_scope)}return document.fire(this.HIDE_EVT)}}};var Subscriber;Subscriber={SUBSCRIBE_CHILLOUT:5*1000,INITIAL_BACKOFF:15*1000,MAX_BACKOFF:4*60*1000,MAX_URL_LENGTH:8096,init:function(){return this.start()},_long_poll:function(a){a=a||0;clearTimeout(this._subscribe_timeout_id);return this._subscribe_timeout_id=setTimeout(this._do_subscribe.bind(Subscriber),a)},_do_subscribe:function(){if(this._is_stopped||this._is_running||!this._get_list_info){return}if(!this._ns_map){this._long_poll(this.SUBSCRIBE_CHILLOUT);return}this._is_running=true;return this._make_subscribe_request()},_make_subscribe_request:function(){var b,a;a="/subscribe";b="host_int=0&ns_map="+(this._get_ns_map_params())+"&ts=0";if(a.length+b.length>this.MAX_URL_LENGTH){return}return new Ajax.DBRequest(a,{no_watch:true,noAutonotify:true,suppress_nonstandard_headers:true,evalJSON:false,method:"GET",parameters:b,onSuccess:this.subscribe_success.bind(this),onFailure:this.subscribe_failure.bind(this)})},subscribe_success:function(a){var b;a=a.responseText||a;b=Util.from_json(a);if(b.ret==="new"){return this._do_list.bind(this).defer()}else{this._is_running=false;this._long_poll();return assert(b.ret==="punt","Invalid response from subscribe: "+a.responseText)}},subscribe_failure:function(){this._is_running=false;return this._long_poll(this.SUBSCRIBE_CHILLOUT)},_do_list:function(){var e,c,a,b,d=this;if(this._is_stopped||!this._get_list_info){this._is_running=false;return}if(Ajax.activeRequestCount!==0){this._is_running=false;this._long_poll(this.SUBSCRIBE_CHILLOUT);return}b=this._get_list_info(),e=b[0],a=b[1],c=b[2];if(c==null){c={}}c=Object.extend(c,{ns_map:this._get_ns_map_params()});return new Ajax.DBRequest(a,{no_watch:true,noAutonotify:true,parameters:c,onSuccess:function(f){var h;h=Util.from_json(f.responseText);d._is_running=false;d._failure_backoff=d.INITIAL_BACKOFF;d._ns_map=h.ns_map;try{e(h)}catch(g){}return d._long_poll()},onFailure:function(){setTimeout(d._do_list.bind(Subscriber),d._failure_backoff);return d._failure_backoff=Math.min(d._failure_backoff*2,d.MAX_BACKOFF)}})},_get_ns_map_params:function(){var a,b;b=[];for(a in this._ns_map){b.push(a+"_"+this._ns_map[a])}return b.join(",")},start:function(){this._is_stopped=false;return this._long_poll()},stop:function(){return this._is_stopped=true},_reset:function(){this._failure_backoff=this.INITIAL_BACKOFF;this._is_running=false;this._get_list_info=false;this._is_stopped=true;this._ns_map=false;return this._subscribe_timeout_id=0},subscribe:function(a){this._get_list_info=a;if(!this._is_stopped){return this._long_poll()}},set_ns_map:function(a){return this._ns_map=a}};Subscriber._reset();var BrowseCompost;BrowseCompost={selected_sort:["modified-sorter",false],show_restore_modal:function(b){var a,c,d;c=b.dir;d=c?_("Restore folder to..."):_("Restore file to...");a=b.fq_path;return FileOps.show_folder_pick(d,a,FileOps.do_move,c,true)},show_bulk_restore_modal:function(a){if(a.pluck("real_path_exists").all()){return FileOps.show_bulk_restore(a)}else{return FileOps.show_bulk_folder_pick(_("Restore files to"),"restore",a,FileOps.do_bulk_move)}}};var BROWSE_SNIPPET_LEN,Browse,BrowseUpdate,FILE_PPREVIEW_MODAL_FOR_DOCS,LAST_MODIFIED_FNAME_SNIPPET,SEARCH_SNIPPET_LEN,__indexOf=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++){if(b in this&&this[b]===c){return b}}return -1};BROWSE_SNIPPET_LEN=25;SEARCH_SNIPPET_LEN=20;LAST_MODIFIED_FNAME_SNIPPET=4;FILE_PPREVIEW_MODAL_FOR_DOCS=false;Browse={KEY_SCOPE:"browse",RENDER_EVT:"db:browse:render",UPDATE_EVT:"db:browse:update",SCROLL_DURATION:0.5,msg:false,files:[],reloading:false,creating_folder:false,first_load:true,last_sort:[Sort.FILES_BY_NAME,true],folder_loading_notification:null,keyboard_nav:false,compost:false,init:function(a){this.unselectable();this.compost=a;if(this.compost){Sort.FILES_BY_MODIFIED=Sort.ALL_BY_MODIFIED;this.last_sort=[Sort.FILES_BY_MODIFIED,true];$("modified-sorter").writeAttribute("data-ascending","true")}this.listen();return Util.viewport_dimensions()},setup:function(b){var d,c,a;this.ns_id_to_mount_point=b.ns_id_to_mount_point;this.old_path_to_ns_id=b.old_path_to_ns_id;this.compiled_tmpl=HTML.tmpl("list_item_tmpl");this.render_timeout=null;this.inside_dir=b.inside_dir;this.inside_deleted_dir=b.inside_deleted_dir;this.inside_shared_folder=b.inside_shared_folder;this.inside_sandbox=b.inside_sandbox;this.public_app_token=b.public_app_token;this.public_folder_enabled=b.public_folder_enabled;this.inside_deleted_sandbox=b.inside_deleted_sandbox;this.inside_deleted_shared_folder=b.inside_deleted_shared_folder;this.ns_map=b.ns_map;this.contents_cache_key=b.contents_cache_key;c="inside_deleted_dir";if(this.inside_deleted_dir){$("browse").addClassName(c)}else{$("browse").removeClassName(c)}this.block_hash=b.block_hash;this.block_hash_param=b.block_hash_param;if(this.inside_dir||this.compost){$("advanced-search-box").hide();$("advanced-search-link").removeClassName("selected");if(this.inside_dir){this._containing_ns_id=b.containing_ns_id;this._containing_ns_path=b.containing_ns_path;this._containing_fq_path=b.containing_fq_path;this._containing_mount_point=b.containing_mount_point;BrowseURL.set_path_url(this._containing_ns_id,this._containing_ns_path);this.breadcrumb()}else{$("advanced-search-link").hide();d=new Element("span",{style:"color:#000;"});d.__sert(Sprite.make("web","money"));d.__sert(_("Compost"));$("browse-location").update(d)}if(this.browse_actions_basic){this.browse_actions_basic.unlisten();delete this.browse_actions_basic}this.browse_actions_basic=new BrowseActionsBasic();new GlobalActionsBasic();if(!b.file_info){this.show_message(_('<h3>This folder is empty</h3> Add files using the <a href="/install">desktop application</a> or the upload button above.'))}}if(this.compost&&!this.inside_dir&&!this.in_search_mode()){$("browse").addClassName("compost");$("browse-sort").addClassName("compost")}else{$("browse").removeClassName("compost");$("browse-sort").removeClassName("compost")}this._push_files(b.file_info);if(this.compost){this.sort_handler(null,BrowseCompost.selected_sort[0],BrowseCompost.selected_sort[1]);a="/browse_deleted";if(this.inside_dir){a+="/"+this._containing_ns_id+this._containing_ns_path}Scroll.init(100,a,{category:BrowseCompost.selected_sort[0],asc:BrowseCompost.selected_sort[1]},this.add_files,this.get_cursor)}return Subscriber.set_ns_map(b.ns_map)},_push_files:function(b){var c,d,a;for(d=0,a=b.length;d<a;d++){c=b[d];BrowseUtil.make_browsefile(c)}BrowseJump.update();if(this.compost){return this.smartfill()}},_get_helper:function(a){assert(this.inside_dir,"accessed "+a+", but not inside a directory");return Browse[a]},containing_ns_id:function(){return this._get_helper("_containing_ns_id")},containing_ns_path:function(){return this._get_helper("_containing_ns_path")},containing_fq_path:function(){return this._get_helper("_containing_fq_path")},containing_mount_point:function(){return this._get_helper("_containing_mount_point")},listen:function(){var d,j,r,m,l,h,f,p,c,b,a,q,n,k,g,e,o=this;$("browse-files").on("click","li.browse-file",this.click.bind(this));$("browse-files").on("dblclick","li.browse-file",this.dblclick.bind(this));$("browse-files").on("contextmenu","li.browse-file",ContextMenu.show_for_file.bind(ContextMenu));this.enable_sorting();j="#browse-sort a.sortable-column-header";if(this.compost){Util.add_sort_arrow_mouseover($("modified-sorter"),false,j,false)}else{Util.add_sort_arrow_mouseover($("name-sorter"),true,j,false)}Event.observe(window,"scroll",this.window_scroll.bind(this));Event.observe(window,"resize",this.updateOffset.bind(this));$(document.body).on("click","a.crumb",this.crumb_click.bind(this));$("browse-files").on("click","a.parent-dir",this.parent_click.bind(this));document.observe("contextmenu",ContextMenu.show_global.bind(ContextMenu));document.observe(BrowseSelection.UPDATED_EVT,this.selection_handler.bind(this));document.observe(FilePreviewModal.PHOTO_DELETE_EVT,function(s){return FileOps.do_delete(s.memo.fq_path)});document.observe(FileEvents.COPY,function(s){if(o.inside_dir&&s.memo.to_fq_path===o.containing_fq_path()){return o.force_reload()}});n=[FileEvents.MOVE,FileEvents.RESTORE,FileEvents.UPLOAD,FileEvents.SF_NEW,FileEvents.SF_REJOIN,FileEvents.SF_IGNORE,FileEvents.LINKS_REMOVE];for(m=0,p=n.length;m<p;m++){d=n[m];document.observe(d,function(s){if(o.inside_dir){return o.force_reload()}})}if(this.compost){k=[FileEvents.RESTORE,FileEvents.MOVE,FileEvents.SF_REJOIN];for(l=0,c=k.length;l<c;l++){d=k[l];document.observe(d,function(s){return o.force_reload()})}}g=[FileEvents.SF_LEAVE,FileEvents.SF_UNSHARE];for(h=0,b=g.length;h<b;h++){d=g[h];document.observe(d,function(s){if(o.inside_dir||o.compost){if(s.memo.target_ns_id===o.containing_ns_id()){if(s.memo.folder_deleted){return o.reload_fqpath("")}else{return o.reload_fqpath(o.containing_fq_path())}}else{return o.force_reload()}}})}e=[FileEvents.DELETE,FileEvents.PURGE];for(f=0,a=e.length;f<a;f++){d=e[f];document.observe(d,function(z){var x,y,s,A,w,u,v,t;if(o.inside_dir||o.compost){if(z.eventName===FileEvents.PURGE||(z.eventName===FileEvents.DELETE&&!BrowseURL.get_del())){for(y=w=v=o.files.length-1;v<=0?w<=0:w>=0;y=v<=0?++w:--w){if(z.memo.files.indexOf(o.files[y])===-1){s=o.files[y]}else{break}}BrowseSelection.deselect_all();t=z.memo.files;for(u=0,A=t.length;u<A;u++){x=t[u];x.get_div().remove();o.files.removeItem(x)}if(o.files.length){if(o.keyboard_nav){if(s!=null){return BrowseSelection.set_selected_files(s)}else{return BrowseSelection.set_selected_files(o.files.last())}}}else{return o.show_empty()}}else{if(o.keyboard_nav){o.select_fq_paths=[o.containing_fq_path()+"/"+z.memo.files.last().filename]}if(FilePreviewModal.shown){return FilePreviewModal.reload=true}else{return o.force_reload()}}}})}document.observe(ContextMenu.SHOW_EVT,this.disable_sorting.bind(this));document.observe(ContextMenu.HIDE_EVT,this.enable_sorting.bind(this));q=function(){var t,s;t=$("browse-header");s=t.cumulativeOffset().top+t.getHeight();return Util.viewport_dimensions().height-s};key("pagedown",this.KEY_SCOPE,function(s){Event.extend(s).preventDefault();return window.scrollBy(0,q())});key("pageup",this.KEY_SCOPE,function(s){Event.extend(s).preventDefault();return window.scrollBy(0,-1*q())});if(this.compost){Scroll.listen()}r=function(){var s;s=Browse.in_search_mode()?FileSearch:Browse;if(Browse.files.length===0){return s.show_empty()}else{return s.hide_empty()}};document.observe(UpdateEvents.ADD,function(v){var t,w,s,u;u=v.memo.files;for(s=0,w=u.length;s<w;s++){t=u[s];o.insert_file(t,true)}return r()});document.observe(UpdateEvents.REMOVE,function(v){var t,w,s,u;u=v.memo.files;for(s=0,w=u.length;s<w;s++){t=u[s];o.remove_file(t)}return r()});return document.observe(UpdateEvents.MOVE,function(w){var z,y,x,t,v,u,s;v=w.memo.files;s=[];for(t=0,x=v.length;t<x;t++){u=v[t],z=u[0],y=u[1];o.remove_file(z);s.push(o.insert_file(y))}return s})},disable_sorting:function(){$("browse-sort").stopObserving("click");return $$("#browse-sort *").invoke("setStyle",{cursor:"default"})},enable_sorting:function(){$("browse-sort").stopObserving("click");$("browse-sort").on("click","#browse-sort a.sortable-column-header",this.sort_handler.bind(this));return $$("#browse-sort *").invoke("setStyle",{cursor:"pointer"})},click:function(b,c){var a;a=$(b.target);if(a.match("a.filename-link")||a.match("img.icon")){return this._click(b,c)}},dblclick:function(a,b){if($(a.target).match("a")){return}return this._click(a,b)},dropbox_open_file:function(c,a){var b,d;if(c.dir){if(a){return this.open_folder_in_new_window(c)}else{return this.open_folder(c)}}else{if(c.bytes>0&&c.preview_type&&!a&&!((c.preview_type==="video")&&Constants.DISABLE_VIDEOS_IN_LIGHTBOX)){b=["photo","video"];if(Constants.PRIVATE_FILE_PREVIEWS_ENABLED){b=b.concat("text","doc")}if(d=c.preview_type,__indexOf.call(b,d)>=0){return BrowseUtil.filepreview_from_selected(c)}else{return window.location.href="/preview"+Util.urlquote(c.fq_path)}}else{UserActivityLogger.log("web","file_view",Object.toJSON({mode:"get"}));return window.open(c.href,"_blank")}}},open_file:function(b,a){if(!b.dir&&Browse.can_open_with&&b.get_extension() in Browse.app_prefs){return window.open(FileOps.open_with_url(Browse.app_prefs[b.get_extension()],[b]),"_blank")}else{return this.dropbox_open_file(b,a)}},_click:function(c,d){var b,a;this.keyboard_nav=false;b=BrowseFile.from_elem(d);if(b.editing){return}a=(c.which===2)||(Util.is_mac()&&c.metaKey);Browse.open_file(b,a);c.preventDefault()},crumb_click:function(d,a){var c,b;this.keyboard_nav=false;d.preventDefault();b=a.readAttribute("data-fq_path");c=this.details_from_fq_path(b);return BrowseURL.set_path_url(c.ns_id,c.ns_path)},parent_click:function(d,c){var a,b;this.keyboard_nav=false;if(this.compost){return}d.preventDefault();b=c.readAttribute("data-parent_ns_path");a=parseInt(c.readAttribute("data-parent_ns_id"),10);return BrowseURL.set_path_url(a,b)},selection_handler:function(){if(BrowseSelection.get_selected_files().length){return $("browse-box").addClassName("selected")}else{return $("browse-box").removeClassName("selected")}},POST_SCROLL_WAIT:100,_last_scroll_timeout:null,window_scroll:function(){clearTimeout(this._last_scroll_timeout);return this._last_scroll_timeout=setTimeout(BrowseUtil.load_visible_thumbs.bind(BrowseUtil),this.POST_SCROLL_WAIT)},updateOffset:function(){if(!this.div_parent){return}this._cumulativeOffset=this.div_parent.cumulativeOffset();return this.viewportOffset()},reset_sort:function(){var b,a;this.last_sort=[Sort.FILES_BY_NAME,true];a="#browse-sort a.sortable-column-header";b=$$(a)[0];Util.add_sort_arrow_mouseover(b,true,a,false);$("kind-sorter-label").__date(FlexColumn.DISPLAY.FILES_BY_KIND);return Sprite.src(b.down("img"),"web","sort-uptick-off")},sort_handler:function(j,k,d){var f,a,h,b,l,c,g;k=$(k);k.blur();f=k.readAttribute("data-sort");if(!(d!=null)){d=this.last_sort[0]===Sort[f]?k.readAttribute("data-ascending")==="false":true}if((j!=null)&&this.compost&&((g=Sort[f])===Sort.FILES_BY_NAME||g===Sort.FILES_BY_MODIFIED)){BrowseCompost.selected_sort=[k.id,d];Scroll.pause();this.force_reload();return}if(FlexColumn.LABELS.indexOf(f)!==-1){l=FlexColumn.SORT_FUNCTIONS.indexOf(this.last_sort[0])!==-1;if(l){h=(FlexColumn.LABELS.indexOf(f)+1)%FlexColumn.LABELS.length;f=FlexColumn.LABELS[h];a=FlexColumn.DISPLAY[f];$("kind-sorter-label").__date(a)}k.writeAttribute("data-sort",f);d=FlexColumn.IS_ASC[f]}else{k.writeAttribute("data-ascending",(d?"true":"false"))}c="#browse-sort a.sortable-column-header";Util.add_sort_arrow_mouseover(k,d,c,true);b=Sort[f];this.sort(b,d);if(j){return j.stop()}},toggle_deleted:function(){var a;a=!BrowseURL.get_del();return BrowseURL.set_del_url(a)},new_folder:function(){var f,s,h,b,g,p,l,d,k,o,c,q,m,j,a,r,e,n=this;if(this.reloading||this.creating_folder){return}this.hide_empty();this.selectable();s=_("New folder");g=[];e=this.files;for(a=0,r=e.length;a<r;a++){p=e[a];if(p.dir&&p.filename.indexOf(s)!==-1){g.push(p.filename)}}d=s;f=1;while(true){if(g.indexOf(d)===-1){break}d=s+" ("+f+")";f++}j=HTML.tmpl("new_folder_tmpl",{name:d});l=-1;if(this.files.length){m=Util.scroll_offsets();if(m.top>0){q=this.files[0].get_div().getLayout().get("margin-box-height");l=Math.floor(m.top/q)}}if(l>0){this.files[l].get_div().__sert({after:j})}else{$("browse-files").__sert({top:j})}k=$$("#browse-files .browse-new-folder .name").first();assert(k!=null,"expected new_folder_name to be defined");h=this.containing_fq_path();c=function(v){var u,t,w;w=v.responseText.evalJSON(true);assert(w.new_browse_files.length===1,"No new file data returned.");u=FileOps.filename(w.new_browse_files.first().fq_path);t=_("Created folder '%(folder_name)s'");t=t.format({folder_name:u.snippet().escapeHTML()});Notify.server_success(t);n.select_fq_paths=[w.new_browse_files.first().fq_path];return n.force_reload()};o=function(u){var t;t=$$("#browse-files li.browse-new-folder").first();if(t){t.remove()}return n.creating_folder=false};b=new Ajax.InPlaceEditor(k,"/cmd/new"+(Util.urlquote(h))+"?long_running",{htmlResponse:false,okControl:false,cancelControl:false,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:25,ajaxClass:Ajax.DBRequest,submitOnBlur:true,onFailure:function(){},onComplete:o,savingText:_("Creating folder..."),onLeaveEditMode:this.unselectable,ajaxOptions:{method:"POST",onSuccess:c},callback:function(t,u){n.creating_folder=true;return{to_path:u||"",folder:"yes"}}});return b.enterEditMode()},open_folder:function(c){var b,a,d,e=this;assert(c.dir,"Only open directories, not files");if(!(BrowseSelection.get_selected_files().length===1&&BrowseSelection.get_selected_files().indexOf(c)===0)){BrowseSelection.deselect_all();c.get_div().addClassName("file-select")}clearTimeout(this.folder_loading_notification);b=function(){var f;f=_("Loading %(filename)s...");f=f.format({filename:c.filename.em_snippet(50).escapeHTML()});return Notify.server_success(f,60,true)};this.folder_loading_notification=setTimeout(b,1000);if(c.target_ns){a=c.target_ns;d=""}else{a=c.ns_id;d=c.ns_path}if(c.is_deleted){return BrowseURL.set_path_url(a,d,true)}else{return BrowseURL.set_path_url(a,d)}},open_folder_in_new_window:function(a){return window.open(BrowseURL._make_url(a.ns_id,a.ns_path),"_blank")},show_message:function(c){var b,a;if((typeof c)!==(typeof"string")){a=$("browse-files").down(".browse-message");if(a){a.show()}return}this.msg=c;b=new Element("div",{"class":"browse-message"});b.__date(c);return $("browse-files").__sert(b)},sort:function(a,d,c){var b;if(!c&&a===this.last_sort[0]&&d===this.last_sort[1]){return}this.last_sort=[a,d];b=a(d);this.files.sort(b);this.smartfill();return BrowseUtil.load_visible_thumbs()},resort:function(){var c,a,b;a=this.last_sort;b=a[0];c=a[1];return this.sort(b,c,true)},in_search_mode:function(){return $("browse").hasClassName("search")},flex_column:function(){return $("kind-sorter").readAttribute("data-sort")},smartfill:function(){var b,e,c,f,d,h,a,g;b=$("browse-files");d=[];f=this.in_search_mode();c=this.flex_column();g=this.files;for(h=0,a=g.length;h<a;h++){e=g[h];d.push(this.compiled_tmpl({file:e,in_search_mode:f,flex_column:c}))}b.__date(d);return document.fire(this.RENDER_EVT)},add_file:function(a){this.files.push(a);if(a.target_ns){Browse.ns_id_to_mount_point[a.target_ns]=a.fq_path}if(a.bytes<0){return this.deleted_shown=true}},insert_file:function(c,b){var a;b=b||0;a=this.find_file(c.fq_path);if(a&&a!==c){this.remove_file(a)}this.update_file_pos(c);if(b){c.get_div().setStyle({display:"none"})}return document.fire(this.RENDER_EVT)},add_files:function(a){return Browse._push_files(a.file_info)},get_cursor:function(){var c,a,h,f,e,j,b,g,d;if(BrowseCompost.selected_sort[0]==="name-sorter"){a={};g=Browse.files;for(f=0,j=g.length;f<j;f++){c=g[f];a[c.ns_id]=c.filename}return Object.toJSON(a)}else{if(BrowseCompost.selected_sort[0]==="modified-sorter"){h={};d=Browse.files;for(e=0,b=d.length;e<b;e++){c=d[e];h[c.ns_id]=c.sjid}return Object.toJSON(h)}}},get_file_pos:function(a){var b;b=this.files.indexOf(a);assert(b!==-1,"file not present in @files");assert(a.to_key() in BrowseFile._file_index,"file not present in BrowseFile._file_index");return b},remove_file:function(a){var b;b=this.files.indexOf(a);if(b!==-1){this.files.splice(b,1);delete BrowseFile._file_index[a.to_key()];return a.get_div().remove()}},update_file_pos:function(f){var a,j,d,e,g,c,b,h;h=this.files.indexOf(f);if(h!==-1){this.files.splice(h,1)}delete f.sort_rank;c=this.last_sort[0];g=this.last_sort[1];e=Util.bsearch(this.files,f,c(g),true);this.files.splice(e,0,f);d=f.get_div();a=$("browse-files");if(d){d.remove()}b=this.compiled_tmpl({file:f,in_search_mode:this.in_search_mode(),flex_column:this.flex_column()});j=a.childElements();if(e<j.length){return a.childElements()[e].__sert({before:b})}else{return a.__sert(b)}},find_file:function(a){return this.files.find(function(b){return b.fq_path.toLowerCase()===a.toLowerCase()})},reset_state:function(){this.msg=false;this.dragging=false;this.files=[];this.selected_files=[];this.selection=[];BrowseFile._file_index={};return BrowseDrag._body_dragend()},clear:function(){$("browse-files").__date();if(this.compost){$("browse").removeClassName("compost");$("browse-sort").removeClassName("compost")}return this.hide_empty()},show_empty:function(){$("browse-empty").show();return $(document.documentElement).removeClassName("earthrise")},hide_empty:function(){$("browse-empty").hide();return $(document.documentElement).addClassName("earthrise")},update:function(a){$("browse-box").show();$("browse-files").__date();if(typeof a==="string"){this.setup(Util.from_json(a))}else{this.setup(a)}this.resort();return document.fire(this.UPDATE_EVT)},reload_fqpath:function(b,a){return this.reload(null,Util.urlquote(b),a)},force_reload:function(){if(this.compost&&!this.inside_dir){return this.reload(void 0,"",true)}return this.reload(this.containing_ns_id(),Util.urlquote(this.containing_ns_path()),true)},set_title:function(){var a;if(this.compost&&!this.inside_dir){document.title=_("Compost")+" - Dropbox";return}a=this.containing_fq_path();return document.title=a?FileOps.filename(a)+" - Dropbox":_("Home")+" - Dropbox"},set_selection_from_fq_paths_or_index:function(j){var c,b,g,f,a,d,e,h;a=j.select_fq_paths;d=j.select_index;if(a||d>-1){b=[];if(a){for(e=0,h=a.length;e<h;e++){g=a[e];f=this.find_file(g);if(f){b.push(f)}}}if(!b.length&&d>-1){c=this.files[d];if(c){b.push(c)}}if(b.length){BrowseSelection.set_selected_files(b);this.scrollToWithPadding(b.first().get_div(),100)}j.select_fq_paths=false;return j.select_index=-1}else{return window.scrollTo(0,0)}},reload:function(d,o,b){var r,f,l,e,j,p,q,c,k,g,n,a,h=this;c="Browse.reload ns_path contains an invalid character: # ; ? : @ & = + $ (ns_path = "+o+")";assert(o.search(DBHistory.URL_ESCAPE_REGEX)===-1,c);if(!this.compost){if(d==null){d=Constants.root_ns}}o=Util.normalize(o);if(BrowseUtil.get_mode()!==BrowseUtil.BROWSE_MODE){this.clear();BrowseUtil.set_browse_mode()}if(FileSearch._clear_on_reload){FileSearch.clear_searchbox()}if(!FileQueue.uploading){InlineUploadStatus.hide()}if(this.reloading){return}if(this.inside_dir&&o===this.containing_ns_path()&&d===this.containing_ns_id()&&!b){return}n=this.first_load?Constants.referrer:"";p=this.deleted_shown?"?show_deleted=yes":"";if(this.compost){g={referrer:n,category:BrowseCompost.selected_sort[0],asc:BrowseCompost.selected_sort[1]}}else{g={ns_id:d,referrer:n}}g=Object.extend(g,this.extra_reload_args);T("Browse.reload:",o);this.reloading=true;if(this.compost){a="/browse_deleted";if(o){if(d!=null){a+="/"+d+o}else{a+=""+o}}}else{a="/browse"+o+p}r=2;f=["browse",d,o,p,Constants.uid,r];k=function(s){h.reset_state();h.update(s);(h.files.length?h.hide_empty.bind(h):h.show_empty.bind(h))();clearTimeout(h.folder_loading_notification);if(Notify.cancel_on_reload){Notify.clear_all();Notify.cancel_on_reload=false}Util.force_delete_cached_scroll_offsets();h.set_selection_from_fq_paths_or_index(Browse);h.set_title();if(Tutorial.should_handle_event(Tutorial.events.browse_reload)){return Tutorial.handle_event(Tutorial.events.browse_reload)}};l=false;if(this.use_local_cache){e=DBLocalStorage.getItem(f);try{q=Util.from_json(e)}catch(m){q={}}g.contents_cache_key=q.contents_cache_key;if(e){j=function(){try{k(q);h.reloading=false;return l=true}catch(s){return DBLocalStorage.removeItem(f)}};j.defer()}}new Ajax.DBRequest(a,{parameters:g,log_timing:true,on304:function(s){},onSuccess:function(w){var z,t,y,u,v,x,s;q=Util.from_json(w.responseText);u=null;y=null;if(h.use_local_cache){v=function(){return DBLocalStorage.setItem(f,w.responseText)};v.defer();if(e&&l){if(!(h.containing_ns_id()===q.containing_ns_id&&h.containing_ns_path()===q.containing_ns_path)){return}u=BrowseSelection.get_selected_files();y=Util.scroll_offsets()}}k(q);if(u){t=[];for(x=0,s=u.length;x<s;x++){z=u[x];t.push(Browse.find_file(z.fq_path))}BrowseSelection.set_selected_files(t);return window.scrollTo(y[0],y[1])}},onFailure:function(){if(h.first_load){h.reload.bind(h).defer(Constants.root_ns,"")}return clearTimeout(h.folder_loading_notification)},cleanUp:function(){h.first_load=false;return h.reloading=false},no_feed_reload:true,evalJSON:false});return true},unload:function(){var a;this.reset_state();a=$("dropdown");if(a){return Util.yank(a)}},can_get_details_from_fq_path:function(c){var b,a;b=this.containing_fq_path();a=this.containing_mount_point();return(a&&c.startsWith(a))||b.startsWith(c)},details_from_fq_path:function(d){var e,b,a,c;assert(this.can_get_details_from_fq_path(d));b=this.containing_mount_point();if(b&&d.startsWith(b)){a=this.containing_ns_id();c=d.slice(b.length);e=FileOps.filename(d)}else{a=Constants.root_ns;c=d;e=FileOps.filename(d)}return{ns_id:a,ns_path:c,fq_path:d,folder_name:e||"Dropbox",url:"/home"+d,icon:(d.length?"folder_32":"dropbox_32")}},_make_breadcrumbs_data:function(){var f,g,b,e,a,d,c;g=this.containing_fq_path();f=[];a=g.split("/");for(b=d=0,c=a.length;0<=c?d<c:d>c;b=0<=c?++d:--d){e=Util.normalize(a.slice(0,b+1).join("/"));f.push(this.details_from_fq_path(e))}return f},_MAX_BREADCRUMB_WIDTH:16.5,_CONNECT_WIDTH:1.64,breadcrumb:function(){var k,b,d,l,g,j,a,h,c,e,f;b=this._make_breadcrumbs_data();if(this.compost){b.remove(1)}c=b.collect(function(m){return new Emstring(m.fq_path?m.folder_name:"").length});h=0;d=0;assert(b.length>0,"expected at least one breadcrumb");for(g=e=f=b.length-1;f<=0?e<=0:e>=0;g=f<=0?++e:--e){h+=c[g];if(h>this._MAX_BREADCRUMB_WIDTH){break}d+=1;h+=this._CONNECT_WIDTH}l=b.slice(0,b.length-Math.max(1,d));b=b.slice(l.length,b.length);if(!l.length&&b.length>1){b.shift()}j=b.pop();k=HTML.tmpl("breadcrumb_tmpl",{breadcrumbs:b,dropdown:l,containing_fq_path:this.compost?this.containing_ns_path():this.containing_fq_path(),compost:this.compost});a=j.folder_name.em_snippet(this._MAX_BREADCRUMB_WIDTH);$("browse-location").__date(k);$("browse-location").__sert(" "+a);if(l.length>1){return this._render_breadcrumbs_dropdown(l)}},_render_breadcrumbs_dropdown:function(f){var a,c,b,e,d=this;a=$("breadcrumbs-box");f.reverse();b=HTML.tmpl("breadcrumb_li_tmpl",{breadcrumbs:f});$("browse-location").__sert(b);c=$("breadcrumb-dropdown");e=function(g){g.stopPropagation();c.show();return c.clonePosition(a,{setWidth:0,setHeight:0,offsetTop:a.getHeight(),offsetLeft:parseInt(a.getStyle("padding-left"),10)})};a.observe("click",e);a.observe("dragover",e);return document.observe("click",function(){a.removeClassName("down");return c.hide()})},viewportOffset:function(){var a,c,b;if(!this.files.length){return}if(!this.div_parent){c=this.files[0].get_div().offsetParent;if(!c){return}this._viewportOffset={};this.div_parent=$(c);this._cumulativeOffset=this.div_parent.cumulativeOffset()}a=Util.scrollLeft(this.div_parent);b=Util.scrollTop(this.div_parent);if(!this.scrollTop||!this.scrollLeft||this.scrollTop!==b||this.scrollLeft!==a){this._viewportOffset.top=this._cumulativeOffset.top-b;this._viewportOffset.left=this._cumulativeOffset.left-a;this.scrollLeft=a;this.scrollTop=b}return this._viewportOffset},selectable:function(){return Util.enableSelection($("browse-files"))},unselectable:function(){return Util.disableSelection($("browse-files"))},_header_offset:(function(){var a;a=$("browse-header");return a.getHeight()+a.cumulativeOffset().top}).cached(1000),scrollTo:function(a){return this.scrollToWithPadding(a,3)},scrollToWithPadding:function(d,f){var c,g,b,e,a;if(!d){return}e=Util.viewport_dimensions();a=Util.scroll_offsets();g=d.cumulativeOffset().top-a.top;c=d.getHeight();b=this._header_offset();if(g<b){Util.scroll_to(0,a.top+g-b-f)}else{if(g+c>e.height){Util.scroll_to(0,a.top+g+c-e.height+f)}}if($("modal-overlay").visible()&&$("modal").getStyle("position")==="absolute"){return Modal.fix_position()}}};BrowseUpdate=(function(){var f,g,e,c,d,b,a;b=function(j){var k,l,h;if(!Browse.inside_dir){return}l=j.parent_changes;if(l.change_to_fq_path!=null){if(l.change_type==="moved"){if(l.is_changing_view){k=_("The folder '%s' has been moved. <a href=\"/home%s\">View</a>");k=k.format(l.old_fq_path.escapeHTML(),Util.urlquote(l.new_fq_path))}else{k=_("This folder has been moved")}}else{if(l.change_type==="renamed"){if(l.is_changing_view){k=_("The folder '%s' has been renamed. <a href=\"/home%s\">View</a>");k=k.format(l.old_fq_path.escapeHTML(),Util.urlquote(l.new_fq_path))}else{k=_("This folder has been renamed to '%s'.");h=l.change_to_fq_path.split("/");k=k.format(h[h.length-1].escapeHTML())}}else{k=_("The folder '%s' has been deleted.");k=k.format(l.old_fq_path.escapeHTML())}}if(l.is_changing_view){Notify.server_error(k)}else{if(l.old_fq_path===Browse.containing_fq_path()){Notify.server_success(k)}}Browse.reload_fqpath(l.change_to_fq_path);return}return d(j)};a=function(n){var j,q,p,h,s,o,l,r,m,k;q=[];o=[];if(!Browse.in_search_mode()){return}FileSearch.clear_cache();for(h in Browse.ns_id_to_mount_point){if(!(h in n.mount_points)){n.mount_points[h]=null}}m=n.mount_points;for(h in m){p=m[h];h=parseInt(h,10);s=Browse.ns_id_to_mount_point[h];if(p===s){continue}if(p){Browse.ns_id_to_mount_point[h]=p}else{delete Browse.ns_id_to_mount_point[h]}k=Browse.files;for(l=0,r=k.length;l<r;l++){j=k[l];if(j.fq_path.indexOf(s)===0&&j.target_ns!==h){if(p){j.fq_path=p+j.fq_path.slice(s.length);j.href="/home"+p+j.href.slice(5+s.length);q.push([j,j])}else{o.push(j)}}}}return d(n,[],o,q)};d=function(z,q,v,p){var u,w,s,t,n,l,j,h,x,A,y,r,o,m,k;if(q==null){q=[]}if(v==null){v=[]}if(p==null){p=[]}r=z.added;for(l=0,x=r.length;l<x;l++){w=r[l];q.push(BrowseUtil.make_browsefile(w))}o=z.removed;for(j=0,A=o.length;j<A;j++){s=o[j];v.push(Browse.find_file(s))}m=z.moved;for(h=0,y=m.length;h<y;h++){k=m[h],t=k[0],n=k[1];p.push([Browse.find_file(t),BrowseUtil.make_browsefile(n)])}document.fire(UpdateEvents.ADD,{files:q});document.fire(UpdateEvents.MOVE,{files:p});BrowseUtil.load_visible_thumbs();u=f(q,v,p);if(Tutorial.should_handle_event(Tutorial.events.browse_folder_update_start)){Tutorial.handle_event(Tutorial.events.browse_folder_update_start,{added:q,moved:p,removed:v})}return new Effect.Parallel(u,{afterFinish:function(){document.fire(UpdateEvents.REMOVE,{files:v});if(Tutorial.should_handle_event(Tutorial.events.browse_folder_update_done)){return Tutorial.handle_event(Tutorial.events.browse_folder_update_done,{added:q,moved:p,removed:v})}}})};f=function(s,r,t){var k,l,v,p,w,o,n,m,u,j,h,q;p=!IE7_OR_LESS&&(s.length+r.length)<=10;k=[];for(o=0,u=s.length;o<u;o++){l=s[o];k.push(e(l));if(p){k.push(g(l))}else{l.get_div().setStyle({display:""})}}for(n=0,j=r.length;n<j;n++){l=r[n];if(!(l&&l.get_div())){continue}k.push(e(l));if(p){k.push(c(l))}}for(m=0,h=t.length;m<h;m++){q=t[m],v=q[0],w=q[1];k.push(e(w))}return k};e=function(h){return new Effect.HighlightForcedWithAlpha(h.get_div(),{sync:true,startcolor:BrowseSelection.is_selected(h)?"#83B8DC":"#CCEAFF",afterFinish:function(){return h.get_div().setStyle({backgroundImage:"",backgroundColor:""})}})};c=function(h){return new Effect.BlindUpComprehensive(h.get_div(),{sync:true,scaleMode:{originalHeight:35,originalWidth:788}})};g=function(h){return new Effect.BlindDownComprehensive(h.get_div(),{sync:true,scaleMode:{originalHeight:35,originalWidth:788}})};return{init:function(){var h;h=function(){var n,m,k,l,j;k=Browse.in_search_mode();n=k?a:b;j=k?"/update/list_search":"/update/list_dir";if(k){l=FileSearch.get_state();if(l.is_advanced){m=l}else{m={all_terms:l.query}}}else{m={fq_dir:Browse.containing_fq_path(),show_deleted:Browse.deleted_shown}}return[n,j,m]};return Subscriber.subscribe(h)}}})();var FileEvents,FileOps,Job,ModalProgress,NOTIFICATION_SNIPPET_LEN,ProgressBar,ProgressWatcher;FileEvents={DELETE:"db:bulk_delete",COPY:"db:bulk_copy",MOVE:"db:bulk_move",RENAME:"db:bulk_rename",PURGE:"db:bulk_purge",RESTORE:"db:bulk_restore",UPLOAD:"db:upload",SF_NEW:"db:sf_new",SF_LEAVE:"db:sf_leave",SF_UNSHARE:"db:sf_unshare",SF_REJOIN:"db:sf_rejoin",SF_IGNORE:"db:sf_ignore",LINKS_REMOVE:"db:link_remove"};NOTIFICATION_SNIPPET_LEN=40;FileOps={OPEN_WITH_ITEM_SELECTED:"#open-with-app-list .selected",is_shmodelable:function(a){var b;if(!Constants.can_shmodel||Browse.public_app_token){return false}if(Browse.public_folder_enabled){b=a.toLowerCase();if(b.startsWith("/public/")){return false}}return true},filename_to_icon:function(a){var b,c;c=FileOps.file_extension(a).toLowerCase();b={exe:"page_white_gear",dll:"page_white_gear",xls:"page_white_excel",xlsx:"page_white_excel",ods:"page_white_tux",c:"page_white_c",h:"page_white_c",php:"page_white_php",mp3:"page_white_sound",wav:"page_white_sound",m4a:"page_white_sound",wma:"page_white_sound",aiff:"page_white_sound",au:"page_white_sound",ogg:"page_white_sound",doc:"page_white_word",docx:"page_white_word",odt:"page_white_tux",ppt:"page_white_powerpoint",pptx:"page_white_powerpoint",odp:"page_white_tux",txt:"page_white_text",rtf:"page_white_text",sln:"page_white_visualstudio",vcproj:"page_white_visualstudio",html:"page_white_code",htm:"page_white_code",psd:"page_white_paint",pdf:"page_white_acrobat",fla:"page_white_actionscript",swf:"page_white_flash",gif:"page_white_picture",png:"page_white_picture",jpg:"page_white_picture",jpeg:"page_white_picture",tiff:"page_white_picture",tif:"page_white_picture",bmp:"page_white_picture",odg:"page_white_picture",py:"page_white_code",gz:"page_white_compressed",tar:"page_white_compressed",rar:"page_white_compressed",zip:"page_white_compressed",iso:"page_white_dvd",css:"page_white_code",xml:"page_white_code",tgz:"page_white_compressed",bz2:"page_white_compressed",rb:"page_white_ruby",cpp:"page_white_cplusplus",java:"page_white_cup",cs:"page_white_csharp",ai:"page_white_vector"};return b[c]||"page_white"},open_with_select:function(a){$$(FileOps.OPEN_WITH_ITEM_SELECTED).invoke("removeClassName","selected");this.addClassName("selected");return $("open-button").addClassName("freshbutton-blue")},open_with_url:function(b,c){var a,d;d={files:(function(){var g,f,e;e=[];for(g=0,f=c.length;g<f;g++){a=c[g];e.push(a.fq_path)}return e})(),uid:Constants.uid};return Util.add_qstring(b,{dropbox:Util.to_json(d)})},do_open_with:function(b,a){return window.open(FileOps.open_with_url(b.landing,a),"_blank")},_find_app_by_id:function(b){var e,d,a,c;c=Modal.vars.apps;for(d=0,a=c.length;d<a;d++){e=c[d];if(e.app_id!==b){continue}return e}return null},close_open_with:function(f,d){var e,a,g,c,b;$("open-button").removeClassName("freshbutton-blue");if(!f){return Modal.hide(d)}c=$$(FileOps.OPEN_WITH_ITEM_SELECTED);if(c.length!==1){return false}c=c[0];a=parseInt(c.readAttribute("name",10));if(a!==-1){e=FileOps._find_app_by_id(a);if(e==null){return Modal.hide(d)}}else{a=null;e=null}g=Modal.vars.extensions[0];b=$("make-default").checked;if(b){if(e!=null){Browse.app_prefs[g]=e.landing}else{delete Browse.app_prefs[g]}new Ajax.DBRequest("/set_open_with_pref",{parameters:{app_id:a,ext:g},onSuccess:function(h){},onFailure:function(h){}})}if(e!=null){FileOps.do_open_with(e,Modal.vars.files)}else{assert(Modal.vars.files.length===1,"App should not be null if there are more than one file, Dropbox handler can only handle one");Browse.dropbox_open_file(Modal.vars.files[0],true)}return Modal.hide(d)},render_open_with_dialog:function(d,b,m){var g,a,o,f,p,j,h,n,c,k;try{a=Util.from_json(d).apps}catch(l){a=[]}if(b.length===1){o={app_id:-1,name:"Dropbox",description:"",landing:"",icon_url:"/static/images/favicon.ico"};a.unshift(o)}if(!a.length){f=ungettext("No apps available for this file!","No apps available for these files",b.length);Notify.server_error(f);return}$("open-with-app-list").__date();for(j=0,n=a.length;j<n;j++){g=a[j];$("open-with-app-list").__sert(HTML.tmpl("open_with_app_tmpl",{app:g}))}k=$$(".open-with-app-list-li");for(h=0,c=k.length;h<c;h++){p=k[h];p.observe("click",FileOps.open_with_select)}return Modal.icon_show("page_white_go_32",_("Open With..."),$("open-with"),{apps:a,action:FileOps.close_open_with,files:b,extensions:m})},file_extension:function(a){return a.split(".").last()},filename:function(c,b){var a;if(b==null){b=_("Dropbox")}c=Util.normalize(c);c=c.split("/");a=c.pop();if(a===""){return b}else{return a}},dir_handler:function(d,c){var b,a;if(typeof c==="string"){c=$(c)}b=$$(".treeview .highlight")[0];if(b){b.removeClassName("highlight")}a=c.up("div");a.addClassName("highlight");Modal.selected_div=a;if(Modal.shown()){c.blur()}document.fire("db:dir_click",{path:d});return Modal.vars.selected_path=d},show_folder_pick:function(h,f,e,g,a){var b,d,c;DomUtil.fillVal(FileOps.filename(f).escapeHTML(),"folder-pick-file");TreeView.move("copy-move-treeview","folder-pick-treeview");TreeView.enable_shared("copy-move-treeview");c=(a?"page_white_go_32":"page_white_copy_32");b=(a?_("Move"):_("Copy"));DomUtil.fillVal(b,"folder-pick-action-text");Modal.icon_show(c,h,$("folder-pick"),{fq_path:f,action:e,folder:g});d=$("first-treeview-link");return d.onclick()},show_bulk_folder_pick:function(h,e,a,f){var b,j,c,g,d;d=BrowseUtil.profile_files(a);j=BrowseUtil.profile_summary(d);DomUtil.fillVal(j,"bulk-folder-pick-file");TreeView.move("copy-move-treeview","bulk-folder-pick-treeview");TreeView.enable_shared("copy-move-treeview");g=(e==="move"?"page_white_go_32":"page_white_copy_32");if(e==="move"){b=_("Move")}else{if(e==="copy"){b=_("Copy")}else{b=_("Restore")}}DomUtil.fillVal(b,"bulk-folder-pick-action-text");Modal.icon_show(g,h,$("bulk-folder-pick"),{files:a,action:f});c=$("first-treeview-link");return c.onclick()},show_copy:function(a,b){var c;c=(b?_("Copy folder to..."):_("Copy file to..."));return FileOps.show_folder_pick(c,a,FileOps.do_copy,b,false)},show_dragdrop_confirm:function(a,k,b){var c,h,e,g,d,j;h=FileOps.filename(k)||"Dropbox";j=void 0;d=void 0;c=void 0;g=void 0;e=void 0;if(b){j=ungettext("Move %(item_count)s item","Move %(item_count)s items",a.length).format({item_count:a.length});c="Move";d=ungettext("Are you sure you want to move %(item_count)s item to '%(destination)s'?","Are you sure you want to move %(item_count)s items to '%(destination)s'?",a.length).format({item_count:a.length,destination:h});g="page_white_go_32";e=FileOps.do_bulk_move}else{j=ungettext("Copy %(item_count)s item","Copy %(item_count)s items",a.length).format({item_count:a.length});c="Copy";d=ungettext("Are you sure you want to copy %(item_count)s item to %(destination)s?","Are you sure you want to copy %(item_count)s items to %(destination)s?",a.length).format({item_count:a.length,destination:h});g="page_white_copy_32";e=FileOps.do_bulk_copy}DomUtil.fillVal(c,"dragdrop-folder-pick-action-text");Modal.icon_show(g,j,$("dragdrop-confirm-modal"),{files:a,to:k,action:e});return $("dropdown-confirm-text").__date(d)},show_copy_bulk:function(a){var b;b=ungettext("Copy %(item_count)s item to...","Copy %(item_count)s items to...",a.length).format({item_count:a.length});return FileOps.show_bulk_folder_pick(b,"copy",a,FileOps.do_bulk_copy)},show_move_bulk:function(a){var b;b=ungettext("Move %(item_count)s item to...","Move %(item_count)s items to...",a.length).format({item_count:a.length});return FileOps.show_bulk_folder_pick(b,"move",a,FileOps.do_bulk_move)},show_move:function(a,b){var c;c=(b?_("Move folder to..."):_("Move file to..."));return FileOps.show_folder_pick(c,a,FileOps.do_move,b,true)},show_delete:function(b,c,a){var d,e;DomUtil.fillVal("'"+FileOps.filename(b).escapeHTML()+"'","delete-filename");d=void 0;if(a){d=function(){return FileOps.do_nonbrowse_delete([b])}}else{d=FileOps.do_delete}e=(c?_("Delete folder?"):_("Delete file?"));return Modal.icon_show("delete_32",e,DomUtil.fromElm("delete-file"),{fq_path:b,action:d,folder:c,wit_group:"delete-confirm"})},show_bulk_delete:function(b){var c,a;c=ungettext("%(item_count)s item","%(item_count)s items",b.length).format({item_count:b.length});DomUtil.fillVal(c,"delete-filename");a=ungettext("Delete %(item_count)s item?","Delete %(item_count)s items?",b.length).format({item_count:b.length});return Modal.icon_show("delete_32",a,DomUtil.fromElm("delete-file"),{files:b,action:FileOps.do_bulk_delete,wit_group:"delete-bulk-confirm"})},show_purge:function(a,b){var c;DomUtil.fillVal("'"+FileOps.filename(a).escapeHTML()+"'","purge-filename");c=(b?_("Permanently delete folder?"):_("Permanently delete file?"));return Modal.icon_show("alert_32",c,DomUtil.fromElm("purge-file"),{fq_path:a,action:FileOps.do_purge,folder:b,wit_group:"purge-file-confirm"})},show_bulk_purge:function(b){var c,a;c=ungettext("%(item_count)s item","%(item_count)s items",b.length).format({item_count:b.length});DomUtil.fillVal(c,"purge-filename");a=ungettext("Permanently delete %d item?","Permanently delete %d items?",b.length).format(b.length);return Modal.icon_show("alert_32",a,DomUtil.fromElm("purge-file"),{files:b,action:FileOps.do_bulk_purge,wit_group:"purge-bulk-confirm"})},show_bulk_restore:function(b){var c,a;c=ungettext("%(item_count)s item","%(item_count)s items",b.length).format({item_count:b.length});DomUtil.fillVal(c,"restore-filename");a=ungettext("Restore %d item...","Restore %d items...",b.length).format(b.length);return Modal.icon_show("alert_32",a,DomUtil.fromElm("restore-file"),{files:b,action:FileOps.do_bulk_restore,wit_group:"restore-bulk-confirm"})},show_upload:function(b,f){var h,c,g,e,a,d;b=b||Browse.containing_fq_path();if(!FlashDetect.versionAtLeast(9)){FileOps.show_basic_upload(b);$("enhanced-upload-toggle").hide();return}h=FileOps.filename(b);DomUtil.fillVal("'"+h.escapeHTML()+"'","upload-foldername");DomUtil.fillVal("'"+h.em_snippet(14).escapeHTML()+"'","dnd-upload-foldername");if($("upload-desc").visible()&&CrossDomainUploader.supported()){$("upload-desc").hide();$("dnd-upload-desc").show()}g=_("Upload to '%(folder_name)s'").format({folder_name:h.em_snippet(20)});Modal.icon_show("upload_32",g,DomUtil.fromElm("advanced-upload-modal"),{fq_path:b,action:FileOps.do_upload,wit_group:"advanced-uploader"},false,false,FileQueue.num_files()&&!f);d=[$("modal").down(".basic-link-start"),$("modal").down(".basic-link-running")];for(e=0,a=d.length;e<a;e++){c=d[e];c.observe("click",function(){FileOps.show_basic_upload(Browse.containing_fq_path());return false})}if(!FileQueue.num_files()||f){Upload.init(Util.normalize(b),true)}else{Upload.set_dest(Util.normalize(b))}return InlineUploadStatus.hide()},show_basic_upload:function(a){var c,b;c=FileOps.filename(a);DomUtil.fillVal("'"+c.escapeHTML()+"'","basic-upload-foldername");b=_("Upload to '%(folder_name)s'").format({folder_name:c.em_snippet(20)});Modal.icon_show("upload_32",b,$("basic-upload-modal"),{},false);$("modal").down(".enhanced-link").observe("click",function(){FileOps.show_upload(Browse.containing_fq_path(),1);return false});Upload.set_dest(Util.normalize(a));return Upload.init_basic()},show_undelete:function(a){var b,c,d;DomUtil.fillVal(a.filename.escapeHTML(),"undelete-filename");b=Sprite.make("web",a.icon,{});b.addClassName("link-img");b.style.backgroundColor="transparent";c="/revisions"+Util.urlquote(a.real_path)+"?undelete=1";$$(".undelete-icon").invoke("update",b);$$(".undelete-other-versions")[0].href=c;$$(".undelete-link")[0].href=c;$("undelete-form").action="/revisions"+Util.urlquote(a.real_path);d=_("Restore file?");return Modal.icon_show("alert_32",d,$("undelete-modal"),{file:a})},show_open_with:function(a){var b,f,h,k,c,g,e,d,j;h={};g=false;for(d=0,j=a.length;d<j;d++){c=a[d];if(c.dir){b="/";g=true}else{b=c.get_extension()}h[b]=(h[b]||0)+1}k=[];e=[];for(b in h){k.push(b);e.push(_(b))}f='"'+e.join('", "')+'"';DomUtil.fillVal(f,"open-with-ext");if(k.length!==1||g){$("open-with-prefs").setStyle("display: none")}else{$("open-with-prefs").setStyle("display: inline");$("make-default").checked=false}return new Ajax.DBRequest("/openwithlist",{parameters:{extensions:Util.to_json(k)},onSuccess:function(l){return FileOps.render_open_with_dialog(l.responseText,a,k)}})},do_undelete:function(f){var c,b,d,a;b=Modal.vars.file;d=$("undelete-form");a=_("Restored '%(file_name)s'").format({file_name:b.filename});c=_("Error, unable to restore '%(file_name)s'").format({file_name:b.filename});Forms.ajax_submit(d,false,(function(){Modal.hide();Notify.server_success(a);return document.fire(FileEvents.RESTORE,{files:[b]})}),(function(){return Notify.server_error(c)}),f.target);return false},do_copy:function(c,b){var a;c=c||Modal.vars.fq_path;b=b||Modal.vars.selected_path;a=Browse.find_file(c);assert(a,"Trying to copy a file we couldn't find.");return FileOps.do_bulk_copy([a],b)},do_bulk_copy:function(f,b){var d,e,c,g,a;Browse.pre_action_selection=BrowseSelection.get_selected_fq_paths();f=f||Modal.vars.files;assert(f.length>0,"Tried to copy 0 files");if(typeof b==="undefined"){if(typeof Modal.vars.selected_path==="undefined"){Notify.server_error(_("You need to select a destination for the file."));return}else{b=Modal.vars.selected_path}}b=Util.normalize(b);c=0;for(g=0,a=f.length;g<a;g++){d=f[g];if(d.dir){if((b+"/").indexOf(d.fq_path+"/")===0){Notify.server_error(_("You cannot copy a folder into itself."));return}}}e=f.pluck("fq_path");Notify.clear_all();return new Ajax.DBRequest("/cmd/copy",{parameters:{files:e,to_path:b},job:true,progress_text:_("Copying..."),onSuccess:function(p){var l,o,h,q,k,m,j,n;l=p.responseText.evalJSON().changesets;o=e.length;q=FileOps.filename(b).em_snippet(NOTIFICATION_SNIPPET_LEN).escapeHTML();k=ungettext("Copied %(count)d item to '<a id=\"reload-link\">%(location)s</a>'.","Copied %(count)d items to '<a id=\"reload-link\">%(location)s</a>'.",o);k=k.format({count:o,location:q});Notify.server_success(k,null,null,l);h=[];n=p.responseText.evalJSON().new_browse_files;for(m=0,j=n.length;m<j;m++){d=n[m];h.push(d.fq_path)}Browse.select_fq_paths=h;$("reload-link").observe("click",function(){return Browse.reload_fqpath(b)});TreeView.schedule_reset();return document.fire(FileEvents.COPY,{files:f,to_fq_path:b})}})},bulk_move_error:function(a,j){var g,d,k,e,l,f,b,c,h;k=Browse.find_file(j);e=BrowseUtil.profile_files(a);c=void 0;f=void 0;h=void 0;if(k){f=k.dir;c=k.fq_path;h=k.target_ns||k.ns_id}else{if(Browse.inside_dir&&Browse.can_get_details_from_fq_path(j)){d=Browse.details_from_fq_path(j);f=true;c=d.fq_path;h=d.ns_id}else{f=true;c=j;h=void 0}}l=a.pluck("fq_path").collect(Util.normalize);if(-1!==l.indexOf(Util.normalize(c))){return _("You cannot copy a folder into itself.")}g=b=function(m){var n;n=Util.parentDir(m.fq_path);return n===(c||"/")};if(a.all(g)){return ungettext("That file already exists in that folder.","Those files already exist in that folder.",a.length)}if(!f){return _("You cannot put files inside one another.")}if(e.target_namespaces>0&&h&&h!==Constants.root_ns){if(e.sandboxes>0){return _("You're not allowed to put an application folder inside a special folder.")}else{if(e.shared_folders>0){return _("You're not allowed to put a shared folder inside a special folder.")}else{return _("You're not allowed to nest special folders.")}}}if(Browse.public_folder_enabled){if(c==="/Public"&&e.target_namespaces>0){return _("You're not allowed to move shared folders to your Public folder.")}}if(e.public_folder>0){return _("You're not allowed to move your Public folder.")}if(e.photos_folder>0){return _("You're not allowed to move your Photos folder.")}if(e.deleted>0&&!Browse.compost){return _("Moving deleted folders or files is not allowed.")}},do_move:function(c,b){var a;c=c||Modal.vars.fq_path;b=b||Modal.vars.selected_path;a=Browse.find_file(c);assert(a,"Trying to move a file we couldn't find.");return FileOps.do_bulk_move([a],b)},do_bulk_move:function(e,f){var c,d,a,b;Browse.pre_action_selection=BrowseSelection.get_selected_fq_paths();e=e||Modal.vars.files;if(!e){return}assert(e.length>0,"Tried to move 0 files");a=f||Modal.vars.selected_path||"";a=Util.normalize(a);c=FileOps.bulk_move_error(e,a);if(c){Notify.server_error(c);return}d=e.pluck("fq_path");Notify.clear_all();b=Browse.compost?"/cmd/restore_move":"/cmd/move";return new Ajax.DBRequest(b,{parameters:{files:d,to_path:a},job:true,progress_text:Browse.compost?_("Restoring..."):_("Moving..."),onSuccess:function(k){var j,h,g,l;if(k.responseText==="dropquest"){window.location.href="/dropquest2012/chapter19";return}j=k.responseText.evalJSON().changesets;h=d.length;g=FileOps.filename(a).em_snippet(NOTIFICATION_SNIPPET_LEN).escapeHTML();if(Browse.compost){l=ungettext("Restored %(count)d item to '<a id=\"reload-link\">%(location)s</a>'.","Restored %(count)d items to '<a id=\"reload-link\">%(location)s</a>'.",h)}else{l=ungettext("Moved %(count)d item to '<a id=\"reload-link\">%(location)s</a>'.","Moved %(count)d items to '<a id=\"reload-link\">%(location)s</a>'.",h)}l=l.format({count:h,location:g});Notify.server_success(l,null,null,j);$("reload-link").observe("click",function(){return Browse.reload_fqpath(a)});TreeView.schedule_reset();return document.fire(FileEvents.MOVE,{files:e,to_fq_path:a})}})},do_rollback:function(a){return new Ajax.DBRequest("/cmd/rollback",{parameters:{ns_to_cs:Util.to_json(a)},job:true,progress_text:_("Undoing..."),onSuccess:function(b){var c;c=_("Undo complete.");Notify.server_success(c);assert(Browse.pre_action_selection instanceof Array,"Expected a selection from before the action to be undone");if(Browse.in_search_mode()){FileSearch.select_fq_paths=Browse.pre_action_selection;FileSearch.force_reload()}else{Browse.select_fq_paths=Browse.pre_action_selection;Browse.force_reload()}return Browse.pre_action_selection=false}})},do_bulk_delete:function(c){var a,b;Browse.pre_action_selection=BrowseSelection.get_selected_fq_paths();c=c||Modal.vars.files;assert(c.length>0,"Tried to delete 0 files");b=(function(){var f,e,d;d=[];for(f=0,e=c.length;f<e;f++){a=c[f];d.push(a.fq_path)}return d})();Notify.clear_all();return new Ajax.DBRequest("/cmd/delete",{parameters:{files:b},job:true,progress_text:_("Deleting..."),onSuccess:function(d){var f,e;e=d.responseText.evalJSON();f=ungettext("Deleted %d item.","Deleted %d items.",b.length).format(b.length);Notify.server_success(f,null,null,e.changesets);TreeView.schedule_reset();Subscriber.set_ns_map(e.ns_map);return document.fire(FileEvents.DELETE,{files:c})}})},do_delete:function(b){var a;a=Browse.find_file(b||Modal.vars.fq_path);assert(a,"Trying to delete a file we couldn't find.");return FileOps.do_bulk_delete([a])},do_nonbrowse_delete:function(a){return new Ajax.DBRequest("/cmd/delete",{parameters:{files:a},onSuccess:function(b){var c;c=ungettext("Deleted %(file_count)s item","Deleted %(file_count)s items",a.length);c=c.format({file_count:a.length});Notify.server_success(success_msg);return document.fire(FileEvents.DELETE,{fq_paths:a})}})},do_purge:function(){var a;a=Browse.find_file(Modal.vars.fq_path);assert(a,"Trying to purge a file we couldn't find.");return FileOps.do_bulk_purge([a])},do_bulk_purge:function(b){var a,c;b=b||Modal.vars.files;assert(b.length>0,"Tried to purge 0 files");a=b.collect(function(d){return d.fq_path});c=ungettext("Permanently deleted %d item","Permanently deleted %d items",a.length).format(a.length);return new Ajax.DBRequest("/cmd/purge",{parameters:{files:a},job:true,progress_text:_("Deleting..."),onSuccess:function(d){Notify.server_success(c);TreeView.schedule_reset();return document.fire(FileEvents.PURGE,{files:b})}})},do_bulk_restore:function(b){var a,c;b=b||Modal.vars.files;assert(b.length>0,"Tried to restore 0 files");a=b.collect(function(d){return d.fq_path});c=ungettext("Restored %d item","Restored %d items",a.length).format(a.length);return new Ajax.DBRequest("/cmd/restore",{parameters:{files:a},job:true,progress_text:_("Restoring..."),onSuccess:function(d){Notify.server_success(c);TreeView.schedule_reset();return document.fire(FileEvents.RESTORE,{files:b})}})},do_upload:function(){$("dest-folder").value=Modal.vars.fq_path;$("upload-form").submit();return frames["upload-frame"].onload=function(a){var b;b=a.target.documentElement.textContent;if(b==="winner!"){Notify.server_success(_("Uploaded file successfully"));return document.fire(FileEvents.UPLOAD,{to_fq_path:Modal.vars.fq_path})}else{return Notify.server_error(_("Upload error, please try again"))}}},do_bulk_download:function(c){var e,b,d,a;e=new Element("form",{action:"https://"+Constants.BLOCK_CLUSTER+"/zip_batch",method:"post"});for(d=0,a=c.length;d<a;d++){b=c[d];Forms.add_vars(e,{files:b.fq_path})}Forms.add_vars(e,{parent_path:Browse.block_hash_param||"/",w:Browse.block_hash});$(document.body).__sert(e);return e.submit()}};ProgressBar={MAGIC:42,make:function(a,b,c){var k,h,j,e,g,d,f;if(b==null){b=300}f=b.toString()+"px";c=(typeof c!=="undefined"?c:"0%");j=new Element("div",{"class":"outer-progress-bar",style:"width: "+f});k=new Element("div",{"class":"inner-progress-bar",id:"pb_"+a,style:"width: "+f});g=new Element("div",{"class":"under-pb progress-bar",style:"width: "+f});e=new Element("div",{style:"display: none","class":"over-pb progress-bar",id:"pb_"+a+"_over"});d=new Element("div",{"class":"pb-percentage",id:"pb_"+a+"_upct",style:"width: "+f});d.update(c);h=new Element("div",{"class":"pb-percentage",id:"pb_"+a+"_opct",style:"width: "+f});h.update(c);g.__sert(d);e.__sert(h);k.__sert(g);k.__sert(e);j.__sert(k);e.progress_width=b;return j},reset:function(a){return ProgressBar.set(a,0)},set:function(e,a,d){var c,b;a=Math.min(a,1);d=(typeof d!=="undefined"&&d!==false?d:Math.floor(a*100).toString()+"%");c=$("pb_"+e+"_over");if(!c){return}b=c.progress_width*a;c.show();c.makeClipping().setStyle({width:b.toString()+"px",backgroundColor:"#348DD3"});$("pb_"+e+"_upct").innerHTML=d;return $("pb_"+e+"_opct").innerHTML=d}};ModalProgress={show:function(c,a){var b;if(!c){return}a=$(a)||$("browse-box")||$("gallery-view-media");b=$("modal-progress-overlay");if(!(a!=null)){b.setStyle({position:"fixed",width:"100%",height:"100%"})}else{b.clonePosition(a)}if(!b.getWidth()){return}$("modal-progress-text").__date(c);$("modal-progress-bar").setOpacity(1);$("modal-progress-bar").__date(ProgressBar.make("modal-progress",150,""));Effect.Appear(b,{to:0.7,duration:0.25});return Effect.Appear("modal-progress-content",{duration:0.25})},update:function(a){var b;if(a.indexOf("/")>0){b=a.split("/");a=Number(b[0])/Number(b[1])}if(a){return ProgressBar.set("modal-progress",a,"")}},hide:function(){Effect.Fade("modal-progress-overlay",{duration:0.25});return Effect.Fade("modal-progress-content",{duration:0.25})}};Job={complete:{},handled:function(a){var b;if(!a){return false}b=!!Job.complete[a];Job.complete[a]=true;return b},peek:function(a){if(!a){return false}return !!Job.complete[a]}};ProgressWatcher={job_info:{},INIT_POLL_INT:1000,FAILS_MEAN_FAIL:3,MODAL_WAIT_MS:1000,watch:function(a){var b;ProgressWatcher.job_info[a.job_id]={};b=ProgressWatcher.job_info[a.job_id];b.req=a;b.poll_int=ProgressWatcher.INIT_POLL_INT;b.poll_count=0;b.int_id=setInterval(ProgressWatcher.update_for(a.job_id),b.poll_int);b.failures=0;return b.start_time=Util.time()},update_for:function(a){return function(){return ProgressWatcher.update(a)}},backoff:function(b){var a;a=ProgressWatcher.job_info[b];clearInterval(a.int_id);a.poll_int=Math.min(Math.floor(a.poll_int*1.5),30000);return a.int_id=setInterval(ProgressWatcher.update_for(b),a.poll_int)},update:function(c){var a,b;b=ProgressWatcher.job_info[c];if(Job.peek(c)){return ProgressWatcher.done(c)}b.poll_count++;if(b.poll_count%10===0){ProgressWatcher.backoff(c)}if(!b.modaled&&Util.time()-b.start_time>ProgressWatcher.MODAL_WAIT_MS){a=b.req.options;ModalProgress.show(a.progress_text,a.cover_this);a.onProgress=ModalProgress.update;if(a.on_modal_shown!=null){a.on_modal_shown()}b.modaled=true}return new Ajax.Request("/job_status/"+c,{method:"post",t:Constants.TOKEN,onSuccess:function(e){var f,d;f=ProgressWatcher.job_info[c];d=e.responseText;if(d.indexOf("err")===0){ProgressWatcher.done(c);ModalProgress.hide();if(f.req.options.onFailure&&!Job.handled(c)){f.req.options.onFailure(e)}return}if(d.indexOf("done")===0){f.req.options.job=false;if(!Job.peek(c)){new Ajax.Request("/job_results/"+c,{onSuccess:function(h){if(Job.handled(c)){return}Notify.clear_if(RequestWatcher.working_msg);if(f.req.options.onSuccess){return f.req.options.onSuccess(h)}},onFailure:function(h){if(Job.handled(c)){return}Notify.clear_if(RequestWatcher.working_msg);if(f.req.options.onFailure){return f.req.options.onFailure(h)}}})}ProgressWatcher.done(c);return ModalProgress.hide()}else{try{if(f.req.options.onProgress){return f.req.options.onProgress(e.responseText)}}catch(g){}}},onFailure:function(d){var e;e=ProgressWatcher.job_info[c];e.failures++;if(e.failures>=ProgressWatcher.FAILS_MEAN_FAIL){if(e.req.options.onFailure){e.req.options.onFailure(d,true)}RequestWatcher.remove(e.req);ProgressWatcher.done(c);return ModalProgress.hide()}}})},done:function(b){var a;a=ProgressWatcher.job_info[b];clearInterval(a.int_id);delete ProgressWatcher.job_info[b];return ModalProgress.hide()}};var Forms,__hasProp={}.hasOwnProperty;Forms={submitOnlyOnce:function(){var a;a=Forms.submitted!==true;Forms.submitted=true;return a},disable:function(a){if(a){return setTimeout((function(){return a.disabled=true}),0)}},enable:function(a){if(a){return setTimeout((function(){return a.disabled=false}),0)}},add_vars:function(c,d){var e,b,a;c=$(c);a=[];for(b in d){if(!__hasProp.call(d,b)){continue}e=new Element("input",{type:"hidden",name:b});e.setValue(d[b]);e.addClassName("added-vars");a.push(c.__sert(e))}return a},clear_added_vars:function(a){return $$("#"+a+" .added-vars").each(Element.remove)},mirror:function(c,b){var a;c=$(c);b=$(b);a=function(e,d){d.setValue($F(e));return d.fire("db:value_change")};if(c&&b){c.observe("keyup",function(){return a(c,b)});c.observe("db:autocompleted",function(){return a(c,b)});b.observe("keyup",function(){return a(b,c)});return b.observe("db:autocompleted",function(){return a(b,c)})}},collect_form_vars:function(d){var g,c,b,f,e,a;d=d||$(document.body);c=d.select("input").concat(d.select("textarea")).concat(d.select("select"));b={};for(e=0,a=c.length;e<a;e++){g=c[e];if(g.name&&g.name!=="t"){f=g.getValue();if(f){if(typeof f!=="string"){f=f.join(",")}if(b[g.name]!=null){if(typeof b[g.name]==="string"){b[g.name]=[b[g.name],f]}else{b[g.name].push(f)}}else{b[g.name]=f}}}}return b},add_loading:function(c,a){var b;if(c){c=$(c);b=new Element("img",{src:"/static/images/icons/ajax-loading-small.gif"});b.addClassName("text-img ajax_submit_loading");if(a==="after"){return c.__sert({after:b})}else{return c.__sert({before:b})}}},remove_loading:function(a){return $$(".ajax_submit_loading").each(function(b){return Util.yank(b)})},ajax_submit:function(c,a,k,b,h,e,j){var l,d,f,m,g;if(c.ajax_submitted){return false}c.ajax_submitted=true;g=c.select(".suggestion-input");for(f=0,m=g.length;f<m;f++){l=g[f];SuggestionInput.blank(l.identify())()}if(h){Forms.add_loading(h,j)}d=Forms.collect_form_vars(c);if(e){Object.extend(d,e)}new Ajax.DBRequest(a||c.action,{noAutonotify:true,parameters:d,evalJSON:false,onSuccess:function(n){if(k&&typeof k==="function"){return k(n)}},onFailure:function(p){var n,o;if(p){if(p.responseText.indexOf("err:")===0){n=p.responseText.substr(4);if(n.indexOf("{")===0){o=n.evalJSON(true);Forms.fill_errors(c,o)}else{Notify.server_error(n)}}else{Notify.server_error()}if(b&&typeof b==="function"){return b(p)}}},onComplete:function(q){var p,o,n;n=c.select(".suggestion-input");for(p=0,o=n.length;p<o;p++){l=n[p];SuggestionInput.blur_elm(l)}c.ajax_submitted=false;return Forms.remove_loading()}});return false},clear_errors:function(a){a=a||$(document.body);SickInput.hide_errors(a);return a.select(".error-removable").invoke("remove")},fill_errors:function(e,d){var b,g,a,c,f;d=d||{};e=e||$(document.body);Forms.clear_errors(e);for(f in d){if(!__hasProp.call(d,f)){continue}g=e.down("[data-error-field-name='"+f+"']")||e.down("[name='"+f+"']");if(g){b=new Element("br",{"class":"error-removable"});a=new Element("span",{"class":"error-message error-removable"});c=d[f];assert(c.message_html||c.message_text,"Error message must have a message_html or message_text property");if(c.message_html){a.update(c.message_html)}else{a.__date(c.message_text)}g.__sert({before:a});g.__sert({before:b})}}return SickInput.show_errors(e)},value:function(d){var c,b,f,e,a;b=$$('input[name="'+d+'"]');f=null;for(e=0,a=b.length;e<a;e++){c=b[e];f=$(c).getValue()||f}return f},postRequest:function(c,d,a){var b;if(d==null){d={}}if(a==null){a={}}assert(c!=null,"postRequest missing action");d.t=Constants.TOKEN;b=new Element("form",{action:c,method:"POST"});if(a.target){b.target=a.target}document.body.appendChild(b);Forms.add_vars(b,d);return b.submit()}};var HOTMAIL_SUFFIXES,Invitations,Referral;HOTMAIL_SUFFIXES=["hotmail.com","msn.com","hotmail.fr","hotmail.it","hotmail.de","hotmail.co.jp","hotmail.co.uk","hotmail.com.ar","hotmail.co.th","hotmail.com.tr","hotmail.es","msnhotmail.com","hotmail.jp","hotmail.se","hotmail.com.br","live.com.ar","live.com.au","live.at","live.be","live.ca","live.cl","live.cn","live.dk","live.fr","live.de","live.hk","live.ie","live.it","live.jp","live.co.kr","live.com.my","live.com.mx","live.nl","live.no","live.ru","live.com.sg","live.co.za","live.se","live.co.uk","live.com","windowslive.com"];Referral={select_all:1,show_login_modal:function(a){return Modal.show(_("Invite contacts from your email address book"),$("cli-login"),a)},get_selected_emails:function(){var a;a=[];$$("#contact-list input").each(function(b){if(b.className==="email"){if(b.checked){return a.push(b.value)}}});return a.join(", ")},get_selected_fb_contacts:function(){var a;a=[];$$("#contact-list input").each(function(b){if(b.className==="fb"){if(b.checked){return a.push(b.value)}}});return a.join(", ")},send_invites:function(a){var b;b=Referral.get_selected_emails();Invitations.do_send(b,false,a,true);return Modal.hide()},show_error:function(a){Referral.hide_captcha();$("contact-info-error").__date(a);return $("contact-info-error").show()},error_messages:[N_("Bad user name or password"),N_("Bad user name"),N_("Bad password"),N_("Captcha challenge was raised"),N_("Captcha challenge raised"),N_("Captcha challenge was issued. Please login through Yahoo mail manually."),N_("AOL requires you to answer some security questions"),N_("Email address has not been verified"),N_("Account closed by system operator"),N_("Account deleted"),N_("Account disabled"),N_("Service disabled"),N_("Authorization required"),N_("Unknown gmail error"),N_("Gmail terms not agreed"),N_("Google contacts service unavailable. Try again later.")],show_captcha:function(a){Referral.hide_captcha();a=a.evalJSON(true);$("captcha-row").hide();$("contact-info-captcha-image").src=a.image.replace("http://","https://");$("contact-info-captcha-image").hide();Element.observe("contact-info-captcha-image","load",function(){return $("contact-info-captcha-image").show()});$("contact-info-captcha-id").value=a.id;$("contact-info-captcha-answer").value="";$("captcha-row").show();$("captcha-answer-row").show();$("contact-info-error").__date(_("Captcha required"));return $("contact-info-error").show()},hide_captcha:function(){$("contact-info-captcha-id").value="";$("contact-info-captcha-answer").value="";$("captcha-row").hide();return $("captcha-answer-row").hide()},parse_contacts:function(a){return a.substr(9)},fetch_contacts:function(b){var c,a,d;Event.stop(b);d=$F("username");c="";if(d.indexOf("@")>0){a=d.split("@");d=a.first();c=a.last()}return Referral.fetch_and_show_contacts(b,d,c,$F("email-password"),$F("contact-info-captcha-id"),$F("contact-info-captcha-answer"))},fetch_and_show_contacts:function(d,f,h,k,a,j){var b,l,c,g;for(c=0,g=HOTMAIL_SUFFIXES.length;c<g;c++){l=HOTMAIL_SUFFIXES[c];if(h===l){Notify.server_error(_("We can't import contacts from "+h+" accounts right now, but we're working on fixing this!"));return}}if(d){Event.stop(d)}$("contact-info-error").hide();Referral.show_loading_modal(h.split(".")[0]);f=(h!==""?f+"@"+h:f);b={email:f,password:k,select_all:(Referral.select_all?1:0)};if(a&&j){Object.extend(b,{captcha_id:a,captcha_answer:j})}return new Ajax.DBRequest("/import_contacts",{noAutonotify:true,parameters:b,onSuccess:function(e){var m;m=Referral.parse_contacts(e.responseText);return Referral.show_select_contacts(m)},onFailure:function(m){var e;if(m.responseText.indexOf("err:")===0){e=m.responseText.substr(4);if(e.indexOf("captcha:")!==0){if(Referral.hide_on_error){Modal.hide()}else{Referral.show_login_modal()}return Referral.show_error(_(e))}else{if(Referral.hide_on_error){Modal.hide()}else{Referral.show_login_modal()}return Referral.show_captcha(e.substr(8))}}else{Referral.show_error(_("Unexpected server error."));if(Referral.hide_on_error){return Modal.hide()}else{return Referral.show_login_modal()}}},cleanUp:function(){return $("modal-title").show()}})},show_loading_modal:function(a){var b;b=["gmail","yahoo","aol","hotmail","live","msn"];if(b.indexOf(a)>-1){$("email-provider-img").src="/static/images/referrals_"+a+".png";$("email-provider-img").show()}else{$("email-provider-img").hide()}Modal.show("Loading contacts",$("loading-contacts-modal"));return $("modal-title").hide()},show_select_contacts:function(k){var e,h,l,j,a,m,g,c,f,d,b;$("contact-list").innerHTML=k;h=$$(".contact-row").length;if(h){SuggestionInput.reset("contact-filter");l=$$("#contact-list img").length;if(l===0){if((d=$("dropbox-users-text"))!=null){d.style.visibility="hidden"}}a=ungettext("Good news! We've found %d contact. Select the contact if you'd like to invite them.","Good news! We've found %d contacts. Select the contacts you'd like to invite.",h).format(h);$("contact-import-msg").__date(a);Referral.contact_rows=$$("#contact-list div");b=Referral.contact_rows;for(c=0,f=b.length;c<f;c++){m=b[c];m.search_text=m.childNodes[1].innerHTML+m.childNodes[2].innerHTML;e=m.down("input");e.observe("click",Referral.checkbox_clicked)}Referral.fresh=true;Referral.update_invite_count()}j=(h?"select-contacts-modal":"no-contacts-modal");g=(h?_("Choose contacts"):_("Oops! No contacts here."));Modal.icon_show("email_32",g,$(j),{action:Referral.action});return Referral.filter_observer=new Form.Element.Observer("contact-filter",0.5,function(n,o){if(!SuggestionInput.defaulted(n)){return Referral.filter(o)}})},checkbox_clicked:function(a){Referral.fresh=false;return Referral.update_invite_count()},update_invite_count:function(b){var f,e,d,a,c;if(!b&&Referral.contact_rows){b=0;c=Referral.contact_rows;for(d=0,a=c.length;d<a;d++){e=c[d];if(e.firstChild.firstChild.checked){b+=1}}}f=ungettext("Invite %d friend","Invite %d friends",b).format(b);return $("select-contacts-submit-button").__date(f)},select_no_contacts:function(){$$(".contact-check input").each(function(a){return a.checked=false});Referral.update_invite_count(0);return false},filter:function(h){var g,f,b,c,e,a,d;if(h===Referral.last_search||(!(Referral.last_search!=null)&&h==="")){return}if(Referral.fresh){Referral.fresh=false;Referral.select_no_contacts()}Referral.last_search=h;b=0;g=new RegExp(RegExp.escape(h.strip()).split(/[;,\s]+/).join(".*"),"i");Referral.contact_container.style.display="none";d=Referral.contact_rows;for(e=0,a=d.length;e<a;e++){f=d[e];c=f.style;if(g.test(f.search_text)){if(b%2===0){c.background="#ffffff"}else{c.background="#f4faff"}c.display="";b+=1}else{c.display="none"}}Referral.update_invite_count();return Referral.contact_container.style.display=""},do_submit:function(a){assert(Referral.action&&typeof Referral.action==="function","Finished with contact list importer but have no callback");return Referral.action(a)},hide:function(b,a){b=$(b);assert(b,"Referral elm doesn't exist");assert(Util.isNumber(a),"Referral id is not a number");Modal.hide();return new Ajax.DBRequest("/account/hide_referral",{parameters:{referral_id:a},onSuccess:function(c){var d;d=b.up("tr");return new Effect.Fade(d)}})}};Invitations={submit:function(a){a=a||window.event;if(a.keyCode===Event.KEY_RETURN){return Invitations.send()}},send:function(b,a){var c;c=$("invite-recip");return Invitations.do_send($F(c),c,b,a)},do_send:function(c,e,b,a){var f,d;f=c.strip().split(/[;,\s]+/).length;if(!f||c===""){Notify.server_error(_("Please enter an e-mail address."));return}if(c!==$("invite-recip").title){d={emails:c,referral_src:b};if(Referral.source){d.source=Referral.source}new Ajax.DBRequest("/send_invite",{parameters:d,onSuccess:function(g){if(Invitations.custom_on_success){Invitations.custom_on_success(g.responseText,a)}else{Notify.server_success(g.responseText.substr(5))}if(Referral.on_success){Referral.on_success(g.responseText)}if(e){return e.setValue("")}},onFailure:function(g){if(g.responseText.startsWith("err:")){return Notify.server_error(g.responseText.substr(4))}else{return Notify.server_error()}},noAutonotify:true})}else{Notify.server_error(_("Please enter an email address."))}return false},addCustomMessage:function(b){var c,a;Event.stop(b);c=(b.target.tagName==="A"?$(b.target):$(b.target).up("a"));c.addHTML=c.innerHTML;c.update(Sprite.make("web","email_delete",{"class":"link-img"}));c.appendChild(document.createTextNode(_("Remove custom message")));c.stopObserving("click");c.observe("click",Invitations.hideCustomMessage);a=new Element("textarea",{title:_("Enter a custom message here"),name:"custom_message","class":"custom-message suggestion-input act_as_block textinput",rows:3,cols:25,style:"margin-top: 0.75em;"});a.setValue(Invitations.custom_message||a.title);SuggestionInput.register(a);c.up().previous("div").__sert({bottom:a});SuggestionInput.register(a);ActAsBlock.resize(a);return false},hideCustomMessage:function(b){var a,c;Event.stop(b);c=(b.target.tagName==="A"?$(b.target):$(b.target).up("a"));c.stopObserving("click");c.observe("click",Invitations.addCustomMessage);c.update(c.addHTML);a=c.up().up().select(".custom-message")[0];Invitations.custom_message=$F(a);a.parentNode.removeChild(a);return false}};var EventBubble,Feed;EventBubble={make:function(b){var a;a='<table class="ebubble">\n  <tr>\n    <td class="tl"></td>\n    <td class="t"></td>\n    <td class="tr"></td>\n  </tr>\n  <tr>\n    <td class="l"></td>\n    <td class="c">\n      <%= content %>\n    </td>\n    <td class="r"></td>\n  </tr>\n  <tr>\n    <td class="bl"></td>\n    <td class="b">\n      <img src="/static/images/events_bubble_tail.gif" alt="" class="events_bubble_tail" />\n    </td>\n    <td class="br"></td>\n  </tr>\n</table>';return HTML.tmpl(a,{content:b})}};Feed={firstTime:true,feedPages:{},page_num:0,ns_id:false,update_pages:function(a){(a&&Feed.page_num?Element.show:Element.hide)("newolddivider");(a?Element.show:Element.hide)("older-events");return(Feed.page_num?Element.show:Element.hide)("newer-events")},older:function(){return Feed.set_url({page_num:(parseInt(Feed.page_num,10)||0)+1})},newer:function(){if(!Feed.page_num){return}return Feed.set_url({page_num:parseInt(Feed.page_num,10)-1})},showLoading:function(h,a,g,f){var c,b,e,d;g=true;e=$("feed-loading");a=$(a);if(!e){e=new Element("div",{id:"feed-loading"});c=new HTML('<table style="height: 100%; width: 100%; background:#fff;">\n  <tr>\n  <td valign="top">\n    <div id="feed-loading-text" style="padding-top: 16px;text-align:center;"></div>\n  </td>\n  </tr>\n</table>');e.__date(c);document.body.appendChild(e)}e.clonePosition(a);if(e.getWidth()===0){return}if(Util.ie){e.style.left=a.getBoundingClientRect().left+"px"}e.setOpacity(0.9);b=$("feed-loading-text");if(h){b.__date()}else{d=new Element("img",{src:"/static/images/icons/ajax-loading.gif",style:"vertical-align: bottom;"});b.__date(d);if(!g){b.__sert(_("Loading..."))}}$("feed-loading").show();if(f){return e.style.zIndex="1001"}},hideLoading:function(){return $("feed-loading").hide()},changeDate:function(a,b){Feed.date=a;Feed.nice_date=Util.niceDate(a);if(!b){return Feed.getPage(0)}},getPage:function(a){var b;a=a||0;Feed.page_num=parseInt(a,10);if(Feed.feedPages[Feed.get_key(a)]){Feed.show(a)}else{Feed.showLoading(false,$("events-content"));b=Feed.ns_id!=null?"&ns_id="+(Feed.ns_id.toString()):"&is_home=yes";new Ajax.DBRequest("/next_events?cur_page="+a+b,{parameters:{date:Feed.nice_date?Feed.nice_date:""},log_timing:true,onSuccess:function(c){Feed.feedPages[Feed.get_key(a)]=new HTML(c.responseText);return Feed.show(a)}})}return false},show:function(a){var b;Feed.hideLoading();$("events-content").__date(Feed.feedPages[Feed.get_key(a)]);b=$("add-comment-button");if(b){return HotButton.register(b)}},url_check:function(b,c,a){var d;c=c||0;b=b||false;d=(Feed.ns_id!==b)||(Feed.page_num!==c)||(Feed.nice_date!==a);Feed.ns_id=b||Feed.ns_id;Feed.page_num=parseInt((c!=null?c:Feed.page_num),10);if(a){Feed.changeDate(new Date(a.gsub("-","/")),true)}if(d){ULSelectMenu.set_selected_by_value($("namespace-list"),Feed.ns_id);if(a){EventDatePicker.change_date(Feed.date)}return Feed.getPage(Feed.page_num)}},set_url:function(c){var b,a,d,e;a=(c.ns_id!=null?c.ns_id:Feed.ns_id);d=(c.page_num!=null?c.page_num:Feed.page_num);b=(c.date!=null?c.date:Feed.nice_date);e={ns:a,n:d,d:b};return DBHistory.push_state("/events",e)},get_key:function(a){return""+Feed.ns_id+"_"+Feed.date+"_"+a+"_"+Feed.nice_date},show_rss_modal:function(){var a,b;a=Feed.ns_id||Constants.root_ns;b=Feed.rss_url;Modal.icon_show("feed_32",_("Subscribe to this RSS feed"),$("rss-modal"));$("rss_url").setValue(b);BrowseActions.addCopyUrlFlash(b);$("copy_success").__date();$("reset-rss-link").writeAttribute("href","/reset_rss/"+a);return $("rss_url").select()}};var DBCalendar,EventDatePicker,TextInputDatePicker,Timezone;Timezone={check_timezone:function(){var a;if(!Constants.uid){return}a=Timezone.get_current_timezone();if(!(Constants.auto_timezone_offset!=null)||Constants.auto_timezone_offset!==a){return Timezone.update(a)}},get_current_timezone:function(){var d,c,a,b;c=new Date();c.setSeconds(0);c.setMilliseconds(0);b=c.toGMTString();d=new Date(b.substring(0,b.lastIndexOf(" ")-1));a=(c-d)/(1000*60*60);return a},update:function(a){assert(typeof a==="number","Timezone offset was not a number: "+a);return new Ajax.DBRequest("/set_timezone",{parameters:{offset:a},noAutonotify:true})},on_change:function(){var a,b;a=[];b=[$("timezone_area"),$("timezone_location"),$("timezone_city")];b.each(function(c){if(c){return a.push($F(c))}});return Timezone.update_form(a)},update_form:function(m){var h,a,n,c,e,j,d,l,b,g,f,k;m=m||["America"];assert(Timezone.tree,"Timezone tree missing...");$("tz").__date();a=["timezone_area","timezone_location","timezone_city"];e=Timezone.tree;b=Math.max(m.length+1,2);for(h=g=0;0<=b?g<b:g>b;h=0<=b?++g:--g){d=m[h];n=Object.keys(e);if(!n.length){break}l=new Element("select",{id:a[h],name:a[h]});l.observe("change",Timezone.on_change);for(f=0,k=n.length;f<k;f++){c=n[f];j=new Element("option");j.value=c;j.update(c);if(c===d){j.selected=true}l.appendChild(j)}$("tz").appendChild(l);e=e[d]}return Util.syncHeight()},auto:function(){var a;a=$F("timezone_auto");if(a){return $("tz").__date()}else{return Timezone.update_form()}},build_tree:function(b){var a;a={};b.each(function(e){var d,c;c=e.split("/");d=a;return c.each(function(f){if(!d[f]){d[f]={}}return d=d[f]})});return Timezone.tree=a}};if(!Constants.is_test){Util.smartLoad(Timezone.check_timezone)}DBCalendar=Class.create({initialize:function(b,a){this.options=a||{};this.container=$(b);assert(this.container,"Couldn't find the element");this.today=new Date();if(this.options.disable_future){this.options.last_day=Util.start_of_day(this.options.last_day||this.today)}if(this.options.disable_past){this.options.first_day=Util.start_of_day(this.options.first_day||this.today)}this.view_date=Util.start_of_day(this.options.selected_date||this.today);this.selected_date=Util.start_of_day(this.options.selected_date||this.today);return this.render()},_change_month:function(b,a){Event.stop(b);this.view_date.setMonth(a);return this.render()},is_valid_date:function(d,f,e,c,a){var b;d=parseInt(d,10);f=parseInt(f,10);e=parseInt(e,10);c=parseInt(c,10);a=parseInt(a,10);c=c||1970;a=a||(new Date()).getFullYear()+1;f+=1;if(e<c){return false}if(e>a){return false}if(f<1||f>12){return false}if(d<=0){return false}if(f===2){b=((e%4)===0)&&(((e%100)!==0)||((e%400)===0));if(b){return d<=29}else{return d<=28}}else{if(f===4||f===6||f===9||f===11){return d<=30}else{return d<=31}}},change_date:function(a,d,b){var c;if(!this.is_valid_date(a,d,b)){return}c=b!==this.view_date.getFullYear()||d!==this.view_date.getMonth();this.selected_date.setDate(a);this.selected_date.setMonth(d);this.selected_date.setFullYear(b);if(c){this.view_date.setMonth(d);this.view_date.setFullYear(b);this.render()}else{this.container.select(".selected").invoke("removeClassName","selected");$$("a#day"+a+"-"+d)[0].addClassName("selected")}if(this.options.onDateChange){return this.options.onDateChange(this.selected_date)}},render:function(){var d,e,a,b,c;e=this.render_days();this._next_month=(function(f){return this._change_month(f,this.view_date.getMonth()+1)}).bind(this);this._prev_month=(function(f){return this._change_month(f,this.view_date.getMonth()-1)}).bind(this);b=new Element("a");b.addClassName("changemonth next");b.update(Sprite.make("web","arrowright",{}));Event.observe(b,"click",this._next_month);c=new Element("a");c.addClassName("changemonth prev");c.update(Sprite.make("web","arrowleft",{}));Event.observe(c,"click",this._prev_month);d=new Element("div");d.addClassName("calendar clearfix");a=new Element("h5");a.update(_("%(month)s %(year)s").format({month:Util.month_name(this.view_date.getMonth()),year:this.view_date.getFullYear()}));d.__sert(b);d.__sert(c);d.__sert(a);d.__sert(e);return this.container.__date(d)},render_days:function(){var h,g,a,f,b,e,d,c;g=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1);d=g.getDay();h=new Element("div");h.addClassName("days");for(a=c=d;d<=0?c<0:c>0;a=d<=0?++c:--c){e=new Date(g.getFullYear(),g.getMonth(),g.getDate());e.setDate(e.getDate()-a);h.__sert(this.render_day(e,true))}f=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1);while(f.getMonth()===this.view_date.getMonth()){h.__sert(this.render_day(f));f=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),f.getDate()+1)}b=new Date(this.view_date.getFullYear(),this.view_date.getMonth()+1,0);while(b.getDay()!==6){b=new Date(b.getFullYear(),b.getMonth(),b.getDate()+1);h.__sert(this.render_day(b,true))}return h},render_day:function(c,d){var b;if(this.options.last_day){d=d||c>this.options.last_day}if(this.options.first_day){d=d||c<this.options.first_day}b=void 0;if(d){b=new Element("span")}else{b=new Element("a")}b.update(c.getDate());b.addClassName("date");b.writeAttribute("id","day"+c.getDate()+"-"+c.getMonth());if(this.selected_date.getDate()===c.getDate()&&this.selected_date.getMonth()===c.getMonth()&&this.selected_date.getFullYear()===c.getFullYear()){b.addClassName("selected")}if(d){b.addClassName("inactive")}else{this._handler=(function(f){var a;a=f.target.identify().substr(3).split("-");return this.change_date(a[0],this.view_date.getMonth(),this.view_date.getFullYear())}).bind(this);Event.observe(b,"click",this._handler)}return b}});EventDatePicker={show_calendar:function(a){var b,c;if(EventDatePicker.shown){return}Event.extend(a).preventDefault();if(!EventDatePicker.calendar){b=new Element("div",{id:"cal_container"});b.observe("click",function(d){return d.preventDefault()});$(document.body).__sert(b);EventDatePicker.calendar=new DBCalendar("cal_container",{onDateChange:function(e){return EventDatePicker.change_date(e,0)},disable_future:true,first_day:EventDatePicker.first_event});b.absolutize();c=$("cal_date");b.clonePosition(c,{setWidth:false,setHeight:false,offsetTop:c.getHeight(),offsetLeft:c.getWidth()-b.down().getWidth()})}$("cal_container").show();$(document.body).observe("click",EventDatePicker.hide_calendar);return EventDatePicker.shown=true},hide_calendar:function(a){if($(a.target).up("#cal_date")){return}Event.stop(a);$("cal_container").hide();$(document.body).stopObserving("click",EventDatePicker.hide_calendar);return EventDatePicker.shown=false},change_date:function(a,b){var c;if(b!=null){Feed.page_num=0}c=$("cur_date_text");c.update(a.localize());return Feed.set_url({date:Util.niceDate(a)})}};TextInputDatePicker=Class.create({initialize:function(d,c){var e,b,a;this.options={include_seconds:true,choose_eod:false};Object.extend(this.options,c||{});this.input=$(d);assert(this.input,"Couldn't find the element "+d.toString());b=new Date();a=(this.input.value?Util.from_mysql_date(this.input.value):false);e=new Date(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate());this.cal_icon=Sprite.make("web","calendar_view_month",{align:"absmiddle"});this.cal_container=new Element("div",{id:"cal_container_"+d,style:"display: none; position: absolute; z-index: 1"});this.calendar=new DBCalendar(this.cal_container,{onDateChange:this.onDateChange.bind(this),last_day:e,selected_date:a});this.input.__sert({after:this.cal_icon});this.cal_icon.observe("click",this.toggle_cal.bindAsEventListener(this));this.cal_container.clonePosition(this.input,{setWidth:false,setHeight:false,offsetTop:this.input.getHeight()+10});return this.cal_icon.__sert({after:this.cal_container})},toggle_cal:function(a){if(a){Event.stop(a)}return this.cal_container.toggle()},hide_cal:function(a){if(a){Event.stop(a)}return this.cal_container.hide()},onDateChange:function(a){if(this.options.choose_eod){a.setTime(Util.start_of_day(a).getTime()+86399999)}this.input.value=Util.to_mysql_date(a,true);return this.hide_cal()}});var AppDirectory,AppReview,Apps;Apps={confirm_disable:function(d,c,b){var e,a;e=(b?_("Are you sure you want to disable '%(app-name)s'?"):_("Are you sure you want to delete '%(app-name)s'?"));DomUtil.fillVal(e.format({"app-name":d.escapeHTML()}),"app-disable-text");Modal.icon_show("application_delete_32",(b?_("Confirm disable"):_("Confirm delete")),$("app-disable-modal"));a="/developers/disable_app/"+c;$("app-disable-modal").down("form").action=a;return $("disable-app-button").setValue((b?_("Disable"):_("Delete")))},enable_app:function(b){var a;a="/developers/enable_app/"+b;return window.location.href=a},show_create:function(){Modal.icon_show("application_add_32",_("Create a new app"),$("create-app"),{});return ActAsBlock.register(false,$("modal-content"))},do_create:function(b){var a;if(b){Event.stop(b)}a=$("create-app-form");assert(a,"Missing form for Apps.do_create");return Forms.ajax_submit(a,false,Apps.on_create,false,b&&b.target)},on_create:function(a){if(a&&a.responseText&&a.responseText!=="ok"){return window.location.href=a.responseText}else{return window.location.reload()}},do_edit:function(b){var a;if(b){Event.stop(b)}a=$("update-app-form");assert(a,"Missing form for Apps.do_edit");return Forms.ajax_submit(a,false,(function(){return window.location.reload()}),false,b&&b.target)},show_about:function(g,f,d,a,c,b){if(g){Event.stop(g)}$$(".app-name")[0].__date(f);$$(".app-description")[0].__date(d);Modal.show(f,$("about-app"),{"force-icon":c});return $("application-link").href=b},show_uninstall:function(f,d,c,a,b){var g;if(f){Event.stop(f)}Modal.vars={token_id:c,delete_row_type:"inst-app",action:"uninstall_app"};g=$("delete-"+a+"-app-confirm");if(b){g.select(".app_folder")[0].__date(b)}else{if(a==="sandbox"){return Apps.do_action()}}g.select(".app_name")[0].__date(d);Modal.icon_show("application_delete_32",_("Remove %(app_name)s?").format({app_name:d.em_snippet(22)}),g,Modal.vars);return null},do_uninstall:function(){new Ajax.DBRequest("/api/uninstall_app",{parameters:{id:Modal.vars.token_id,keep_sandbox_files:$F("keep_sandbox_files")},onSuccess:function(a){Notify.server_success(a.responseText);$("inst-app-"+Modal.vars.token_id+"-row").hide().removeClassName("active_app");if($$(".active_app").length===0){$("applications-table-container").__date(_("You're not using any Dropbox API apps."));return $("applications-explanation").remove()}}});return Modal.hide()},do_action:function(){return new Ajax.DBRequest("/api/"+Modal.vars.action,{parameters:{id:Modal.vars.token_id},onSuccess:function(a){Notify.server_success(a.responseText);if(Modal.vars.delete_row_type){return $(Modal.vars.delete_row_type+"-"+Modal.vars.token_id.toString()+"-row").hide()}else{return window.location.reload()}}})},enable_users_in_dev:function(a){Modal.icon_show("teams",_("Enable additional users"),$("confirm-users-in-dev-modal"),{enable:function(){return new Ajax.DBRequest("/developers/enable_users_in_dev/"+a,{onSuccess:function(b){$("enable-users-in-dev").remove();$("none-linked").show();return Modal.hide()}})}});return false},remove_user:function(c,b,a){new Ajax.DBRequest("/developers/remove_user/"+c+"/"+b,{onSuccess:function(e){var d;d=$(a).up("table");$(a).up("tr").remove();if(d.down("tr").id==="none-linked"){$("none-linked").show();return $("apply-for-more").hide()}}});return false},show_add_key_confirm:function(c,b,a){if(c){Event.stop(c)}$$(".app-name")[0].__date(b);Modal.show(_("Confirm key creation"),$("add-key-confirm"),{app_id:a});return 0},do_add_key:function(a){return new Ajax.DBRequest("/api/create_app_token",{parameters:{id:Modal.vars.app_id},onSuccess:function(b){var c,d;Notify.server_success(_("Key created successfully."));d="<tr id=\"token-#{id}-row\"><td>#{key}</td><td>#{secret}</td><td><a href=\"#\" onclick=\"Apps.show_del_key_confirm(event, '#{key}', '#{secret}', '#{id}');\">"+Sprite.html("web","x")+"</a></td></tr>";c=b.responseText.evalJSON(true);c.id=Number(c.id);c.key=c.key.replace("'","");c.secret=c.secret.replace("'","");d=d.interpolate(c);return $("api-key-last-row").insert({before:d})}})},show_del_key_confirm:function(d,b,a,c){if(d){Event.stop(d)}$$(".token-key")[0].__date(b);$$(".token-secret")[0].__date(a);Modal.show(_("Confirm key removal"),$("del-key-confirm"),{token_id:c});return 0},do_del_key:function(a){return new Ajax.DBRequest("/api/delete_app_token",{parameters:{id:Modal.vars.token_id},onSuccess:function(c){var b;Notify.server_success(_("Key removed successfully."));b=c.responseText.evalJSON(true);return $("token-"+b.id+"-row").hide()}})},restore_sandbox:function(b,a){var d,c;d=$("restore-sandbox");Modal.icon_show("folder_app_32",_("Restore app folder '%(filename)s'").format({filename:FileOps.filename(b).em_snippet(17)}),d);c=$("restore-sandbox-form");return Forms.add_vars(c,{ns_id:a})},submit_restore_sandbox:function(b){var a;Event.stop(b);a=$("restore-sandbox-form");Forms.ajax_submit(a,false,(function(c){Modal.hide();Notify.server_success(_("Restored app folder"));if(c.responseText.length){return Browse.reload_fqpath(c.responseText)}else{return Browse.reload("","",true)}}),false,b.target);return false},developer_support:function(){var a;a=$("dev-support-modal");return Modal.icon_show("alert_32",_("Dropbox developer support"),a)},submit_developer_support:function(b){var a;a=$("dev-support-form");assert(a,"Form is missing in submit_developer_support");return Forms.ajax_submit(a,false,(function(){Modal.hide();return Notify.server_success(_("Thanks for your help request.  We'll get back to you soon."))}),false,b&&b.target)},submit_app_info:function(c,a){var b;try{b=$("update-app-form");return Forms.ajax_submit(b,"/developers/app_info/%s".format(a),(function(d){return b.submit()}),false,c&&c.target)}finally{return false}},delete_screenshot:function(a,b,c){return new Ajax.DBRequest("/developers/delete_screenshot/%s".format(b),{parameters:{screenshot_id:c},onSuccess:function(d){return Effect.Fade(a)}})},add_screenshot_form:function(){var a;a=new Element("input",{type:"file",name:"screenshots"});return $("screenshots-container").appendChild(a)},show_need_users_modal:function(a){Event.stop(a);Modal.icon_show("alert_32",_("Please test this app"),$("app-need-users-modal"));return false},show_name_branding_modal:function(a){Event.stop(a);Modal.icon_show("alert_32",_("Please rename this app"),$("app-name-branding-modal"));return false}};AppDirectory={click:function(a){a=Object.toQueryString(a);AppDirectory.get_page(a);return HashRouter._set_hash(a)},get_page:function(a){Feed.showLoading(true,"list-content");return new Ajax.Request("/apps/list?"+a,{onSuccess:function(b){return $("list-content").update(b.responseText)},onComplete:function(){return Feed.hideLoading()}})},hash_change:function(b){var a;a=b.memo.hash;return AppDirectory.get_page(a)},platform_change:function(){var b,a;b=Object.clone(AppDirectory.filter_state);a=[];$$(".platform input").each(function(c){if(c.checked){return a.push(c.value)}});b.page=0;b.platform=a.join(",");return AppDirectory.click(b)},set_order:function(a){var b;b=Object.clone(AppDirectory.filter_state);b.order_by=a;b.page=0;return AppDirectory.click(b)},set_page:function(a){var b;b=Object.clone(AppDirectory.filter_state);b.page=a;return AppDirectory.click(b)}};AppReview={page:0,get_page:function(a,b){Feed.showLoading(true,$("reviews").down("div"));return new Ajax.Request("/apps/reviews",{parameters:{page:b,app_id:a},onSuccess:function(c){AppReview.update(c.responseText);AppReview.page=parseInt(b,10);HashRouter.set_hash("review",a,b.toString());return $("reviews").scrollTo()},onComplete:function(){return Feed.hideLoading()}})},update:function(a){return $("reviews").update(a)},check_hash:function(a,b){b=b||0;b=parseInt(b,10);if(b!==AppReview.page){return AppReview.get_page(a,b)}},add_review:function(c,a){var b;Event.stop(c);b=$("app-review-form");return Forms.ajax_submit(b,false,(function(d){AppReview.get_page(a,0);return b.down("textarea").setValue("")}),false,c.target)}};var FacebookOAuth,Twitter;Twitter={get_progress_container:function(){var a;assert(Twitter.progress_container,"Twitter is missing progress_container");a=$(Twitter.progress_container);assert(a,"Missing progress_container elm");return a},follow_dropbox:function(a){var b;if(a.showWorking){a.showWorking()}b=function(){if(a.onFailure){return a.onFailure()}else{return window.location.reload()}};return new Ajax.DBRequest("/twitter/follow_us",{onSuccess:function(c){if(!c.responseText.startsWith("ok")){return b()}else{if(a.onSuccess){return a.onSuccess()}}},onFailure:function(){return b()}})},do_auth:function(a){window.open("/twitter/request_token","twitter_auth","width=800,height=400");if(a){return Twitter.onLoginSuccessCallback=a}},show_auth:function(a){if(a){Twitter.onLoginSuccessCallback=a}return DomUtil.updateFromElm(Twitter.get_progress_container(),"inline-twitter-auth")},show_posting:function(){if(Twitter.should_hide_modal()){Modal.hide()}return Twitter.get_progress_container().update(DomUtil.fromElm("sharing-progress"))},show_complete:function(b){var a;a=Twitter.get_progress_container();a.update(DomUtil.fromElm("sharing-posted"));return Twitter.show_complete_into(b,a)},show_complete_into:function(g,a){var d,e,c,f,b;d="twitter";f=_("View tweet");b=void 0;if(g.startsWith("ok")){b="http://www.twitter.com/"}else{b=g}e=a.down("#view-post");e.href=b;e.update(f);c=Sprite.make("web",d);return e.__sert({top:c})},post:function(c,e,b){var d,a;assert(c,"Twitter message is empty");d={message:c,from_referrals:Twitter.from_referrals,from_getspace:Twitter.from_getspace};new Ajax.DBRequest("/twitter_post",{parameters:d,onSuccess:function(f){var g,h;if(f.responseText==="login"){Twitter.onLoginSuccessCallback=function(){return Twitter.post(c)};g=Twitter.custom_show_auth||Twitter.show_auth;return g()}else{if(Twitter.should_hide_modal()){Modal.hide()}h=Twitter.onPostSuccessCallback||Twitter.show_complete;return h(f.responseText)}}});a=Twitter.custom_show_posting||Twitter.show_posting;return a()},custom_post:function(a,b){if(b){Twitter.onPostSuccessCallback=b}if(!a){return}assert(a,"Twitter message doesn't exist");if(!Constants.uid){return window.open("http://www.twitter.com/home?status="+encodeURI(a))}else{return Twitter.post(a)}},get_user_info:function(a){return new Ajax.DBRequest("/twitter/user_info",{parameters:{},onSuccess:function(b){return a(Util.from_json(b.responseText))}})},should_hide_modal:function(){if(typeof Twitter.hide_modal==="undefined"){return true}else{return Twitter.hide_modal}}};FacebookOAuth={get_progress_container:function(){var a;assert(FacebookOAuth.progress_container,"Facebook is missing progress_container");a=$(FacebookOAuth.progress_container);assert(a,"Missing progress_container elm");return a},do_auth:function(a){window.open("/fb/access_token","fb_auth","width=600,height=450");if(a){return FacebookOAuth.onLoginSuccessCallback=a}},show_posting:function(){Modal.hide();return FacebookOAuth.get_progress_container().update(DomUtil.fromElm("sharing-progress"))},show_auth:function(a){if(a){FacebookOAuth.onLoginSuccessCallback=a}return DomUtil.updateFromElm(FacebookOAuth.get_progress_container(),"inline-facebook-auth")},show_complete:function(){var a,d,e,c,f,b;a=FacebookOAuth.get_progress_container();a.update(DomUtil.fromElm("sharing-posted"));d="facebook";f="View Post";b="http://www.facebook.com/profile.php?v=wall";e=a.down("#view-post");e.href=b;e.update(f);c=Sprite.make("web",d);return e.__sert({top:c})},post:function(e,d,c,b,f){var a;if(!Constants.uid){window.open("http://www.facebook.com/sharer.php?u="+encodeURI(d)+"&t="+encodeURI(c));return}a=FacebookOAuth.custom_show_posting||FacebookOAuth.show_posting;a();return new Ajax.DBRequest("/fb/post",{parameters:{message:e,link:d,link_name:c,description:b,from_referrals:FacebookOAuth.from_referrals,from_getspace:FacebookOAuth.from_getspace,picture:(f?f:"")},onSuccess:function(g){var h;if(g.responseText.startsWith("ok")){h=FacebookOAuth.custom_show_complete||FacebookOAuth.show_complete;return h()}else{if(g.responseText.startsWith("auth")){return do_auth(function(){return FacebookOAuth.post(e,d,c,b)})}}}})}};var Scroll;Scroll={SCROLL_OFFSET:100,_get_cursor:null,_getting_more:false,_more_endpoint:null,_get_more_params:null,_render_more:null,_paused:true,_more:true,init:function(a,b,c,e,d){this.SCROLL_OFFSET=a;this._more_endpoint=b;this._get_more_params=c;this._render_more=e;this._get_cursor=d;this._paused=false;return this._more=true},listen:function(){return Event.observe(window,"scroll",this._window_scroll)},pause:function(){return this._paused=true},_window_scroll:function(){var c,b,a;if(Scroll._more){a=Util.scroll_offsets().top;b=Util.viewport_dimensions().height;c=document.body.getHeight();if(a+b+Scroll.SCROLL_OFFSET>=c){return Scroll._get_more()}}},_get_more:function(){var a,b;if(Scroll._getting_more||Scroll._paused){return}Scroll._getting_more=true;if((b=$("more-loading"))!=null){b.show()}a={cursor:Scroll._get_cursor()};Object.extend(a,Scroll._get_more_params);return new Ajax.DBRequest(Scroll._more_endpoint,{method:"POST",parameters:a,onSuccess:function(d){var e,c;if((c=$("more-loading"))!=null){c.hide()}e=Util.from_json(d.responseText);Scroll._more=e.more;Scroll._render_more(e);return Scroll._getting_more=false}})}};var DocPreview,FilePreviewBase,FilePreviewModal,JWPlayerError,PhotoPreview,VideoPreview,fp_vid_player,fp_vid_player_error,fp_vid_player_loading,fp_vid_thumbnail_hidden,playerReady,player_error_handler,render_video_error;FilePreviewBase=Class.create({initialize:function(a,d,c,b,e){this.fq_path=d;this.filename=a;this.thumbnail_url_tmpl=c;this.dl_url=b;return this.display_time=e||null},preload:function(){},render:function(){},activate:function(){},image_size:function(){var a;a=document.viewport.getDimensions();return Util.dimensions_to_imagesize(a.width,a.height)},actions:function(){return[]},global_actions:function(c){var e,d,b,f,a;b=this.actions();d=new Element("a",{id:"lightbox_download_link",href:this.dl_url,"class":"title_bubble white",title:_("Download")});d.__date(Sprite.make("web","download_arrow_white"));e=new Element("a",{href:"#",id:"lightbox_delete_link","class":"title_bubble white",title:_("Delete")}).__date(Sprite.make("web","white-trash"));e.observe("click",function(g){g.preventDefault();return FilePreviewModal.toggle_delete()});if(Constants.can_shmodel){f=new Element("a",{id:"lightbox_shmodel_link","class":"title_bubble white"});if(this instanceof PhotoPreview){f.writeAttribute("title",_("Share link to photo"))}else{if(this instanceof VideoPreview){f.writeAttribute("title",_("Share link to video"))}else{if(this instanceof DocPreview){f.writeAttribute("title",_("Share link to document"))}else{assert(false,"preview needs to be a photo or video")}}}f.__date(Sprite.make("web","link_white"));if(this.shmodel_link){f.writeAttribute("href",this.shmodel_link)}else{f.writeAttribute("href","#");a=(function(g){g.preventDefault();return Forms.postRequest("/sm/create"+Util.urlquote(this.fq_path),{},{target:"_blank"})}).bind(this);f.observe("click",a)}b=b.concat([f,d])}else{b=b.concat([d])}if(c.include_delete){b.push(e)}return b}});PhotoPreview=Class.create(FilePreviewBase,{initialize:function($super,a,e,c,b,d,f,g){$super(a,e,c,b,f);this.original_url=d;this.fail_image_src="/static/images/preview_fail.png";this.shmodel_link=g;if(this.is_gif()){this.thumbnail_url_tmpl=d}return this.loaded=false},show_fail:function(b){var a;a=new Element("div").__sert(_("Unable to preview this item."));return b.__sert(a)},fallback:function(b){var a,c;a=$(b.target);a.writeAttribute({src:this.fail_image_src,width:128,height:128});c=a.up("div.content-item");if(c){return this.show_fail(c)}},is_gif:function(){return"gif"===FileOps.file_extension(this.filename).toLowerCase()},preload:function(c){var b,a;a=Util.add_qstring(this.thumbnail_url_tmpl,{size:this.image_size()});if(this.is_gif()){a=this.thumbnail_url_tmpl}Util.preload_image(a,this.fallback.bind(this),c);b=$(Util.preloaded_images[a]);b.writeAttribute("class","thumbnail");return b},render:function(c){var b,d,a,e;if(this.loaded){c()}b=this.preload(c);e=new Element("div").__sert(b);d=b.getAttribute("src").length;a=b.getAttribute("src").substring(d-this.fail_image_src.length,d);if(a===this.fail_image_src){this.show_fail(e)}return e},actions:function(b){var a;a=new Element("a",{id:"view_original",href:this.original_url,"class":"title_bubble white",title:_("View original"),target:"_blank"});a.__date(Sprite.make("web","fullscreen"));return[a]},advance_on_click:true});fp_vid_player=null;fp_vid_player_loading=null;fp_vid_player_error=null;fp_vid_thumbnail_hidden=null;render_video_error=function(b,d){var a,c;b.down("div.video-player").remove();a=new Element("img",{src:"/static/images/preview_fail.png","class":"video-preview-fail"});c=new Element("div",{"class":"video-preview-fail"});if(d==="no_flash"){c.__sert(_("Please enable Flash to preview this video."))}else{c.__sert(_("Unable to preview this item."))}if(!fp_vid_thumbnail_hidden){a.hide();c.hide()}b.__sert(a);return b.__sert(c)};JWPlayerError="db:jwplayer:error";player_error_handler=function(b){var a;document.fire(JWPlayerError,b);fp_vid_player_error=true;a=fp_vid_player.up("div.content-item");if(a){fp_vid_player=null;return render_video_error(a,b.message)}};playerReady=function(a){fp_vid_player_loading=null;fp_vid_player=document.getElementById(a.id);fp_vid_player.addModelListener("error","player_error_handler");fp_vid_player.sendEvent("play","true");return fp_vid_player.sendEvent("play","false")};VideoPreview=Class.create(FilePreviewBase,{initialize:function($super,a,e,d,b,c,f,g){$super(a,e,d,c,f);this.preview_url=b;this.thumbnail_div=null;return this.shmodel_link=g},preload:function(c){var g,b,f,d,a,e;if(this.preloaded){return}a=Util.add_qstring(this.thumbnail_url_tmpl,{size:this.image_size()});g=function(h){return $(h.target).writeAttribute("src",Sprite.SPACER)};Util.preload_image(a,g,c);b=Util.get_preloaded_image(a);b.writeAttribute("class","thumbnail");d=new Element("img");d.writeAttribute("src","/static/images/playbutton2.png");d.setStyle({position:"absolute",top:"50%",left:"50%",marginTop:"-58px",marginLeft:"-58px"});f=new Element("img",{"class":"video-player-loading"});f.writeAttribute("src","/static/images/bigspinner.gif");f.setStyle({position:"absolute",top:"50%",left:"50%",marginTop:"-16px",marginLeft:"-16px",display:"none"});e=new Element("div",{"class":"video_thumbnail"});e.__sert(d);e.__sert(f);e.__sert(b);this.thumbnail_div=e;return this.preloaded=true},render:function(a){var e,c,d,b;this.preload(a);fp_vid_player_loading=true;fp_vid_player_error=null;fp_vid_thumbnail_hidden=false;this.rendered_div=null;b=new Element("div",{"class":"video-player"});d=this.image_size().split("x")[0]*0.8;c=false;if(FlashDetect.installed){Util.embed_flash_video.defer(this.preview_url,b,d,0)}else{c=true}b.setStyle({position:"absolute",left:"-5000px"});e=new Element("div");e.__sert(this.thumbnail_div);e.__sert(b);this.rendered_div=e;if(c){fp_vid_player_loading=false;fp_vid_player_error=true;render_video_error(e,"no_flash")}this.preloaded=false;return e},play_video:function(){if(fp_vid_player_loading||!this.rendered_div){if(this.rendered_div){this.thumbnail_div.down("img.video-player-loading").show()}return setTimeout(this.play_video.bind(this),100)}else{if(!fp_vid_thumbnail_hidden){this.thumbnail_div.remove();fp_vid_thumbnail_hidden=true;if(fp_vid_player_error){this.rendered_div.down("img.video-preview-fail").show();return this.rendered_div.down("div.video-preview-fail").show()}else{this.rendered_div.down("div.video-player").setStyle({position:"absolute",top:"50%",left:"50%",marginTop:-fp_vid_player.getHeight()/2+"px",marginLeft:-fp_vid_player.getWidth()/2+"px"});fp_vid_player.sendEvent("play","true");return $(fp_vid_player).observe("click",function(a){return Event.stop(a)})}}}},show_or_play_pause:function(){if(fp_vid_thumbnail_hidden){if(fp_vid_player){return fp_vid_player.sendEvent("play")}}else{return this.play_video()}},activate:function(){return this.show_or_play_pause()}});DocPreview=Class.create(FilePreviewBase,{initialize:function($super,a,d,c,b,f,h,g,e){$super(a,d,null,c,null);this.path=d;this.original_url=b;this.fail_image_src="/static/images/preview_fail.png";this.shmodel_link=e;this.preview_type=f;this.code_class=h;return this.htmlified_link=g},show_fail:function(b){var a;a=new Element("div").__sert(_("Unable to preview this item."));return b.__sert(a)},render:function(){var c,d,j,e,n,f,o,m,b,l,h,k,a,g=this;o=$("file-preview-modal");o.addClassName("doc-preview");if(this.htmlified_link){o.addClassName("doc-preview-markdown")}else{o.addClassName("doc-preview-"+this.preview_type)}c=new Element("div");$$("html").first().addClassName("no-scroll");m=new Element("div",{id:"doc-title"});m.__sert(this.filename);o.down(".preview-container").__sert({top:m});e=new Element("div",{id:"code-loading"});e.__sert(new Element("img",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:"","class":"text-img"}));e.__sert(_("Loading..."));c.__sert(e);if(this.preview_type==="text"&&!this.htmlified_link){a=new Element("div",{id:"code-wrapper"});a.__sert(new Element("pre",{id:"code","class":this.code_class||"plain-text"}));c.__sert(a);c.__sert(new Element("img",{"class":"thumbnail"}));window.addEventListener("message",function(p){if(p.data==="syntax.js"){FilePreview.init_text(g.original_url,true);return window._syntax_js_loaded=true}});if(!window._syntax_js_loaded){Util.async_load_script("/static/javascript/external/syntax.js");Util.async_load_css("/static/css/syntax.css")}else{FilePreview.init_text(this.original_url,true)}}else{if(this.htmlified_link){b=this.htmlified_link}else{b=this.original_url;b+="&disable_range=1&convert_doc_to_pdf=1"}if(Prototype.Browser.Gecko&&!this.htmlified_link){j="/static/javascript/external/pdf-js";k=""+j+"/pdf.js";if(!window.PDFJS||!window.PDFView){Util.async_load_script(k);Util.async_load_script(""+j+"/compatibility.js");Util.async_load_script(""+j+"/viewer.js");Util.async_load_css("/static/css/pdfjs.css")}l=new Element("div",{id:"viewerContainer"});l.__date(new Element("div",{id:"viewer"}));f=new Element("div",{id:"loadingBox",style:"display: none"});f.__sert(new Element("div",{id:"loading"}));n=new Element("div",{id:"loadingBar"});n.__date(new Element("div",{"class":"progress"}));f.__sert(n);c.__sert(l);c.__sert(f);h=function(){if(!window.PDFJS||!window.PDFView){window.setTimeout(h,100);return}if(!PDFView.initialized){PDFView.initialize()}PDFJS.workerSrc=k;return PDFView.open(b,0)};h()}else{d=new Element("iframe",{src:b});c.__sert(d);c.firstChild.observe("load",function(){return $("code-loading").remove()});d.observe("load",function(){return $("code-loading").remove()})}c.__sert(new Element("img",{"class":"thumbnail"}))}o.observe("click",FilePreviewModal.back);$$(".preview-content").first().observe("click",function(p){return p.stopPropagation()});$("doc-title").observe("click",function(p){return p.stopPropagation()});return c},actions:function(b){var a;a=new Element("a",{id:"view_original",href:this.original_url,"class":"title_bubble white",title:_("View original"),target:"_blank"});a.__date(Sprite.make("web","fullscreen"));return[a]},advance_on_click:false});FilePreviewModal=(function(){var l,j,K,C,e,d,a,z,p,x,J,w,F,E,u,N,g,H,G,c,I,v,f,q,r,A,k,y,M,D,h,n,b,m,B,s,t,o,L;K=[];l=0;C=false;s=void 0;d="lightbox";a=/^\d+\-\d+\-\d+\s+\d+\.\d+\.\d+/;e=false;I=void 0;F=void 0;B=-1;g=function(O){return O.complete!==false};b=function(){var O;if($$("#file-preview-modal .loading-image").length){return}O=new Element("img",{"class":"loading-image",src:"/static/images/icons/ajax-loader-black.gif"});return $$("#file-preview-modal .preview-content").first().__sert(O)};u=function(){return $$("#file-preview-modal .loading-image").invoke("remove")};r=function(){var U,S,Q,O,R,P;S=$$("#file-preview-modal .content-item").first().down("img.thumbnail");if(!S||!g(S)){return}O=$$("#file-preview-modal .preview").first().getDimensions();U=void 0;if(!S.naturalHeight){U=S.getDimensions();S.naturalHeight=U.height;S.naturalWidth=U.width}else{U={width:S.naturalWidth,height:S.naturalHeight}}Q=U.width/O.width;P=U.height/O.height;R=Math.max(Q,P);S.style.visibility="";if(R<1){S.style.width="";return S.style.height=""}else{S.style.width=Math.floor(U.width/R)+"px";return S.style.height=Math.floor(U.height/R)+"px"}};z=void 0;w=void 0;G=function(){var Q,P,O,S,R;P=0;Q=1.5;O=$("file-preview-modal");R=O.down(".menu");S=O.down(".header");return z=new Effect.Parallel([new Effect.Opacity(R,{sync:true,to:P}),new Effect.Opacity(S,{sync:true,to:P})],{duration:Q})};m=function(){var O;if(w){clearTimeout(w)}if(z){z.cancel()}O=$("file-preview-modal");O.down(".header").setOpacity(1);return O.down(".menu").setOpacity(1)};A=function(P){var O;m();O=P&&$(P.target).descendantOf("file-preview-menu");if(!e&&!O){return w=setTimeout(G,3112)}};N=function(P){var O;O=K.length;return(O+(l+P)%O)%O};v=function(P){var O,Q;if(I.no_preload){return}O=h.bind(null,P);return typeof(Q=K[P]).preload==="function"?Q.preload(O):void 0};f=function(){var Q,S,P,R,O;R=[1,2,3,4,5,6,-1,-2];O=[];for(S=0,P=R.length;S<P;S++){Q=R[S];if(Math.abs(Q)<K.length){O.push(v(N(Q)))}else{O.push(void 0)}}return O};n=function(){TitleBubble.hide_all();$$("#file-preview-modal .delete-file-prompt").first().show();$("lightbox-delete-photo").focus();m();return e=true};E=function(){if(e){$$("#file-preview-modal .delete-file-prompt").first().hide();A();e=false;return document.activeElement.blur()}};t=function(){return(e?E:n)()};k=function(O){if(!I.filename_in_url){return}if(O!=null){return HashRouter.replace_hash("f",O)}else{return HashRouter.replace_hash("")}};y=function(Q){var U,W,P,R,O,S,V;B=Util.time();UserActivityLogger.log("web","file_view",Object.toJSON({mode:"lightbox"}));fp_vid_player=null;assert(l<K.length,"Invalid index "+l);S=K[l];O=Q?D:h;W=S.render(O);W.addClassName("content-item");R=$("file-preview-modal");V=R.down(".preview-content");V.__date(W);k(S.filename);R.down(".current_index").__date(l+1);R.down(".total").__date(I.num_previews||K.length);if(S.display_time){if(S.filename.match(a)){R.down(".filename").__date(S.display_time)}else{R.down(".filename").__date(S.filename.snippet(20)+" - "+S.display_time)}}else{R.down(".filename").__date(S.filename.snippet(40))}R.down(".filename").writeAttribute("title",S.filename);if(K.length===1){R.down(".prev").hide();R.down(".next").hide()}else{if(l===0&&I.no_wrap){R.down(".prev").hide();R.down(".next").show()}else{if(l===K.length-1&&I.no_wrap){R.down(".prev").show();R.down(".next").hide()}else{R.down(".prev").show();R.down(".next").show()}}}U=S.global_actions(I);P=document.createDocumentFragment();U.each(function(X){return P.appendChild(X)});R.down(".actions").__date();R.down(".actions").appendChild(P);document.fire(FilePreviewModal.ACTIONS_ADDED);if(Photos.in_single_collection_view()){R.down(".album-name").show().__date(Photos.get_current_collection().name.em_snippet(15,1));R.down(".filename").addClassName("faded");if(I.include_delete){$("lightbox-delete-photo").setAttribute("value",_("Remove from album"));$("lightbox_delete_link").setAttribute("title",_("Remove from album"))}}else{R.down(".album-name").hide();R.down(".filename").removeClassName("faded");if(I.include_delete){$("lightbox-delete-photo").setAttribute("value",_("Delete"));$("lightbox_delete_link").setAttribute("title",_("Delete"))}}W=W.down("img.thumbnail");if(!g(W)){W.hide();b();W.observe("load",function(){u();W.style.visibility="hidden";W.show();return r()})}else{W.show();r()}return document.fire(FilePreviewModal.PHOTO_CHANGE_EVT,S)};M=function(Q){var O,P;if(B===-1){return}P=Util.time()-B;O={current_view:typeof PhotosLogger!=="undefined"&&PhotosLogger!==null?PhotosLogger.get_current_view():"not_photos"};WebTimingLogger.log_ajax_transition(P,Q,O);B=-1;return f()};D=function(){return M("file-preview-lightbox-load-initial")};h=function(O){var P;if(typeof O==="number"){if((P=K[O])!=null){P.loaded=true}if(O===l){return M("file-preview-lightbox-load")}}else{return M("file-preview-lightbox-load")}};c=function(O){if(I.no_actions){return}if(O){O.stop()}if(l===K.length-1&&I.no_wrap){return}l=N(1);if(l===0){A()}return y()};q=function(O){if(I.no_actions){return}if(O){O.stop()}if(l===0&&I.no_wrap){return}l=N(-1);return y()};x=function(O){if(I.no_actions){return}if(O){O.stop()}if(e){return E()}else{if(K[l].advance_on_click){return c()}else{return K[l].activate()}}};J=function(V){var R,Q,U,W,S,P,O;if(I.no_actions){return}R=K.dict_by("fq_path");W=void 0;if(V.memo.files){W=V.memo.files.collect(function(X){return X.fq_path})}else{W=V.memo.fq_paths}O=[];for(S=0,P=W.length;S<P;S++){U=W[S];if(R[U]){Q=K.indexOf(R[U]);K.splice(Q,1);if(I.num_previews){I.num_previews--}if(!I.num_previews&&!K.length){O.push(F())}else{if(Q===K.length){O.push(q())}else{O.push(y())}}}else{O.push(void 0)}}return O};o=function(){Event.stopObserving(document,"mousemove",A);Event.stopObserving(document,"click",A);document.stopObserving(FileEvents.DELETE,J);return clearInterval(s)};F=function(R){var P,Q,O,U,S;if(R){R.preventDefault()}if(!FilePreviewModal.shown){return}P=$("file-preview-modal");P.hide();if(fp_vid_player&&fp_vid_player.sendEvent){fp_vid_player.sendEvent("stop")}P.down(".preview-content").__date();if((Q=$("doc-title"))!=null){Q.remove()}$$("html").first().removeClassName("no-scroll");document.body.removeClassName("full_no_overflow");P.removeClassName("doc-preview");P.removeClassName("doc-preview-"+K[l].preview_type);P.removeClassName("doc-preview-markdown");o();k();FilePreviewModal.shown=0;P.stopObserving("click",FilePreviewModal.back);if((O=$$(".preview-content"))!=null){if((U=O.first())!=null){U.stopObserving("click")}}if((S=$("doc-title"))!=null){S.stopObserving("click")}if(FilePreviewModal.reload){Browse.force_reload()}if(Tutorial.should_handle_event(Tutorial.events.browse_hide_lightbox)){return Tutorial.handle_event(Tutorial.events.browse_hide_lightbox)}};j="db:filepreview:exitselect";p=function(O){if(I.keep_url){F()}else{window.history.go(-1)}Event.extend(O).stop();return document.fire(j,K[l])};H=function(){var O;if(!C){O=$("file-preview-modal");O.on("click",".close",p);key("esc",d,function(P){return(e?E:p)(P)});O.on("click",".next",c);O.on("click",".prev",q);O.on("click",".preview-container",x);key("left, k",d,function(P){return q()});key("right, j",d,function(P){c();return false});key("up, down",d,function(P){return false});key("space",d,function(P){x(P);return false});if(I.include_delete){key("delete, command+backspace, backspace",d,function(P){Event.extend(P).preventDefault();return FilePreviewModal.toggle_delete()})}$("lightbox-delete-photo").observe("click",function(P){if(Photos.in_single_collection_view()){return document.fire(FilePreviewModal.PHOTO_REMOVE_FROM_ALBUM_EVT,K[l])}else{return document.fire(FilePreviewModal.PHOTO_DELETE_EVT,K[l])}});$("lightbox-delete-cancel").observe("click",function(){return E()});DBHistory.add_exit_callback("/lightbox",function(){return F()});if(!I.allow_text_selection){Util.disableSelection(O.down(".preview-container"));Util.disableSelection(O.down(".header"))}document.observe(FilePreviewModal.PHOTO_CHANGE_EVT,E);C=true}Event.observe(document,"mousemove",A);Event.observe(document,"click",A);document.observe(FileEvents.DELETE,J);key.setScope(d);return s=setInterval(r,500)};L=function(){return on_script_loaded(function(){return HashRouter.watch("f",function(O){var R,S,V,U,Q,P;R=decodeURIComponent(O);P=[];for(S=U=0,Q=K.length;U<Q;S=++U){V=K[S];if(V.filename.toLowerCase()===R.toLowerCase()){l=S;if(!FilePreviewModal.shown){P.push(FilePreviewModal.show())}else{P.push(y())}}else{P.push(void 0)}}return P})})};return{init:function(O,P){if(FilePreviewModal.shown){return}P=P||{};I={include_delete:P.include_delete||false,keep_url:P.keep_url||false,num_previews:P.num_previews||null,filename_in_url:P.filename_in_url||false,no_wrap:P.no_wrap||false,no_preload:P.no_preload||false,no_actions:P.no_actions||false,allow_text_selection:P.allow_text_selection||false};assert(!I.filename_in_url||I.keep_url,"filename_in_url cannot be used with keep_url off");K=O;if(P.start_index!=null){FilePreviewModal.show(P.start_index)}if(I.filename_in_url){return L()}},show:function(O){var P;if(FilePreviewModal.shown){return}assert(K&&K.length,"FilePreviewModal.show() requires file preview objects to show");H();if(O!=null){l=O}assert(!FilePreviewModal.shown,"Trying to reshow file preview modal");$("file-preview-modal").show();$(document.body).addClassName("full_no_overflow");y(true);FilePreviewModal.shown=1;if(!I.keep_url){P=DBHistory.deconstruct_url(DBHistory.get_url());DBHistory.push_state("/lightbox"+P.path,P.qargs)}return A()},jump_to:function(O){assert(FilePreviewModal.shown,"Lightbox should be showing");l=O;y();return A()},set_no_wrap:function(O){return I.no_wrap=O},toggle_delete:t,back:p,PHOTO_CHANGE_EVT:"db:lightbox:photo_change",PHOTO_DELETE_EVT:"db:lightbox:photo_delete",PHOTO_REMOVE_FROM_ALBUM_EVT:"db:lightbox:photo_remove_from_album",ACTIONS_ADDED:"db:lightbox:actions_added",EXIT_SELECT_EVT:j,reload:false}})();var Tour;Tour=(function(){var d,c,f,g,l,j,k,h,e,m,b,a;c=6;d=0;b=function(n){var w,v,u,p,o,q,s,t,r;$$(".page-end").each(Element.remove);o=n;s=c-n-1;w=document.createDocumentFragment();for(v=t=0;0<=o?t<o:t>o;v=0<=o?++t:--t){p=new Element("img",{src:"/static/images/page-left.png","class":"page-end-left page-end"});p.style.left=(28-v*5)+"px";p.style.zIndex=c-v;w.appendChild(p)}for(u=r=0;0<=s?r<s:r>s;u=0<=s?++r:--r){q=new Element("img",{src:"/static/images/page-right.png","class":"page-end-right page-end"});q.style.right=(31-u*5)+"px";q.style.zIndex=c-u;w.appendChild(q)}return $("book").appendChild(w)};a=function(n){(n>0?Element.show:Element.hide)("tour-page-back");return(n+1<c?Element.show:Element.hide)("tour-page-forward")};e=function(n){$$(".pages").invoke("hide");return $("page-"+n).show()};f=function(n){a(n);b(n);e(n);return d=n};h=function(o){var n;Event.extend(o).preventDefault();n=d-1;if(n<0){return}f(n);return DBHistory.push_state("/tour/"+n)};j=function(o){var n;Event.extend(o).preventDefault();n=d+1;if(n>=c){return}f(n);return DBHistory.push_state("/tour/"+n)};m=function(o,p){var n;o.preventDefault();n=parseInt(p.href.split("/").last(),10);f(n);return DBHistory.push_state("/tour/"+n)};l=function(){$("tour-page-back").observe("click",h);$("tour-page-forward").observe("click",j);key("right",j);key("left",h);return $("toc").on("click","a",m)};g=function(o,p){var n;n=parseInt(o,10)||0;return f(n)};k=function(){var r,q,o,p,n;p=$$(".page-right img");n=[];for(q=0,o=p.length;q<o;q++){r=p[q];n.push(Util.preload_image(r.src))}return n};return{setup:function(){return Util.smartLoad(function(){DBHistory.add_callback("/tour",g);l();return k()})}}})();var CameraUploads;CameraUploads={SIZE_Q:"?size=cu_154",THUMBS_PER_ROW:5,SCROLL_OFFSET:2000,LIGHTBOX_OFFSET:30,POST_SCROLL_WAIT:100,POST_SCROLL_MAX_WAIT:300,DUPLICATES_SNIPPET_LENGTH:30,PHOTO_FILTER:"photos",VIDEO_FILTER:"videos",LOADING_SPINNER:new HTML('<div class="cu-loading"><img src="/static/images/icons/ajax-loading-small.gif" /></div>'),THUMBS_BATCH_SIZE:15,MAX_URL_LENGTH:4000,_photos:[],_key_to_photos:{},_preview_objs:[],_num_total:null,_selected_index:-1,_cursor:null,_current_filter:null,_last_scroll_timeout:null,_start_scroll_time:-1,_prev_date:null,_getting_more:false,_tmpl:null,_cu_duplicate_tmpl:null,_flow:false,_more_endpoint:"",_count_endpoint:"",_batch_thumb_endpoints:[],_batch_thumb_endpoint_index:0,_uniqueness_key_to_index_of_photo_in_event:{},_photo_grid:{},init:function(g,c,f,d,b,e,a){if(e){CameraUploads._more_endpoint="/more_pm";CameraUploads._count_endpoint="/pm_count"}else{CameraUploads._more_endpoint="/more_cu";CameraUploads._count_endpoint="/cu_count"}CameraUploads._batch_thumb_endpoints=a;CameraUploads._flow=b;if(b){CameraUploads.SIZE_Q="?size=l"}return on_script_loaded(function(){CameraUploads._tmpl=HTML.tmpl("cu_list_item_tmpl");CameraUploads._cu_duplicate_tmpl=HTML.tmpl("cu_duplicate_list_item_tmpl");if(c){CameraUploads._cursor=f}else{CameraUploads._cursor=null}if(d===CameraUploads.PHOTO_FILTER||d===CameraUploads.VIDEO_FILTER){CameraUploads._set_filter(d)}if(!HTML5_HISTORY&&!Util.url_hash()){DBHistory.push_state("/camera",{})}CameraUploads._render(g);CameraUploads._listen();return CameraUploads._get_num_total()})},_listen:function(){$(document.body).on("click",".cu-thumb",CameraUploads._thumb_click);document.observe(FilePreviewModal.PHOTO_CHANGE_EVT,CameraUploads._lightbox_event);document.observe(FilePreviewModal.PHOTO_DELETE_EVT,CameraUploads._lightbox_delete);document.observe(FilePreviewModal.EXIT_SELECT_EVT,CameraUploads._lightbox_exit);document.observe(FileEvents.DELETE,CameraUploads._remove);Event.observe(window,"scroll",CameraUploads._window_scroll);DBHistory.add_callback("/camera",CameraUploads._history_change_handler);return document.on("click",".filter-option",function(c,b){var a;c.preventDefault();a=b.readAttribute("data-filter");return CameraUploads._filter(a)})},_render:function(f){var d,b,a,e,c;if(!f.length){a=void 0;if(CameraUploads._current_filter===CameraUploads.PHOTO_FILTER){a=_("photos")}else{if(CameraUploads._current_filter===CameraUploads.VIDEO_FILTER){a=_("videos")}else{a=_("photos or videos")}}DomUtil.fillVal(a,"file-types");$("cu-empty").show();return}b=[];c=void 0;d=void 0;e=void 0;CameraUploads._update_key_to_photos(f);if(CameraUploads._prev_date){c=CameraUploads._prev_date}else{c=new Date(f[0].time_taken);b.push(CameraUploads._generate_month_header(c))}f.each(function(g){e=CameraUploads._get_newest(g.uniqueness_key);if(CameraUploads._photos.indexOf(e)===-1){d=new Date(e.time_taken);if(d.getMonth()!==c.getMonth()||d.getFullYear()!==c.getFullYear()){b.push(CameraUploads._generate_month_header(d))}b.push(CameraUploads._tmpl({photo:e,display_date:Util.niceDateWithMonthName(d,d.getFullYear()<new Date().getFullYear()),shareable:false}));CameraUploads._photos.push(e);CameraUploads._preview_objs.push(CameraUploads._get_preview_obj(e));return c=d}});CameraUploads._prev_date=c;if(CameraUploads._cursor){b.push(CameraUploads.LOADING_SPINNER)}$("photos-list").__sert(b);CameraUploads._update_grid();if(CameraUploads._num_total){CameraUploads._set_lightbox_wrap()}CameraUploads._load_visible_thumbs();if(CameraUploads._flow){return $$(".cu-thumb").each(function(g){return g.setStyle({width:"auto"})})}},_update_grid:function(){var b,n,a,r,j,f,m,o,q,l,k,g,e,p,h,d,c;a=$("photos-list").childElements();q=$$(".cu-thumb");l=q.first().getLayout().get("margin-box-height");o=$$(".cu-month-header").first().getLayout().get("margin-box-height");r=q.first().cumulativeOffset();k=r.top;m=r.left;b=0;j=void 0;CameraUploads._photo_grid.thumb_height=l;CameraUploads._photo_grid.height_to_photo={};CameraUploads._photo_grid.photo_heights=[];CameraUploads._photo_grid.left_offsets=[];for(j=g=0,h=CameraUploads.THUMBS_PER_ROW;0<=h?g<=h:g>=h;j=0<=h?++g:--g){CameraUploads._photo_grid.left_offsets.push(m+l*j)}CameraUploads._photo_grid.height_to_photo[k]=null;CameraUploads._photo_grid.photo_heights.push(k);f=-1;d=a.slice(1);c=[];for(e=0,p=d.length;e<p;e++){n=d[e];if(n.hasClassName("cu-month-header")){b=0;k+=o;CameraUploads._photo_grid.height_to_photo[k]=null;CameraUploads._photo_grid.photo_heights.push(k);f=-1}else{if(n.hasClassName("cu-thumb")){f++;this._uniqueness_key_to_index_of_photo_in_event[n.id]=f;if(b===0){k+=l;b++;CameraUploads._photo_grid.height_to_photo[k]={uniqueness_key:n.id,num_photos:1};CameraUploads._photo_grid.photo_heights.push(k)}else{b++;CameraUploads._photo_grid.height_to_photo[k].num_photos++;if(b>=CameraUploads.THUMBS_PER_ROW){b=0}}}}c.push(j++)}return c},_reset:function(){CameraUploads._photos=[];CameraUploads._key_to_photos={};CameraUploads._preview_objs=[];CameraUploads._num_total=null;CameraUploads._cursor=null;CameraUploads._set_filter(null);CameraUploads._last_scroll_timeout=null;CameraUploads._start_scroll_time=-1;CameraUploads._prev_date=null;CameraUploads._getting_more=false;$("photos-list").__date();return $("cu-empty").hide()},_get_thumb_elm_for_photo:function(a){return $(a.uniqueness_key)},_get_photo_for_thumb_elm:function(a){if(!a.hasClassName("cu-thumb")){a=a.up(".cu-thumb")}if(a){return CameraUploads._get_newest(a.identify())}else{return null}},_update_key_to_photos:function(a){return a.each(function(b){if(CameraUploads._key_to_photos[b.uniqueness_key]){return CameraUploads._key_to_photos[b.uniqueness_key].push(b)}else{return CameraUploads._key_to_photos[b.uniqueness_key]=[b]}})},_get_newest:function(c){var f,g,b,e,a,d;g=CameraUploads._key_to_photos[c];if(g.length===0){}else{if(g.length===1){return g[0]}else{b=g[0];d=g.slice(1);for(e=0,a=d.length;e<a;e++){f=d[e];if(f.mtime>b.mtime){b=f}}return b}}},_thumb_click:function(c){var b,a;a=CameraUploads._get_photo_for_thumb_elm($(c.target));CameraUploads._preview(CameraUploads._photos.indexOf(a));b={timeline_photo_index:CameraUploads._photos.indexOf(a),event_photo_index:CameraUploads._uniqueness_key_to_index_of_photo_in_event[a.uniqueness_key]};return PhotosLogger.log_interaction(PhotosEvents.OPEN_LIGHTBOX,"camera_uploads_page_click",b)},_preview:function(a){if(CameraUploads._num_total){return FilePreviewModal.show(a)}else{return setTimeout((function(){return CameraUploads._preview(a)}),100)}},_get_num_total:function(){return new Ajax.DBRequest(CameraUploads._count_endpoint,{parameters:{filter:CameraUploads._current_filter},onSuccess:function(a){CameraUploads._num_total=a.responseText;FilePreviewModal.init(CameraUploads._preview_objs,{include_delete:true,num_previews:CameraUploads._num_total});return CameraUploads._set_lightbox_wrap()}})},_set_lightbox_wrap:function(){if(CameraUploads._cursor){return FilePreviewModal.set_no_wrap(true)}else{return FilePreviewModal.set_no_wrap(false)}},_window_scroll:function(){var d,a,c,b;a=new Date().getTime();if(CameraUploads._start_scroll_time===-1||a-CameraUploads._start_scroll_time<CameraUploads.POST_SCROLL_MAX_WAIT){clearTimeout(CameraUploads._last_scroll_timeout)}if(CameraUploads._start_scroll_time===-1){CameraUploads._start_scroll_time=a}CameraUploads._last_scroll_timeout=setTimeout(CameraUploads._load_visible_thumbs,CameraUploads.POST_SCROLL_WAIT);if(CameraUploads._cursor){b=Util.scroll_offsets().top;c=Util.viewport_dimensions().height;d=document.body.getHeight();if(b+c+CameraUploads.SCROLL_OFFSET>=d){return CameraUploads._get_more()}}},_load_visible_thumbs:function(r){var l,q,p,b,m,o,n,k,c,s,g,f,h,a,v,u,d,t,j;CameraUploads._start_scroll_time=-1;if(!CameraUploads._photos.length){return}h=$$(".cu-thumb");u=Util.scroll_offsets().top;v=Util.viewport_dimensions().height;m=void 0;c=void 0;o=void 0;s=void 0;p=void 0;k=void 0;j=CameraUploads._photo_grid.photo_heights;for(d=0,t=j.length;d<t;d++){n=j[d];q=CameraUploads._photo_grid.height_to_photo[n];if(q!==null){a=h.indexOf($(q.uniqueness_key));if(n>u-v&&n<u){if(!(m!=null)){m=a}c=a+q.num_photos-1}else{if(n>u&&n<u+v){if(!(o!=null)){o=a}s=a+q.num_photos-1}else{if(n>u+v&&n<u+3*v){if(!(p!=null)){p=a}k=a+q.num_photos-1}}}}}f=Util.calc_thumb_prep_size();g=function(e){return function(){return h[e].addClassName("thumb-loaded")}};l=[];b=true;[[o,s],[p,k],[m,c]].each(function(A){var y,x,z,e,B,w;w=[];for(y=z=e=A[0],B=A[1];e<=B?z<=B:z>=B;y=e<=B?++z:--z){x=h[y].down("img");if(Prototype.BrowserFeatures.DB_CORS&&CameraUploads._batch_thumb_endpoints.length){l.push({elt:x,callback:g(y)});if(l.length===CameraUploads.THUMBS_BATCH_SIZE){CameraUploads._batch_load_thumbs(l,b);l=[];w.push(b=false)}else{w.push(void 0)}}else{w.push(Util.thumb_load(x,f,g(y)))}}return w});if(l.length){return CameraUploads._batch_load_thumbs(l)}},_lightbox_event:function(a){CameraUploads._selected_index=CameraUploads._preview_objs.indexOf(a.memo);if(CameraUploads._cursor&&CameraUploads._selected_index>CameraUploads._preview_objs.length-CameraUploads.LIGHTBOX_OFFSET){return CameraUploads._get_more()}},_lightbox_delete:function(a){var d,c,b;d=CameraUploads._preview_objs.indexOf(a.memo);c=CameraUploads._photos[d];b=CameraUploads._key_to_photos[c.uniqueness_key];assert(b.length,"No key_to_photos entry for cu photo");if(b.length===1){return FileOps.do_nonbrowse_delete([c.path])}else{return CameraUploads._show_duplicates_delete_modal(b)}},_lightbox_exit:function(a){return key.setScope("all")},_history_change_handler:function(b,c){var a;a=c.filter;if(a===CameraUploads.PHOTO_FILTER||a===CameraUploads.VIDEO_FILTER){if(a!==CameraUploads._current_filter){CameraUploads._reset();CameraUploads._set_filter(a);CameraUploads._get_more()}}else{if(CameraUploads._current_filter){CameraUploads._reset();CameraUploads._set_filter(null);CameraUploads._get_more()}}if(CameraUploads._selected_index>-1){CameraUploads._scroll_to_thumb(CameraUploads._selected_index);return CameraUploads._selected_index=-1}},_show_duplicates_delete_modal:function(d){var c,b,a;d.sort(function(f,e){return e.mtime-f.mtime});b=$("cu-duplicate-files");a=[];c=void 0;d.each(function(e){c="Dropbox"+Util.normalize(Util.parentDir(e.path));return a.push(CameraUploads._cu_duplicate_tmpl({thumbnail_url:e.thumbnail_url,filename_snippet:e.filename.em_snippet(CameraUploads.DUPLICATES_SNIPPET_LENGTH),path_snippet:c.em_snippet(CameraUploads.DUPLICATES_SNIPPET_LENGTH,0),path_href:Photos._get_browse_link(e)}))});b.__date(a);if(d.length>=5){b.addClassName("scroll")}else{b.removeClassName("scroll")}FilePreviewModal.toggle_delete();return Modal.icon_show("delete_32",_("Delete all copies of this file?"),$("cu-delete-modal"),{photos:d})},delete_all_duplicates:function(){var a;a=Modal.vars.photos.collect(function(b){return b.path});return FileOps.do_nonbrowse_delete(a)},_remove:function(b){var d,a,c;c=b.memo.fq_paths;if(c.length===1){a=c[0];d=false;if(Modal.vars.photos){Modal.vars.photos.each(function(e){if(e.path===a){CameraUploads._remove_photo_with_duplicates(e);return d=true}})}if(!d){return CameraUploads._remove_photo(a)}}else{return c.each(function(e){return CameraUploads._remove_photo(e)})}},_remove_photo:function(f){var c,b,e,a,d;d=CameraUploads._photos;for(c=e=0,a=d.length;e<a;c=++e){b=d[c];if(b.path===f){CameraUploads._photos.splice(c,1);$$(".cu-thumb")[c].remove();return}}},_remove_photo_with_duplicates:function(a){var e,c,d,b;e=CameraUploads._key_to_photos[a.uniqueness_key];e.removeItem(a);assert(e.length,"Photo has no duplicates");c=CameraUploads._photos.indexOf(a);if(c!==-1){d=CameraUploads._get_newest(a.uniqueness_key);b=new HTML('<img src="'+d.thumbnail_url+CameraUploads.SIZE_Q+'" class="cu-thumb" />');CameraUploads._photos[c]=d;$$(".cu-thumb")[c].__sert({after:b});$$(".cu-thumb")[c].remove();CameraUploads._preview_objs.splice(c,0,CameraUploads._get_preview_obj(d));if(CameraUploads._preview_objs.length===CameraUploads._photos.length){return FilePreviewModal.jump_to(c)}else{return FilePreviewModal.jump_to(c+1)}}},_set_filter:function(b){var a;CameraUploads._current_filter=b;a=void 0;if(b===CameraUploads.PHOTO_FILTER){a=_("Photos only")}else{if(b===CameraUploads.VIDEO_FILTER){a=_("Videos only")}else{a=_("Photos and videos")}}return $$(".current-filter")[0].__date(a)},_filter:function(b){var a;a=DBHistory.deconstruct_url();if(b===CameraUploads.PHOTO_FILTER||b===CameraUploads.VIDEO_FILTER){a.qargs.filter=b}else{delete a.qargs.filter}return DBHistory.push_state(a.path,a.qargs)},_get_more:function(){if(CameraUploads._getting_more){return}CameraUploads._getting_more=true;return new Ajax.DBRequest(CameraUploads._more_endpoint,{parameters:{cursor:CameraUploads._cursor,filter:CameraUploads._current_filter},onSuccess:function(a){var b;if($$(".cu-loading")){$$(".cu-loading").invoke("remove")}b=Util.from_json(a.responseText);if(b.more){CameraUploads._cursor=b.cursor}else{CameraUploads._cursor=null}CameraUploads._render(b.photos);CameraUploads._getting_more=false;if(!CameraUploads._num_total){return CameraUploads._get_num_total()}}})},_batch_load_thumbs:function(a,b){var g,f,e,h,d,c;f=[];e=[];a.each(function(j){var k;if(j.elt.hasAttribute("data-src")){k=j.elt.readAttribute("data-src");k=k.replace(/https?:\/\/[^\/]+\//,"/");f.push(k);return e.push({elt:j.elt,callback:j.callback})}});if(!f.length){return}g=CameraUploads._batch_thumb_endpoints[CameraUploads._batch_thumb_endpoint_index];CameraUploads._batch_thumb_endpoint_index=(CameraUploads._batch_thumb_endpoint_index+1)%CameraUploads._batch_thumb_endpoints.length;c=g+CameraUploads.SIZE_Q+encodeURIComponent(Util.to_json(f));h=(c.length<CameraUploads.MAX_URL_LENGTH?"get":"post");d=function(k){var j;j=k.responseText.split("\n");if(j.length<2){return}j.splice(j.length-1);return e.each(function(n,l){var m;if(j.length>l&&n.elt.hasAttribute("data-src")){if(((m=j[l])!=null?m.indexOf("data:image"):void 0)===0){n.elt.writeAttribute("src",j[l]);n.elt.removeAttribute("data-src");return n.callback()}}})};return new Ajax.DBRequest(g+CameraUploads.SIZE_Q,{method:h,parameters:{image_urls:Util.to_json(f)},log_timing:b,withCredentials:true,onInteractive:d,onSuccess:d})},_get_preview_obj:function(a){if(a.preview_type==="photo"&&a.thumbnail_url){return new PhotoPreview(a.filename,a.path,a.thumbnail_url,a.href+"&dl=1",a.href,a.display_time_taken)}else{if(a.preview_type==="video"&&a.thumbnail_url&&!Constants.DISABLE_VIDEOS_IN_LIGHTBOX){return new VideoPreview(a.filename,a.path,a.thumbnail_url,"https://"+Constants.LIVE_TRANSCODE_SERVER+"/transcode_video/w/"+a.block_hash+(Util.urlquote(a.path)),a.href+"&dl=1",a.display_time_taken)}}return null},_generate_month_header:function(a){return new HTML('<h1 class="cu-month-header">'+_("%(month)s %(year)s").format({month:Util.month_name(a.getMonth()),year:a.getFullYear()})+"</h1>")},_scroll_to_thumb:function(b){var a;a=$$(".cu-thumb")[b];if(!a){return}Util.scroll_to_thumb(a);return CameraUploads._load_visible_thumbs()},reflow:function(){var g,c,n,p,q,d,m,b,a,f,l,k,o,e,h;n=800;g=10;c=150;f=$$(".cu-thumb");p=[];d=0;q=void 0;h=[];for(l=0,o=f.length;l<o;l++){q=f[l];if(d+q.width+g>n){if(d-n<q.width/2){p.push(q);d+=q.width+g;b=c*(n-g*p.length)/(d-g*p.length)-1;m=0;for(k=0,e=p.length;k<e;k++){a=p[k];a.setStyle({height:b+"px"})}p=[];h.push(d=0)}else{CameraUploads._adjust_row_height(p,d);p=[q];h.push(d=q.width+g)}}else{p.push(q);h.push(d+=q.width+g)}}return h}};var Photos,PhotosUtil;Photos={SIZE_Q:"?size=cu_154",THUMB_SIZE:158,HEADER_HEIGHT:51,THUMBS_PER_ROW:5,LIGHTBOX_OFFSET:25,DUPLICATES_SNIPPET_LENGTH:30,KEY_SCOPE:"photos",PHOTO_TYPE:"photos",VIDEO_TYPE:"videos",NUM_PHOTOS_LONG_RUNNING_DELETES:100,_all_photos_timeline:null,_single_collection_timeline:null,_last_lightbox_index:-1,_current_filters:{},_current_collection_gid:null,_in_all_collections_view:false,_tmpl:null,_cu_duplicate_tmpl:null,_batch_thumb_endpoints:[],_creating_filetags:false,_creating_filetags_cb:null,_is_all_photos:false,init:function(j,b,g,c,l,e,h,d,a,f){var k=this;PhotosCollections.init(h,d);PhotosSelection.drag_select_enabled=f;return on_script_loaded(function(){var m;k.disable_selection();Util.disable_ie_image_dragging();k._tmpl=HTML.tmpl("cu_list_item_tmpl");k._cu_duplicate_tmpl=HTML.tmpl("cu_duplicate_list_item_tmpl");k._set_filters(c);k._current_collection_gid=l;k._is_all_photos=a;k._batch_thumb_endpoints=e;m=k._is_all_photos?"/all_photos":"/camera";if(!HTML5_HISTORY&&!Util.url_hash()){DBHistory.push_state(m,{})}key.setScope(k.KEY_SCOPE);k._init_timeline(j,b,g);k._init_lightbox();return k._listen()})},_listen:function(){var a=this;$(document.body).on("click",".cu-thumb",this._thumb_click.bind(this));$(document.body).on("dblclick",".cu-thumb",this._thumb_double_click.bind(this));$(document.body).on("contextmenu",".cu-thumb",this._thumb_context_menu.bind(this));document.observe(FilePreviewModal.PHOTO_CHANGE_EVT,this._lightbox_photo_change.bind(this));document.observe(FilePreviewModal.PHOTO_DELETE_EVT,this._lightbox_delete.bind(this));document.observe(FilePreviewModal.PHOTO_REMOVE_FROM_ALBUM_EVT,this._lightbox_remove.bind(this));document.observe(FilePreviewModal.EXIT_SELECT_EVT,this._lightbox_exit.bind(this));document.observe(ContextMenu.HIDE_EVT,this._context_menu_hide.bind(this));Event.observe(window,"resize",this._window_resize.bind(this));DBHistory.add_callback((this._is_all_photos?"/all_photos":"/camera"),this._history_change_handler.bind(this));document.on("click",".filter-option",function(d,c){var b;d.preventDefault();b=c.readAttribute("data-filter");return a._filter_type(b)});$("photos-nav-item").observe("click",this._clear_filters.bind(this));$("back-to-photos").observe("click",this._back_to_photos.bind(this));$("back-to-albums").observe("click",this._back_to_albums.bind(this));$("share-selected").observe("click",this._share_selected.bind(this));$("clear-selected").observe("click",this._clear_selected.bind(this));$("share-collection").observe("click",this._share_collection.bind(this));PhotosCollections.listen();return PhotosSelection.listen()},_init_timeline:function(f,b,c){var a,g,j,h,e,d;if(!f.length){this.set_empty_state();return}a=this.in_single_collection_view()?$("single-collection-list"):$("photos-list");h=$("cu-view").cumulativeOffset().top+a.getLayout().get("margin-top")+a.getLayout().get("padding-top");g=$("cu-view").cumulativeOffset().left+a.getLayout().get("margin-left")+a.getLayout().get("padding-left");j=new PhotoTimeline(a,h,g,f,b,c,this._current_filters,this._tmpl,this._batch_thumb_endpoints);if(this.in_single_collection_view()){if((e=this._single_collection_timeline)!=null){e.unlisten()}this._single_collection_timeline=j}else{if((d=this._all_photos_timeline)!=null){d.unlisten()}this._all_photos_timeline=j}return this.get_timeline().render()},_init_lightbox:function(){if(this.get_timeline()==null){return}return FilePreviewModal.init(this.get_timeline().preview_objs,{include_delete:true,no_wrap:true})},_refresh_view:function(){var a;if((a=this.get_timeline())!=null){a.unlisten()}PhotosSelection.clear();$("cu-empty").hide();$("single-album-empty").hide();if(this.in_single_collection_view()){$("single-collection-list").__date()}this._refresh_photo_events();return window.scrollTo(0,0)},_refresh_photo_events:function(){var a=this;return new Ajax.DBRequest("/photos_events",{parameters:{filters:Util.to_json(this._current_filters),collection_gid:this._current_collection_gid,is_all_photos:this._is_all_photos},onSuccess:function(b){var c;c=Util.from_json(b.responseText);if(c==="deleted_collection"){a._current_collection_gid=null;PhotosCollections.reload();a.show_all_collections();Notify.server_error(_("This album has been deleted!"));return}a._init_timeline(c.header_ids,c.header_id_to_name,c.header_id_to_num_photos);return a._init_lightbox()}})},set_empty_state:function(){var a;if(this._current_filters.file_type===this.PHOTO_TYPE){a=_("photos")}else{if(this._current_filters.file_type===this.VIDEO_TYPE){a=_("videos")}else{a=_("photos or videos")}}DomUtil.fillVal(a,"file-types");return $("cu-empty").show()},get_timeline:function(){if(this.in_single_collection_view()){return this._single_collection_timeline}else{return this._all_photos_timeline}},show_in_folder:function(a){var b;b=this.get_timeline().key_to_duplicates[a.uniqueness_key];if(b.length>1){return this._show_duplicates_modal(a,b,false)}else{return window.location.href=this._get_browse_link(a)}},_get_browse_link:function(a){return"/home"+(Util.urlquote(Util.normalize(Util.parentDir(a.path))))+"?select="+(Util.urlquote(a.filename))},in_single_collection_view:function(){return this._current_collection_gid!=null},get_current_collection:function(){if(this._current_collection_gid!=null){return PhotosCollections.get(this._current_collection_gid)}else{return null}},enable_selection:function(){return Util.enableSelection($(document.body))},disable_selection:function(){return Util.disableSelection($(document.body))},_set_filters:function(b){var a;this._current_filters=b;if(b.file_type===this.PHOTO_TYPE){a=_("Photos only")}else{if(b.file_type===this.VIDEO_TYPE){a=_("Videos only")}else{a=_("Photos and videos")}}return $$(".current-filter")[0].__date(a)},_filter_type:function(a){var b;b=DBHistory.deconstruct_url();if(a===this.PHOTO_TYPE||a===this.VIDEO_TYPE){b.qargs.file_type=a}else{delete b.qargs.file_type}return DBHistory.push_state(b.path,b.qargs)},show_collection:function(b){var a;PhotosLogger.log_transition_to(PhotosViews.SINGLE_COLLECTION_VIEW);a=DBHistory.deconstruct_url();if(a.qargs.all_albums!=null){$("back-to-photos").hide();$("back-to-albums").show()}else{$("back-to-albums").hide();$("back-to-photos").show()}delete a.qargs.all_albums;if(b!=null){a.qargs.album=b}else{delete a.qargs.album}return DBHistory.push_state(a.path,a.qargs)},show_all_collections:function(){var a;PhotosLogger.log_transition_to(PhotosViews.ALBUMS_VIEW);a=DBHistory.deconstruct_url();delete a.qargs.album;a.qargs.all_albums="";return DBHistory.push_state(a.path,a.qargs)},_clear_filters:function(c){var b,a;c.preventDefault();PhotosLogger.log_transition_to(PhotosViews.PHOTOS_VIEW);a=DBHistory.deconstruct_url();if(((function(){var d;d=[];for(b in a.qargs){d.push(b)}return d})()).length){PhotosSelection.clear();return DBHistory.push_state(a.path)}else{return this._refresh_view()}},_back_to_photos:function(a){PhotosSelection.clear();return this._clear_filters(a)},_back_to_albums:function(a){PhotosSelection.clear();return this.show_all_collections()},get_thumb_click_event_data:function(c,a){var b;b=this.get_timeline().get_event_for_photo(c,a);return{timeline_photo_index:a,event_photo_index:b.photos.indexOf(c),num_photos_in_event:b.num_photos,event_index:this.get_timeline().events.list.indexOf(b.unique_id),num_events:this.get_timeline().events.list.length}},_thumb_click:function(b){var a;a=this.get_timeline().get_photo_for_thumb_elm($(b.target));if(PhotosSelection._drag_drop.ignore_next_click){return PhotosSelection._drag_drop.ignore_next_click=false}else{return PhotosSelection.photo_click(b,a)}},_thumb_double_click:function(d){var c,b,a;b=this.get_timeline().get_photo_for_thumb_elm($(d.target));a=this.get_timeline().photos.indexOf(b);this._preview(a);c=this.get_thumb_click_event_data(b,a);return PhotosLogger.log_interaction(PhotosEvents.OPEN_LIGHTBOX,PhotosTriggers.DBL_CLICK,c)},_thumb_context_menu:function(f){var b,g,d,a,c;b=this.get_timeline().get_photo_for_thumb_elm($(f.target));if(f.shiftKey){PhotosSelection.photo_click(f,b);return}if(PhotosSelection.contains(b)){g=PhotosSelection.get()}else{g=[b]}ContextMenu.show_photos(f,g);for(d=0,a=g.length;d<a;d++){b=g[d];if((c=this.get_timeline().get_thumb_elm_for_photo(b))!=null){c.addClassName("context-selected")}}if(g.length<=PhotosCollections.NUM_PHOTOS_LONG_RUNNING_ADDS){return this._async_create_filetags(g)}},_context_menu_hide:function(a){$$(".cu-thumb.context-selected").invoke("removeClassName","context-selected");return $$(".photo-collection.context-selected").invoke("removeClassName","context-selected")},_share_selected:function(b){var a;a=PhotosSelection.get();if(a.length<=PhotosCollections.NUM_PHOTOS_LONG_RUNNING_ADDS){this._async_create_filetags(a)}if(!a.length){return}Foshmodal.show(a,false);return PhotosLogger.log_interaction(PhotosEvents.SHARE,PhotosTriggers.SAH,{num_photos:a.length})},_clear_selected:function(b){var a;a=PhotosSelection.get().length;PhotosSelection.clear();return PhotosLogger.log_interaction(PhotosEvents.CLEAR_SELECTED,PhotosTriggers.SAH,{num_photos:a})},_share_collection:function(a){assert(this.in_single_collection_view(),"_share_collection can only happen in single collection view");Foshmodal.show(this.get_current_collection(),true);return PhotosLogger.log_interaction(PhotosEvents.SHARE_ALBUM,PhotosTriggers.SCA)},show_delete_photos_modal:function(h){var g,f,e,b,c,d,a;if(h.length===1){f=this.get_timeline().key_to_duplicates[h[0].uniqueness_key];if(f.length>1){this._show_duplicates_modal(h[0],f,true);return}}else{g=[];for(d=0,a=h.length;d<a;d++){b=h[d];f=this.get_timeline().key_to_duplicates[b.uniqueness_key];if(f.length>1){f.sort(function(k,j){return j.mtime-k.mtime});g=g.concat(f)}}if(g.length){this._show_delete_multiple_duplicates_modal(h,g);return}}c=PhotosUtil.categorize_files(h);if(c===PhotosUtil.ONLY_PHOTOS){e=ungettext("Delete %(file_count)s photo?","Delete %(file_count)s photos?",h.length)}else{if(c===PhotosUtil.ONLY_VIDEOS){e=ungettext("Delete %(file_count)s video?","Delete %(file_count)s videos?",h.length)}else{e=ungettext("Delete %(file_count)s file?","Delete %(file_count)s files?",h.length)}}e=e.format({file_count:h.length});DomUtil.fillVal(PhotosUtil.file_desc(h),"delete-filename");return Modal.icon_show("delete_32",e,DomUtil.fromElm("delete-file"),{action:this._delete_photos.curry(h.slice(0)),wit_group:"delete-confirm"})},_delete_photos:function(m){var c,g,d,a,l,h,f,e,k,b,j=this;l=[];for(f=0,k=m.length;f<k;f++){a=m[f];g=Photos.get_timeline().key_to_duplicates[a.uniqueness_key];for(e=0,b=g.length;e<b;e++){c=g[e];l.push(c.path)}}d=PhotosUtil.file_desc(m,l.length);h=function(n){return new Ajax.DBRequest("/cmd/delete",{parameters:{files:l},job:l.length>Photos.NUM_PHOTOS_LONG_RUNNING_DELETES,progress_text:_("Deleting "+d),onSuccess:function(q){var p,o;Notify.server_success(_("Deleted "+d));for(p=0,o=m.length;p<o;p++){a=m[p];Photos.get_timeline().remove_photo(a)}if(n.length>0){return PhotosCollections.refresh_album_views(n)}}})};return new Ajax.DBRequest("/collections_from_paths",{parameters:{fq_paths:Util.to_json(l)},onSuccess:function(p){var o,n,q,r;n=Util.from_json(p.responseText);q=[];for(r in n){o=n[r];q=q.concat(o)}return h(q)}})},_preview:function(a){return FilePreviewModal.show(a)},_lightbox_delete:function(a){var c,b;c=this.get_timeline().preview_objs.indexOf(a.memo);b=this.get_timeline().photos[c];PhotosLogger.log_interaction(PhotosEvents.DELETE,PhotosTriggers.LIGHTBOX);return this.show_delete_photos_modal([b])},_lightbox_remove:function(c){var b,a;b=this.get_timeline().preview_objs.indexOf(c.memo);a=this.get_timeline().photos[b];PhotosCollections.remove_photos(this.get_current_collection(),[a]);return PhotosLogger.log_interaction(PhotosEvents.REMOVE,PhotosTriggers.LIGHTBOX)},_show_duplicates_modal:function(a,h,p){var g,o,e,j,c,l,b,f,n,k,d,m;h.sort(function(r,q){return q.mtime-r.mtime});j=$("cu-duplicate-files");c=[];for(d=0,m=h.length;d<m;d++){e=h[d];o="Dropbox"+Util.normalize(Util.parentDir(e.path));c.push(this._cu_duplicate_tmpl({thumbnail_url:e.thumbnail_url,filename_snippet:e.filename.em_snippet(this.DUPLICATES_SNIPPET_LENGTH),path_snippet:o.em_snippet(this.DUPLICATES_SNIPPET_LENGTH,0),path_href:this._get_browse_link(e)}))}j.__date(c);if(h.length>=5){j.addClassName("scroll")}else{j.removeClassName("scroll")}if(FilePreviewModal.shown){FilePreviewModal.toggle_delete()}k=PhotosUtil.categorize_files([a]);if(k===PhotosUtil.ONLY_PHOTOS){b=_("There are multiple copies of this photo.");f=_("Delete all copies of this photo?")}else{b=_("There are multiple copies of this video.");f=_("Delete all copies of this video?")}if(p){l="delete_32";n=f;g=b+" "+_("Would you like to delete them all?");$("cu-delete-all-duplicates").show()}else{l="folder_32";n=_("Show in folder");g=b+" "+_("Which folder would you like to view?");$("cu-delete-all-duplicates").hide()}DomUtil.fillVal(g,"cu-duplicates-desc");return Modal.icon_show(l,n,$("cu-duplicates-modal"),{action:this._delete_photos.curry([a])})},_show_delete_multiple_duplicates_modal:function(m,g){var l,e,h,b,a,f,d,j,c,k;h=$("cu-multiple-duplicate-files");b=[];for(c=0,k=g.length;c<k;c++){e=g[c];l="Dropbox"+Util.normalize(Util.parentDir(e.path));b.push(this._cu_duplicate_tmpl({thumbnail_url:e.thumbnail_url,filename_snippet:e.filename.em_snippet(this.DUPLICATES_SNIPPET_LENGTH),path_snippet:l.em_snippet(this.DUPLICATES_SNIPPET_LENGTH,0),path_href:this._get_browse_link(e)}))}h.__date(b);if(g.length>=5){h.addClassName("scroll")}else{h.removeClassName("scroll")}j=PhotosUtil.categorize_files(m);if(j===PhotosUtil.ONLY_PHOTOS){a=_("Delete "+m.length+" photos and all copies?");f=_("There are multiple copies of these photos in your Dropbox.");d=_("Show photos with multiple copies")}else{if(j===PhotosUtil.ONLY_VIDEOS){a=_("Delete "+m.length+" videos and all copies?");f=_("There are multiple copies of these videos in your Dropbox.");d=_("Show videos with multiple copies")}else{a=_("Delete "+m.length+" files and all copies?");f=_("There are multiple copies of these files in your Dropbox.");d=_("Show files with multiple copies")}}DomUtil.fillVal(f,"cu-multiple-duplicates-desc");DomUtil.fillVal(d,"cu-multiple-duplicates-show");$("cu-multiple-duplicates-modal").removeClassName("show-duplicates");return Modal.icon_show("delete_32",a,$("cu-multiple-duplicates-modal"),{action:this._delete_photos.curry(m.slice(0))})},_lightbox_photo_change:function(h){var d,c,a,b,g,f;this._last_lightbox_index=this.get_timeline().preview_objs.indexOf(h.memo);if(this._last_lightbox_index===this.get_timeline().preview_objs.length-1){return}c=this._last_lightbox_index+1;if(this._last_lightbox_index+this.LIGHTBOX_OFFSET*this.THUMBS_PER_ROW<this.get_timeline().preview_objs.length){c=this._last_lightbox_index+this.LIGHTBOX_OFFSET*this.THUMBS_PER_ROW}b=null;for(d=g=f=this._last_lightbox_index+1;f<=c?g<=c:g>=c;d=f<=c?++g:--g){if(typeof(this.get_timeline().preview_objs[d])==="object"){continue}a=this.get_timeline().events.valueFromKey(this.get_timeline().preview_objs[d]);if(!(b!=null)){b=a}if(a===b){continue}if(!b.has_loaded_metadata){b.load_metadata(Math.ceil((d-b.photo_index_offset)/this.get_timeline().THUMBS_PER_ROW))}b=a}if((b!=null)&&!b.has_loaded_metadata){return b.load_metadata(Math.ceil((d-b.photo_index_offset)/this.get_timeline().THUMBS_PER_ROW))}},_lightbox_exit:function(a){return key.setScope(this.KEY_SCOPE)},_window_resize:function(){var c,b,d,a;b=$("cu-view").cumulativeOffset().top+$("photos-list").getLayout().get("margin-top")+$("photos-list").getLayout().get("padding-top");c=$("cu-view").cumulativeOffset().left+$("photos-list").getLayout().get("margin-left")+$("photos-list").getLayout().get("padding-left");if((d=this._all_photos_timeline)!=null){d.update_offsets(b,c)}return(a=this._single_collection_timeline)!=null?a.update_offsets(b,c):void 0},_history_change_handler:function(m,l){var h,j,d,a,f,b,e,k,g,c;$("photos-nav-item").removeClassName("selected");$$(".sidebar-album.selected").invoke("removeClassName","selected");if((g=this.get_timeline())!=null){g.unlisten()}if(l.all_albums!=null){this._in_all_collections_view=true;$("cu-view").removeClassName("single-collection");$("cu-view").addClassName("all-collections");$("all-albums-sidebar").addClassName("selected");PhotosSelection.clear();document.title=_("Albums")+" - Dropbox";window.scrollTo(0,0);this._current_collection_gid=null;return}else{this._in_all_collections_view=false;$("cu-view").removeClassName("all-collections")}if(l.album!=null){a=l.album;c=$$(".sidebar-album");for(e=0,k=c.length;e<k;e++){j=c[e];if(j.readAttribute("data-gid")===a){j.addClassName("selected");break}}h=PhotosCollections.get(a);$("single-collection-title").__date(h.name.em_snippet(PhotosCollections.HEADER_COLLECTION_SNIPPET_LENGTH,1));if(h.shmodel_url!=null){$("single-collection-share-status").writeAttribute("href",h.shmodel_url);$("single-collection-share-status").__date(_("Shared"))}else{$("single-collection-share-status").__date()}$("cu-view").addClassName("single-collection");document.title=""+h.name+" - Dropbox";AlbumsLogger.log_event("show_collection",h.gid,null)}else{a=null;$("cu-view").removeClassName("single-collection");$("photos-nav-item").addClassName("selected");document.title=(this._is_all_photos?_("Photos"):_("Camera"))+" - Dropbox"}f={};if(l.file_type!=null){f.file_type=l.file_type}d=false;if(Util.to_json(f)!==Util.to_json(this._current_filters)){d=true}if(a!=null){if(a!==this._current_collection_gid){d=true}}else{if(!(this._all_photos_timeline!=null)){d=true}}this._set_filters(f);this._current_collection_gid=a;if(d){this._refresh_view()}else{this._init_lightbox();this.get_timeline().init_timeline_nav();this.get_timeline().restore_scroll_position();this.get_timeline().listen()}if(this._last_lightbox_index>-1){b=this.get_timeline().photos[this._last_lightbox_index].uniqueness_key;this.get_timeline().scroll_to_photo_with_key(b);$(b).addClassName("wiggobble");setTimeout((function(){return $(b).removeClassName("wiggobble")}),1000);return this._last_lightbox_index=-1}},_async_create_filetags:function(c){var a,b=this;a=c.collect(function(d){return d.path});this._creating_filetags=true;return new Ajax.DBRequest("/prepare_collection_items",{parameters:{fq_paths:Util.to_json(a)},job:false,no_watch:true,noAutonotify:true,onSuccess:function(d){b._creating_filetags=false;if(b._creating_filetags_cb!=null){b._creating_filetags_cb();return b._creating_filetags_cb=null}}})}};PhotosUtil={ONLY_PHOTOS:1,ONLY_VIDEOS:2,MIXED_TYPES:3,categorize_files:function(b){var c,a;c=b.filter(function(d){return d.preview_type==="photo"});a=b.filter(function(d){return d.preview_type==="video"});if(c.length&&!a.length){return this.ONLY_PHOTOS}else{if(a.length&&!c.length){return this.ONLY_VIDEOS}else{return this.MIXED_TYPES}}},file_desc:function(d,b){var c,a;if(b==null){b=d.length}a=this.categorize_files(d);if(a===PhotosUtil.ONLY_PHOTOS){c=ungettext("%(file_count)s photo","%(file_count)s photos",b)}else{if(a===PhotosUtil.ONLY_VIDEOS){c=ungettext("%(file_count)s video","%(file_count)s videos",b)}else{c=ungettext("%(file_count)s file","%(file_count)s files",b)}}return c.format({file_count:b})}};var PhotosSelection,__indexOf=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++){if(b in this&&this[b]===c){return b}}return -1};PhotosSelection={SHIFT_KEY_CODE:16,DRAG_STATUS_OFFSET:16,DRAG_START_THRESHOLD:10,SCROLL_BAR_WIDTH:10,_selected:[],_context_selected:null,_highlighted:[],_dehighlighted:[],_last_selected:null,_last_mouseover:null,_drag_select:{},_marquee:{},_drag_drop:{},_num_events_highlighting:0,_last_highlight_from_photo:null,_last_highlight_to_photo:null,_select_highlighted_waiting:0,listen:function(){var a=this;$(document.body).on("keydown",function(b){if(b.keyCode===a.SHIFT_KEY_CODE&&a._last_mouseover&&!Util.focus_in_input()){return a._highlight_range(a._last_selected,a._last_mouseover)}});$(document.body).on("keyup",function(b){if(b.keyCode===a.SHIFT_KEY_CODE&&!a._marquee.active){return a.clear_highlighted()}});key("delete, command+backspace, backspace",Photos.KEY_SCOPE,function(b){b.preventDefault();if(Photos.in_single_collection_view()){if(a._selected.length){return PhotosCollections.show_remove_photos_modal(Photos.get_current_collection(),a._selected)}}else{if(a._selected.length){return Photos.show_delete_photos_modal(a._selected)}}});key("esc",Photos.KEY_SCOPE,function(b){if(typeof b.preventDefault==="function"){b.preventDefault()}if(a._drag_drop.active){a._drag_drop.active=false;$("albums-sidebar-list").removeClassName("drag-drop");return $("photos-drag-status").removeClassName("active")}else{a.clear();return PhotosLogger.log_interaction(PhotosEvents.CLEAR_SELECTED,PhotosTriggers.ESC)}});$(document.body).on("mouseover",".cu-thumb",this._photo_mouseover.bind(this));$(document.body).on("mouseout",".cu-thumb",this._photo_mouseout.bind(this));$(document.body).on("mousedown",this._body_mousedown.bind(this));$(document.body).on("mousemove",this._body_mousemove.bind(this));$(document.body).on("mouseup",this._body_mouseup.bind(this));return $(document.body).on("dblclick",this._body_double_click.bind(this))},is_selection_active:function(){return this._highlighted.length||this._selected.length||this._marquee.active||this._drag_drop.active||this._drag_select.active},get:function(){return this._selected},contains:function(a){return this._selected.indexOf(a)!==-1},clear:function(){this._selected=[];this._last_selected=null;$$(".cu-thumb.selected").invoke("removeClassName","selected");$("cu-view").removeClassName("photos-selected");return $("page-sidebar").removeClassName("photos-selected")},clear_highlighted:function(){this._highlighted=[];this._dehighlighted=[];if(!this._select_highlighted_waiting){$$(".cu-thumb.highlighted").invoke("removeClassName","highlighted");$$(".cu-thumb.dehighlighted").invoke("removeClassName","dehighlighted");this._last_highlight_from_photo=null;return this._last_highlight_to_photo=null}},photo_click:function(b,a){if(b.isRightClick()&&!b.shiftKey){return}if(b.shiftKey){return this._select_highlighted()}else{if(this.contains(a)){return this._remove(a)}else{return this._add(a)}}},num_selected:function(){return this._selected.length},_photo_mouseover:function(a){this._last_mouseover=Photos.get_timeline().get_photo_for_thumb_elm($(a.target));if(a.shiftKey){return this._highlight_range(this._last_selected,this._last_mouseover)}else{if(this._drag_select.active){return this._highlight_range(this._drag_select.anchor,this._last_mouseover,true)}}},_photo_mouseout:function(a){if(!this._marquee.active){this.clear_highlighted();return this._last_mouseover=null}},_body_mousedown:function(c){var a,d,b;if(Photos._in_all_collections_view||c.isRightClick()||this._invalid_mouse_target($(c.target))){return}ContextMenu.hide();FreshDropdown.hide_all();a=Photos.get_timeline().get_photo_for_thumb_elm($(c.target));if(a!=null){if(this.contains(a)||!PhotosSelection.drag_select_enabled){b=Util.scroll_offsets();this._drag_drop.active=true;this._drag_drop.start_x=c.clientX+b.left;this._drag_drop.start_y=c.clientY+b.top;this._drag_drop.anchor=$(c.target);this._drag_drop.single_photo=this.contains(a)?null:a;this._build_drag_status(a);this._update_drag_status_position(c);d=this.get();if(d.length<=PhotosCollections.NUM_PHOTOS_LONG_RUNNING_ADDS){return Photos._async_create_filetags(d)}}else{this._drag_select.active=true;return this._drag_select.anchor=a}}else{b=Util.scroll_offsets();if((c.clientX+b.left)>=($(document.body).getWidth()-this.SCROLL_BAR_WIDTH)){return}this._marquee.active=true;this._marquee.start_x=c.clientX+b.left;this._marquee.start_y=c.clientY+b.top;this._marquee.x_max_boundary=-1;return this._marquee.y_max_boundary=-1}},_body_mousemove:function(c){var b,a,d;b=Util.scroll_offsets();a=c.clientX+b.left;d=c.clientY+b.top;if(this._marquee.active){if(!$("marquee").visible()){if(Math.abs(a-this._marquee.start_x)<this.DRAG_START_THRESHOLD&&Math.abs(d-this._marquee.start_y)<this.DRAG_START_THRESHOLD){return}}this._marquee.end_x=a;this._marquee.end_y=d;return this._draw_marquee()}else{if(this._drag_drop.active){if(!$("photos-drag-status").hasClassName("active")){if(Math.abs(a-this._drag_drop.start_x)<this.DRAG_START_THRESHOLD&&Math.abs(d-this._drag_drop.start_y)<this.DRAG_START_THRESHOLD){return}}this._update_drag_status_position(c);$$(".sidebar-album").invoke("removeClassName","album-flash");$("albums-sidebar-list").addClassName("drag-drop");return $("photos-drag-status").addClassName("active")}}},_body_mouseup:function(b){var a;if(this._drag_select.active){this._drag_select.active=false;this._select_highlighted()}if(this._marquee.active){this._marquee.active=false;$("marquee").hide();a=this._highlighted.length;this._select_highlighted();if(a){PhotosLogger.log_interaction(PhotosEvents.MARQUEE_SELECT,PhotosTriggers.DRAG,{num_selected:a})}}if(this._drag_drop.active){if($(b.target)===this._drag_drop.anchor&&$("photos-drag-status").hasClassName("active")){this._drag_drop.ignore_next_click=true}this._drag_drop.active=false;this._drag_drop.anchor=null;this._drag_drop.single_photo=null;$("albums-sidebar-list").removeClassName("drag-drop");return $("photos-drag-status").removeClassName("active")}},_body_double_click:function(a){if(Photos.get_timeline().get_photo_for_thumb_elm($(a.target))||this._invalid_mouse_target($(a.target))){return}this.clear();return PhotosLogger.log_interaction(PhotosEvents.CLEAR_SELECTED,PhotosTriggers.DBL_CLICK)},_draw_marquee:function(){var a,e,d,c,b;b=Math.abs(this._marquee.start_x-this._marquee.end_x);a=Math.abs(this._marquee.start_y-this._marquee.end_y);d=Math.min(this._marquee.start_y,this._marquee.end_y);e=Math.min(this._marquee.start_x,this._marquee.end_x);$("marquee").setStyle({width:b+"px",height:a+"px",top:d+"px",left:e+"px"});$("marquee").show();c=false;if(this._marquee.end_x>=this._marquee.x_max_boundary||this._marquee.end_x<=this._marquee.x_min_boundary){this._update_marquee_x_bounds(this._marquee.end_x);c=true}if(this._marquee.end_y>=this._marquee.y_max_boundary||this._marquee.end_y<=this._marquee.y_min_boundary){this._update_marquee_y_bounds(this._marquee.end_y);c=true}if(c){return this._update_marquee_highlight(d,e,b,a)}},_update_marquee_highlight:function(m,c,a,o){var k,l,h,b,g,f,n,j,e,d;this.clear_highlighted();b=[];l=Photos.get_timeline().grid.photo_col_offsets.length;j=Photos.get_timeline().grid.photo_col_offsets.slice(0,l-1);for(k=g=0,n=j.length;g<n;k=++g){h=j[k];if(h<=c+a&&Photos.get_timeline().grid.photo_col_offsets[k+1]>=c){b.push(k)}}d=[];for(k=f=0,e=Photos.get_timeline().events.length();0<=e?f<e:f>e;k=0<=e?++f:--f){d.push(Photos.get_timeline().events.valueAtIndex(k).marquee_highlight(m,m+o,b))}return d},_update_marquee_x_bounds:function(a){var d,g,h,f,c,e,b;g=$(document.body).getWidth();if(a<Photos.get_timeline().grid.photo_col_offsets.first()){this._marquee.x_min_boundary=-1;return this._marquee.x_max_boundary=Photos.get_timeline().grid.photo_col_offsets.first()}else{if(a>Photos.get_timeline().grid.photo_col_offsets.last()){this._marquee.x_min_boundary=Photos.get_timeline().grid.photo_col_offsets.last();return this._marquee.x_max_boundary=g}else{e=Photos.get_timeline().grid.photo_col_offsets;b=[];for(d=f=0,c=e.length;f<c;d=++f){h=e[d];if(h>a){this._marquee.x_min_boundary=Photos.get_timeline().grid.photo_col_offsets[d-1];this._marquee.x_max_boundary=h;break}else{b.push(void 0)}}return b}}},_update_marquee_y_bounds:function(h){var a,e,d,g,c,f,b;d=$(document.body).getHeight();if(h<Photos.get_timeline().grid.photo_row_offsets.first()){this._marquee.y_min_boundary=-1;return this._marquee.y_max_boundary=Photos.get_timeline().grid.photo_row_offsets.first()}else{if(h>Photos.get_timeline().grid.photo_row_offsets.last()){this._marquee.y_min_boundary=Photos.get_timeline().grid.photo_row_offsets.last();return this._marquee.y_max_boundary=d}else{f=Photos.get_timeline().grid.photo_row_offsets;b=[];for(e=g=0,c=f.length;g<c;e=++g){a=f[e];if(a>h){this._marquee.y_min_boundary=Photos.get_timeline().grid.photo_row_offsets[e-1];this._marquee.y_max_boundary=a;break}else{b.push(void 0)}}return b}}},_build_drag_status:function(d){var c,a,b;a=Photos.get_timeline().get_thumb_elm_for_photo(d);b=a.down("img.thumb-content").cloneNode(false);$("photos-drag-status").down(".thumb").__date(b);c=this._drag_drop.single_photo?[this._drag_drop.single_photo]:this._selected;return $("photos-drag-status").down(".count").__date(PhotosUtil.file_desc(c))},_update_drag_status_position:function(a){return $("photos-drag-status").setStyle({left:(a.pointerX()-Util.scroll_offsets().left+this.DRAG_STATUS_OFFSET)+"px",top:(a.pointerY()-Util.scroll_offsets().top+this.DRAG_STATUS_OFFSET)+"px"})},_highlight_range:function(m,l,c){var k,a,d,g,j,h,b,f,e;if(c==null){c=false}this.clear_highlighted();this._last_highlight_from_photo=m;this._last_highlight_to_photo=l;d=Photos.get_timeline().photos.indexOf(m);b=Photos.get_timeline().photos.indexOf(l);k=!c&&this.contains(l)&&!this.contains(m);e=[];for(g=f=d;d<=b?f<=b:f>=b;g=d<=b?++f:--f){h=Photos.get_timeline().photos[g];if(typeof h!=="object"){if(h!==j){a=Photos.get_timeline().events.valueFromKey(h);if(!a.has_loaded_metadata){a.on_load_all_metadata=this._highlight_range_incremental.bind(this);a.load_metadata();this._num_events_highlighting++;e.push(j=h)}else{e.push(void 0)}}else{e.push(void 0)}}else{if(this.contains(h)){if(k){e.push(this._dehighlight(h))}else{e.push(void 0)}}else{if(!k){e.push(this._highlight(h))}else{e.push(void 0)}}}}return e},_highlight_range_incremental:function(){var f,e,d,c,b,a,g;e=this._last_highlight_from_photo;a=this._last_highlight_to_photo;f=Photos.get_timeline().photos.indexOf(e);b=Photos.get_timeline().photos.indexOf(a);for(d=g=f;f<=b?g<=b:g>=b;d=f<=b?++g:--g){c=Photos.get_timeline().photos[d];if(typeof c==="object"&&!this.contains(c)&&this._highlighted.indexOf(c)===-1){this._highlight(c)}}this._num_events_highlighting--;if(this._select_highlighted_waiting){ModalProgress.update(""+(this._select_highlighted_waiting-this._num_events_highlighting)+"/"+this._select_highlighted_waiting);if(this._num_events_highlighting===0){return this._select_highlighted()}}},_highlight_list:function(d){var c,e,b,a;this.clear_highlighted();a=[];for(e=0,b=d.length;e<b;e++){c=d[e];if(!this.contains(c)){a.push(this._highlight(c))}else{a.push(void 0)}}return a},_select_highlighted:function(){var d,g,e,c,b,f,a;if(this._num_events_highlighting>0){ModalProgress.show(_("Selecting photos..."));this._select_highlighted_waiting=this._num_events_highlighting;return}f=this._highlighted;for(g=0,c=f.length;g<c;g++){d=f[g];this._add(d)}a=this._dehighlighted;for(e=0,b=a.length;e<b;e++){d=a[e];this._remove(d)}if(this._select_highlighted_waiting){ModalProgress.hide();this._select_highlighted_waiting=0}return this.clear_highlighted()},_highlight:function(b){var a;this._highlighted.push(b);a=Photos.get_timeline().get_thumb_elm_for_photo(b);return a!=null?a.addClassName("highlighted"):void 0},_dehighlight:function(b){var a;this._dehighlighted.push(b);a=Photos.get_timeline().get_thumb_elm_for_photo(b);return a!=null?a.addClassName("dehighlighted"):void 0},_add:function(b){var a;a=Photos.get_timeline().get_thumb_elm_for_photo(b);if(a!=null){a.addClassName("selected")}this._selected.push(b);this._last_selected=b;DomUtil.fillVal(PhotosUtil.file_desc(this._selected),"selected-desc");DomUtil.fillVal(this._selected.length,"num-selected");$("cu-view").addClassName("photos-selected");return $("page-sidebar").addClassName("photos-selected")},_remove:function(c){var b,a;a=Photos.get_timeline().get_thumb_elm_for_photo(c);if(a!=null){a.removeClassName("selected")}b=this._selected.indexOf(c);if(b!==-1){this._selected.splice(b,1);this._last_selected=c;if(this._selected.length){DomUtil.fillVal(PhotosUtil.file_desc(this._selected),"selected-desc");return DomUtil.fillVal(this._selected.length,"num-selected")}else{$("cu-view").removeClassName("photos-selected");return $("page-sidebar").removeClassName("photos-selected")}}},_invalid_mouse_target:function(c){var a,b;a=c.classNames().toArray().concat(c.up().classNames().toArray());return(__indexOf.call(a,"freshbutton")>=0)||(__indexOf.call(a,"freshbutton-blue")>=0)||(__indexOf.call(a,"freshbutton-lightblue")>=0)||(__indexOf.call(a,"photos-button")>=0)||(__indexOf.call(a,"photos-button-blue")>=0)||(__indexOf.call(a,"timeline-elm")>=0)||(c.up(".no-marquee")!=null)||(c.up("#context-menu")!=null)||(c.up(".freshdropdown-menu")!=null)||c.nodeName==="A"||((b=c.tagName.toUpperCase())==="INPUT"||b==="TEXTAREA"||b==="SELECT")||Modal.shown()||$("modal-progress-content").visible()||FilePreviewModal.shown}};var PhotosCollections,__indexOf=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++){if(b in this&&this[b]===c){return b}}return -1};PhotosCollections={SIDEBAR_COLLECTION_SNIPPET_LENGTH:10,HEADER_COLLECTION_SNIPPET_LENGTH:25,CONTEXT_MENU_COLLECTION_SNIPPET_LENGTH:11,NUM_PHOTOS_LONG_RUNNING_ADDS:100,NUM_PHOTOS_LONG_RUNNING_REMOVES:250,LOADING_SPINNER:new HTML('<br/><div class="cu-loading"><img src="/static/images/icons/ajax-loading-small.gif" /></div>'),_collections:[],_gid_to_collection:{},_collection_list_item_tmpl:null,_albums_sidebar_tmpl:null,_add_to_album_menu_tmpl:null,_all_collections_loaded:false,_removed_pre_load:[],init:function(b,a){this._collections=b;this._gid_to_collection=b.dict_by("gid");this._collection_list_item_tmpl=HTML.tmpl("collection_list_item_tmpl");this._albums_sidebar_tmpl=HTML.tmpl("albums_sidebar_tmpl");this._add_to_album_menu_tmpl=HTML.tmpl("add_to_album_menu_tmpl");this._all_collections_loaded=a<=4;this.refresh_album_views();return this._init_all_collections()},_init_all_collections:function(){var a=this;if(!this._all_collections_loaded){return new Ajax.DBRequest("/collections",{onSuccess:function(d){var g,f,c,e,b;e=Util.from_json(d.responseText);for(f=0,c=e.length;f<c;f++){g=e[f];if(!(g.gid in a._gid_to_collection)&&!(b=g.gid,__indexOf.call(a._removed_pre_load,b)>=0)){a._collections.push(g);a._gid_to_collection[g.gid]=g}}a._all_collections_loaded=true;return a.refresh_album_views()}})}},reload:function(){this._collections=[];this._gid_to_collection={};this._all_collections_loaded=false;this.refresh_album_views();return this._init_all_collections()},listen:function(){var a=this;$("single-collection-title").observe("click",function(b){a.header_rename();return PhotosLogger.log_interaction(PhotosEvents.RENAME_ALBUM,PhotosTriggers.CLICK_TITLE)});$(document.body).on("contextmenu",".albums-list-item",this._albums_list_item_contextmenu.bind(this));$(document.body).on("click",".show-collection-target",this._show_collection_click.bind(this));$(document.body).on("click",".add-to-album-target",this._add_to_album_click.bind(this));$(document.body).on("mouseover",".add-to-album-drop-target",this._drop_target_mouseover.bind(this));$(document.body).on("mouseup",".add-to-album-drop-target",this._drop_target_mouseup.bind(this));$(document.body).on("mouseout",".add-to-album-drop-target",this._drop_target_mouseout.bind(this));return document.observe(ContextMenu.HIDE_EVT,(function(){return $$(".albums-list-item.context-selected").invoke("removeClassName","context-selected")}))},render_all_albums_view:function(){var e,b,d,a,c;if(this._collections.length||!this._all_collections_loaded){$("albums-empty").hide()}else{$("albums-empty").show()}b=[];c=this._collections;for(d=0,a=c.length;d<a;d++){e=c[d];b.push(this._collection_list_item_tmpl({collection:e,additional_class:"albums-list-item show-collection-target"}))}$("albums-list").__date(b);if(!this._all_collections_loaded){return $("albums-list").__sert(this.LOADING_SPINNER)}},render_add_to_album_modal:function(){var e,b,d,a,c;b=[];c=this._collections;for(d=0,a=c.length;d<a;d++){e=c[d];b.push(this._collection_list_item_tmpl({collection:e,additional_class:"add-to-album-target"}))}$("add-to-album-modal-list").__date(b);if(!this._all_collections_loaded&&this._collections.length>0){return $("add-to-album-modal-list").__sert(this.LOADING_SPINNER)}},render_albums_sidebar:function(){var h,k,e,j,f,d,b,a,c,g=this;k=this._albums_sidebar_tmpl({collections:this._collections.slice(0,5)});if((f=$("albums-sidebar"))!=null){f.__date(k)}if((d=$("all-albums-sidebar"))!=null){d.observe("click",Photos.show_all_collections)}if((b=$("all-albums-sidebar"))!=null){b.observe("mouseup",function(l){var m;if(!PhotosSelection._drag_drop.active){return}if(PhotosSelection._drag_drop.single_photo!=null){m=[PhotosSelection._drag_drop.single_photo]}else{m=PhotosSelection.get()}g.show_add_to_album_modal(l,m);return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_OTHER_ALBUM,PhotosTriggers.DROP_TARGET,{num_photos:PhotosSelection.get().length})})}if(Photos._in_all_collections_view){return $("all-albums-sidebar").addClassName("selected")}else{if(Photos.in_single_collection_view()){a=$$(".sidebar-album");c=[];for(e=0,j=a.length;e<j;e++){h=a[e];if(h.readAttribute("data-gid")===Photos.get_current_collection().gid){h.addClassName("selected");break}else{c.push(void 0)}}return c}}},render_add_to_album_menu:function(){var c,b,a,d=this;c=this._add_to_album_menu_tmpl({collections:this._collections.slice(0,3),all_link:this._collections.length>3});if((b=$("add-to-album-menu"))!=null){b.__date(c)}return(a=$("show-add-to-album-modal"))!=null?a.observe("click",function(f){d.show_add_to_album_modal(f);return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_OTHER_ALBUM,PhotosTriggers.SAH,{num_photos:PhotosSelection.get().length})}):void 0},refresh_album_views:function(b){var a,c=this;if(b==null){b=null}a=function(){c.render_all_albums_view();c.render_albums_sidebar();c.render_add_to_album_menu();return c.render_add_to_album_modal()};if(b!=null?b.length:void 0){return new Ajax.DBRequest("/collections",{parameters:{collection_gids:Util.to_json(b.unique())},onSuccess:function(e){var h,g,d,f;f=Util.from_json(e.responseText);for(g=0,d=f.length;g<d;g++){h=f[g];c.refresh_collection(h)}return a()}})}else{return a()}},get_all:function(){return this._collections},get:function(a){return this._gid_to_collection[a]},share:function(a){return Forms.postRequest("/collection_share",{collection_gid:a.gid},{target:"_blank"})},show_unshare_modal:function(b){var a;DomUtil.fillVal(b.name.escapeHTML(),"collection-unshare-name");a=_("Unshare album?");return Modal.icon_show("alert_32",a,DomUtil.fromElm("collection-unshare-modal"),{action:this.unshare.curry(b)})},unshare:function(a){assert(a.share_tkey!=null,"Can't unshare collection "+a.gid+" without a tkey");return new Ajax.DBRequest("/sm/disable/"+a.share_tkey,{onSuccess:function(){var b;a.share_tkey=null;$("single-collection-share-status").__date();b=a.name.escapeHTML();return Notify.server_success(_("Unshared '"+b+"'"))}})},add_photos:function(e,g){var a,b,d,c,f=this;d=g.collect(function(h){return h.path});b={collection_gid:e.gid,fq_paths:Util.to_json(d),is_all_photos:Photos._is_all_photos};c=g.length>this.NUM_PHOTOS_LONG_RUNNING_ADDS;Notify.server_success(_("Adding to album..."));a={parameters:b,job:c,progress_text:_("Adding to album..."),onSuccess:function(l){var j,n,h,m,k;if(e.num_photos===0){assert(!(e.thumbnail_url!=null),"Empty album shouldn't have a thumbnail url");e.thumbnail_url=g[0].thumbnail_url}f._collection_updated(e);if(g===PhotosSelection.get()){PhotosSelection.clear()}m=Util.from_json(l.responseText);h=m.num_added;e.num_photos+=h;k=PhotosUtil.categorize_files(g);if(h<1){if(k===PhotosUtil.ONLY_PHOTOS){n=ungettext("That photo is already in '%(collection_name)s'","Those photos are already in '%(collection_name)s'",d.length)}else{if(k===PhotosUtil.ONLY_VIDEOS){n=ungettext("That video is already in '%(collection_name)s'","Those videos are already in '%(collection_name)s'",d.length)}else{n=ungettext("That file is already in '%(collection_name)s'","Those files are already in '%(collection_name)s'",d.length)}}}else{if(k===PhotosUtil.ONLY_PHOTOS){n=ungettext("Added photo to '%(collection_name)s'","Added photos to '%(collection_name)s'",d.length)}else{if(k===PhotosUtil.ONLY_VIDEOS){n=ungettext("Added video to '%(collection_name)s'","Added videos to '%(collection_name)s'",d.length)}else{n=ungettext("Added file to '%(collection_name)s'","Added files to '%(collection_name)s'",d.length)}}}j=e.name.escapeHTML();n=n.format({collection_name:"<a data-gid='"+e.gid+"' class='show-collection-target'>"+j+"</a>"});return Notify.server_success(n)}};if(Photos._creating_filetags){return Photos._creating_filetags_cb=function(){return new Ajax.DBRequest("/collection_add",a)}}else{return new Ajax.DBRequest("/collection_add",a)}},show_remove_photos_modal:function(c,d){var b,a;a=PhotosUtil.categorize_files(d);if(a===PhotosUtil.ONLY_PHOTOS){b=ungettext("Remove %(file_count)s photo?","Remove %(file_count)s photos?",d.length)}else{if(a===PhotosUtil.ONLY_VIDEOS){b=ungettext("Remove %(file_count)s video?","Remove %(file_count)s videos?",d.length)}else{b=ungettext("Remove %(file_count)s file?","Remove %(file_count)s files?",d.length)}}b=b.format({file_count:d.length});DomUtil.fillVal(PhotosUtil.file_desc(d),"collection-remove-files");DomUtil.fillVal(c.name.escapeHTML(),"collection-remove-name");return Modal.icon_show("delete_32",b,DomUtil.fromElm("collection-remove-modal"),{action:this.remove_photos.curry(c,d.slice(0)).bind(this)})},remove_photos:function(d,f){var c,a,b,e=this;a=f.collect(function(g){return g.item_counter});c=PhotosUtil.file_desc(f);b=f.length>this.NUM_PHOTOS_LONG_RUNNING_REMOVES;return new Ajax.DBRequest("/collection_remove",{parameters:{collection_gid:d.gid,item_counters:Util.to_json(a),num_items:d.num_photos,is_shared:d.share_tkey!=null},job:b,progress_text:_("Removing from album..."),onSuccess:function(k){var j,h,m,g,l;PhotosCollections._collection_updated(d);j=d.name.escapeHTML();Notify.server_success(_("Removed "+c+" from '"+j+"'"));PhotosSelection.clear();for(m=0,g=f.length;m<g;m++){h=f[m];Photos.get_timeline().remove_photo(h)}d.num_photos-=f.length;Photos.get_current_collection().thumbnail_url=((l=Photos.get_timeline().photos[0])!=null?l.thumbnail_url:void 0)||null;return e.refresh_album_views()}})},_add_to_album_new:function(a){document.stopObserving("click",FreshDropdown.hide_all);return this.create(a,$("add-to-album-new").down(".new-album-text"))},_add_to_album_sidebar_new:function(b,a){var c;if(a&&!PhotosSelection._drag_drop.active){return}if(PhotosSelection._drag_drop.single_photo!=null){c=[PhotosSelection._drag_drop.single_photo]}else{c=PhotosSelection.get()}$("add-to-album-sidebar-new").addClassName("editing");return this.create(b,$("add-to-album-sidebar-new").down(".collection-name"),c,true)},show_delete_modal:function(b){var a;DomUtil.fillVal(b.name.escapeHTML(),"collection-delete-name");a=_("Delete album?");return Modal.icon_show("delete_32",a,DomUtil.fromElm("collection-delete-modal"),{action:this["delete"].curry(b)})},"delete":function(a){var b=this;return new Ajax.DBRequest("/collection_delete",{parameters:{collection_gid:a.gid,num_items:a.num_photos,is_shared:a.share_tkey!=null},onSuccess:function(e){var d,f,c;if((f=$(a.gid))!=null){f.remove()}PhotosCollections._collections.removeItem(a);if(!PhotosCollections._all_collections_loaded){PhotosCollections._removed_pre_load.push(a.gid)}PhotosCollections.refresh_album_views();if(((c=Photos.get_current_collection())!=null?c.gid:void 0)===a.gid){Photos.show_all_collections()}delete PhotosCollections._gid_to_collection[a.gid];d=a.name.escapeHTML();return Notify.server_success(_("Deleted '"+d+"'"))}})},rename:function(d,c){var a,b,e=this;Photos.enable_selection();b=function(n){var m,f,o,k,j,p,l,h,g;o=n.responseText;k=o.em_snippet(e.SIDEBAR_COLLECTION_SNIPPET_LENGTH,1);if((l=$(d.gid))!=null){l.down("a").__date(k)}if(((h=Photos.get_current_collection())!=null?h.gid:void 0)===d.gid){$("single-collection-title").__date(o.em_snippet(e.HEADER_COLLECTION_SNIPPET_LENGTH,1));document.title=""+o+" - Dropbox"}g=e._collections;for(j=0,p=g.length;j<p;j++){m=g[j];if(m.gid===d.gid){m.name=o;e._collection_updated(m);break}}e._gid_to_collection[d.gid].name=o;e.refresh_album_views();f=o.escapeHTML();return Notify.server_success(_("Renamed '"+f+"'"))};a=new Ajax.InPlaceEditor(c,"/collection_rename",{htmlResponse:false,okControl:false,cancelControl:false,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:11,ajaxClass:Ajax.DBRequest,submitOnBlur:true,initialText:d.name,cancelIfSame:true,clickToEdit:false,onComplete:function(){return $("single-collection-title-container").removeClassName("editing")},onFailure:function(){},savingText:_("Saving..."),onLeaveEditMode:Photos.disable_selection,onLeaveHover:function(){},ajaxOptions:{method:"POST",onSuccess:b},callback:function(f,g){return{collection_gid:d.gid,new_collection_name:g,is_shared:d.share_tkey!=null}}});return a.enterEditMode()},create:function(j,h,n,b){var c,f,a,l,m,k,g,d=this;if(b==null){b=false}if(j){Event.extend(j).preventDefault();g=$(j.target);if(g.hasClassName("inplaceeditor-form")||(g.up(".inplaceeditor-form")!=null)){return}}Photos.enable_selection();if(!n){n=PhotosSelection.get()}a=n.collect(function(e){return e.path});n.sort_by_key(function(e){return e.time_taken});l=n.length>this.NUM_PHOTOS_LONG_RUNNING_ADDS;c=Class.create({initialize:function(o,e){if(e==null){e={}}if(Photos._creating_filetags){return Photos._creating_filetags_cb=function(){return new Ajax.DBRequest(o,e)}}else{return new Ajax.DBRequest(o,e)}}});k=function(o){var q,e,r,p;q=Util.from_json(o.responseText);q.thumbnail_url=(p=n[0])!=null?p.thumbnail_url:void 0;q.num_photos=n.length;PhotosSelection.clear();d._gid_to_collection[q.gid]=q;d._collections.unshift(q);FreshDropdown.hide_all();ContextMenu.hide();$("add-to-album-sidebar-new").removeClassName("editing");d.refresh_album_views();Photos.disable_selection();$("add-to-album-new").down(".new-album-text").__date(_("New album"));r=_("Created '%(collection_name)s'");e=q.name.escapeHTML();r=r.format({collection_name:"<a data-gid='"+q.gid+"' class='show-collection-target'>"+e+"</a>"});Notify.server_success(r);return d.flash_sidebar_album(q.gid)};m=function(){FreshDropdown.hide_all();ContextMenu.hide();$("add-to-album-sidebar-new").removeClassName("editing");PhotosCollections.render_add_to_album_menu();PhotosCollections.render_albums_sidebar();return Photos.disable_selection()};f=new Ajax.InPlaceEditor(h,"/collection_create",{htmlResponse:false,okControl:false,cancelControl:false,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:11,ajaxClass:c,submitOnBlur:b,initialText:"",cancelIfSame:true,clickToEdit:false,onCancel:m,onFailure:function(){},savingText:_("Creating..."),onLeaveEditMode:Photos.disable_selection(),onLeaveHover:function(){},ajaxOptions:{method:"POST",onSuccess:k,job:l,progress_text:_("Creating album...")},callback:function(e,o){Notify.server_success(_("Creating album..."));return{collection_name:o,fq_paths:Util.to_json(a),is_all_photos:Photos._is_all_photos}}});f.enterEditMode();if(!b){return f._controls.editor.observe("blur",m)}},header_rename:function(){if($("single-collection-title-container").hasClassName("editing")){return}$("single-collection-title-container").addClassName("editing");return this.rename(Photos.get_current_collection(),$("single-collection-title"))},toggle_add_to_album:function(a){var b;if(a){Event.extend(a).preventDefault()}if(!$("add-to-album-menu").visible()){FreshDropdown.show($("add-to-album-menu"),$("add-to-album-button"))}b=PhotosSelection.get();if(b.length<=this.NUM_PHOTOS_LONG_RUNNING_ADDS){return Photos._async_create_filetags(b)}},toggle_share_add_to_album:function(a){if(a){Event.extend(a).preventDefault()}if(!$("share-add-to-album-menu").visible()){return FreshDropdown.show($("share-add-to-album-menu"),$("share-add-to-album-button"))}},toggle_more_actions:function(a){if(a){Event.extend(a).preventDefault()}if(!$("more-collection-actions-menu").visible()){if(Photos.get_current_collection().share_tkey!=null){$("unshare-album").show()}else{$("unshare-album").hide()}return FreshDropdown.show($("more-collection-actions-menu"),$("more-collection-actions-button"))}},show_add_to_album_modal:function(a,b){if(b!==PhotosSelection.get()&&!(PhotosSelection._drag_drop.single_photo!=null)){PhotosSelection._context_selected=b}Modal.onHide=function(){PhotosSelection._context_selected=null;delete Modal.onHide;return Modal.hide()};return Modal.show(_("Choose an album"),$("add-to-album-modal"),false,false,770)},_collection_updated:function(a){this._collections.removeItem(a);this._collections.unshift(a);return this.refresh_album_views()},_albums_list_item_contextmenu:function(b,a){ContextMenu.show_photo_collection(b,this.get(a.readAttribute("data-gid")),a);a.removeClassName("album-flash");return a.addClassName("context-selected")},_show_collection_click:function(c,a){var b;b=$(c.target);if(b.hasClassName("inplaceeditor-form")||(b.up(".inplaceeditor-form")!=null)){return}return Photos.show_collection(a.readAttribute("data-gid"))},_add_to_album_click:function(b,a){if(PhotosSelection._context_selected){this.add_photos(this.get(a.readAttribute("data-gid")),PhotosSelection._context_selected);PhotosSelection._context_selected=null}else{this.add_photos(this.get(a.readAttribute("data-gid")),PhotosSelection.get())}delete Modal.onHide;Modal.hide();return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_RECENT_ALBUM,PhotosTriggers.SAH,{num_photos:PhotosSelection.get().length})},_drop_target_mouseover:function(b,a){if(PhotosSelection._drag_drop.active){a.addClassName("hovered");return $("photos-drag-status").addClassName("hovering")}},_drop_target_mouseout:function(b,a){if(PhotosSelection._drag_drop.active){a.removeClassName("hovered");return $("photos-drag-status").removeClassName("hovering")}},_drop_target_mouseup:function(b,a){var c;if(a.hasClassName("hovered")){a.removeClassName("hovered");$("photos-drag-status").removeClassName("hovering");if(PhotosSelection._drag_drop.single_photo!=null){c=[PhotosSelection._drag_drop.single_photo]}else{c=PhotosSelection.get()}if(a.readAttribute("data-gid")!=null){this.add_photos(this.get(a.readAttribute("data-gid")),c)}if(a.identify()==="add-to-album-sidebar-new"){return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_NEW_ALBUM,PhotosTriggers.DROP_TARGET,{num_photos:PhotosSelection.get().length})}else{if(a.identify()==="all-albums-sidebar"){return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_OTHER_ALBUM,PhotosTriggers.DROP_TARGET,{num_photos:PhotosSelection.get().length})}else{return PhotosLogger.log_interaction(PhotosEvents.ADD_TO_RECENT_ALBUM,PhotosTriggers.DROP_TARGET,{num_photos:PhotosSelection.get().length})}}}},two_line_snippet:function(c,b){var a,e,d;a=c.em_snippet(b,1);e=a.lastIndexOf(" ");if(e===-1){return a}else{a=a.slice(0,e+1||9000000000);d=c.slice(e+1).em_snippet(b,1);return a+d}},collection_name_in_use:function(b){var e,d,a,c;c=this.get_all();for(d=0,a=c.length;d<a;d++){e=c[d];if(e.name===b.trim()){return true}}return false},increment_collection_name_until_valid:function(b){var c,a;c=this.collection_name_in_use(b);a=0;while(c){a++;c=this.collection_name_in_use(b+(" ("+a+")"))}return(a===0?b:b+(" ("+a+")"))},refresh_collection:function(e){var b,d,c,a;this._gid_to_collection[e.gid]=e;a=[];for(b=d=0,c=this._collections.length;0<=c?d<c:d>c;b=0<=c?++d:--d){if(this._collections[b].gid===e.gid){this._collections[b]=e;break}else{a.push(void 0)}}return a},flash_sidebar_album:function(e){var f,d,b,c,a;c=$$(".sidebar-album");a=[];for(d=0,b=c.length;d<b;d++){f=c[d];if(f.readAttribute("data-gid")===e){f.removeClassName("album-flash");f.addClassName("album-flash");break}else{a.push(void 0)}}return a}};var PhotoTimeline;PhotoTimeline=(function(){a.prototype.SIZE_Q="?size=cu_154";a.prototype.THUMB_SIZE=158;a.prototype.HEADER_HEIGHT=51;a.prototype.THUMBS_PER_ROW=5;a.prototype.RENDER_SCROLL_WAIT=100;a.prototype.RENDER_SCROLL_MAX_WAIT=750;a.prototype.HIDE_TIMELINE_NAV_DELAY=1500;a.prototype.THUMBS_BATCH_SIZE=15;a.prototype.MAX_THUMB_BATCH_REQUESTS=24;a.prototype.MAX_URL_LENGTH=4000;a.prototype.VIEWPORT_SCALE_SCROLL_DIRECTION=4;a.prototype.VIEWPORT_SCALE_OTHER_DIRECTION=1;a.prototype.TIMELINE_NAV_MOUSE_THRESHOLD=100;a.prototype.TIMELINE_NAV_ELM_HEIGHT=20;a.prototype.TIMELINE_DOT_HTML=Sprite.html("web","timeline_dot");a.container;a.events;a.current_event;a.photos;a.key_to_photo;a.key_to_duplicates;a.preview_objs;a.filters;a.tmpl;a.batch_thumb_endpoints;a.last_render_scroll_timeout;a.start_render_scroll_time;a.last_scroll_position;a.hide_timeline_nav_timeout;a.grid;a.batch_load_thumbs_queue;a.num_pending_batch_requests;a._skip_scroll_update;a.scroll_count;function a(b,h,j,g,d,f,e,k,c){this.container=b;this.photos=[];this.key_to_photo={};this.key_to_duplicates={};this.preview_objs=[];this.filters=e;this.tmpl=k;this.batch_thumb_endpoints=c;this.start_render_scroll_time=-1;this.grid={};this.batch_load_thumbs_queue=[];this.num_pending_batch_requests=0;this._skip_scroll_update=false;this._init_events(g,d,f);this.update_offsets(h,j);this.listen();this.scroll_count=0;Velocity.start_capture()}a.prototype._init_events=function(l,c,f){var b,h,e,g,d,k,j,m;if(l.length<1){this.events=new SuperDictionary([],{});return}h=[];g={};d=0;k=0;for(j=0,m=l.length;j<m;j++){e=l[j];e=String(e);b=new PhotoEvent(this,e,c[e],f[e],d,k);h.push(e);g[e]=b;d+=f[e];k+=Math.ceil(f[e]/this.THUMBS_PER_ROW)+1}return this.events=new SuperDictionary(h,g)};a.prototype.listen=function(){this._bound_window_scroll=this._window_scroll.bind(this);this._bound_window_resize=this._window_resize.bind(this);this._body_mousemove_handler=$(document.body).on("mousemove",this._body_mousemove.bind(this));this._timeline_elm_click_handler=$(document.body).on("click",".timeline-elm",this._timeline_elm_click.bind(this));Event.observe(window,"scroll",this._bound_window_scroll);return Event.observe(window,"resize",this._bound_window_resize)};a.prototype.unlisten=function(){var c,b;if((c=this._body_mousemove_handler)!=null){c.stop()}if((b=this._timeline_elm_click_handler)!=null){b.stop()}Event.stopObserving(window,"scroll",this._bound_window_scroll);return Event.stopObserving(window,"resize",this._bound_window_resize)};a.prototype.render=function(){this._render_empty_grid();this.init_timeline_nav();return this._render_viewport()};a.prototype.update_offsets=function(j,k){var b,h,f,e,l,g,d,c;this.top_offset=j;this.grid.photo_row_offsets=[];g=this.events.getValues();for(f=0,l=g.length;f<l;f++){b=g[f];b.top_offset=j;b.create_global_row_heights();j+=b.height}this.left_offset=k;this.grid.photo_col_offsets=[];c=[];for(h=e=0,d=this.THUMBS_PER_ROW;0<=d?e<=d:e>=d;h=0<=d?++e:--e){c.push(this.grid.photo_col_offsets.push(this.left_offset+this.THUMB_SIZE*h))}return c};a.prototype._render_empty_grid=function(){var d,f,c,e,b;this.container.__date();e=this.events.getValues();b=[];for(f=0,c=e.length;f<c;f++){d=e[f];b.push(d.add_html_elements_to(this.container))}return b};a.prototype._render_viewport=function(e){var m,c,n,p,q,k,j,g,o,d,b,l,h,f;if(e==null){e=false}this.start_render_scroll_time=-1;q=Util.get_viewport();n=[];l=this.events.getValues();for(k=0,o=l.length;k<o;k++){c=l[k];if(!c.has_loaded_metadata&&!c.loading_metadata){if(c.in_current_viewport(q,false)){n.unshift(c)}else{if(c.in_current_viewport(q,true)){n.push(c)}}}}for(j=0,d=n.length;j<d;j++){c=n[j];h=c.get_row_range_to_render(q,true),p=h[0],m=h[1];if(m!=null){c.load_metadata(m)}}if(e){q=Util.get_viewport();f=this.events.getValues();for(g=0,b=f.length;g<b;g++){c=f[g];if(c.in_current_viewport(q,false)){c.timing_stopped_scrolling_on_event=Util.time()-this.RENDER_SCROLL_WAIT}}}return this._load_visible_photos()};a.prototype._load_visible_photos=function(){var d,f,c,e,b;e=this.events.getValues();b=[];for(f=0,c=e.length;f<c;f++){d=e[f];b.push(d.update_photo_divs())}return b};a.prototype.batch_load_thumbs=function(){var q,e,h,f,o,j,g,c,n,b,d,k,p,l,m=this;l=this.batch_load_thumbs_queue.first(),o=l[0],e=l[1];this.batch_load_thumbs_queue=this.batch_load_thumbs_queue.slice(1);f=[];j=[];for(k=0,p=o.length;k<p;k++){h=o[k];if(h.elt.hasAttribute("data-src")){b=h.elt.readAttribute("data-src");h.elt.removeAttribute("data-src");h.elt.writeAttribute("loading-src",b);b=b.replace(/https?:\/\/[^\/]+\//,"/");f.push(b);j.push({elt:h.elt})}}if(!f.length){return}q=this.batch_thumb_endpoints[Math.abs(Util.string_hash(Util.to_json(f))%this.batch_thumb_endpoints.length)];d=q+this.SIZE_Q+encodeURIComponent(Util.to_json(f));c=(d.length<this.MAX_URL_LENGTH?"get":"post");g=[];n=function(z,y){var A,w,t,D,B,C,x,v,u,s,r;if(y==null){y=false}D=z.responseText.split("\n");if(D.length<2){return}B=[];if(y){C=D.splice(D.length-2,1)[0]}D.splice(D.length-1);for(w=v=0,s=j.length;v<s;w=++v){h=j[w];if(D.length>w&&h.elt.hasAttribute("loading-src")){if(D[w]&&D[w].indexOf("data:image")===0){h.elt.writeAttribute("src",D[w]);h.elt.removeAttribute("loading-src");h.elt.up(".cu-thumb").addClassName("thumb-loaded");if(e.scroll_count===m.scroll_count&&!e.logged_thumbs_arrived){if((w+1)%m.THUMBS_PER_ROW===0||w+1===j.length){if(e.visible_thumbs_loaded()){x=Util.get_viewport();t=(e.photo_index_offset+e.num_photos)===m.photos.length;if((e.top_offset<x.bottom&&x.bottom<e.top_offset+e.height)||t){g.push(e.log_timing_event(PhotosTimingEvents.viewport_loaded,null,true))}g.push(e.log_timing_event(PhotosTimingEvents.thumbs_arrived,null,true));e.logged_thumbs_arrived=true}}}}else{console.log("Failed image: "+h.elt.up("span").identify(),D[w])}}}if(y){for(u=0,r=g.length;u<r;u++){A=g[u];if(typeof A==="function"){A({thumbcachehit:C==="thumbcachehit: 1"})}}g=[]}if(B.length){m.batch_load_thumbs_queue.push(B)}if(m.batch_load_thumbs_queue.length){return m.batch_load_thumbs()}};this.num_pending_batch_requests++;e.scroll_count=this.scroll_count;new Ajax.DBRequest(q+this.SIZE_Q,{method:c,parameters:{image_urls:Util.to_json(f)},withCredentials:true,onInteractive:n,onSuccess:function(r){return n(r,true)},onComplete:function(){m.num_pending_batch_requests--}});if(this.num_pending_batch_requests<this.MAX_THUMB_BATCH_REQUESTS&&this.batch_load_thumbs_queue.length){return this.batch_load_thumbs()}};a.prototype._body_mousemove=function(b){if((b.clientX+Util.scroll_offsets().left)>=($(document.body).getWidth()-this.TIMELINE_NAV_MOUSE_THRESHOLD)){return $("timeline-nav").addClassName("mouse-active")}else{return $("timeline-nav").removeClassName("mouse-active")}};a.prototype._timeline_elm_click=function(g,f){var c,d,b;d=f.readAttribute("data-event-id");if(d){c=this.events.valueFromKey(d)}this._update_timeline_position(c);b=c.top_offset-this.top_offset;if(c&&(Util.scroll_offsets().top!==b)){this._skip_scroll_update=true;return window.scrollTo(Util.scroll_offsets().left,b)}};a.prototype._window_scroll=function(){var e,d,h,g,c,f,b,j=this;d=Util.time();this.batch_load_thumbs_queue=[];if(this.start_render_scroll_time===-1||d-this.start_render_scroll_time<this.RENDER_SCROLL_MAX_WAIT){clearTimeout(this.last_render_scroll_timeout)}if(this.start_render_scroll_time===-1){this.start_render_scroll_time=d}h=this.visible_thumbs_loaded()?0:this.RENDER_SCROLL_WAIT;this.last_render_scroll_timeout=setTimeout(this._render_viewport.curry(true).bind(this),h);this._update_timeline_position();$("timeline-nav").addClassName("scroll-active");clearTimeout(this.hide_timeline_nav_timeout);this.hide_timeline_nav_timeout=setTimeout((function(){return $("timeline-nav").removeClassName("scroll-active")}),this.HIDE_TIMELINE_NAV_DELAY);this.last_scroll_position=Util.scroll_offsets().top;this.scroll_count++;f=this.events.getValues();b=[];for(g=0,c=f.length;g<c;g++){e=f[g];b.push(e.logged_thumbs_arrived=false)}return b};a.prototype._window_resize=function(){this._resize_timeline_nav();return this._show_hide_timeline_elms()};a.prototype.init_timeline_nav=function(){var c,e,b,d;this.grid.side_nav={};this.current_event=null;$("timeline-nav").__date();this._resize_timeline_nav();d=this.events.getValues().reverse();for(e=0,b=d.length;e<b;e++){c=d[e];c.add_to_timeline_nav(c===this.events.getValues()[0])}this._update_timeline_position();return this._show_hide_timeline_elms()};a.prototype._resize_timeline_nav=function(){var b;b=Util.viewport_dimensions().height-this.TIMELINE_NAV_ELM_HEIGHT;return $("timeline-nav").setStyle({height:b+"px"})};a.prototype._update_timeline_position=function(h){var l,j,b,f,e,k,c,g,d;if(this._skip_scroll_update){this._skip_scroll_update=false;return}if(!(h!=null)){l=document.viewport.getScrollOffsets().top+Util.viewport_dimensions().height/2;g=this.events.getValues();for(f=0,k=g.length;f<k;f++){b=g[f];if(b.top_offset>l){break}h=b}}if(!(h!=null)||h===this.current_event){return}$$(".timeline-elm.current").invoke("removeClassName","current");d=$$(".timeline-elm");for(e=0,c=d.length;e<c;e++){j=d[e];if(j.readAttribute("data-event-id")===h.unique_id){j.addClassName("current");break}}return this.current_event=h};a.prototype._show_hide_timeline_elms=function(){var j,f,d,e,h,c,g,b;d=$("cu-header").cumulativeOffset().left+$("cu-header").getWidth();f=$("cu-header").cumulativeOffset().top+$("cu-header").getHeight();g=$$(".timeline-elm");b=[];for(h=0,c=g.length;h<c;h++){j=g[h];j.show();e=j.cumulativeOffset();if(e.top<f&&e.left<d){b.push(j.hide())}else{b.push(void 0)}}return b};a.prototype.get_thumb_elm_for_photo=function(b){return $(b.uniqueness_key)};a.prototype.get_photo_for_thumb_elm=function(b){if(!b.hasClassName("cu-thumb")){b=b.up(".cu-thumb")}if(b){return this.key_to_photo[b.identify()]}else{return null}};a.prototype.get_preview_obj=function(b){if(b.preview_type==="photo"&&b.thumbnail_url){return new PhotoPreview(b.filename,b.path,b.thumbnail_url,b.href+"&dl=1",b.href,b.display_time_taken)}else{if(b.preview_type==="video"&&b.thumbnail_url&&!Constants.DISABLE_VIDEOS_IN_LIGHTBOX){return new VideoPreview(b.filename,b.path,b.thumbnail_url,"https://"+Constants.LIVE_TRANSCODE_SERVER+"/transcode_video/w/"+b.block_hash+(Util.urlquote(b.path)),b.href+"&dl=1",b.display_time_taken)}}return null};a.prototype.scroll_to_photo_with_key=function(b){var c;c=$(b);if(!c){return}Util.scroll_to_thumb(c);return this._load_visible_photos()};a.prototype.restore_scroll_position=function(){if(this.last_scroll_position!=null){window.scrollTo(0,this.last_scroll_position)}else{window.scrollTo(0,0)}if(Prototype.Browser.IE&&Prototype.Browser.IEV<9){return this._load_visible_photos()}};a.prototype.get_event_for_photo=function(d,c){var j,f,h,b,g;if(c==null){c=this.photos.indexOf(d)}g=this.events.getValues();for(h=0,b=g.length;h<b;h++){j=g[h];if(j.photo_index_offset>c){break}f=j}return f};a.prototype.remove_photo=function(b){var c;c=this.get_event_for_photo(b);return c.remove_photo(b)};a.prototype.visible_thumbs_loaded=function(){var c,e,b,d;d=this.events.getValues();for(e=0,b=d.length;e<b;e++){c=d[e];if(!c.visible_thumbs_loaded()){return false}}return true};return a})();var PhotoEvent;PhotoEvent=(function(){a.prototype.MONTH_PREFIX="m_";a.prototype.COLLECTION_PREFIX="c_";a.prototype.NUM_LIGHTBOX_PHOTOS_TO_PRELOAD=5;a.timeline;a.unique_id;a.name;a.num_photos;a.num_rows;a.photos;a.header_html;a.placeholder_html;a.photos_html;a.height;a.top_offset;a.photo_index_offset;a.photo_row_offset;a.displaying_row;a.rendered_row;a.loading_metadata;a.has_loaded_metadata;a.cursor;a.num_rows_loaded_metadata;a.num_rows_to_load_metadata;a.on_load_all_metadata;a.logged_thumbs_arrived;a.timing_metadata_received;a.timing_stopped_scrolling_on_event;a.scroll_count;function a(k,g,b,h,j,c){var f,d,e;this.timeline=k;this.unique_id=g;this.name=b;this.num_photos=h;this.num_rows=Math.ceil(this.num_photos/this.timeline.THUMBS_PER_ROW);this.photos=[];this.photos_html=[];this.displaying_row=[];this.rendered_row=[];for(f=d=0,e=this.num_rows;0<=e?d<e:d>e;f=0<=e?++d:--d){this.displaying_row[f]=false;this.rendered_row[f]=false}this.photo_index_offset=j;this.photo_row_offset=c;this._generate_container_html();this._create_global_array_placeholders();this.timing_metadata_received=-1;this.timing_stopped_scrolling_on_event=-1;this.num_rows_loaded_metadata=0;this.num_rows_to_load_metadata=0;this.has_loaded_metadata=false;this.loading_metadata=false}a.prototype.is_month=function(){return this.unique_id.slice(0,2)===this.MONTH_PREFIX};a.prototype.get_month=function(){assert(this.is_month(),"this must be a month event");return parseInt(this.unique_id.slice(6,8),10)};a.prototype.get_year=function(){assert(this.is_month(),"this must be a month event");return parseInt(this.unique_id.slice(2,6),10)};a.prototype.is_collection=function(){return this.unique_id.slice(0,2)===this.COLLECTION_PREFIX};a.prototype.get_collection_gid=function(){assert(this.is_collection(),"this must be a collection event");return this.unique_id.slice(2)};a.prototype._generate_container_html=function(){var b,d,e,c;e=this.name;this.header_html=new HTML("<h1 class='cu-month-header' id='h-"+this.unique_id+"'>"+e+"</h1>");b=this.num_rows*this.timeline.THUMB_SIZE;c=this.num_photos%this.timeline.THUMBS_PER_ROW;d=c===0?0:(this.timeline.THUMBS_PER_ROW-c)*this.timeline.THUMB_SIZE;this.placeholder_html=new HTML('<div style="height: '+b+'px;" id="p-'+this.unique_id+'" class="content-placeholder-container">\n  <div style="height: '+b+'px;" id="p-top-'+this.unique_id+'" class="content-placeholder"></div>\n  <div style="height: 0px;" id="p-bottom-'+this.unique_id+'" class="content-placeholder"></div>\n  <div style="width: '+d+'px" id="p-cover-'+this.unique_id+'" class="thumb-cover"></div>\n</div>');return this.height=this.timeline.HEADER_HEIGHT+b};a.prototype.add_to_timeline_nav=function(b){var j,h,c,f,e,d,g;if(b==null){b=false}if(!this.is_month()){return}g=Util.get_viewport().height;f=$(document.body).getHeight();e=this.top_offset/f*100;c=Util.monthAbrWithYear(this.get_month()-1,this.get_year());h=false;for(d in this.timeline.grid.side_nav){if(Math.abs(this.timeline.events.valueFromKey(d).top_offset-this.top_offset)/f*g<this.timeline.TIMELINE_NAV_ELM_HEIGHT){h=true;if(b){$("timeline-nav-"+d).remove()}}}if(!h||b){j=new Element("div",{"class":"timeline-elm",style:"top: "+e+"%",id:"timeline-nav-"+this.unique_id,"data-event-id":this.unique_id});j.__date(c);$("timeline-nav").__sert(j);return this.timeline.grid.side_nav[this.unique_id]=e}};a.prototype._create_global_array_placeholders=function(){var c,e,d,b;b=[];for(c=e=0,d=this.num_photos;0<=d?e<d:e>d;c=0<=d?++e:--e){this.timeline.preview_objs[this.photo_index_offset+c]=this.unique_id;b.push(this.timeline.photos[this.photo_index_offset+c]=this.unique_id)}return b};a.prototype.create_global_row_heights=function(){var f,c,e,d,b;f=this.top_offset;this.timeline.grid.photo_row_offsets[this.photo_row_offset]=this.top_offset;f+=this.timeline.HEADER_HEIGHT;b=[];for(c=e=0,d=this.num_rows;0<=d?e<d:e>d;c=0<=d?++e:--e){b.push(this.timeline.grid.photo_row_offsets[this.photo_row_offset+c+1]=f+c*this.timeline.THUMB_SIZE)}return b};a.prototype._num_photos_changed=function(){var d,c,b;d=this.num_rows*this.timeline.THUMB_SIZE;this.height=this.timeline.HEADER_HEIGHT+d;$("p-"+this.unique_id).setStyle({height:d+"px"});b=this.num_photos%this.timeline.THUMBS_PER_ROW;c=b!==0?(this.timeline.THUMBS_PER_ROW-b)*this.timeline.THUMB_SIZE:0;return $("p-cover-"+this.unique_id).setStyle({width:c+"px"})};a.prototype.add_metadata_to_global_arrays=function(j,h){var e,d,g,f,c,b;if(!j){j=this.photos;h=0}b=[];for(e=f=0,c=j.length;f<c;e=++f){d=j[e];g=this.timeline.get_preview_obj(d);this.timeline.preview_objs[this.photo_index_offset+e+h]=g;if(e+h<this.NUM_LIGHTBOX_PHOTOS_TO_PRELOAD){g.preload()}this.timeline.photos[this.photo_index_offset+e+h]=d;b.push(this.timeline.key_to_photo[d.uniqueness_key]=d)}return b};a.prototype.load_metadata=function(j){var d,c,g,b,f,e,h=this;if((!(j!=null))||(j>this.num_rows-1)){j=this.num_rows-1}if(this.has_loaded_metadata||(this.num_rows_loaded_metadata-1>=j)){return}if(this.loading_metadata){this.num_rows_to_load_metadata=Math.max(this.num_rows_to_load_metadata,j+1);return}this.loading_metadata=true;f={is_all_photos:Photos._is_all_photos};if(this.cursor!=null){f.cursor=this.cursor}if(this.is_month()){e=this.get_year();g=this.get_month();d=new Date(Date.UTC(e,g-1,1,0,0,0,0));b=new Date(e,g,0).getDate();c=new Date(Date.UTC(e,g-1,b,23,59,59));j=this.num_rows-1;f.limit=(j-this.num_rows_loaded_metadata+1)*this.timeline.THUMBS_PER_ROW;f.filters=Util.to_json({date_begin:d.getTime(),date_end:c.getTime(),file_type:this.timeline.filters.file_type})}else{if(this.is_collection()){f.limit=(j-this.num_rows_loaded_metadata+1)*this.timeline.THUMBS_PER_ROW;f.filters=Util.to_json({collection_gid:this.get_collection_gid()})}else{assert(false,"invalid photo event id: "+this.unique_id)}}return new Ajax.DBRequest("/photos_event_metadata",{parameters:f,onSuccess:function(k){var l;l=Util.from_json(k.responseText);h.timing_metadata_received=Util.time();h.cursor=l.cursor;return h._load_metadata_callback(l.photos,l.key_to_duplicates,(l.more!=null)&&l.more,j)}})};a.prototype._load_metadata_callback=function(m,l,g,k){var h,b,f,c,d,j,e;this.photos=this.photos.concat(m);Object.extend(this.timeline.key_to_duplicates,l);this.photos_html=[];e=this.photos;for(f=d=0,j=e.length;d<j;f=++d){c=e[f];if(c.time_taken!=null){h=new Date(c.time_taken);b=Util.niceDateWithMonthName(h,h.getUTCFullYear()<new Date().getFullYear(),true)}else{b=""}this.photos_html.push(this.timeline.tmpl({photo:c,display_date:b,shareable:true}))}this.add_metadata_to_global_arrays(m,this.num_rows_loaded_metadata*this.timeline.THUMBS_PER_ROW);this.num_rows_loaded_metadata=k+1;this.has_loaded_metadata=(!g)||(this.num_rows_loaded_metadata===this.num_rows);if(this.has_loaded_metadata){this._fix_photo_count();this.num_rows_loaded_metadata=this.num_rows;if(typeof this.on_load_all_metadata==="function"){this.on_load_all_metadata()}this.on_load_all_metadata=null}this.loading_metadata=false;this.update_photo_divs();if(!this.has_loaded_metadata&&this.num_rows_to_load_metadata>k+1){return this.load_metadata(this.num_rows_to_load_metadata-1)}};a.prototype._fix_photo_count=function(){var h,j,b,d,c,l,k,f,g,e;if(this.photos.length!==this.num_photos){d=this.num_photos;c=this.num_rows;this.num_photos=this.photos.length;this.num_rows=Math.ceil(this.num_photos/this.timeline.THUMBS_PER_ROW);assert(d>this.num_photos,"the initial photo count of an event should never be lower than the actual count");j=d-this.num_photos;b=c-this.num_rows;this.timeline.preview_objs.splice(this.photo_index_offset+this.num_photos,j);this.timeline.photos.splice(this.photo_index_offset+this.num_photos,j);this.timeline.grid.photo_row_offsets.splice(this.photo_row_offset+this.num_rows,b);this.create_global_row_heights();this._num_photos_changed();k=this.timeline.events.indexOfKey(this.unique_id);for(h=f=g=k+1,e=this.timeline.events.length();g<=e?f<e:f>e;h=g<=e?++f:--f){l=this.timeline.events.valueAtIndex(h);l.change_index_offset(j,b,false)}}if(this.num_photos===0&&this.is_collection()){return $("single-album-empty").show()}};a.prototype.remove=function(){this.timeline.events.remove(this.unique_id);this.timeline.init_timeline_nav();$("h-"+this.unique_id).remove();$("p-"+this.unique_id).remove();if(this.is_collection()){return $("single-album-empty").show()}else{if(this.timeline.events.length()===0){return Photos.set_empty_state()}}};a.prototype.change_index_offset=function(b,d,c){this.photo_index_offset-=b;this.top_offset-=d*this.timeline.THUMB_SIZE;if(c){this.top_offset-=this.timeline.HEADER_HEIGHT}this.photo_row_offset-=d;this.add_metadata_to_global_arrays();return this.create_global_row_heights()};a.prototype.in_y_range=function(c,b){return !(this.top_offset+this.timeline.HEADER_HEIGHT>b||this.top_offset+this.height<c)};a.prototype.blur_range=function(e,b,g){var d,c,f;if(g==null){g=Util.get_viewport()}f=Velocity.get();if(f>=0){c=this.timeline.VIEWPORT_SCALE_OTHER_DIRECTION;d=this.timeline.VIEWPORT_SCALE_SCROLL_DIRECTION}else{if(f<0){c=this.timeline.VIEWPORT_SCALE_SCROLL_DIRECTION;d=this.timeline.VIEWPORT_SCALE_OTHER_DIRECTION}}e-=c*g.height;b+=d*g.height;return[e,b]};a.prototype.in_current_viewport=function(d,f){var b,c,e;if(d==null){d=Util.get_viewport()}if(f==null){f=true}c=d.top;b=d.top+d.height;if(f){e=this.blur_range(c,b,d),c=e[0],b=e[1]}return this.in_y_range(c,b)};a.prototype.add_html_elements_to=function(b){b.__sert(this.header_html);return b.__sert(this.placeholder_html)};a.prototype.hide_photos_if_not_in_current_viewport=function(c){var b,e,d;if(!this.in_current_viewport(c)){for(b=e=0,d=this.num_rows;0<=d?e<d:e>d;b=0<=d?++e:--e){this._remove_row(b)}$("p-top-"+this.unique_id).setStyle({height:this.num_rows*this.timeline.THUMB_SIZE+"px"});$("p-bottom-"+this.unique_id).setStyle({height:"0px"});return true}return false};a.prototype.get_row_range_to_render=function(e,h){var g,c,b,d,f;if(h==null){h=true}d=e.top;b=e.bottom;if(h){f=this.blur_range(d,b,e),d=f[0],b=f[1]}if(!this.in_y_range(d,b)){return[null,null]}c=Math.floor((d-this.top_offset-this.timeline.HEADER_HEIGHT)/this.timeline.THUMB_SIZE);g=Math.floor((b-this.top_offset-this.timeline.HEADER_HEIGHT)/this.timeline.THUMB_SIZE);return[Math.max(0,c),Math.min(this.num_rows-1,g)]};a.prototype.update_photo_divs=function(){var u,w,x,B,p,r,n,g,q,y,v,m,s,k,h,e,c,z,A,b,t,o,l,j,f,d;if(!this.num_rows_loaded_metadata||!this.num_photos){return}s=Util.get_viewport();if(this.hide_photos_if_not_in_current_viewport(s)){return}t=this.get_row_range_to_render(s),v=t[0],w=t[1];assert((v!=null)&&(w!=null),"This line is after @hide_photos_if_not_in_      current_viewport, so top_row_to_render and bottom_row_to_render shouldn't be null.");if(!this.has_loaded_metadata&&w>this.num_rows_loaded_metadata-1){this.load_metadata(w);w=this.num_rows_loaded_metadata-1;if(v>this.num_rows_loaded_metadata-1){return}}m=v*this.timeline.THUMB_SIZE;$("p-top-"+this.unique_id).setStyle({height:m+"px"});B=(this.num_rows-w-1)*this.timeline.THUMB_SIZE;$("p-bottom-"+this.unique_id).setStyle({height:B+"px"});for(x=k=0;0<=v?k<v:k>v;x=0<=v?++k:--k){this._remove_row(x)}for(x=h=o=w+1,l=this.num_rows_loaded_metadata;o<=l?h<l:h>l;x=o<=l?++h:--h){this._remove_row(x)}for(x=e=v;v<=w?e<=w:e>=w;x=v<=w?++e:--e){this._add_row(x)}j=PhotosSelection.get();for(c=0,z=j.length;c<z;c++){n=j[c];if((f=$(n.uniqueness_key))!=null){f.addClassName("selected")}}q=Util.calc_thumb_prep_size();u=[];p=0;d=this.get_photo_indexes_for_row_range(v,w);for(b=0,A=d.length;b<A;b++){g=d[b];if(g<this.photos.length){y=$(this.photos[g].uniqueness_key);if(y!=null?y.down("img").hasAttribute("data-src"):void 0){if(Prototype.BrowserFeatures.DB_CORS&&this.timeline.batch_thumb_endpoints.length){u.push({elt:y.down("img")});if(u.length===this.timeline.THUMBS_BATCH_SIZE){this.timeline.batch_load_thumbs_queue.push([u,this]);p+=this.timeline.THUMBS_BATCH_SIZE;u=[]}}else{r=function(C){return function(){return C.addClassName("thumb-loaded")}};Util.thumb_load(y.down("img"),q,r(y))}}}}if(u.length){p+=u.length;this.timeline.batch_load_thumbs_queue.push([u,this])}if(p>0){this.log_timing_event(PhotosTimingEvents.thumbs_queued,p)}if(this.timeline.batch_load_thumbs_queue.length){this.timeline.batch_load_thumbs()}};a.prototype.log_timing_event=function(e,d,g){var b,c,f;if(g==null){g=false}c=Util.time();b={};if(this.timing_stopped_scrolling_on_event===-1){return}if(e===PhotosTimingEvents.viewport_loaded){f=c-this.timing_stopped_scrolling_on_event}else{if(this.timing_stopped_scrolling_on_event>this.timing_metadata_received){f=c-this.timing_stopped_scrolling_on_event}else{b.blocking_event="metadata_load";f=c-this.timing_metadata_received}if(e===PhotosTimingEvents.thumbs_queued){assert(d!=null,"Must pass in num_thumbs_queued if logging queued_thumbs event");b={num_photos_in_event:this.photos.length,num_thumbs_queued:d,ms_per_photo_in_event:f/this.photos.length,ms_per_thumbs_queued:f/d}}}if(g){return(function(h){Object.extend(b,h);return WebTimingLogger.log_ajax_transition(f,e,b,e)})}return WebTimingLogger.log_ajax_transition(f,e,b,e)};a.prototype._remove_row=function(f){var b,e,h,d,g,c;if(!this.displaying_row[f]){return}this.displaying_row[f]=false;g=this.get_photo_indexes_in_row(f);c=[];for(h=0,d=g.length;h<d;h++){b=g[h];if(b<this.photos_html.length){e=$(this.photos[b].uniqueness_key);c.push(e.hide())}else{c.push(void 0)}}return c};a.prototype._add_row=function(m){var k,p,b,n,l,h,g,d,o,j,f,c,e;if(this.displaying_row[m]){return}this.displaying_row[m]=true;if(this.rendered_row[m]){j=this.get_photo_indexes_in_row(m);for(h=0,o=j.length;h<o;h++){l=j[h];if(l<this.photos_html.length){$(this.photos[l].uniqueness_key).show()}}}else{this.rendered_row[m]=true;p=$("p-top-"+this.unique_id);if(m!==0){for(k=g=f=m-1;f<=0?g<=0:g>=0;k=f<=0?++g:--g){if(this.rendered_row[k]){n=(k+1)*this.timeline.THUMBS_PER_ROW-1;if(n>this.photos.length-1){n=this.photos.length-1}b=this.timeline.get_thumb_elm_for_photo(this.photos[n]);assert(b!=null,"row "+k+" was marked as rendered, but its last thumb elm doesn't exist");p=b;break}}}e=[];for(k=d=c=this.timeline.THUMBS_PER_ROW-1;c<=0?d<=0:d>=0;k=c<=0?++d:--d){l=m*this.timeline.THUMBS_PER_ROW+k;if(l<this.photos_html.length){e.push(p.__sert({after:this.photos_html[l]}))}else{e.push(void 0)}}return e}};a.prototype.marquee_highlight=function(b,j,f){var d,k,c,l,n,e,h,g,m;if(this.top_offset>j||this.top_offset+this.height<b){return}if(b<this.top_offset){j-=this.top_offset;if(j<this.timeline.HEADER_HEIGHT){return}e=0;n=Math.floor((j-this.timeline.HEADER_HEIGHT)/this.timeline.THUMB_SIZE)}else{if(j>this.top_offset+this.height){b-=this.top_offset;n=Math.ceil(this.num_photos/this.timeline.THUMBS_PER_ROW);if(b<this.timeline.HEADER_HEIGHT){e=0}else{e=Math.floor((b-this.timeline.HEADER_HEIGHT)/this.timeline.THUMB_SIZE)}}else{b-=this.top_offset;j-=this.top_offset;if(b<this.timeline.HEADER_HEIGHT&&j<this.timeline.HEADER_HEIGHT){return}else{if(b<this.timeline.HEADER_HEIGHT){e=0;n=Math.floor((j-this.timeline.HEADER_HEIGHT)/this.timeline.THUMB_SIZE)}else{e=Math.floor((b-this.timeline.HEADER_HEIGHT)/this.timeline.THUMB_SIZE);n=Math.floor((j-this.timeline.HEADER_HEIGHT)/this.timeline.THUMB_SIZE)}}}}for(l=h=e;e<=n?h<=n:h>=n;l=e<=n?++h:--h){for(g=0,m=f.length;g<m;g++){d=f[g];k=this.timeline.THUMBS_PER_ROW*l+d;if(k<this.num_photos){c=this.photos[k];if(!PhotosSelection.contains(c)){PhotosSelection._highlight(c)}}}}};a.prototype.remove_photo=function(c){var n,o,b,h,e,q,p,k,d,f,l,m,j,g;d=this.photos.indexOf(c);k=this.photo_index_offset+d;h=this.num_photos;e=this.num_rows;this.num_photos--;this.num_rows=Math.ceil(this.num_photos/this.timeline.THUMBS_PER_ROW);o=h-this.num_photos;b=e-this.num_rows;this.photos.splice(d,1);if(d<this.photos_html.length){this.photos_html.splice(d,1)}this.timeline.grid.photo_row_offsets.splice(this.photo_row_offset,b);this.create_global_row_heights();this._num_photos_changed();this._fix_row_display_after_remove(Math.ceil(d/this.timeline.THUMBS_PER_ROW));this.update_photo_divs();if((m=$(this.timeline.photos[k].uniqueness_key))!=null){m.remove()}this.timeline.photos.splice(k,1);this.timeline.preview_objs.splice(k,1);PhotosSelection._remove(c);if(k>=this.timeline.photos.length){k=this.timeline.photos.length-1}p=this.timeline.events.indexOfKey(this.unique_id);for(n=l=j=p+1,g=this.timeline.events.length();j<=g?l<g:l>g;n=j<=g?++l:--l){q=this.timeline.events.valueAtIndex(n);f=this.num_photos===0;q.change_index_offset(o,b,f)}if(FilePreviewModal.shown){FilePreviewModal.jump_to(k)}if(this.num_photos===0){return this.remove()}};a.prototype._fix_row_display_after_remove=function(b){var e,d,h,c,g,f;for(e=g=b,f=this.num_rows;b<=f?g<f:g>f;e=b<=f?++g:--g){d=(e+1)*this.timeline.THUMBS_PER_ROW-1;if(d>=this.photos.length){return}c=$(this.photos[d].uniqueness_key);if(this.displaying_row[e]){if(this.rendered_row[e+1]){c.show()}else{if(d<this.photos_html.length){h=$(this.photos[d-1].uniqueness_key);h.__sert({after:this.photos_html[d]})}}}else{if(this.rendered_row[e]){if(this.displaying_row[e+1]){c.hide()}else{if(!this.rendered_row[e+1]){if(d<this.photos_html.length){h=$(this.photos[d-1].uniqueness_key);h.__sert({after:this.photos_html[d]});$(this.photos[d].uniqueness_key).hide()}}}}else{if(this.rendered_row[e+1]){c.remove()}}}}};a.prototype.get_photo_index=function(b,c){return b*this.timeline.THUMBS_PER_ROW+c};a.prototype.get_photo_indexes_in_row=function(b){var c;return(function(){var f,e,d;d=[];for(c=f=0,e=this.timeline.THUMBS_PER_ROW;0<=e?f<e:f>e;c=0<=e?++f:--f){d.push(this.get_photo_index(b,c))}return d}).call(this)};a.prototype.get_photo_indexes_for_row_range=function(b,h){var g,c,j,f,d,e;j=[];for(c=f=b;b<=h?f<=h:f>=h;c=b<=h?++f:--f){for(g=d=0,e=this.timeline.THUMBS_PER_ROW;0<=e?d<e:d>e;g=0<=e?++d:--d){j.push(this.get_photo_index(c,g))}}return j};a.prototype.visible_thumbs_loaded=function(c){var f,g,b,e,d;if(c==null){c=Util.get_viewport()}if(!this.in_current_viewport(c,false)){return true}if(!this.has_loaded_metadata||this.loading_metadata){return false}d=this.get_row_range_to_render(c,false),b=d[0],f=d[1];assert((b!=null)&&(f!=null),"This line is after a check to see if this      event lies in the current_viewport, so top_row_to_render and bottom_row_to_render shouldn't      be null.");for(g=e=b;b<=f?e<=f:e>=f;g=b<=f?++e:--e){if(!this.rendered_row[g]){return false}}return true};return a})();var FilePreview;FilePreview={PARTIAL_TEXT_LENGTH_THRESHOLD:64*1024,init_doc:function(){var a,b=this;a=new DocViewer({id:"crocodoc-preview",zoom:"auto"});a.bind("fail",this._preview_failed);jQuery(".doc").attr("tabindex",0).focus();a.bind("statusupdate",function(c){if(c!=null?c.viewable:void 0){return b._fire_pdf_render_event()}});return this._log_pdf_render_time("pdf-crocodoc")},init_pdf:function(c,g,h){var f,b,a,d,j,e=this;this._log_pdf_render_time(c);if(c==="pdf-embedded"){Util.smart_window_load(function(){return e._fire_pdf_render_event()});j=/Chrome PDF|Adobe Reader|Adobe PDF|Acrobat/gi;a=(function(){var n,l,m,k;m=window.navigator.plugins;k=[];for(n=0,l=m.length;n<l;n++){d=m[n];if(j.test(d.name)){k.push(d)}}return k})();b=$$("#pdf-embed-container iframe");if(!a.length){b.invoke("setStyle",{webkitTransformOrigin:"50% 0%",webkitTransform:"scale(1.5)"});$("pdf-embed-container").setStyle({overflowY:"auto"})}return window.setTimeout((function(){return b.invoke("setStyle",{visibility:"visible"})}),200)}else{if(c==="pdf-js"){PDFView.initialize();h=h.replace(/https?:\/\/[^\/]+/,"");PDFJS.workerSrc=h;if(Prototype.BrowserFeatures.DB_CORS){f=window["pdf-js-data"];if(f){if(f.byteLength){delete window["pdf-js-data"];return PDFView.open(f,0)}else{if(f.pending){return window.addEventListener("message",function(k){if(k.data==="pdf-js-data-ready"){f=window["pdf-js-data"];if(f.byteLength){delete window["pdf-js-data"];return PDFView.open(f,0)}}})}}}else{return PDFView.open(g,0)}}else{Util.add_script(Util.add_qstring(g,{js_callback:"got_text",binary:"1",b64:"1"}));return window.got_text=function(k){var p,l,m,o,n;p=Util.decode_b64(k,true);m=new Uint8Array(p.length);for(l=o=0,n=p.length;0<=n?o<=n:o>=n;l=0<=n?++o:--o){m[l]=p.charCodeAt(l)}return PDFView.open(m)}}}}},init_font:function(){var a=this;return Util.smartLoad(function(){if(!$(document.documentElement).hasClassName("fontface")||$(document.body).hasClassName("gecko")){return $(document.body).removeClassName("file-preview-body")}})},init_photo:function(d,g){var j,e,h,f,c,a,b;$("preview-img").observe("error",this._preview_failed.bind(this));if(IE7_OR_LESS){$(document.body).removeClassName("preview-photo");Util.smartLoad(this.resize_preview_img.bind(this));setInterval(this.resize_preview_img,500)}if((f=window.performance)!=null?(c=f.timing)!=null?c.navigationStart:void 0:void 0){$("preview-img").observe("load",function(){var k;k=Util.time()-window.performance.timing.navigationStart;return WebTimingLogger.log_ajax_transition(k,"file-preview-photo")})}$("full-img").src=d;a=$$("#preview-img, #full-img");b=[];for(e=0,h=a.length;e<h;e++){j=a[e];j.setAttribute("data-original-href",g);b.push(j.on("contextmenu","img",ContextMenu.show_shmodel.bind(ContextMenu)))}return b},init_text:function(d,b){var c,f,e,a,g=this;c=0;e=function(j){var h;if(!j.responseText){return}h=j.responseText.length;if(c===0&&h>g.PARTIAL_TEXT_LENGTH_THRESHOLD){a(j.responseText,true);return c=h}};f=function(h){return a(h.responseText)};window.got_text=function(h){if(h){h=Util.decode_b64(h)}return a(h)};a=function(h,j){var l,m,k;if(!h||!h.length){$("code-wrapper").remove();return}if((k=$("code-loading"))!=null){k.remove()}l=$("code").className;m=h.substring(c);$("code").appendChild(document.createTextNode(m));if(b&&!j){SyntaxHighlighter.defaults.toolbar=false;SyntaxHighlighter.defaults["quick-code"]=false;SyntaxHighlighter.highlight($("code"))}return window.filled_text=1};return Util.smartLoad(function(){if(Prototype.BrowserFeatures.DB_CORS){new Ajax.DBRequest(d,{method:"GET",parameters:{},log_timing:true,withCredentials:true,onInteractive:e,onSuccess:f,onFailure:function(){return Util.add_script(Util.add_qstring(d,{js_callback:"got_text",b64:"1"}))}})}else{Util.add_script(Util.add_qstring(d,{js_callback:"got_text",b64:"1"}))}return setTimeout((function(){if(!window.filled_text){return g._preview_failed()}}),10000)})},init_htmlified:function(){var a=this;if(window.htmlified_height){htmlified_loaded();return}if(!window.postMessage){this._preview_failed();return}return setTimeout((function(){if(!window.htmlified_height){return a._preview_failed()}}),10000)},htmlified_loaded:function(){var a;if((a=$("htmlified-loading"))!=null){a.remove()}$("htmlified").style.height=window.htmlified_height+"px";return $("htmlified").style.visibility=""},init_video:function(c,d,a,b){var e=this;return Util.smartLoad(function(){var f;f=e._preview_failed;if(b==="hls"){return Util.embed_video(a,"video",828,true,false)}else{if(c){$("video").__date();if(d){Util.embed_h264_video(a,"video",828,true,false,f)}else{f()}}else{if(FlashDetect.installed){$("video").__date();Util.embed_flash_video(a,"video",828,true)}else{f()}}return document.observe(JWPlayerError,f)}})},photo_loaded:function(c){var b,a;if((b=window.performance)!=null?(a=b.timing)!=null?a.navigationStart:void 0:void 0){c=c-window.performance.timing.navigationStart;return WebTimingLogger.log_ajax_transition(c,"file-preview-photo")}},resize_preview_img:function(){var c,b,a;c=document.viewport.getDimensions();a=(c.width-56)+"px";b=(c.height-103)+"px";return $("preview-img").setStyle({maxHeight:b,maxWidth:a})},_preview_failed:function(){var a;a=$(document.body);if(a.hasClassName("shmodel-body")){return a.removeClassName("file-preview-body")}},_fire_pdf_render_event:function(){var a;if(document.createEvent&&window.dispatchEvent){a=document.createEvent("UIEvents");a.initUIEvent("pagerender",false,false,window,0);return window.dispatchEvent(a)}},_log_pdf_render_time:function(b){var a;a=function(f){var d,e,c;if((e=window.performance)!=null?(c=e.timing)!=null?c.navigationStart:void 0:void 0){d=Util.time()-window.performance.timing.navigationStart;return WebTimingLogger.log_ajax_transition(d,f)}};Event.observe(window,"pagerender",function(){Event.stopObserving(window,"pagerender");return a(b)});return Event.observe(window,"parsecomplete",function(){Event.stopObserving(window,"parsecomplete");return a(""+b+"-parse")})}};var parse_color_to_rgba;Effect.BlindFadeUp=function(d,c){var b,a;b=new Effect.BlindUp(d,c);a=new Effect.Fade(d,c);this.cancel=function(){b.cancel();return a.cancel()}};Effect.BlindFadeDown=function(d,c){var b,a;b=new Effect.BlindDown(d,c);a=new Effect.Appear(d,c);this.cancel=function(){b.cancel();return a.cancel()}};Effect.Flash=function(c,b,a){assert(b.startcolor&&b.endcolor,"Start and end colors must be specified");assert(b.cycles,"Fade cycles must be specified");a=a||0;return new Effect.Highlight(c,{duration:1,startcolor:b.startcolor,endcolor:b.endcolor,restorecolor:b.endcolor,afterFinish:function(){return new Effect.Highlight(c,{duration:1,startcolor:b.endcolor,endcolor:b.startcolor,restorecolor:b.startcolor,afterFinish:function(){if(a<b.cycles){return Effect.Flash(c,b,a+1)}}})}})};Effect.ScaleComprehensive=Class.create(Effect.Scale,{setup:function(){var s,q,y,m,r,t,n,o,h,e,c,b,z,E,C,A,x,w,v,u,a,F,D,B,p,l,j,g,d,f;this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};p=["top","left","width","height","fontSize"];for(h=0,z=p.length;h<z;h++){t=p[h];this.originalStyle[t]=this.element.style[t]}this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;m=this.element.getStyle("font-size")||"100%";l=["em","px","%","pt"];for(e=0,E=l.length;e<E;e++){r=l[e];if(m.indexOf(r)>0){this.fontSize=parseFloat(m);this.fontSizeType=r}}this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;if(this.options.scaleMode==="box"){this.dims={height:this.element.offsetHeight,width:this.element.offsetWidth}}if(/^content/.test(this.options.scaleMode)){this.dims={height:this.element.scrollHeight,width:this.element.scrollWidth}}if(!this.dims){this.dims={height:this.options.scaleMode.originalHeight,width:this.options.scaleMode.originalWidth}}this.full_height=this.dims.height;this.full_width=this.dims.width;q=["border%sWidth","margin%s","padding%s"];for(c=0,C=q.length;c<C;c++){n=q[c];j=["Top","Bottom","Left","Right"];for(b=0,A=j.length;b<A;b++){y=j[b];o=n.format(y);this.dims[o]=parseFloat(this.element.getStyle(o));if(y==="Top"||y==="Bottom"){this.full_height+=this.dims[o]}else{this.full_width+=this.dims[o]}}}this.attrs_vertical=[];this.attrs_horizontal=[];if(this.options.scaleX){for(a=0,x=q.length;a<x;a++){s=q[a];this.attrs_horizontal.push(s.format("Left"))}this.attrs_horizontal.push("width");g=q.reverse();for(F=0,w=g.length;F<w;F++){s=g[F];this.attrs_horizontal.push(s.format("Right"))}}if(this.options.scaleY){for(D=0,v=q.length;D<v;D++){s=q[D];this.attrs_vertical.push(s.format("Top"))}this.attrs_vertical.push("height");d=q.reverse();f=[];for(B=0,u=d.length;B<u;B++){s=d[B];f.push(this.attrs_vertical.push(s.format("Bottom")))}return f}},update:function(a){var b;b=(this.options.scaleFrom/100)+(this.factor*a);b=(-0.5+1/(1+Math.exp((0.5-b)*7)))*1.055+0.5;if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*b+this.fontSizeType})}return this.setDimensions(b)},setDimensions:function(f){var l,o,m,j,k,b,g,e,n,a,h,c;m={};h=[[this.full_width,this.attrs_horizontal],[this.full_height,this.attrs_vertical]];for(g=0,n=h.length;g<n;g++){c=h[g],j=c[0],o=c[1];k=j*f;for(e=0,a=o.length;e<a;e++){l=o[e];b=this.dims[l];if(b<k){m[l]=b+"px";k-=b}else{m[l]=k.round()+"px";k=0}}}return this.element.setStyle(m)}});Effect.BlindUpComprehensive=function(a){a=$(a);a.makeClipping();return new Effect.ScaleComprehensive(a,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(b){return b.element.hide().undoClipping()}},arguments[1]||{}))};Effect.BlindDownComprehensive=function(b){var a;b=$(b);a=b.getDimensions();return new Effect.ScaleComprehensive(b,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:a.height,originalWidth:a.width},restoreAfterFinish:true,afterSetup:function(c){return c.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(c){return c.element.undoClipping()}},arguments[1]||{}))};Effect.HighlightForcedWithAlpha=Class.create(Effect.Highlight,{setup:function(){var k,h,c,g,j,d,l,f,b,a;this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color")}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color")}this._supports_alpha=false;try{h=new Element("div");j="rgba(1, 1, 1, 0)";h.setStyle({backgroundColor:j});this._supports_alpha=(h.getStyle("background-color"))===j}catch(m){}this._base=parse_color_to_rgba(this.options.startcolor);if((f=this.options.endcolor)==="transparent"||f==="rgba(0, 0, 0, 0)"){if(this._supports_alpha){c=this._base.slice(0);c[3]=0}else{c=[255,255,255,1]}}else{c=parse_color_to_rgba(this.options.endcolor)}this._delta=[];b=this._base;a=[];for(g=d=0,l=b.length;d<l;g=++d){k=b[g];a.push(this._delta.push(c[g]-k))}return a},update:function(a){var h,c,g,d,f,b,e;g=[];e=this._base;for(d=f=0,b=e.length;f<b;d=++f){h=e[d];c=h+this._delta[d]*a;if(!(d>2)){c=Math.round(c)}g.push(c)}if(this._supports_alpha){return this.element.setStyle({backgroundColor:"rgba("+(g.join(", "))+")"})}else{return this.element.setStyle({backgroundColor:"rgb("+(g.slice(0,3).join(", "))+")"})}}});parse_color_to_rgba=function(c){var d,g,f,e,a,b,h,k,j;b=/^rgb\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3})\)$/;a=/^rgba\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3}), ?(\d+?\.?\d*)\)$/;e=/^#([0-9A-F])([0-9A-F])([0-9A-F])$/i;g=/^#([0-9A-F])([0-9A-F])([0-9A-F])([0-9A-F])$/i;f=/^#([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])$/i;d=/^#([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])$/i;if(k=c.match(b)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c,10))}return l})()}else{if(k=c.match(a)){j=(function(){var o,m,n,l;n=k.slice(1,4);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c,10))}return l})();j[3]=parseFloat(k[4])}else{if(k=c.match(e)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c+c,16))}return l})()}else{if(k=c.match(g)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c+c,16))}return l})()}else{if(k=c.match(f)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c,16))}return l})()}else{if(k=c.match(d)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c,16))}return l})()}}}}}}j=j||[255,255,255,1];h=j.length;if(h===3){j.push(1)}else{if(h===4&&j[h-1]>1){j[h-1]=j[h-1]/255}}return j};var ClientDownload;ClientDownload=(function(){function a(){}a.prototype.show_download_modal=function(){return new Ajax.DBRequest("/download_modal_view",{onSuccess:function(b){var c;c=new Element("div",{"class":"brodal-header"});c.__sert(_("Install Dropbox"));return Modal.show(c,$("client-download"),{},false,450)}})};return a})();var WebTimingLogger;WebTimingLogger={init:function(){if(!Constants.WEB_TIMING_ENABLED||!window.performance){return}return Util.smart_window_load(function(){return WebTimingLogger._log_navigation.defer()})},_log_navigation:function(){var b,c,a;a=window.performance&&window.performance.timing;if(!a){return}c=a.navigationStart||a.fetchStart;if(!c){return}b={navigation_type:WebTimingLogger._get_navigation_type(),redirect_time:a.fetchStart-c,connect_time:a.requestStart-c,time_to_first_byte:a.responseStart-c,dom_load_time:a.domContentLoadedEventEnd-c,page_load_time:a.loadEventEnd-c};return WebTimingLogger._log(b)},log_ajax_transition:function(e,a,c,b){var d;d={navigation_type:"ajax",page_load_time:e};if(c!=null){d.extra_columns=Util.to_json(c)}if(b!=null){d.stopwatch_suffix=b}return WebTimingLogger._log(d,a)},log_ajax_transition_batch:function(e,b,a,c){var d;d={page_load_times:Util.to_json(e)};if(a!=null){d.list_of_extra_columns_dicts=Util.to_json(a)}if(c!=null){d.stopwatch_suffix=c}return WebTimingLogger._log(d,b,"/log_ajax_transition_batch")},_log:function(b,a,c){if(c==null){c="/web_timing_log"}if(!Constants.WEB_TIMING_ENABLED){return}b.url=window.location.href;b.source_type="web";if(a){b.url_info=a}return new Ajax.DBRequest(c,{noAutonotify:true,parameters:b})},_get_navigation_type:function(){switch(window.performance.navigation.type){case 0:return"navigate";case 1:return"reload";case 2:return"back_forward"}}};var HiRes,_this=this;HiRes=(function(){var a;a=false;if("devicePixelRatio" in window&&window.devicePixelRatio>1){a=true}return{init:function(){var j,h,f,e,d,g,b,c;if(!a){return}g=$$("[data-hi-res]");for(h=0,e=g.length;h<e;h++){j=g[h];this._replace(j,j.readAttribute("data-hi-res"),this._replace_img)}b=$$("[data-hi-res-background]");c=[];for(f=0,d=b.length;f<d;f++){j=b[f];c.push(this._replace(j,j.readAttribute("data-hi-res-background"),this._replace_background))}return c},get_background:function(c,b){if(!a){return}return this._replace(c,b,this._replace_background)},_replace:function(e,c,d){var b;if(!c){return}b=new Image();b.src=c;return b.observe("load",function(){return d(e,c)})},_replace_img:function(c,b){return c.src=b},_replace_background:function(d,b){var c;c="url('%(src)s')".format({src:b});return d.setStyle({backgroundImage:c})}}})();Util.smartLoad(function(){return HiRes.init()});var TwoFactorAuth;TwoFactorAuth={_checkpoint_token:null,_email:null,_container_selector:null,_error_selector:null,_is_offline_setup:null,_invalid_code_count:null,login_init:function(){this._container_selector="#twofactor-confirm";this._error_selector="#twofactor-confirm .error-message";return this.login_listen()},login_listen:function(){var a;if((a=$("resend-link"))!=null){a.observe("click",this.resend_phone_code.bind(this))}return $("code").focus()},account_init:function(b){var e,d,a,c;this._email=b;this._container_selector=".twofactor-account-form";this._error_selector=".twofactor-account-form .error-message";c=$$(".email-placeholder");for(d=0,a=c.length;d<a;d++){e=c[d];e.__date(b)}this.account_listen();return Util.async_load_script("/static/javascript/external/phone_helpers.js")},account_listen:function(){var e,c,a,b,d=this;b=$$("#enable-twofactor, #disable-twofactor, #toggle-qr");for(c=0,a=b.length;c<a;c++){e=b[c];e.observe("click",function(f){return f.preventDefault()})}$("enable-twofactor").observe("click",this.show_enable_start.bind(this));$("disable-twofactor").observe("click",this.disable_show_enter_password.bind(this));$("twofactor-start").observe("submit",this.show_enter_password.bind(this));$("twofactor-enter-password").observe("submit",this.submit_password.bind(this));$("twofactor-delivery-choice").observe("submit",this.submit_delivery_choice.bind(this));$("twofactor-offline-setup").observe("submit",this.show_confirm_phone.bind(this));$("twofactor-enter-phone").observe("submit",this.submit_phone_number.bind(this));$("twofactor-enable-confirm").observe("submit",this.submit_phone_code.bind(this));$("twofactor-recovery").observe("submit",this.submit_finish.bind(this));$("twofactor-done").observe("submit",this.close_modal.bind(this));$("country-code").observe("change",this.reset_phone_field.bind(this));$("resend-link").observe("click",this.enable_resend_phone_code.bind(this));$$("#twofactor-enter-phone .backbutton")[0].observe("click",this.show_delivery_choice.bind(this));$$("#twofactor-offline-setup .backbutton")[0].observe("click",this.show_delivery_choice.bind(this));$$("#twofactor-enable-confirm .backbutton")[0].observe("click",function(f){if(d._is_offline_setup){return d.show_offline_setup(f)}else{return d.show_enter_phone_number(f)}});$$("#twofactor-recovery .backbutton")[0].observe("click",this.close_modal.bind(this));jQuery("#twofactor-delivery-choice input").change(function(){jQuery(".delivery-choice").removeClass("selected");return jQuery(this).parents(".delivery-choice").addClass("selected")});$("show-qr").observe("click",function(f){Event.stop(f);return $("twofactor-offline-setup").addClassName("showing-qr")});$("hide-qr").observe("click",function(f){Event.stop(f);return $("twofactor-offline-setup").removeClassName("showing-qr")});$("twofactor-disable-enter-password").observe("submit",this.disable_submit_password.bind(this));$("twofactor-disable").observe("submit",this.disable_submit.bind(this));return $("cancel-button").observe("click",Modal.hide)},connect_login_init:function(){this._container_selector="#twofactor-form";this._error_selector="#twofactor-form .error";return this.connect_login_listen()},connect_login_listen:function(){return $("resend-link").observe("click",this.connect_resend_phone_code.bind(this))},resend_phone_code:function(a){var b=this;Event.stop(a);if(this.is_resending()){return}this.show_resending();return new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(c){switch(c.responseText.strip()){case"OK":b.hide_error();return b.notify_resent();case"UNREACHABLE":return b.show_error_unreachable();case"BADCARRIER":return b.show_error_bad_carrier();case"INVALIDNUMBER":return b.show_error_invalid_number();case"NOTAMOBILE":return b.show_error_not_a_mobile();case"RATELIMIT":return Notify.server_error(_("You've asked for too many SMS messages. Please try again in a few minutes."));case"EXPIRED":return $("twofactor-confirm").submit()}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_resending_with_delay.bind(this)})},connect_resend_phone_code:function(a){var b=this;Event.stop(a);if(this.is_resending()){return}this.show_resending();return new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(c){switch(c.responseText.strip()){case"OK":b.hide_error();return b.notify_resent();case"UNREACHABLE":return Notify.server_error(error_unreachable());case"BADCARRIER":return Notify.server_error(error_bad_carrier());case"INVALIDNUMBER":return b.show_error_invalid_number();case"NOTAMOBILE":return Notify.server_error(error_not_a_mobile());case"RATELIMIT":return Notify.server_error(_("You've asked for too many SMS messages. Please try again in a few minutes."));case"EXPIRED":return $("twofactor-form").submit()}},onFailure:function(c){return Notify.server_error(b.error500())},cleanUp:this.hide_resending_with_delay.bind(this)})},DEFAULT_ENABLE_TITLE:_("Enable two-step verification"),DEFAULT_DISABLE_TITLE:_("Disable two-step verification"),LOCK_ICON:"lock32",show_enable_start:function(){var a;this.hide_error();a=$("twofactor-start");return Modal.icon_show(this.LOCK_ICON,this.DEFAULT_ENABLE_TITLE,a)},show_enter_password:function(b){var a;Event.stop(b);this.hide_error();a=$("twofactor-enter-password");Modal.icon_show(this.LOCK_ICON,this.DEFAULT_ENABLE_TITLE,a);return $("password").clear().focus()},submit_password:function(b){var a,c=this;Event.stop(b);a=$("password").getValue();if(!a){this.show_error(_("Please enter your password"));return}this.show_loading();return new Ajax.DBRequest("/account/twofactor/confirm_password",{parameters:{password:a},onSuccess:function(d){var e;e=d.responseText.strip();if(e.startsWith("OK:")){c._checkpoint_token=e.substr(3);return c.show_delivery_choice()}else{switch(e){case"EXPIRED_PASSWORD":return c.show_error_expired_password();case"INVALID":return c.show_error(_("Invalid password"));case"RATELIMIT":return c.show_error(_("Too many incorrect passwords. Please try again in a few minutes."));case"ALREADY_ENABLED":$("twofactor-row").addClassName("twofactor-enabled");Notify.server_success("Two-step verification is already enabled. Did you maybe enable it in another window?");return Modal.hide()}}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},show_delivery_choice:function(){var b,a;this.hide_error();b=$("twofactor-delivery-choice");Modal.icon_show(this.LOCK_ICON,this.DEFAULT_ENABLE_TITLE,b);a=0;jQuery(".delivery-choice").each(function(){var c;c=jQuery(this).height();return a=Math.max(c,a)});jQuery(".delivery-choice").height(a);return jQuery(".delivery-choice.selected > input").attr("checked","true")},submit_delivery_choice:function(a){Event.stop(a);if($("use-sms").getValue()==="on"){return this.show_enter_phone_number()}else{return this.fetch_offline_key()}},show_offline_setup:function(){var a;this.hide_error();this._is_offline_setup=true;a=$("twofactor-offline-setup");return Modal.icon_show(this.LOCK_ICON,this.DEFAULT_ENABLE_TITLE,a)},fetch_offline_key:function(){var a=this;this.show_loading();return new Ajax.DBRequest("/account/twofactor/add_phone",{parameters:{checkpoint_token:this._checkpoint_token,offline:true},onSuccess:function(b){var c;c=b.responseText.strip();if(c.startsWith("OK:")){a.fill_key(c.substr(3));return a.show_offline_setup()}else{switch(c){case"EXPIRED":a.show_enter_password();return a.show_error_expired()}}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},fill_key:function(b){var a,d,c;b=b.replace(new RegExp("=+$"),"");a=b.toLowerCase().replace(/(.{4})/g,"$1 ");$("secret-div").__date(a);$("qr-div").__date();c=Constants.IS_PROD?"Dropbox":"DropboxDev";d={text:"otpauth://totp/"+c+":"+this._email+"?secret="+b,width:200,height:200};if(!Modernizr.canvas){d.render="table"}jQuery("#qr-div").qrcode(d);if(!Modernizr.canvas){return jQuery("#qr-div > table").css("margin","0 auto")}},show_enter_phone_number:function(){var a;this.hide_error();this._is_offline_setup=false;a=$("twofactor-enter-phone");Modal.icon_show(this.LOCK_ICON,this.DEFAULT_ENABLE_TITLE,a);return $("phone-number").clear().focus()},submit_phone_number:function(d){var b,c,a,f=this;Event.stop(d);b=$("country-code").getValue().strip();a=$("phone-number").getValue().strip();if(!a){this.show_error(_("Please enter your phone number"));return}a=a.replace(/\D/g,"");c=""+b+" "+a;if(typeof phone_helpers!=="undefined"&&phone_helpers!==null){if(!phone_helpers.is_valid(c)){this.show_error(_("Invalid phone number"));return}}else{if(b==="+1"){if(a.length!==10){this.show_error(_("Invalid phone number"));return}}else{if(!(a.length>=4)){this.show_error(_("Invalid phone number"));return}}}this.show_loading();return new Ajax.DBRequest("/account/twofactor/add_phone",{parameters:{checkpoint_token:this._checkpoint_token,phone_number:c},onSuccess:function(g){var e;switch(g.responseText.strip()){case"OK":e=typeof phone_helpers!=="undefined"&&phone_helpers!==null?""+b+" "+(phone_helpers.format(b,a)):c;return f.show_confirm_phone(null,e);case"EXPIRED":f.show_enter_password();return f.show_error_expired();case"UNREACHABLE":return f.show_error_unreachable();case"BADCARRIER":return f.show_error_bad_carrier();case"INVALIDNUMBER":return f.show_error_invalid_number();case"NOTAMOBILE":return f.show_error_not_a_mobile();case"RATELIMIT":return f.show_error(_("You've added too many phone numbers. Please try again in a few minutes."))}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},show_confirm_phone:function(c,a){var b;Event.stop(c);this._invalid_code_count=0;if(this._is_offline_setup){$("twofactor-enable-confirm").addClassName("offline")}else{assert(a,"expected a display_phone argument");$("phone-number-placeholder").__date(a);$("twofactor-enable-confirm").removeClassName("offline")}this.hide_error();b=$("twofactor-enable-confirm");Modal.icon_show(this.LOCK_ICON,this.DEFAULT_ENABLE_TITLE,b);return $("phone-code").clear().focus()},submit_phone_code:function(b){var a,c=this;Event.stop(b);a=$("phone-code").getValue().strip();if(!a){this.show_error(_("Please enter the security code"));return}if(a.search(/^\d{6}$/)===-1){this.show_error(_("Invalid security code"));return}this.show_loading();return new Ajax.DBRequest("/account/twofactor/confirm_phone",{parameters:{checkpoint_token:this._checkpoint_token,twofactor_code:a},onSuccess:function(d){var f,e;e=d.responseText.strip();if(e.startsWith("OK:")){c.fill_recovery_code(e.substr(3));return c.show_recovery()}else{switch(e){case"INVALID":c._invalid_code_count+=1;f=c._invalid_code_count<=2?_("Invalid code"):c._is_offline_setup?_("Invalid code. Check the clock on your phone: it must be accurate to the minute."):_("Invalid code");return c.show_error(f);case"EXPIRED":c.show_enter_password();return c.show_error_expired();case"RATELIMIT":return c.show_error(_("Too many invalid codes. Try again in a few minutes."))}}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},enable_resend_phone_code:function(a){var b=this;Event.stop(a);if(this.is_resending()){return}this.show_resending();return new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(c){switch(c.responseText.strip()){case"OK":b.hide_error();return b.notify_resent();case"UNREACHABLE":return b.show_error_unreachable();case"BADCARRIER":return b.show_error_bad_carrier();case"INVALIDNUMBER":return b.show_error_invalid_number();case"NOTAMOBILE":return b.show_error_not_a_mobile();case"RATELIMIT":return Notify.server_error("You've asked for too many SMS messages. Please try again in a few minutes.");case"EXPIRED":b.show_enter_password();return b.show_error_expired()}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_resending_with_delay.bind(this)})},fill_recovery_code:function(a){a=a.toLowerCase().replace(/(.{4})/g,"$1 ");return $("backup-code-div").__date(a)},show_recovery:function(b){var a;this.hide_error();Event.stop(b);a=$("twofactor-recovery");return Modal.icon_show(this.LOCK_ICON,this.DEFAULT_ENABLE_TITLE,a)},submit_finish:function(a){var b=this;Event.stop(a);this.show_loading();return new Ajax.DBRequest("/account/twofactor/enable_finish",{parameters:{checkpoint_token:this._checkpoint_token},onSuccess:function(c){switch(c.responseText.strip()){case"OK":return b.show_done();case"EXPIRED":b.show_enter_password();return b.show_error_expired()}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},show_done:function(){var a,b;this._checkpoint_token=null;this.hide_error();$("twofactor-row").addClassName("twofactor-enabled");a=$("twofactor-done");b=_("Congrats! You've enabled two-step verification!");return Modal.icon_show(this.LOCK_ICON,b,a)},close_modal:function(a){Event.stop(a);return Modal.hide()},disable_show_enter_password:function(){var a;this.hide_error();a=$("twofactor-disable-enter-password");Modal.icon_show(this.LOCK_ICON,this.DEFAULT_DISABLE_TITLE,a);return $("password").clear().focus()},disable_submit_password:function(b){var a,c=this;Event.stop(b);a=$("password").getValue();if(!a){this.show_error(_("Please enter your password"));return}this.show_loading();return new Ajax.DBRequest("/account/twofactor/disable_confirm_password",{parameters:{password:a},onSuccess:function(d){var e;e=d.responseText.strip();if(e.startsWith("OK:")){c._checkpoint_token=e.substr(3);return c.disable_show()}else{switch(e){case"EXPIRED_PASSWORD":return c.show_error_expired_password();case"INVALID":return c.show_error(_("Invalid password"));case"RATELIMIT":return c.show_error(_("Too many incorrect passwords. Please try again in a few minutes."));case"ALREADY_DISABLED":$("twofactor-row").removeClassName("twofactor-enabled");Notify.server_success("Two-step verification is already disabled. Did you maybe disable it in another window?");return Modal.hide()}}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},disable_show:function(){var a;this.hide_error();a=$("twofactor-disable");return Modal.icon_show(this.LOCK_ICON,this.DEFAULT_DISABLE_TITLE,a)},disable_submit:function(a){var b=this;Event.stop(a);this.show_loading();return new Ajax.DBRequest("/account/twofactor/disable",{parameters:{checkpoint_token:this._checkpoint_token},onSuccess:function(c){switch(c.responseText.strip()){case"OK":b._checkpoint_token=null;$("twofactor-row").removeClassName("twofactor-enabled");Notify.server_success(_("Two-step verification is now disabled."));return Modal.hide();case"EXPIRED":b.disable_show_enter_password();return b.show_error_expired()}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},show_error:function(b){var a;a=$$(this._error_selector);if(b===this.error_expired_password()){a.invoke("update",b)}else{a.invoke("__date",b)}return a.invoke("show")},show_error500:function(){return this.show_error(this.error_500())},show_error_bad_carrier:function(){return this.show_error(this.error_bad_carrier())},show_error_invalid_number:function(){return this.show_error(this.error_invalid_number())},show_error_not_a_mobile:function(){return this.show_error(this.error_not_a_mobile())},show_error_unreachable:function(){return this.show_error(this.error_unreachable())},show_error_expired:function(){return this.show_error(this.error_expired())},show_error_expired_password:function(){return this.show_error(this.error_expired_password())},error_500:function(){return _("Sorry, an error occurred. Please try again later.")},error_bad_carrier:function(){return _("Unfortunately, your carrier is not supported at this time.")},error_invalid_number:function(){return _("That is not a valid phone number.")},error_not_a_mobile:function(){return _("That phone number does not appear to be a valid mobile number.")},error_unreachable:function(){return _("We couldn't reach your phone number. Are you sure it's correct?")},error_expired:function(){return _("Since it's been a while, please enter your password again.")},error_expired_password:function(){return _('Your password has expired. Please create a new password <a target="_blank" href="/password_expired">here</a>.')},hide_error:function(){return $$(this._error_selector).invoke("__date")},show_loading:function(){this.hide_error();return $$(this._container_selector).invoke("addClassName","loading")},hide_loading:function(){return $$(this._container_selector).invoke("removeClassName","loading")},is_resending:function(){return $$(this._container_selector)[0].hasClassName("resending")},show_resending:function(){return $$(this._container_selector).invoke("addClassName","resending")},hide_resending:function(){return $$(this._container_selector).invoke("removeClassName","resending")},hide_resending_with_delay:function(){return setTimeout(this.hide_resending.bind(this),3000)},notify_resent:function(){return Notify.server_success(_("We sent you another code. Keep in mind that it might take a few minutes."))},reset_phone_field:function(){var b,a;b=$("country-code").getValue().substr(1);$$("#phone-number-field input")[0].setValue("").focus();if(typeof phone_helpers==="undefined"||phone_helpers===null){return}a=phone_helpers.get_example_mobile_number(b);return $$("#phone-number-field label")[0].__date("Example: "+a)}};var DBLocalStorage,PseudoLocalStorage,dbstore;PseudoLocalStorage={_store:{},getItem:function(a){return this._store[a]},setItem:function(a,b){return this._store[a]=b},removeItem:function(a){return delete this._store[a]},clear:function(){return this._store={}}};dbstore=Modernizr.localstorage?window.localStorage:PseudoLocalStorage;DBLocalStorage={_access_order_key:"ao",_get_access_order:function(){var a;a=dbstore.getItem(this._access_order_key);try{a=Util.from_json(a)}catch(b){a=[]}if(a instanceof Array){return a}else{return[]}},_to_key:function(a){return Util.to_json(a)},attemptWrite:function(g,d){var j,c,e,h,f,k,b;j=0;c=10;f=0;b=[];while(j<c&&!f){e=this._get_access_order();e.push(g);try{dbstore.setItem(g,d);dbstore.setItem(this._access_order_key,Util.to_json(e));f=1}catch(a){h=this._get_access_order();if(h.length){k=h.shift();dbstore.removeItem(k);dbstore.setItem(this._access_order_key,Util.to_json(h))}else{dbstore.clear()}}b.push(j+=1)}return b},getItem:function(b){var c,a,d;b=this._to_key(b);d=dbstore.getItem(b);if(d){c=this._get_access_order();c.removeItem(b);c.push(b);dbstore.setItem(this._access_order_key,Util.to_json(c));a=Util.from_json(d);return a}},setItem:function(a,b){return this.attemptWrite(this._to_key(a),Util.to_json(b))},removeItem:function(a){var b;a=this._to_key(a);b=this._get_access_order();b.removeItem(a);dbstore.setItem(this._access_order_key,Util.to_json(b));return dbstore.removeItem(a)},clear:function(){return dbstore.clear()}};var handler,listener,_i,_j,_len,_len1,_ref,_ref1;Util.smart_window_load(function(){var b,a;b=$("footer");if(b){a=(b.getStyle("display")==="none")||(b.getWidth()<900);if(!a){return assert(false,"HTML Broken on "+window.location.pathname)}}});if(window._document_observe_listeners){_ref=window._document_observe_listeners;for(_i=0,_len=_ref.length;_i<_len;_i++){listener=_ref[_i];if(document.loaded){listener.func()}else{document.observe(listener.event,listener.func)}}}if(window._jquery_ready_handlers){_ref1=window._jquery_ready_handlers;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){handler=_ref1[_j];jQuery(handler)}}Util.smartLoad(function(){Event.fire(document,"script:loaded");return $(document.body).removeClassName("deferred-resources")});window.LoadedJsSuccessfully=true;